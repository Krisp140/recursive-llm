# Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- packages/react-devtools-shared/src/devtools/views/DevTools.js

commit ec7ef50e8b7a61639d5b622e9e675602120e2e96
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 13 11:37:25 2019 -0700

    Reorganized things again into packages

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
new file mode 100644
index 0000000000..44d48b6131
--- /dev/null
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -0,0 +1,160 @@
+// @flow
+
+// Reach styles need to come before any component styles.
+// This makes overridding the styles simpler.
+import '@reach/menu-button/styles.css';
+import '@reach/tooltip/styles.css';
+
+import React, { useMemo, useState } from 'react';
+import Store from '../store';
+import { BridgeContext, StoreContext } from './context';
+import Components from './Components/Components';
+import Profiler from './Profiler/Profiler';
+import TabBar from './TabBar';
+import { SettingsContextController } from './Settings/SettingsContext';
+import { TreeContextController } from './Components/TreeContext';
+import ViewElementSourceContext from './Components/ViewElementSourceContext';
+import { ProfilerContextController } from './Profiler/ProfilerContext';
+import { ModalDialogContextController } from './ModalDialog';
+import ReactLogo from './ReactLogo';
+import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
+import ShowWelcomeToTheNewDevToolsDialog from './ShowWelcomeToTheNewDevToolsDialog';
+
+import styles from './DevTools.css';
+
+import './root.css';
+
+import type { InspectedElement } from 'src/devtools/views/Components/types';
+import type { FrontendBridge } from 'src/bridge';
+
+export type BrowserTheme = 'dark' | 'light';
+export type TabID = 'components' | 'profiler';
+export type ViewElementSource = (
+  id: number,
+  inspectedElement: InspectedElement
+) => void;
+export type CanViewElementSource = (
+  inspectedElement: InspectedElement
+) => boolean;
+
+export type Props = {|
+  bridge: FrontendBridge,
+  browserTheme?: BrowserTheme,
+  canViewElementSourceFunction?: ?CanViewElementSource,
+  defaultTab?: TabID,
+  showTabBar?: boolean,
+  showWelcomeToTheNewDevToolsDialog?: boolean,
+  store: Store,
+  warnIfLegacyBackendDetected?: boolean,
+  viewElementSourceFunction?: ?ViewElementSource,
+
+  // This property is used only by the web extension target.
+  // The built-in tab UI is hidden in that case, in favor of the browser's own panel tabs.
+  // This is done to save space within the app.
+  // Because of this, the extension needs to be able to change which tab is active/rendered.
+  overrideTab?: TabID,
+
+  // To avoid potential multi-root trickiness, the web extension uses portals to render tabs.
+  // The root <DevTools> app is rendered in the top-level extension window,
+  // but individual tabs (e.g. Components, Profiling) can be rendered into portals within their browser panels.
+  componentsPortalContainer?: Element,
+  profilerPortalContainer?: Element,
+|};
+
+const componentsTab = {
+  id: ('components': TabID),
+  icon: 'components',
+  label: 'Components',
+  title: 'React Components',
+};
+const profilerTab = {
+  id: ('profiler': TabID),
+  icon: 'profiler',
+  label: 'Profiler',
+  title: 'React Profiler',
+};
+
+const tabs = [componentsTab, profilerTab];
+
+export default function DevTools({
+  bridge,
+  browserTheme = 'light',
+  canViewElementSourceFunction = null,
+  defaultTab = 'components',
+  componentsPortalContainer,
+  overrideTab,
+  profilerPortalContainer,
+  showTabBar = false,
+  showWelcomeToTheNewDevToolsDialog = false,
+  store,
+  warnIfLegacyBackendDetected = false,
+  viewElementSourceFunction = null,
+}: Props) {
+  const [tab, setTab] = useState(defaultTab);
+  if (overrideTab != null && overrideTab !== tab) {
+    setTab(overrideTab);
+  }
+
+  const viewElementSource = useMemo(
+    () => ({
+      canViewElementSourceFunction,
+      viewElementSourceFunction,
+    }),
+    [canViewElementSourceFunction, viewElementSourceFunction]
+  );
+
+  return (
+    <BridgeContext.Provider value={bridge}>
+      <StoreContext.Provider value={store}>
+        <ModalDialogContextController>
+          <SettingsContextController
+            browserTheme={browserTheme}
+            componentsPortalContainer={componentsPortalContainer}
+            profilerPortalContainer={profilerPortalContainer}
+          >
+            <ViewElementSourceContext.Provider value={viewElementSource}>
+              <TreeContextController>
+                <ProfilerContextController>
+                  <div className={styles.DevTools}>
+                    {showTabBar && (
+                      <div className={styles.TabBar}>
+                        <ReactLogo />
+                        <span className={styles.DevToolsVersion}>
+                          {process.env.DEVTOOLS_VERSION}
+                        </span>
+                        <div className={styles.Spacer} />
+                        <TabBar
+                          currentTab={tab}
+                          id="DevTools"
+                          selectTab={setTab}
+                          tabs={tabs}
+                          type="navigation"
+                        />
+                      </div>
+                    )}
+                    <div
+                      className={styles.TabContent}
+                      hidden={tab !== 'components'}
+                    >
+                      <Components portalContainer={componentsPortalContainer} />
+                    </div>
+                    <div
+                      className={styles.TabContent}
+                      hidden={tab !== 'profiler'}
+                    >
+                      <Profiler portalContainer={profilerPortalContainer} />
+                    </div>
+                  </div>
+                </ProfilerContextController>
+              </TreeContextController>
+            </ViewElementSourceContext.Provider>
+          </SettingsContextController>
+          {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
+          {showWelcomeToTheNewDevToolsDialog && (
+            <ShowWelcomeToTheNewDevToolsDialog />
+          )}
+        </ModalDialogContextController>
+      </StoreContext.Provider>
+    </BridgeContext.Provider>
+  );
+}

commit 08743b1a8e012c1a36ba99391c6332e462b808b2
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 13 15:59:43 2019 -0700

    Reorganized folders into packages/*

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 44d48b6131..a7e2016ccd 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -24,8 +24,8 @@ import styles from './DevTools.css';
 
 import './root.css';
 
-import type { InspectedElement } from 'src/devtools/views/Components/types';
-import type { FrontendBridge } from 'src/bridge';
+import type { InspectedElement } from 'react-devtools-shared/src/devtools/views/Components/types';
+import type { FrontendBridge } from 'react-devtools-shared/src/bridge';
 
 export type BrowserTheme = 'dark' | 'light';
 export type TabID = 'components' | 'profiler';
@@ -79,7 +79,7 @@ const tabs = [componentsTab, profilerTab];
 export default function DevTools({
   bridge,
   browserTheme = 'light',
-  canViewElementSourceFunction = null,
+  canViewElementSourceFunction,
   defaultTab = 'components',
   componentsPortalContainer,
   overrideTab,
@@ -88,7 +88,7 @@ export default function DevTools({
   showWelcomeToTheNewDevToolsDialog = false,
   store,
   warnIfLegacyBackendDetected = false,
-  viewElementSourceFunction = null,
+  viewElementSourceFunction,
 }: Props) {
   const [tab, setTab] = useState(defaultTab);
   if (overrideTab != null && overrideTab !== tab) {

commit 183f96f2ac35c36772781cb37bc3ce842e2dc78b
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 13 17:58:03 2019 -0700

    Prettier

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index a7e2016ccd..2ba7b4f66d 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -5,17 +5,17 @@
 import '@reach/menu-button/styles.css';
 import '@reach/tooltip/styles.css';
 
-import React, { useMemo, useState } from 'react';
+import React, {useMemo, useState} from 'react';
 import Store from '../store';
-import { BridgeContext, StoreContext } from './context';
+import {BridgeContext, StoreContext} from './context';
 import Components from './Components/Components';
 import Profiler from './Profiler/Profiler';
 import TabBar from './TabBar';
-import { SettingsContextController } from './Settings/SettingsContext';
-import { TreeContextController } from './Components/TreeContext';
+import {SettingsContextController} from './Settings/SettingsContext';
+import {TreeContextController} from './Components/TreeContext';
 import ViewElementSourceContext from './Components/ViewElementSourceContext';
-import { ProfilerContextController } from './Profiler/ProfilerContext';
-import { ModalDialogContextController } from './ModalDialog';
+import {ProfilerContextController} from './Profiler/ProfilerContext';
+import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 import ShowWelcomeToTheNewDevToolsDialog from './ShowWelcomeToTheNewDevToolsDialog';
@@ -24,17 +24,17 @@ import styles from './DevTools.css';
 
 import './root.css';
 
-import type { InspectedElement } from 'react-devtools-shared/src/devtools/views/Components/types';
-import type { FrontendBridge } from 'react-devtools-shared/src/bridge';
+import type {InspectedElement} from 'react-devtools-shared/src/devtools/views/Components/types';
+import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
 
 export type BrowserTheme = 'dark' | 'light';
 export type TabID = 'components' | 'profiler';
 export type ViewElementSource = (
   id: number,
-  inspectedElement: InspectedElement
+  inspectedElement: InspectedElement,
 ) => void;
 export type CanViewElementSource = (
-  inspectedElement: InspectedElement
+  inspectedElement: InspectedElement,
 ) => boolean;
 
 export type Props = {|
@@ -100,7 +100,7 @@ export default function DevTools({
       canViewElementSourceFunction,
       viewElementSourceFunction,
     }),
-    [canViewElementSourceFunction, viewElementSourceFunction]
+    [canViewElementSourceFunction, viewElementSourceFunction],
   );
 
   return (
@@ -110,8 +110,7 @@ export default function DevTools({
           <SettingsContextController
             browserTheme={browserTheme}
             componentsPortalContainer={componentsPortalContainer}
-            profilerPortalContainer={profilerPortalContainer}
-          >
+            profilerPortalContainer={profilerPortalContainer}>
             <ViewElementSourceContext.Provider value={viewElementSource}>
               <TreeContextController>
                 <ProfilerContextController>
@@ -134,14 +133,12 @@ export default function DevTools({
                     )}
                     <div
                       className={styles.TabContent}
-                      hidden={tab !== 'components'}
-                    >
+                      hidden={tab !== 'components'}>
                       <Components portalContainer={componentsPortalContainer} />
                     </div>
                     <div
                       className={styles.TabContent}
-                      hidden={tab !== 'profiler'}
-                    >
+                      hidden={tab !== 'profiler'}>
                       <Profiler portalContainer={profilerPortalContainer} />
                     </div>
                   </div>

commit 30b8ef375610587b8d5714fbfe895ea9c1c9aef0
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed Aug 14 09:24:35 2019 -0700

    Iterated on Webpack configs until I got the inline and shell packages seemingly working

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 2ba7b4f66d..70fa19f596 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -97,8 +97,8 @@ export default function DevTools({
 
   const viewElementSource = useMemo(
     () => ({
-      canViewElementSourceFunction,
-      viewElementSourceFunction,
+      canViewElementSourceFunction: canViewElementSourceFunction || null,
+      viewElementSourceFunction: viewElementSourceFunction || null,
     }),
     [canViewElementSourceFunction, viewElementSourceFunction],
   );

commit 4da836af71f035a25c26814e7f6aa04e0535f4af
Merge: 833f206348 3ad50710a7
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 20 11:34:51 2019 -0700

    Merged changes from 4.0.0 -> 4.0.5 from DevTools fork

diff --cc packages/react-devtools-shared/src/devtools/views/DevTools.js
index 70fa19f596,0000000000..16e15aad07
mode 100644,000000..100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@@ -1,157 -1,0 +1,170 @@@
 +// @flow
 +
 +// Reach styles need to come before any component styles.
 +// This makes overridding the styles simpler.
 +import '@reach/menu-button/styles.css';
 +import '@reach/tooltip/styles.css';
 +
- import React, {useMemo, useState} from 'react';
++import React, {useEffect, useMemo, useState} from 'react';
 +import Store from '../store';
 +import {BridgeContext, StoreContext} from './context';
 +import Components from './Components/Components';
 +import Profiler from './Profiler/Profiler';
 +import TabBar from './TabBar';
 +import {SettingsContextController} from './Settings/SettingsContext';
 +import {TreeContextController} from './Components/TreeContext';
 +import ViewElementSourceContext from './Components/ViewElementSourceContext';
 +import {ProfilerContextController} from './Profiler/ProfilerContext';
 +import {ModalDialogContextController} from './ModalDialog';
 +import ReactLogo from './ReactLogo';
 +import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 +import ShowWelcomeToTheNewDevToolsDialog from './ShowWelcomeToTheNewDevToolsDialog';
 +
 +import styles from './DevTools.css';
 +
 +import './root.css';
 +
 +import type {InspectedElement} from 'react-devtools-shared/src/devtools/views/Components/types';
 +import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
 +
 +export type BrowserTheme = 'dark' | 'light';
 +export type TabID = 'components' | 'profiler';
 +export type ViewElementSource = (
 +  id: number,
 +  inspectedElement: InspectedElement,
 +) => void;
 +export type CanViewElementSource = (
 +  inspectedElement: InspectedElement,
 +) => boolean;
 +
 +export type Props = {|
 +  bridge: FrontendBridge,
 +  browserTheme?: BrowserTheme,
 +  canViewElementSourceFunction?: ?CanViewElementSource,
 +  defaultTab?: TabID,
 +  showTabBar?: boolean,
 +  showWelcomeToTheNewDevToolsDialog?: boolean,
 +  store: Store,
 +  warnIfLegacyBackendDetected?: boolean,
 +  viewElementSourceFunction?: ?ViewElementSource,
 +
 +  // This property is used only by the web extension target.
 +  // The built-in tab UI is hidden in that case, in favor of the browser's own panel tabs.
 +  // This is done to save space within the app.
 +  // Because of this, the extension needs to be able to change which tab is active/rendered.
 +  overrideTab?: TabID,
 +
 +  // To avoid potential multi-root trickiness, the web extension uses portals to render tabs.
 +  // The root <DevTools> app is rendered in the top-level extension window,
 +  // but individual tabs (e.g. Components, Profiling) can be rendered into portals within their browser panels.
 +  componentsPortalContainer?: Element,
 +  profilerPortalContainer?: Element,
 +|};
 +
 +const componentsTab = {
 +  id: ('components': TabID),
 +  icon: 'components',
 +  label: 'Components',
 +  title: 'React Components',
 +};
 +const profilerTab = {
 +  id: ('profiler': TabID),
 +  icon: 'profiler',
 +  label: 'Profiler',
 +  title: 'React Profiler',
 +};
 +
 +const tabs = [componentsTab, profilerTab];
 +
 +export default function DevTools({
 +  bridge,
 +  browserTheme = 'light',
 +  canViewElementSourceFunction,
 +  defaultTab = 'components',
 +  componentsPortalContainer,
 +  overrideTab,
 +  profilerPortalContainer,
 +  showTabBar = false,
 +  showWelcomeToTheNewDevToolsDialog = false,
 +  store,
 +  warnIfLegacyBackendDetected = false,
 +  viewElementSourceFunction,
 +}: Props) {
 +  const [tab, setTab] = useState(defaultTab);
 +  if (overrideTab != null && overrideTab !== tab) {
 +    setTab(overrideTab);
 +  }
 +
 +  const viewElementSource = useMemo(
 +    () => ({
 +      canViewElementSourceFunction: canViewElementSourceFunction || null,
 +      viewElementSourceFunction: viewElementSourceFunction || null,
 +    }),
 +    [canViewElementSourceFunction, viewElementSourceFunction],
 +  );
 +
++  useEffect(
++    () => {
++      return () => {
++        try {
++          bridge.shutdown();
++        } catch (error) {
++          // Attempting to use a disconnected port.
++        }
++      };
++    },
++    [bridge],
++  );
++
 +  return (
 +    <BridgeContext.Provider value={bridge}>
 +      <StoreContext.Provider value={store}>
 +        <ModalDialogContextController>
 +          <SettingsContextController
 +            browserTheme={browserTheme}
 +            componentsPortalContainer={componentsPortalContainer}
 +            profilerPortalContainer={profilerPortalContainer}>
 +            <ViewElementSourceContext.Provider value={viewElementSource}>
 +              <TreeContextController>
 +                <ProfilerContextController>
 +                  <div className={styles.DevTools}>
 +                    {showTabBar && (
 +                      <div className={styles.TabBar}>
 +                        <ReactLogo />
 +                        <span className={styles.DevToolsVersion}>
 +                          {process.env.DEVTOOLS_VERSION}
 +                        </span>
 +                        <div className={styles.Spacer} />
 +                        <TabBar
 +                          currentTab={tab}
 +                          id="DevTools"
 +                          selectTab={setTab}
 +                          tabs={tabs}
 +                          type="navigation"
 +                        />
 +                      </div>
 +                    )}
 +                    <div
 +                      className={styles.TabContent}
 +                      hidden={tab !== 'components'}>
 +                      <Components portalContainer={componentsPortalContainer} />
 +                    </div>
 +                    <div
 +                      className={styles.TabContent}
 +                      hidden={tab !== 'profiler'}>
 +                      <Profiler portalContainer={profilerPortalContainer} />
 +                    </div>
 +                  </div>
 +                </ProfilerContextController>
 +              </TreeContextController>
 +            </ViewElementSourceContext.Provider>
 +          </SettingsContextController>
 +          {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
 +          {showWelcomeToTheNewDevToolsDialog && (
 +            <ShowWelcomeToTheNewDevToolsDialog />
 +          )}
 +        </ModalDialogContextController>
 +      </StoreContext.Provider>
 +    </BridgeContext.Provider>
 +  );
 +}

commit 8e1434e80e203ebd2cd066772d68f121808c83aa
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 27 10:54:01 2019 -0700

    Added FB copyright header

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 16e15aad07..f73e0848e6 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -1,4 +1,11 @@
-// @flow
+/**
+ * Copyright (c) Facebook, Inc. and its affiliates.
+ *
+ * This source code is licensed under the MIT license found in the
+ * LICENSE file in the root directory of this source tree.
+ *
+ * @flow
+ */
 
 // Reach styles need to come before any component styles.
 // This makes overridding the styles simpler.

commit 206d61f72214e8ae5b935f0bf8628491cb7f0797
Author: Alex Rohleder <alex+github@alexrohleder.com>
Date:   Fri Sep 6 16:47:44 2019 +0200

    fix typos on react-devtools comments (#16681)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index f73e0848e6..5787a11aeb 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -8,7 +8,7 @@
  */
 
 // Reach styles need to come before any component styles.
-// This makes overridding the styles simpler.
+// This makes overriding the styles simpler.
 import '@reach/menu-button/styles.css';
 import '@reach/tooltip/styles.css';
 

commit 4ddcb8e1344630a63c10790d8e24e1194a1abdce
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Sep 19 16:41:18 2019 +0100

    [DevTools] Remove Welcome dialog (#16834)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 5787a11aeb..89b275cffd 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -25,7 +25,6 @@ import {ProfilerContextController} from './Profiler/ProfilerContext';
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
-import ShowWelcomeToTheNewDevToolsDialog from './ShowWelcomeToTheNewDevToolsDialog';
 
 import styles from './DevTools.css';
 
@@ -50,7 +49,6 @@ export type Props = {|
   canViewElementSourceFunction?: ?CanViewElementSource,
   defaultTab?: TabID,
   showTabBar?: boolean,
-  showWelcomeToTheNewDevToolsDialog?: boolean,
   store: Store,
   warnIfLegacyBackendDetected?: boolean,
   viewElementSourceFunction?: ?ViewElementSource,
@@ -92,7 +90,6 @@ export default function DevTools({
   overrideTab,
   profilerPortalContainer,
   showTabBar = false,
-  showWelcomeToTheNewDevToolsDialog = false,
   store,
   warnIfLegacyBackendDetected = false,
   viewElementSourceFunction,
@@ -167,9 +164,6 @@ export default function DevTools({
             </ViewElementSourceContext.Provider>
           </SettingsContextController>
           {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
-          {showWelcomeToTheNewDevToolsDialog && (
-            <ShowWelcomeToTheNewDevToolsDialog />
-          )}
         </ModalDialogContextController>
       </StoreContext.Provider>
     </BridgeContext.Provider>

commit b6606ecba80b591ea66db1e2ee1fed72befb4c32
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Sep 26 08:41:46 2019 -0700

    DevTools shows unsupported renderer version dialog (#16897)
    
    * DevTools shows unsupported renderer version dialog
    
    * Optimistic CHANGELOG udpate

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 89b275cffd..229a750adb 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -24,6 +24,7 @@ import ViewElementSourceContext from './Components/ViewElementSourceContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
+import UnsupportedVersionDialog from './UnsupportedVersionDialog';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 
 import styles from './DevTools.css';
@@ -51,6 +52,7 @@ export type Props = {|
   showTabBar?: boolean,
   store: Store,
   warnIfLegacyBackendDetected?: boolean,
+  warnIfUnsupportedVersionDetected?: boolean,
   viewElementSourceFunction?: ?ViewElementSource,
 
   // This property is used only by the web extension target.
@@ -92,6 +94,7 @@ export default function DevTools({
   showTabBar = false,
   store,
   warnIfLegacyBackendDetected = false,
+  warnIfUnsupportedVersionDetected = false,
   viewElementSourceFunction,
 }: Props) {
   const [tab, setTab] = useState(defaultTab);
@@ -164,6 +167,7 @@ export default function DevTools({
             </ViewElementSourceContext.Provider>
           </SettingsContextController>
           {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
+          {warnIfUnsupportedVersionDetected && <UnsupportedVersionDialog />}
         </ModalDialogContextController>
       </StoreContext.Provider>
     </BridgeContext.Provider>

commit 933f6a07cac6beb5a5540b1942e84064f1c8dd36
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed Dec 18 12:12:34 2019 -0800

    DevTools context menu (#17608)
    
    * Added rudimentary context menu hook and menu UI
    
    * Added backend support for copying a value at a specific path for the inspected element
    
    * Added backend support for storing a value (at a specified path) as a global variable
    
    * Added special casing to enable copying undefined/unserializable values to the clipboard
    
    * Added copy and store-as-global context menu options to selected element props panel
    
    * Store global variables separately, with auto-incremented name (like browsers do)
    
    * Added tests for new copy and store-as-global backend functions
    
    * Fixed some ownerDocument/contentWindow edge cases
    
    * Refactored context menu to support dynamic options
    
    Used this mechanism to add a conditional menu option for inspecting the current value (if it's a function)
    
    * Renamed "safeSerialize" to "serializeToString" and added inline comment

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 229a750adb..f05cdd54e7 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -14,7 +14,7 @@ import '@reach/tooltip/styles.css';
 
 import React, {useEffect, useMemo, useState} from 'react';
 import Store from '../store';
-import {BridgeContext, StoreContext} from './context';
+import {BridgeContext, ContextMenuContext, StoreContext} from './context';
 import Components from './Components/Components';
 import Profiler from './Profiler/Profiler';
 import TabBar from './TabBar';
@@ -40,6 +40,10 @@ export type ViewElementSource = (
   id: number,
   inspectedElement: InspectedElement,
 ) => void;
+export type ViewAttributeSource = (
+  id: number,
+  path: Array<string | number>,
+) => void;
 export type CanViewElementSource = (
   inspectedElement: InspectedElement,
 ) => boolean;
@@ -49,10 +53,12 @@ export type Props = {|
   browserTheme?: BrowserTheme,
   canViewElementSourceFunction?: ?CanViewElementSource,
   defaultTab?: TabID,
+  enabledInspectedElementContextMenu?: boolean,
   showTabBar?: boolean,
   store: Store,
   warnIfLegacyBackendDetected?: boolean,
   warnIfUnsupportedVersionDetected?: boolean,
+  viewAttributeSourceFunction?: ?ViewAttributeSource,
   viewElementSourceFunction?: ?ViewElementSource,
 
   // This property is used only by the web extension target.
@@ -87,14 +93,16 @@ export default function DevTools({
   bridge,
   browserTheme = 'light',
   canViewElementSourceFunction,
-  defaultTab = 'components',
   componentsPortalContainer,
+  defaultTab = 'components',
+  enabledInspectedElementContextMenu = false,
   overrideTab,
   profilerPortalContainer,
   showTabBar = false,
   store,
   warnIfLegacyBackendDetected = false,
   warnIfUnsupportedVersionDetected = false,
+  viewAttributeSourceFunction,
   viewElementSourceFunction,
 }: Props) {
   const [tab, setTab] = useState(defaultTab);
@@ -110,6 +118,14 @@ export default function DevTools({
     [canViewElementSourceFunction, viewElementSourceFunction],
   );
 
+  const contextMenu = useMemo(
+    () => ({
+      isEnabledForInspectedElement: enabledInspectedElementContextMenu,
+      viewAttributeSourceFunction: viewAttributeSourceFunction || null,
+    }),
+    [enabledInspectedElementContextMenu, viewAttributeSourceFunction],
+  );
+
   useEffect(
     () => {
       return () => {
@@ -126,49 +142,53 @@ export default function DevTools({
   return (
     <BridgeContext.Provider value={bridge}>
       <StoreContext.Provider value={store}>
-        <ModalDialogContextController>
-          <SettingsContextController
-            browserTheme={browserTheme}
-            componentsPortalContainer={componentsPortalContainer}
-            profilerPortalContainer={profilerPortalContainer}>
-            <ViewElementSourceContext.Provider value={viewElementSource}>
-              <TreeContextController>
-                <ProfilerContextController>
-                  <div className={styles.DevTools}>
-                    {showTabBar && (
-                      <div className={styles.TabBar}>
-                        <ReactLogo />
-                        <span className={styles.DevToolsVersion}>
-                          {process.env.DEVTOOLS_VERSION}
-                        </span>
-                        <div className={styles.Spacer} />
-                        <TabBar
-                          currentTab={tab}
-                          id="DevTools"
-                          selectTab={setTab}
-                          tabs={tabs}
-                          type="navigation"
+        <ContextMenuContext.Provider value={contextMenu}>
+          <ModalDialogContextController>
+            <SettingsContextController
+              browserTheme={browserTheme}
+              componentsPortalContainer={componentsPortalContainer}
+              profilerPortalContainer={profilerPortalContainer}>
+              <ViewElementSourceContext.Provider value={viewElementSource}>
+                <TreeContextController>
+                  <ProfilerContextController>
+                    <div className={styles.DevTools}>
+                      {showTabBar && (
+                        <div className={styles.TabBar}>
+                          <ReactLogo />
+                          <span className={styles.DevToolsVersion}>
+                            {process.env.DEVTOOLS_VERSION}
+                          </span>
+                          <div className={styles.Spacer} />
+                          <TabBar
+                            currentTab={tab}
+                            id="DevTools"
+                            selectTab={setTab}
+                            tabs={tabs}
+                            type="navigation"
+                          />
+                        </div>
+                      )}
+                      <div
+                        className={styles.TabContent}
+                        hidden={tab !== 'components'}>
+                        <Components
+                          portalContainer={componentsPortalContainer}
                         />
                       </div>
-                    )}
-                    <div
-                      className={styles.TabContent}
-                      hidden={tab !== 'components'}>
-                      <Components portalContainer={componentsPortalContainer} />
-                    </div>
-                    <div
-                      className={styles.TabContent}
-                      hidden={tab !== 'profiler'}>
-                      <Profiler portalContainer={profilerPortalContainer} />
+                      <div
+                        className={styles.TabContent}
+                        hidden={tab !== 'profiler'}>
+                        <Profiler portalContainer={profilerPortalContainer} />
+                      </div>
                     </div>
-                  </div>
-                </ProfilerContextController>
-              </TreeContextController>
-            </ViewElementSourceContext.Provider>
-          </SettingsContextController>
-          {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
-          {warnIfUnsupportedVersionDetected && <UnsupportedVersionDialog />}
-        </ModalDialogContextController>
+                  </ProfilerContextController>
+                </TreeContextController>
+              </ViewElementSourceContext.Provider>
+            </SettingsContextController>
+            {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
+            {warnIfUnsupportedVersionDetected && <UnsupportedVersionDialog />}
+          </ModalDialogContextController>
+        </ContextMenuContext.Provider>
       </StoreContext.Provider>
     </BridgeContext.Provider>
   );

commit 79734771cd78f0b0ee02abbbe386f4a40ccca1ab
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Fri Dec 20 08:31:38 2019 -0800

    Disable "copy to clipboard" and "go to definition" context menu options for Firefox addon (#17668)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index f05cdd54e7..42e194e70c 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -54,6 +54,7 @@ export type Props = {|
   canViewElementSourceFunction?: ?CanViewElementSource,
   defaultTab?: TabID,
   enabledInspectedElementContextMenu?: boolean,
+  enabledInspectedElementContextMenuCopy?: boolean,
   showTabBar?: boolean,
   store: Store,
   warnIfLegacyBackendDetected?: boolean,
@@ -96,6 +97,7 @@ export default function DevTools({
   componentsPortalContainer,
   defaultTab = 'components',
   enabledInspectedElementContextMenu = false,
+  enabledInspectedElementContextMenuCopy = false,
   overrideTab,
   profilerPortalContainer,
   showTabBar = false,
@@ -121,9 +123,14 @@ export default function DevTools({
   const contextMenu = useMemo(
     () => ({
       isEnabledForInspectedElement: enabledInspectedElementContextMenu,
+      supportsCopyOperation: enabledInspectedElementContextMenuCopy,
       viewAttributeSourceFunction: viewAttributeSourceFunction || null,
     }),
-    [enabledInspectedElementContextMenu, viewAttributeSourceFunction],
+    [
+      enabledInspectedElementContextMenu,
+      enabledInspectedElementContextMenuCopy,
+      viewAttributeSourceFunction,
+    ],
   );
 
   useEffect(

commit 22ef96ae63f40b1b9367bc2d8bdb3db33e6943b0
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Sun Dec 29 13:27:44 2019 -0800

    Devtools renable copy attr context menu for firefox (#17740)
    
    * Use exportFunction() to share clipboard copy with JS running in document/page context.
    
    * Remove no-longer-used option to disable copy operation.

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 42e194e70c..f05cdd54e7 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -54,7 +54,6 @@ export type Props = {|
   canViewElementSourceFunction?: ?CanViewElementSource,
   defaultTab?: TabID,
   enabledInspectedElementContextMenu?: boolean,
-  enabledInspectedElementContextMenuCopy?: boolean,
   showTabBar?: boolean,
   store: Store,
   warnIfLegacyBackendDetected?: boolean,
@@ -97,7 +96,6 @@ export default function DevTools({
   componentsPortalContainer,
   defaultTab = 'components',
   enabledInspectedElementContextMenu = false,
-  enabledInspectedElementContextMenuCopy = false,
   overrideTab,
   profilerPortalContainer,
   showTabBar = false,
@@ -123,14 +121,9 @@ export default function DevTools({
   const contextMenu = useMemo(
     () => ({
       isEnabledForInspectedElement: enabledInspectedElementContextMenu,
-      supportsCopyOperation: enabledInspectedElementContextMenuCopy,
       viewAttributeSourceFunction: viewAttributeSourceFunction || null,
     }),
-    [
-      enabledInspectedElementContextMenu,
-      enabledInspectedElementContextMenuCopy,
-      viewAttributeSourceFunction,
-    ],
+    [enabledInspectedElementContextMenu, viewAttributeSourceFunction],
   );
 
   useEffect(

commit b979db4e7215957f03c4221622f0b115a868439a
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Jan 9 13:54:11 2020 +0000

    Bump Prettier (#17811)
    
    * Bump Prettier
    
    * Reformat
    
    * Use non-deprecated option

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index f05cdd54e7..3d19c9390e 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -126,18 +126,15 @@ export default function DevTools({
     [enabledInspectedElementContextMenu, viewAttributeSourceFunction],
   );
 
-  useEffect(
-    () => {
-      return () => {
-        try {
-          bridge.shutdown();
-        } catch (error) {
-          // Attempting to use a disconnected port.
-        }
-      };
-    },
-    [bridge],
-  );
+  useEffect(() => {
+    return () => {
+      try {
+        bridge.shutdown();
+      } catch (error) {
+        // Attempting to use a disconnected port.
+      }
+    };
+  }, [bridge]);
 
   return (
     <BridgeContext.Provider value={bridge}>

commit 09348798a912c8682e57c35842aa7a007e13fdb9
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Fri Feb 21 19:45:20 2020 -0800

    Codemod to import * as React from "react"; (#18102)
    
    * import * as React from "react";
    
    This is the correct way to import React from an ES module since the ES
    module will not have a default export. Only named exports.
    
    * import * as ReactDOM from "react-dom"

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 3d19c9390e..4eac118696 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -12,7 +12,8 @@
 import '@reach/menu-button/styles.css';
 import '@reach/tooltip/styles.css';
 
-import React, {useEffect, useMemo, useState} from 'react';
+import * as React from 'react';
+import {useEffect, useMemo, useState} from 'react';
 import Store from '../store';
 import {BridgeContext, ContextMenuContext, StoreContext} from './context';
 import Components from './Components/Components';

commit 6b7281ec14397d6908fb4ae3292243ab6b2c4ef8
Author: Kerollos Magdy <kerolloz@yahoo.com>
Date:   Wed Mar 18 20:05:41 2020 +0200

    [DevTools] Add shortcut keys for tab switching (#18248)
    
    * [DevTools] Add shortcut keys for tab switching
    * Use LocalStorage to remember most recently selected tab
    
    Resolves #18227 and #18226
    
    Co-authored-by: Brian Vaughn <brian.david.vaughn@gmail.com>

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 4eac118696..28714cb927 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -13,7 +13,7 @@ import '@reach/menu-button/styles.css';
 import '@reach/tooltip/styles.css';
 
 import * as React from 'react';
-import {useEffect, useMemo, useState} from 'react';
+import {useEffect, useMemo, useRef} from 'react';
 import Store from '../store';
 import {BridgeContext, ContextMenuContext, StoreContext} from './context';
 import Components from './Components/Components';
@@ -27,6 +27,7 @@ import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
 import UnsupportedVersionDialog from './UnsupportedVersionDialog';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
+import {useLocalStorage} from './hooks';
 
 import styles from './DevTools.css';
 
@@ -106,9 +107,13 @@ export default function DevTools({
   viewAttributeSourceFunction,
   viewElementSourceFunction,
 }: Props) {
-  const [tab, setTab] = useState(defaultTab);
-  if (overrideTab != null && overrideTab !== tab) {
-    setTab(overrideTab);
+  let [tab, setTab] = useLocalStorage<TabID>(
+    'React::DevTools::defaultTab',
+    defaultTab,
+  );
+
+  if (overrideTab != null) {
+    tab = overrideTab;
   }
 
   const viewElementSource = useMemo(
@@ -127,6 +132,41 @@ export default function DevTools({
     [enabledInspectedElementContextMenu, viewAttributeSourceFunction],
   );
 
+  const devToolsRef = useRef<HTMLElement | null>(null);
+
+  useEffect(() => {
+    if (!showTabBar) {
+      return;
+    }
+
+    const div = devToolsRef.current;
+    if (div === null) {
+      return;
+    }
+
+    const ownerWindow = div.ownerDocument.defaultView;
+    const handleKeyDown = (event: KeyboardEvent) => {
+      if (event.ctrlKey || event.metaKey) {
+        switch (event.key) {
+          case '1':
+            setTab(tabs[0].id);
+            event.preventDefault();
+            event.stopPropagation();
+            break;
+          case '2':
+            setTab(tabs[1].id);
+            event.preventDefault();
+            event.stopPropagation();
+            break;
+        }
+      }
+    };
+    ownerWindow.addEventListener('keydown', handleKeyDown);
+    return () => {
+      ownerWindow.removeEventListener('keydown', handleKeyDown);
+    };
+  }, [showTabBar]);
+
   useEffect(() => {
     return () => {
       try {
@@ -149,7 +189,7 @@ export default function DevTools({
               <ViewElementSourceContext.Provider value={viewElementSource}>
                 <TreeContextController>
                   <ProfilerContextController>
-                    <div className={styles.DevTools}>
+                    <div className={styles.DevTools} ref={devToolsRef}>
                       {showTabBar && (
                         <div className={styles.TabBar}>
                           <ReactLogo />

commit 3e94bce765d355d74f6a60feb4addb6d196e3482
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Wed Apr 1 12:35:52 2020 -0700

    Enable prefer-const lint rules (#18451)
    
    * Enable prefer-const rule
    
    Stylistically I don't like this but Closure Compiler takes advantage of
    this information.
    
    * Auto-fix lints
    
    * Manually fix the remaining callsites

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 28714cb927..56f11a1c3f 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -107,11 +107,13 @@ export default function DevTools({
   viewAttributeSourceFunction,
   viewElementSourceFunction,
 }: Props) {
-  let [tab, setTab] = useLocalStorage<TabID>(
+  const [currentTab, setTab] = useLocalStorage<TabID>(
     'React::DevTools::defaultTab',
     defaultTab,
   );
 
+  let tab = currentTab;
+
   if (overrideTab != null) {
     tab = overrideTab;
   }

commit 1cfd332fd7d6e26af259d14a992ecf9bfb216d9f
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Jun 23 11:48:04 2020 -0400

    Shutdown DevTools Bridge synchronously when unmounting (#19180)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 56f11a1c3f..cb5c36cf68 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -13,7 +13,7 @@ import '@reach/menu-button/styles.css';
 import '@reach/tooltip/styles.css';
 
 import * as React from 'react';
-import {useEffect, useMemo, useRef} from 'react';
+import {useEffect, useLayoutEffect, useMemo, useRef} from 'react';
 import Store from '../store';
 import {BridgeContext, ContextMenuContext, StoreContext} from './context';
 import Components from './Components/Components';
@@ -169,9 +169,10 @@ export default function DevTools({
     };
   }, [showTabBar]);
 
-  useEffect(() => {
+  useLayoutEffect(() => {
     return () => {
       try {
+        // Shut the Bridge down synchronously (during unmount).
         bridge.shutdown();
       } catch (error) {
         // Attempting to use a disconnected port.

commit 8e2bb3e89c8c3c8b64b3aa94e0bb524775ef4522
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Apr 27 17:26:07 2021 -0400

    DevTools: Add Bridge protocol version backend/frontend (#21331)
    
    Add an explicit Bridge protocol version to the frontend and backend components as well as a check during initialization to ensure that both are compatible. If not, the frontend will display either upgrade or downgrade instructions.
    
    Note that only the `react-devtools-core` (React Native) and `react-devtools-inline` (Code Sandbox) packages implement this check. Browser extensions inject their own backend and so the check is unnecessary. (Arguably the `react-devtools-inline` check is also unlikely to be necessary _but_ has been added as an extra guard for use cases such as Replay.io.)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index cb5c36cf68..a7ac1c4397 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -25,6 +25,7 @@ import ViewElementSourceContext from './Components/ViewElementSourceContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
+import UnsupportedBridgeProtocolDialog from './UnsupportedBridgeProtocolDialog';
 import UnsupportedVersionDialog from './UnsupportedVersionDialog';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 import {useLocalStorage} from './hooks';
@@ -226,6 +227,7 @@ export default function DevTools({
                 </TreeContextController>
               </ViewElementSourceContext.Provider>
             </SettingsContextController>
+            <UnsupportedBridgeProtocolDialog />
             {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
             {warnIfUnsupportedVersionDetected && <UnsupportedVersionDialog />}
           </ModalDialogContextController>

commit c5cfa71948dbf4c2dd9ff64596ab663f8d559cd6
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Jul 1 14:39:18 2021 -0400

    DevTools: Show hook names based on variable usage (#21641)
    
    Co-authored-by: Brian Vaughn <brian.david.vaughn@gmail.com>
    Co-authored-by: Saphal Patro <saphal1998@gmail.com>
    Co-authored-by: VibhorCodecianGupta <vibhordelgupta@gmail.com>

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index a7ac1c4397..534e2cc4e2 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -22,6 +22,7 @@ import TabBar from './TabBar';
 import {SettingsContextController} from './Settings/SettingsContext';
 import {TreeContextController} from './Components/TreeContext';
 import ViewElementSourceContext from './Components/ViewElementSourceContext';
+import LoadHookNamesFunctionContext from './Components/LoadHookNamesFunctionContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
@@ -34,15 +35,22 @@ import styles from './DevTools.css';
 
 import './root.css';
 
+import type {HooksTree} from 'react-debug-tools/src/ReactDebugHooks';
 import type {InspectedElement} from 'react-devtools-shared/src/devtools/views/Components/types';
 import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
+import type {HookNames} from 'react-devtools-shared/src/types';
+import type {Thenable} from '../cache';
 
 export type BrowserTheme = 'dark' | 'light';
 export type TabID = 'components' | 'profiler';
+
 export type ViewElementSource = (
   id: number,
   inspectedElement: InspectedElement,
 ) => void;
+export type LoadHookNamesFunction = (
+  hooksTree: HooksTree,
+) => Thenable<HookNames>;
 export type ViewAttributeSource = (
   id: number,
   path: Array<string | number>,
@@ -75,6 +83,11 @@ export type Props = {|
   // but individual tabs (e.g. Components, Profiling) can be rendered into portals within their browser panels.
   componentsPortalContainer?: Element,
   profilerPortalContainer?: Element,
+
+  // Loads and parses source maps for function components
+  // and extracts hook "names" based on the variables the hook return values get assigned to.
+  // Not every DevTools build can load source maps, so this property is optional.
+  loadHookNamesFunction?: ?LoadHookNamesFunction,
 |};
 
 const componentsTab = {
@@ -99,6 +112,7 @@ export default function DevTools({
   componentsPortalContainer,
   defaultTab = 'components',
   enabledInspectedElementContextMenu = false,
+  loadHookNamesFunction,
   overrideTab,
   profilerPortalContainer,
   showTabBar = false,
@@ -180,7 +194,6 @@ export default function DevTools({
       }
     };
   }, [bridge]);
-
   return (
     <BridgeContext.Provider value={bridge}>
       <StoreContext.Provider value={store}>
@@ -191,40 +204,43 @@ export default function DevTools({
               componentsPortalContainer={componentsPortalContainer}
               profilerPortalContainer={profilerPortalContainer}>
               <ViewElementSourceContext.Provider value={viewElementSource}>
-                <TreeContextController>
-                  <ProfilerContextController>
-                    <div className={styles.DevTools} ref={devToolsRef}>
-                      {showTabBar && (
-                        <div className={styles.TabBar}>
-                          <ReactLogo />
-                          <span className={styles.DevToolsVersion}>
-                            {process.env.DEVTOOLS_VERSION}
-                          </span>
-                          <div className={styles.Spacer} />
-                          <TabBar
-                            currentTab={tab}
-                            id="DevTools"
-                            selectTab={setTab}
-                            tabs={tabs}
-                            type="navigation"
+                <LoadHookNamesFunctionContext.Provider
+                  value={loadHookNamesFunction || null}>
+                  <TreeContextController>
+                    <ProfilerContextController>
+                      <div className={styles.DevTools} ref={devToolsRef}>
+                        {showTabBar && (
+                          <div className={styles.TabBar}>
+                            <ReactLogo />
+                            <span className={styles.DevToolsVersion}>
+                              {process.env.DEVTOOLS_VERSION}
+                            </span>
+                            <div className={styles.Spacer} />
+                            <TabBar
+                              currentTab={tab}
+                              id="DevTools"
+                              selectTab={setTab}
+                              tabs={tabs}
+                              type="navigation"
+                            />
+                          </div>
+                        )}
+                        <div
+                          className={styles.TabContent}
+                          hidden={tab !== 'components'}>
+                          <Components
+                            portalContainer={componentsPortalContainer}
                           />
                         </div>
-                      )}
-                      <div
-                        className={styles.TabContent}
-                        hidden={tab !== 'components'}>
-                        <Components
-                          portalContainer={componentsPortalContainer}
-                        />
-                      </div>
-                      <div
-                        className={styles.TabContent}
-                        hidden={tab !== 'profiler'}>
-                        <Profiler portalContainer={profilerPortalContainer} />
+                        <div
+                          className={styles.TabContent}
+                          hidden={tab !== 'profiler'}>
+                          <Profiler portalContainer={profilerPortalContainer} />
+                        </div>
                       </div>
-                    </div>
-                  </ProfilerContextController>
-                </TreeContextController>
+                    </ProfilerContextController>
+                  </TreeContextController>
+                </LoadHookNamesFunctionContext.Provider>
               </ViewElementSourceContext.Provider>
             </SettingsContextController>
             <UnsupportedBridgeProtocolDialog />

commit e26cb8f86db0936e14682c39e2d26373fa6f433d
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Jul 15 23:39:30 2021 -0400

    Clear named hooks Suspense and AST cache after a Fast Refresh (#21891)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 534e2cc4e2..812ca916d8 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -22,7 +22,7 @@ import TabBar from './TabBar';
 import {SettingsContextController} from './Settings/SettingsContext';
 import {TreeContextController} from './Components/TreeContext';
 import ViewElementSourceContext from './Components/ViewElementSourceContext';
-import LoadHookNamesFunctionContext from './Components/LoadHookNamesFunctionContext';
+import HookNamesContext from './Components/HookNamesContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
@@ -51,6 +51,7 @@ export type ViewElementSource = (
 export type LoadHookNamesFunction = (
   hooksTree: HooksTree,
 ) => Thenable<HookNames>;
+export type PurgeCachedHookNamesMetadata = () => void;
 export type ViewAttributeSource = (
   id: number,
   path: Array<string | number>,
@@ -87,7 +88,8 @@ export type Props = {|
   // Loads and parses source maps for function components
   // and extracts hook "names" based on the variables the hook return values get assigned to.
   // Not every DevTools build can load source maps, so this property is optional.
-  loadHookNamesFunction?: ?LoadHookNamesFunction,
+  loadHookNames?: ?LoadHookNamesFunction,
+  purgeCachedHookNamesMetadata?: ?PurgeCachedHookNamesMetadata,
 |};
 
 const componentsTab = {
@@ -112,9 +114,10 @@ export default function DevTools({
   componentsPortalContainer,
   defaultTab = 'components',
   enabledInspectedElementContextMenu = false,
-  loadHookNamesFunction,
+  loadHookNames,
   overrideTab,
   profilerPortalContainer,
+  purgeCachedHookNamesMetadata,
   showTabBar = false,
   store,
   warnIfLegacyBackendDetected = false,
@@ -149,6 +152,14 @@ export default function DevTools({
     [enabledInspectedElementContextMenu, viewAttributeSourceFunction],
   );
 
+  const hookNamesContext = useMemo(
+    () => ({
+      loadHookNames: loadHookNames || null,
+      purgeCachedMetadata: purgeCachedHookNamesMetadata || null,
+    }),
+    [loadHookNames, purgeCachedHookNamesMetadata],
+  );
+
   const devToolsRef = useRef<HTMLElement | null>(null);
 
   useEffect(() => {
@@ -204,8 +215,7 @@ export default function DevTools({
               componentsPortalContainer={componentsPortalContainer}
               profilerPortalContainer={profilerPortalContainer}>
               <ViewElementSourceContext.Provider value={viewElementSource}>
-                <LoadHookNamesFunctionContext.Provider
-                  value={loadHookNamesFunction || null}>
+                <HookNamesContext.Provider value={hookNamesContext}>
                   <TreeContextController>
                     <ProfilerContextController>
                       <div className={styles.DevTools} ref={devToolsRef}>
@@ -240,7 +250,7 @@ export default function DevTools({
                       </div>
                     </ProfilerContextController>
                   </TreeContextController>
-                </LoadHookNamesFunctionContext.Provider>
+                </HookNamesContext.Provider>
               </ViewElementSourceContext.Provider>
             </SettingsContextController>
             <UnsupportedBridgeProtocolDialog />

commit f4161c3ec7d2ab2993695a458f771bb331e256d5
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Jul 22 13:58:57 2021 -0400

    [DRAFT] Import scheduling profiler into DevTools Profiler (#21897)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 812ca916d8..3c768c11ab 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -24,6 +24,7 @@ import {TreeContextController} from './Components/TreeContext';
 import ViewElementSourceContext from './Components/ViewElementSourceContext';
 import HookNamesContext from './Components/HookNamesContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
+import {SchedulingProfilerContextController} from 'react-devtools-scheduling-profiler/src/SchedulingProfilerContext';
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
 import UnsupportedBridgeProtocolDialog from './UnsupportedBridgeProtocolDialog';
@@ -218,36 +219,40 @@ export default function DevTools({
                 <HookNamesContext.Provider value={hookNamesContext}>
                   <TreeContextController>
                     <ProfilerContextController>
-                      <div className={styles.DevTools} ref={devToolsRef}>
-                        {showTabBar && (
-                          <div className={styles.TabBar}>
-                            <ReactLogo />
-                            <span className={styles.DevToolsVersion}>
-                              {process.env.DEVTOOLS_VERSION}
-                            </span>
-                            <div className={styles.Spacer} />
-                            <TabBar
-                              currentTab={tab}
-                              id="DevTools"
-                              selectTab={setTab}
-                              tabs={tabs}
-                              type="navigation"
+                      <SchedulingProfilerContextController>
+                        <div className={styles.DevTools} ref={devToolsRef}>
+                          {showTabBar && (
+                            <div className={styles.TabBar}>
+                              <ReactLogo />
+                              <span className={styles.DevToolsVersion}>
+                                {process.env.DEVTOOLS_VERSION}
+                              </span>
+                              <div className={styles.Spacer} />
+                              <TabBar
+                                currentTab={tab}
+                                id="DevTools"
+                                selectTab={setTab}
+                                tabs={tabs}
+                                type="navigation"
+                              />
+                            </div>
+                          )}
+                          <div
+                            className={styles.TabContent}
+                            hidden={tab !== 'components'}>
+                            <Components
+                              portalContainer={componentsPortalContainer}
+                            />
+                          </div>
+                          <div
+                            className={styles.TabContent}
+                            hidden={tab !== 'profiler'}>
+                            <Profiler
+                              portalContainer={profilerPortalContainer}
                             />
                           </div>
-                        )}
-                        <div
-                          className={styles.TabContent}
-                          hidden={tab !== 'components'}>
-                          <Components
-                            portalContainer={componentsPortalContainer}
-                          />
-                        </div>
-                        <div
-                          className={styles.TabContent}
-                          hidden={tab !== 'profiler'}>
-                          <Profiler portalContainer={profilerPortalContainer} />
                         </div>
-                      </div>
+                      </SchedulingProfilerContextController>
                     </ProfilerContextController>
                   </TreeContextController>
                 </HookNamesContext.Provider>

commit e3b76a85c5233fad6f411c14e88ac4a61af800fb
Author: houssemchebeb <59608551+houssemchebeb@users.noreply.github.com>
Date:   Mon Aug 2 16:20:04 2021 +0100

    Devtools: Refactor imperative theme code (#21950)
    
    Co-authored-by: Brian Vaughn <bvaughn@fb.com>

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 3c768c11ab..190fa7917a 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -31,6 +31,7 @@ import UnsupportedBridgeProtocolDialog from './UnsupportedBridgeProtocolDialog';
 import UnsupportedVersionDialog from './UnsupportedVersionDialog';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 import {useLocalStorage} from './hooks';
+import ThemeProvider from './ThemeProvider';
 
 import styles from './DevTools.css';
 
@@ -220,38 +221,40 @@ export default function DevTools({
                   <TreeContextController>
                     <ProfilerContextController>
                       <SchedulingProfilerContextController>
-                        <div className={styles.DevTools} ref={devToolsRef}>
-                          {showTabBar && (
-                            <div className={styles.TabBar}>
-                              <ReactLogo />
-                              <span className={styles.DevToolsVersion}>
-                                {process.env.DEVTOOLS_VERSION}
-                              </span>
-                              <div className={styles.Spacer} />
-                              <TabBar
-                                currentTab={tab}
-                                id="DevTools"
-                                selectTab={setTab}
-                                tabs={tabs}
-                                type="navigation"
+                        <ThemeProvider>
+                          <div className={styles.DevTools} ref={devToolsRef}>
+                            {showTabBar && (
+                              <div className={styles.TabBar}>
+                                <ReactLogo />
+                                <span className={styles.DevToolsVersion}>
+                                  {process.env.DEVTOOLS_VERSION}
+                                </span>
+                                <div className={styles.Spacer} />
+                                <TabBar
+                                  currentTab={tab}
+                                  id="DevTools"
+                                  selectTab={setTab}
+                                  tabs={tabs}
+                                  type="navigation"
+                                />
+                              </div>
+                            )}
+                            <div
+                              className={styles.TabContent}
+                              hidden={tab !== 'components'}>
+                              <Components
+                                portalContainer={componentsPortalContainer}
+                              />
+                            </div>
+                            <div
+                              className={styles.TabContent}
+                              hidden={tab !== 'profiler'}>
+                              <Profiler
+                                portalContainer={profilerPortalContainer}
                               />
                             </div>
-                          )}
-                          <div
-                            className={styles.TabContent}
-                            hidden={tab !== 'components'}>
-                            <Components
-                              portalContainer={componentsPortalContainer}
-                            />
-                          </div>
-                          <div
-                            className={styles.TabContent}
-                            hidden={tab !== 'profiler'}>
-                            <Profiler
-                              portalContainer={profilerPortalContainer}
-                            />
                           </div>
-                        </div>
+                        </ThemeProvider>
                       </SchedulingProfilerContextController>
                     </ProfilerContextController>
                   </TreeContextController>

commit 42251331d8f7a997a018d75370f5216bb7552819
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Mon Aug 2 14:30:43 2021 -0400

    DevTools: Scheduling profiler (#22006)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 190fa7917a..8f1ccc5540 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -222,7 +222,10 @@ export default function DevTools({
                     <ProfilerContextController>
                       <SchedulingProfilerContextController>
                         <ThemeProvider>
-                          <div className={styles.DevTools} ref={devToolsRef}>
+                          <div
+                            className={styles.DevTools}
+                            ref={devToolsRef}
+                            data-react-devtools-portal-root={true}>
                             {showTabBar && (
                               <div className={styles.TabBar}>
                                 <ReactLogo />

commit 83205c0aea3226eac063910bab128f3258d7c7dc
Author: Holger Benl <hbenl@evandor.de>
Date:   Fri Aug 20 18:55:50 2021 +0200

    [DevTools] Add options for disabling some features (#22136)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 8f1ccc5540..17a88d44cb 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -15,7 +15,12 @@ import '@reach/tooltip/styles.css';
 import * as React from 'react';
 import {useEffect, useLayoutEffect, useMemo, useRef} from 'react';
 import Store from '../store';
-import {BridgeContext, ContextMenuContext, StoreContext} from './context';
+import {
+  BridgeContext,
+  ContextMenuContext,
+  StoreContext,
+  OptionsContext,
+} from './context';
 import Components from './Components/Components';
 import Profiler from './Profiler/Profiler';
 import TabBar from './TabBar';
@@ -74,6 +79,12 @@ export type Props = {|
   warnIfUnsupportedVersionDetected?: boolean,
   viewAttributeSourceFunction?: ?ViewAttributeSource,
   viewElementSourceFunction?: ?ViewElementSource,
+  readOnly?: boolean,
+  hideSettings?: boolean,
+  hideToggleErrorAction?: boolean,
+  hideToggleSuspenseAction?: boolean,
+  hideLogAction?: boolean,
+  hideViewSourceAction?: boolean,
 
   // This property is used only by the web extension target.
   // The built-in tab UI is hidden in that case, in favor of the browser's own panel tabs.
@@ -126,6 +137,12 @@ export default function DevTools({
   warnIfUnsupportedVersionDetected = false,
   viewAttributeSourceFunction,
   viewElementSourceFunction,
+  readOnly,
+  hideSettings,
+  hideToggleErrorAction,
+  hideToggleSuspenseAction,
+  hideLogAction,
+  hideViewSourceAction,
 }: Props) {
   const [currentTab, setTab] = useLocalStorage<TabID>(
     'React::DevTools::defaultTab',
@@ -138,6 +155,25 @@ export default function DevTools({
     tab = overrideTab;
   }
 
+  const options = useMemo(
+    () => ({
+      readOnly: readOnly || false,
+      hideSettings: hideSettings || false,
+      hideToggleErrorAction: hideToggleErrorAction || false,
+      hideToggleSuspenseAction: hideToggleSuspenseAction || false,
+      hideLogAction: hideLogAction || false,
+      hideViewSourceAction: hideViewSourceAction || false,
+    }),
+    [
+      readOnly,
+      hideSettings,
+      hideToggleErrorAction,
+      hideToggleSuspenseAction,
+      hideLogAction,
+      hideViewSourceAction,
+    ],
+  );
+
   const viewElementSource = useMemo(
     () => ({
       canViewElementSourceFunction: canViewElementSourceFunction || null,
@@ -210,65 +246,67 @@ export default function DevTools({
   return (
     <BridgeContext.Provider value={bridge}>
       <StoreContext.Provider value={store}>
-        <ContextMenuContext.Provider value={contextMenu}>
-          <ModalDialogContextController>
-            <SettingsContextController
-              browserTheme={browserTheme}
-              componentsPortalContainer={componentsPortalContainer}
-              profilerPortalContainer={profilerPortalContainer}>
-              <ViewElementSourceContext.Provider value={viewElementSource}>
-                <HookNamesContext.Provider value={hookNamesContext}>
-                  <TreeContextController>
-                    <ProfilerContextController>
-                      <SchedulingProfilerContextController>
-                        <ThemeProvider>
-                          <div
-                            className={styles.DevTools}
-                            ref={devToolsRef}
-                            data-react-devtools-portal-root={true}>
-                            {showTabBar && (
-                              <div className={styles.TabBar}>
-                                <ReactLogo />
-                                <span className={styles.DevToolsVersion}>
-                                  {process.env.DEVTOOLS_VERSION}
-                                </span>
-                                <div className={styles.Spacer} />
-                                <TabBar
-                                  currentTab={tab}
-                                  id="DevTools"
-                                  selectTab={setTab}
-                                  tabs={tabs}
-                                  type="navigation"
+        <OptionsContext.Provider value={options}>
+          <ContextMenuContext.Provider value={contextMenu}>
+            <ModalDialogContextController>
+              <SettingsContextController
+                browserTheme={browserTheme}
+                componentsPortalContainer={componentsPortalContainer}
+                profilerPortalContainer={profilerPortalContainer}>
+                <ViewElementSourceContext.Provider value={viewElementSource}>
+                  <HookNamesContext.Provider value={hookNamesContext}>
+                    <TreeContextController>
+                      <ProfilerContextController>
+                        <SchedulingProfilerContextController>
+                          <ThemeProvider>
+                            <div
+                              className={styles.DevTools}
+                              ref={devToolsRef}
+                              data-react-devtools-portal-root={true}>
+                              {showTabBar && (
+                                <div className={styles.TabBar}>
+                                  <ReactLogo />
+                                  <span className={styles.DevToolsVersion}>
+                                    {process.env.DEVTOOLS_VERSION}
+                                  </span>
+                                  <div className={styles.Spacer} />
+                                  <TabBar
+                                    currentTab={tab}
+                                    id="DevTools"
+                                    selectTab={setTab}
+                                    tabs={tabs}
+                                    type="navigation"
+                                  />
+                                </div>
+                              )}
+                              <div
+                                className={styles.TabContent}
+                                hidden={tab !== 'components'}>
+                                <Components
+                                  portalContainer={componentsPortalContainer}
+                                />
+                              </div>
+                              <div
+                                className={styles.TabContent}
+                                hidden={tab !== 'profiler'}>
+                                <Profiler
+                                  portalContainer={profilerPortalContainer}
                                 />
                               </div>
-                            )}
-                            <div
-                              className={styles.TabContent}
-                              hidden={tab !== 'components'}>
-                              <Components
-                                portalContainer={componentsPortalContainer}
-                              />
-                            </div>
-                            <div
-                              className={styles.TabContent}
-                              hidden={tab !== 'profiler'}>
-                              <Profiler
-                                portalContainer={profilerPortalContainer}
-                              />
                             </div>
-                          </div>
-                        </ThemeProvider>
-                      </SchedulingProfilerContextController>
-                    </ProfilerContextController>
-                  </TreeContextController>
-                </HookNamesContext.Provider>
-              </ViewElementSourceContext.Provider>
-            </SettingsContextController>
-            <UnsupportedBridgeProtocolDialog />
-            {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
-            {warnIfUnsupportedVersionDetected && <UnsupportedVersionDialog />}
-          </ModalDialogContextController>
-        </ContextMenuContext.Provider>
+                          </ThemeProvider>
+                        </SchedulingProfilerContextController>
+                      </ProfilerContextController>
+                    </TreeContextController>
+                  </HookNamesContext.Provider>
+                </ViewElementSourceContext.Provider>
+              </SettingsContextController>
+              <UnsupportedBridgeProtocolDialog />
+              {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
+              {warnIfUnsupportedVersionDetected && <UnsupportedVersionDialog />}
+            </ModalDialogContextController>
+          </ContextMenuContext.Provider>
+        </OptionsContext.Provider>
       </StoreContext.Provider>
     </BridgeContext.Provider>
   );

commit 9fc04eaf3fb701cdc14f57d5aed48f3126af6c94
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Wed Sep 1 14:10:07 2021 -0400

    DevTools: Improve named hooks network caching (#22198)
    
    While testing the recently-launched named hooks feature, I noticed that one of the two big performance bottlenecks is fetching the source file. This was unexpected since the source file has already been loaded by the page. (After all, DevTools is inspecting a component defined in that same file.)
    
    To address this, I made the following changes:
    - [x] Keep CPU bound work (parsing source map and AST) in a worker so it doesn't block the main thread but move I/O bound code (fetching files) to the main thread.
    - [x] Inject a function into the page (as part of the content script) to fetch cached files for the extension. Communicate with this function using `eval()` (to send it messages) and `chrome.runtime.sendMessage()` to return its responses to the extension).
    
    With the above changes in place, the extension gets cached responses from a lot of sites- but not Facebook. This seems to be due to the following:
    * Facebook's response headers include [`vary: 'Origin'`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Vary).
    * The `fetch` made from the content script does not include an `Origin` request header.
    
    To reduce the impact of cases where we can't re-use the Network cache, this PR also makes additional changes:
    - [x] Use `devtools.network.onRequestFinished` to (pre)cache resources as the page loads them. This allows us to avoid requesting a resource that's already been loaded in most cases.
    - [x] In case DevTools was opened _after_ some requests were made, we also now pre-fetch (and cache in memory) source files when a component is selected (if it has hooks). If the component's hooks are later evaluated, the source map will be faster to access. (Note that in many cases, this prefetch is very fast since it is returned from the disk cache.)
    
    With the above changes, we've reduced the time spent in `loadSourceFiles` to nearly nothing.

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 17a88d44cb..a1280d14bd 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -51,6 +51,11 @@ import type {Thenable} from '../cache';
 export type BrowserTheme = 'dark' | 'light';
 export type TabID = 'components' | 'profiler';
 
+export type FetchFileWithCaching = (url: string) => Promise<string>;
+export type PrefetchSourceFiles = (
+  hooksTree: HooksTree,
+  fetchFileWithCaching: FetchFileWithCaching | null,
+) => void;
 export type ViewElementSource = (
   id: number,
   inspectedElement: InspectedElement,
@@ -101,7 +106,9 @@ export type Props = {|
   // Loads and parses source maps for function components
   // and extracts hook "names" based on the variables the hook return values get assigned to.
   // Not every DevTools build can load source maps, so this property is optional.
+  fetchFileWithCaching?: ?FetchFileWithCaching,
   loadHookNames?: ?LoadHookNamesFunction,
+  prefetchSourceFiles?: ?PrefetchSourceFiles,
   purgeCachedHookNamesMetadata?: ?PurgeCachedHookNamesMetadata,
 |};
 
@@ -127,9 +134,11 @@ export default function DevTools({
   componentsPortalContainer,
   defaultTab = 'components',
   enabledInspectedElementContextMenu = false,
+  fetchFileWithCaching,
   loadHookNames,
   overrideTab,
   profilerPortalContainer,
+  prefetchSourceFiles,
   purgeCachedHookNamesMetadata,
   showTabBar = false,
   store,
@@ -192,10 +201,17 @@ export default function DevTools({
 
   const hookNamesContext = useMemo(
     () => ({
+      fetchFileWithCaching: fetchFileWithCaching || null,
       loadHookNames: loadHookNames || null,
+      prefetchSourceFiles: prefetchSourceFiles || null,
       purgeCachedMetadata: purgeCachedHookNamesMetadata || null,
     }),
-    [loadHookNames, purgeCachedHookNamesMetadata],
+    [
+      fetchFileWithCaching,
+      loadHookNames,
+      prefetchSourceFiles,
+      purgeCachedHookNamesMetadata,
+    ],
   );
 
   const devToolsRef = useRef<HTMLElement | null>(null);

commit 225740be4864ee8eeb349b38b329291450245578
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Sep 9 15:25:26 2021 -0400

    Add named hooks support to react-devtools-inline (#22263)
    
    This commit builds on PR #22260 and makes the following changes:
    * Adds a DevTools feature flag for named hooks support. (This allows us to disable it entirely for a build via feature flag.)
    * Adds a new Suspense cache for dynamically imported modules. (This allows a component to suspend while importing an external code chunk– like the hook names parsing code).
    * DevTools supports a hookNamesModuleLoaderFunction param to import the hook names module. I wish this could be handles as part of the react-devtools-shared package, but I'm not sure how to configure Webpack (4) to serve the chunk from react-devtools-inline. This seemed like a reasonable workaround.
    
    The PR also contains an additional unrelated change:
    * Removes pre-fetch optimization (added in DevTools: Improve named hooks network caching #22198). This optimization was mostly only important for cases where sources needed to be re-downloaded, something which we can now avoid in most cases¹ thanks to using cached responses already loaded by the page. (I tested this locally on Facebook and this change has no negative performance impact. There is still some overhead from serializing the JS through the Bridge but that's constant between the two approaches.)
    
    ¹ The case where we don't benefit from cached responses is when DevTools are opened after the page has already loaded certain scripts. This seems uncommon enough that I don't think it justified the added complexity of prefetching.

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index a1280d14bd..6461441710 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -27,7 +27,8 @@ import TabBar from './TabBar';
 import {SettingsContextController} from './Settings/SettingsContext';
 import {TreeContextController} from './Components/TreeContext';
 import ViewElementSourceContext from './Components/ViewElementSourceContext';
-import HookNamesContext from './Components/HookNamesContext';
+import FetchFileWithCachingContext from './Components/FetchFileWithCachingContext';
+import HookNamesModuleLoaderContext from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
 import {SchedulingProfilerContextController} from 'react-devtools-scheduling-profiler/src/SchedulingProfilerContext';
 import {ModalDialogContextController} from './ModalDialog';
@@ -42,28 +43,18 @@ import styles from './DevTools.css';
 
 import './root.css';
 
-import type {HooksTree} from 'react-debug-tools/src/ReactDebugHooks';
 import type {InspectedElement} from 'react-devtools-shared/src/devtools/views/Components/types';
+import type {FetchFileWithCaching} from './Components/FetchFileWithCachingContext';
+import type {HookNamesModuleLoaderFunction} from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
-import type {HookNames} from 'react-devtools-shared/src/types';
-import type {Thenable} from '../cache';
 
 export type BrowserTheme = 'dark' | 'light';
 export type TabID = 'components' | 'profiler';
 
-export type FetchFileWithCaching = (url: string) => Promise<string>;
-export type PrefetchSourceFiles = (
-  hooksTree: HooksTree,
-  fetchFileWithCaching: FetchFileWithCaching | null,
-) => void;
 export type ViewElementSource = (
   id: number,
   inspectedElement: InspectedElement,
 ) => void;
-export type LoadHookNamesFunction = (
-  hooksTree: HooksTree,
-) => Thenable<HookNames>;
-export type PurgeCachedHookNamesMetadata = () => void;
 export type ViewAttributeSource = (
   id: number,
   path: Array<string | number>,
@@ -107,9 +98,8 @@ export type Props = {|
   // and extracts hook "names" based on the variables the hook return values get assigned to.
   // Not every DevTools build can load source maps, so this property is optional.
   fetchFileWithCaching?: ?FetchFileWithCaching,
-  loadHookNames?: ?LoadHookNamesFunction,
-  prefetchSourceFiles?: ?PrefetchSourceFiles,
-  purgeCachedHookNamesMetadata?: ?PurgeCachedHookNamesMetadata,
+  // TODO (Webpack 5) Hopefully we can remove this prop after the Webpack 5 migration.
+  hookNamesModuleLoaderFunction?: ?HookNamesModuleLoaderFunction,
 |};
 
 const componentsTab = {
@@ -135,11 +125,9 @@ export default function DevTools({
   defaultTab = 'components',
   enabledInspectedElementContextMenu = false,
   fetchFileWithCaching,
-  loadHookNames,
+  hookNamesModuleLoaderFunction,
   overrideTab,
   profilerPortalContainer,
-  prefetchSourceFiles,
-  purgeCachedHookNamesMetadata,
   showTabBar = false,
   store,
   warnIfLegacyBackendDetected = false,
@@ -199,21 +187,6 @@ export default function DevTools({
     [enabledInspectedElementContextMenu, viewAttributeSourceFunction],
   );
 
-  const hookNamesContext = useMemo(
-    () => ({
-      fetchFileWithCaching: fetchFileWithCaching || null,
-      loadHookNames: loadHookNames || null,
-      prefetchSourceFiles: prefetchSourceFiles || null,
-      purgeCachedMetadata: purgeCachedHookNamesMetadata || null,
-    }),
-    [
-      fetchFileWithCaching,
-      loadHookNames,
-      prefetchSourceFiles,
-      purgeCachedHookNamesMetadata,
-    ],
-  );
-
   const devToolsRef = useRef<HTMLElement | null>(null);
 
   useEffect(() => {
@@ -270,51 +243,55 @@ export default function DevTools({
                 componentsPortalContainer={componentsPortalContainer}
                 profilerPortalContainer={profilerPortalContainer}>
                 <ViewElementSourceContext.Provider value={viewElementSource}>
-                  <HookNamesContext.Provider value={hookNamesContext}>
-                    <TreeContextController>
-                      <ProfilerContextController>
-                        <SchedulingProfilerContextController>
-                          <ThemeProvider>
-                            <div
-                              className={styles.DevTools}
-                              ref={devToolsRef}
-                              data-react-devtools-portal-root={true}>
-                              {showTabBar && (
-                                <div className={styles.TabBar}>
-                                  <ReactLogo />
-                                  <span className={styles.DevToolsVersion}>
-                                    {process.env.DEVTOOLS_VERSION}
-                                  </span>
-                                  <div className={styles.Spacer} />
-                                  <TabBar
-                                    currentTab={tab}
-                                    id="DevTools"
-                                    selectTab={setTab}
-                                    tabs={tabs}
-                                    type="navigation"
+                  <HookNamesModuleLoaderContext.Provider
+                    value={hookNamesModuleLoaderFunction || null}>
+                    <FetchFileWithCachingContext.Provider
+                      value={fetchFileWithCaching || null}>
+                      <TreeContextController>
+                        <ProfilerContextController>
+                          <SchedulingProfilerContextController>
+                            <ThemeProvider>
+                              <div
+                                className={styles.DevTools}
+                                ref={devToolsRef}
+                                data-react-devtools-portal-root={true}>
+                                {showTabBar && (
+                                  <div className={styles.TabBar}>
+                                    <ReactLogo />
+                                    <span className={styles.DevToolsVersion}>
+                                      {process.env.DEVTOOLS_VERSION}
+                                    </span>
+                                    <div className={styles.Spacer} />
+                                    <TabBar
+                                      currentTab={tab}
+                                      id="DevTools"
+                                      selectTab={setTab}
+                                      tabs={tabs}
+                                      type="navigation"
+                                    />
+                                  </div>
+                                )}
+                                <div
+                                  className={styles.TabContent}
+                                  hidden={tab !== 'components'}>
+                                  <Components
+                                    portalContainer={componentsPortalContainer}
+                                  />
+                                </div>
+                                <div
+                                  className={styles.TabContent}
+                                  hidden={tab !== 'profiler'}>
+                                  <Profiler
+                                    portalContainer={profilerPortalContainer}
                                   />
                                 </div>
-                              )}
-                              <div
-                                className={styles.TabContent}
-                                hidden={tab !== 'components'}>
-                                <Components
-                                  portalContainer={componentsPortalContainer}
-                                />
-                              </div>
-                              <div
-                                className={styles.TabContent}
-                                hidden={tab !== 'profiler'}>
-                                <Profiler
-                                  portalContainer={profilerPortalContainer}
-                                />
                               </div>
-                            </div>
-                          </ThemeProvider>
-                        </SchedulingProfilerContextController>
-                      </ProfilerContextController>
-                    </TreeContextController>
-                  </HookNamesContext.Provider>
+                            </ThemeProvider>
+                          </SchedulingProfilerContextController>
+                        </ProfilerContextController>
+                      </TreeContextController>
+                    </FetchFileWithCachingContext.Provider>
+                  </HookNamesModuleLoaderContext.Provider>
                 </ViewElementSourceContext.Provider>
               </SettingsContextController>
               <UnsupportedBridgeProtocolDialog />

commit 2825a08dc0981b7e745b2742a84195f75e4d6f72
Author: Juan <jstejada@fb.com>
Date:   Thu Sep 30 17:19:07 2021 -0400

    [DevTools] Log basic usage events (#22478)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 6461441710..0fa4a44013 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -13,7 +13,7 @@ import '@reach/menu-button/styles.css';
 import '@reach/tooltip/styles.css';
 
 import * as React from 'react';
-import {useEffect, useLayoutEffect, useMemo, useRef} from 'react';
+import {useCallback, useEffect, useLayoutEffect, useMemo, useRef} from 'react';
 import Store from '../store';
 import {
   BridgeContext,
@@ -47,6 +47,7 @@ import type {InspectedElement} from 'react-devtools-shared/src/devtools/views/Co
 import type {FetchFileWithCaching} from './Components/FetchFileWithCachingContext';
 import type {HookNamesModuleLoaderFunction} from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
+import {logEvent} from '../../Logger';
 
 export type BrowserTheme = 'dark' | 'light';
 export type TabID = 'components' | 'profiler';
@@ -152,6 +153,24 @@ export default function DevTools({
     tab = overrideTab;
   }
 
+  const selectTab = useCallback(
+    (tabId: TabID) => {
+      // We show the TabBar when DevTools is NOT rendered as a browser extension.
+      // In this case, we want to capture when people select tabs with the TabBar.
+      // When DevTools is rendered as an extension, we capture this event when
+      // the browser devtools panel changes.
+      if (showTabBar === true) {
+        if (tabId === 'components') {
+          logEvent({event_name: 'selected-components-tab'});
+        } else {
+          logEvent({event_name: 'selected-profiler-tab'});
+        }
+      }
+      setTab(tabId);
+    },
+    [setTab, showTabBar],
+  );
+
   const options = useMemo(
     () => ({
       readOnly: readOnly || false,
@@ -204,12 +223,12 @@ export default function DevTools({
       if (event.ctrlKey || event.metaKey) {
         switch (event.key) {
           case '1':
-            setTab(tabs[0].id);
+            selectTab(tabs[0].id);
             event.preventDefault();
             event.stopPropagation();
             break;
           case '2':
-            setTab(tabs[1].id);
+            selectTab(tabs[1].id);
             event.preventDefault();
             event.stopPropagation();
             break;
@@ -232,6 +251,10 @@ export default function DevTools({
       }
     };
   }, [bridge]);
+
+  useEffect(() => {
+    logEvent({event_name: 'loaded-dev-tools'});
+  }, []);
   return (
     <BridgeContext.Provider value={bridge}>
       <StoreContext.Provider value={store}>
@@ -265,7 +288,7 @@ export default function DevTools({
                                     <TabBar
                                       currentTab={tab}
                                       id="DevTools"
-                                      selectTab={setTab}
+                                      selectTab={selectTab}
                                       tabs={tabs}
                                       type="navigation"
                                     />

commit a45533cc2511cffa972bf58b68789c9b8aeea516
Author: Gabriel Trompiz <gab.tc@icloud.com>
Date:   Thu Oct 14 07:31:45 2021 -0500

    Allow to use the Profiler when no client is connected in standalone DevTools (#22551)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 0fa4a44013..781ad9d902 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -38,6 +38,7 @@ import UnsupportedVersionDialog from './UnsupportedVersionDialog';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 import {useLocalStorage} from './hooks';
 import ThemeProvider from './ThemeProvider';
+import {LOCAL_STORAGE_DEFAULT_TAB_KEY} from '../../constants';
 
 import styles from './DevTools.css';
 
@@ -143,7 +144,7 @@ export default function DevTools({
   hideViewSourceAction,
 }: Props) {
   const [currentTab, setTab] = useLocalStorage<TabID>(
-    'React::DevTools::defaultTab',
+    LOCAL_STORAGE_DEFAULT_TAB_KEY,
     defaultTab,
   );
 

commit 930c9e7eeb4c9721e1b8dee074c2eef4d1eae5dc
Author: Juan <jstejada@fb.com>
Date:   Fri Oct 15 11:27:13 2021 -0400

    Show warning in UI when duplicate installations of DevTools extension are detected (#22563)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 781ad9d902..8f1b6a22c1 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -34,6 +34,7 @@ import {SchedulingProfilerContextController} from 'react-devtools-scheduling-pro
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
 import UnsupportedBridgeProtocolDialog from './UnsupportedBridgeProtocolDialog';
+import DuplicateInstallationDialog from './DuplicateInstallationDialog';
 import UnsupportedVersionDialog from './UnsupportedVersionDialog';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 import {useLocalStorage} from './hooks';
@@ -73,6 +74,7 @@ export type Props = {|
   enabledInspectedElementContextMenu?: boolean,
   showTabBar?: boolean,
   store: Store,
+  warnIfDuplicateInstallation?: boolean,
   warnIfLegacyBackendDetected?: boolean,
   warnIfUnsupportedVersionDetected?: boolean,
   viewAttributeSourceFunction?: ?ViewAttributeSource,
@@ -132,6 +134,7 @@ export default function DevTools({
   profilerPortalContainer,
   showTabBar = false,
   store,
+  warnIfDuplicateInstallation = false,
   warnIfLegacyBackendDetected = false,
   warnIfUnsupportedVersionDetected = false,
   viewAttributeSourceFunction,
@@ -319,6 +322,7 @@ export default function DevTools({
                 </ViewElementSourceContext.Provider>
               </SettingsContextController>
               <UnsupportedBridgeProtocolDialog />
+              {warnIfDuplicateInstallation && <DuplicateInstallationDialog />}
               {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
               {warnIfUnsupportedVersionDetected && <UnsupportedVersionDialog />}
             </ModalDialogContextController>

commit 26bc8ff9bfcdb67e255fea424b56909899ac208b
Author: Juan <jstejada@fb.com>
Date:   Wed Oct 27 16:34:44 2021 -0400

    Revert logic for checking for duplicate installations of DevTools (#22638)
    
    * Revert "Only show DevTools warning about unrecognized build in Chrome (#22571)"
    
    This reverts commit b72dc8e9300f5ae997f7f5cfcd79b604cca3df0c.
    
    * Revert "Show warning in UI when duplicate installations of DevTools extension are detected (#22563)"
    
    This reverts commit 930c9e7eeb4c9721e1b8dee074c2eef4d1eae5dc.
    
    * Revert "Prevent errors/crashing when multiple installs of DevTools are present (#22517)"
    
    This reverts commit 545d4c2de7934a43b0c5d3ce050d77b4c3113bd3.
    
    * Remove all references to passing extensionId in postMessage
    
    * Keep build changes
    
    * lint

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 8f1b6a22c1..781ad9d902 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -34,7 +34,6 @@ import {SchedulingProfilerContextController} from 'react-devtools-scheduling-pro
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
 import UnsupportedBridgeProtocolDialog from './UnsupportedBridgeProtocolDialog';
-import DuplicateInstallationDialog from './DuplicateInstallationDialog';
 import UnsupportedVersionDialog from './UnsupportedVersionDialog';
 import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 import {useLocalStorage} from './hooks';
@@ -74,7 +73,6 @@ export type Props = {|
   enabledInspectedElementContextMenu?: boolean,
   showTabBar?: boolean,
   store: Store,
-  warnIfDuplicateInstallation?: boolean,
   warnIfLegacyBackendDetected?: boolean,
   warnIfUnsupportedVersionDetected?: boolean,
   viewAttributeSourceFunction?: ?ViewAttributeSource,
@@ -134,7 +132,6 @@ export default function DevTools({
   profilerPortalContainer,
   showTabBar = false,
   store,
-  warnIfDuplicateInstallation = false,
   warnIfLegacyBackendDetected = false,
   warnIfUnsupportedVersionDetected = false,
   viewAttributeSourceFunction,
@@ -322,7 +319,6 @@ export default function DevTools({
                 </ViewElementSourceContext.Provider>
               </SettingsContextController>
               <UnsupportedBridgeProtocolDialog />
-              {warnIfDuplicateInstallation && <DuplicateInstallationDialog />}
               {warnIfLegacyBackendDetected && <WarnIfLegacyBackendDetected />}
               {warnIfUnsupportedVersionDetected && <UnsupportedVersionDialog />}
             </ModalDialogContextController>

commit 1bf6deb865052111474f2988bb831de13d09c560
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Nov 4 10:02:06 2021 -0400

    Renamed packages/react-devtools-scheduling-profiler to packages/react-devtools-timeline (#22691)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 781ad9d902..b0b8f03032 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -30,7 +30,7 @@ import ViewElementSourceContext from './Components/ViewElementSourceContext';
 import FetchFileWithCachingContext from './Components/FetchFileWithCachingContext';
 import HookNamesModuleLoaderContext from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
-import {SchedulingProfilerContextController} from 'react-devtools-scheduling-profiler/src/SchedulingProfilerContext';
+import {SchedulingProfilerContextController} from 'react-devtools-timeline/src/SchedulingProfilerContext';
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
 import UnsupportedBridgeProtocolDialog from './UnsupportedBridgeProtocolDialog';

commit 13455d26d1904519c53686d6f295d4eb50b6c2fc
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Nov 4 11:40:45 2021 -0400

    Cleaned up remaining "scheduling profiler" references in DevTools (#22696)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index b0b8f03032..b16429b5bc 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -30,7 +30,7 @@ import ViewElementSourceContext from './Components/ViewElementSourceContext';
 import FetchFileWithCachingContext from './Components/FetchFileWithCachingContext';
 import HookNamesModuleLoaderContext from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
-import {SchedulingProfilerContextController} from 'react-devtools-timeline/src/SchedulingProfilerContext';
+import {TimelineContextController} from 'react-devtools-timeline/src/TimelineContext';
 import {ModalDialogContextController} from './ModalDialog';
 import ReactLogo from './ReactLogo';
 import UnsupportedBridgeProtocolDialog from './UnsupportedBridgeProtocolDialog';
@@ -273,7 +273,7 @@ export default function DevTools({
                       value={fetchFileWithCaching || null}>
                       <TreeContextController>
                         <ProfilerContextController>
-                          <SchedulingProfilerContextController>
+                          <TimelineContextController>
                             <ThemeProvider>
                               <div
                                 className={styles.DevTools}
@@ -311,7 +311,7 @@ export default function DevTools({
                                 </div>
                               </div>
                             </ThemeProvider>
-                          </SchedulingProfilerContextController>
+                          </TimelineContextController>
                         </ProfilerContextController>
                       </TreeContextController>
                     </FetchFileWithCachingContext.Provider>

commit 2e1c8841e97923e7af50c5c5311e3724b7b6555d
Author: Blake Friedman <blakef@fb.com>
Date:   Tue Jun 28 22:15:24 2022 +0100

    [DevTools] front-end for profiling event stack (#24805)
    
    * [DevTools] front-end for profiling event stack
    
    Adds a side-bar to the profiling tab. Users can now select an update event, and are
    shown the callstack from the originating component. When a source path is available
    there is now UI to jump to source.
    
    Add FB enabled feature flag: enableProfilerComponentTree for the side-bar.
    
    resolves #24170

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index b16429b5bc..49c947ba91 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -27,6 +27,7 @@ import TabBar from './TabBar';
 import {SettingsContextController} from './Settings/SettingsContext';
 import {TreeContextController} from './Components/TreeContext';
 import ViewElementSourceContext from './Components/ViewElementSourceContext';
+import ViewSourceContext from './Components/ViewSourceContext';
 import FetchFileWithCachingContext from './Components/FetchFileWithCachingContext';
 import HookNamesModuleLoaderContext from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
@@ -57,6 +58,7 @@ export type ViewElementSource = (
   id: number,
   inspectedElement: InspectedElement,
 ) => void;
+export type ViewSourceLine = (url: string, row: number, column: number) => void;
 export type ViewAttributeSource = (
   id: number,
   path: Array<string | number>,
@@ -77,6 +79,7 @@ export type Props = {|
   warnIfUnsupportedVersionDetected?: boolean,
   viewAttributeSourceFunction?: ?ViewAttributeSource,
   viewElementSourceFunction?: ?ViewElementSource,
+  viewSourceLineFunction?: ?ViewSourceLine,
   readOnly?: boolean,
   hideSettings?: boolean,
   hideToggleErrorAction?: boolean,
@@ -136,6 +139,7 @@ export default function DevTools({
   warnIfUnsupportedVersionDetected = false,
   viewAttributeSourceFunction,
   viewElementSourceFunction,
+  viewSourceLineFunction,
   readOnly,
   hideSettings,
   hideToggleErrorAction,
@@ -199,6 +203,15 @@ export default function DevTools({
     [canViewElementSourceFunction, viewElementSourceFunction],
   );
 
+  const viewSource = useMemo(
+    () => ({
+      viewSourceLineFunction: viewSourceLineFunction || null,
+      // todo(blakef): Add inspect(...) method here and remove viewElementSource
+      // to consolidate source code inspection.
+    }),
+    [viewSourceLineFunction],
+  );
+
   const contextMenu = useMemo(
     () => ({
       isEnabledForInspectedElement: enabledInspectedElementContextMenu,
@@ -267,55 +280,59 @@ export default function DevTools({
                 componentsPortalContainer={componentsPortalContainer}
                 profilerPortalContainer={profilerPortalContainer}>
                 <ViewElementSourceContext.Provider value={viewElementSource}>
-                  <HookNamesModuleLoaderContext.Provider
-                    value={hookNamesModuleLoaderFunction || null}>
-                    <FetchFileWithCachingContext.Provider
-                      value={fetchFileWithCaching || null}>
-                      <TreeContextController>
-                        <ProfilerContextController>
-                          <TimelineContextController>
-                            <ThemeProvider>
-                              <div
-                                className={styles.DevTools}
-                                ref={devToolsRef}
-                                data-react-devtools-portal-root={true}>
-                                {showTabBar && (
-                                  <div className={styles.TabBar}>
-                                    <ReactLogo />
-                                    <span className={styles.DevToolsVersion}>
-                                      {process.env.DEVTOOLS_VERSION}
-                                    </span>
-                                    <div className={styles.Spacer} />
-                                    <TabBar
-                                      currentTab={tab}
-                                      id="DevTools"
-                                      selectTab={selectTab}
-                                      tabs={tabs}
-                                      type="navigation"
+                  <ViewSourceContext.Provider value={viewSource}>
+                    <HookNamesModuleLoaderContext.Provider
+                      value={hookNamesModuleLoaderFunction || null}>
+                      <FetchFileWithCachingContext.Provider
+                        value={fetchFileWithCaching || null}>
+                        <TreeContextController>
+                          <ProfilerContextController>
+                            <TimelineContextController>
+                              <ThemeProvider>
+                                <div
+                                  className={styles.DevTools}
+                                  ref={devToolsRef}
+                                  data-react-devtools-portal-root={true}>
+                                  {showTabBar && (
+                                    <div className={styles.TabBar}>
+                                      <ReactLogo />
+                                      <span className={styles.DevToolsVersion}>
+                                        {process.env.DEVTOOLS_VERSION}
+                                      </span>
+                                      <div className={styles.Spacer} />
+                                      <TabBar
+                                        currentTab={tab}
+                                        id="DevTools"
+                                        selectTab={selectTab}
+                                        tabs={tabs}
+                                        type="navigation"
+                                      />
+                                    </div>
+                                  )}
+                                  <div
+                                    className={styles.TabContent}
+                                    hidden={tab !== 'components'}>
+                                    <Components
+                                      portalContainer={
+                                        componentsPortalContainer
+                                      }
+                                    />
+                                  </div>
+                                  <div
+                                    className={styles.TabContent}
+                                    hidden={tab !== 'profiler'}>
+                                    <Profiler
+                                      portalContainer={profilerPortalContainer}
                                     />
                                   </div>
-                                )}
-                                <div
-                                  className={styles.TabContent}
-                                  hidden={tab !== 'components'}>
-                                  <Components
-                                    portalContainer={componentsPortalContainer}
-                                  />
-                                </div>
-                                <div
-                                  className={styles.TabContent}
-                                  hidden={tab !== 'profiler'}>
-                                  <Profiler
-                                    portalContainer={profilerPortalContainer}
-                                  />
                                 </div>
-                              </div>
-                            </ThemeProvider>
-                          </TimelineContextController>
-                        </ProfilerContextController>
-                      </TreeContextController>
-                    </FetchFileWithCachingContext.Provider>
-                  </HookNamesModuleLoaderContext.Provider>
+                              </ThemeProvider>
+                            </TimelineContextController>
+                          </ProfilerContextController>
+                        </TreeContextController>
+                      </FetchFileWithCachingContext.Provider>
+                    </HookNamesModuleLoaderContext.Provider>
+                  </ViewSourceContext.Provider>
                 </ViewElementSourceContext.Provider>
               </SettingsContextController>
               <UnsupportedBridgeProtocolDialog />

commit cd80d3274d48155d0f83347daab3eda57009f41b
Author: Luna Ruan <lunaris.ruan@gmail.com>
Date:   Wed Jun 29 13:38:27 2022 -0400

    [DevTools] Add column number to viewSourceLineFunction (#24814)
    
    Add column number for `viewSourceLineFunction` and renamed the function to `viewUrlSourceFunction` to match the other source function naming conventions

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 49c947ba91..a78261e9fc 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -58,7 +58,7 @@ export type ViewElementSource = (
   id: number,
   inspectedElement: InspectedElement,
 ) => void;
-export type ViewSourceLine = (url: string, row: number, column: number) => void;
+export type ViewUrlSource = (url: string, row: number, column: number) => void;
 export type ViewAttributeSource = (
   id: number,
   path: Array<string | number>,
@@ -79,7 +79,7 @@ export type Props = {|
   warnIfUnsupportedVersionDetected?: boolean,
   viewAttributeSourceFunction?: ?ViewAttributeSource,
   viewElementSourceFunction?: ?ViewElementSource,
-  viewSourceLineFunction?: ?ViewSourceLine,
+  viewUrlSourceFunction?: ?ViewUrlSource,
   readOnly?: boolean,
   hideSettings?: boolean,
   hideToggleErrorAction?: boolean,
@@ -139,7 +139,7 @@ export default function DevTools({
   warnIfUnsupportedVersionDetected = false,
   viewAttributeSourceFunction,
   viewElementSourceFunction,
-  viewSourceLineFunction,
+  viewUrlSourceFunction,
   readOnly,
   hideSettings,
   hideToggleErrorAction,
@@ -205,11 +205,11 @@ export default function DevTools({
 
   const viewSource = useMemo(
     () => ({
-      viewSourceLineFunction: viewSourceLineFunction || null,
+      viewUrlSourceFunction: viewUrlSourceFunction || null,
       // todo(blakef): Add inspect(...) method here and remove viewElementSource
       // to consolidate source code inspection.
     }),
-    [viewSourceLineFunction],
+    [viewUrlSourceFunction],
   );
 
   const contextMenu = useMemo(

commit 8003ab9cf5c711eb00f741bbd89def56b066b999
Author: Jan Kassens <jan@kassens.net>
Date:   Fri Sep 9 16:03:48 2022 -0400

    Flow: remove explicit object syntax (#25223)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index a78261e9fc..c29febb628 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -67,7 +67,7 @@ export type CanViewElementSource = (
   inspectedElement: InspectedElement,
 ) => boolean;
 
-export type Props = {|
+export type Props = {
   bridge: FrontendBridge,
   browserTheme?: BrowserTheme,
   canViewElementSourceFunction?: ?CanViewElementSource,
@@ -105,7 +105,7 @@ export type Props = {|
   fetchFileWithCaching?: ?FetchFileWithCaching,
   // TODO (Webpack 5) Hopefully we can remove this prop after the Webpack 5 migration.
   hookNamesModuleLoaderFunction?: ?HookNamesModuleLoaderFunction,
-|};
+};
 
 const componentsTab = {
   id: ('components': TabID),

commit e6a062bd2a1d53f7349a0d0950d89593b63a0c3c
Author: Jan Kassens <jan@kassens.net>
Date:   Tue Sep 13 12:03:20 2022 -0400

    Flow: add simple explicit export types to Devtools (#25251)

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index c29febb628..879b9ba0a7 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -146,7 +146,7 @@ export default function DevTools({
   hideToggleSuspenseAction,
   hideLogAction,
   hideViewSourceAction,
-}: Props) {
+}: Props): React.Node {
   const [currentTab, setTab] = useLocalStorage<TabID>(
     LOCAL_STORAGE_DEFAULT_TAB_KEY,
     defaultTab,

commit 9cdf8a99edcfd94d7420835ea663edca04237527
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Oct 18 11:19:24 2022 -0400

    [Codemod] Update copyright header to Meta (#25315)
    
    * Facebook -> Meta in copyright
    
    rg --files | xargs sed -i 's#Copyright (c) Facebook, Inc. and its affiliates.#Copyright (c) Meta Platforms, Inc. and affiliates.#g'
    
    * Manual tweaks

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 879b9ba0a7..59a2ab55fe 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -1,5 +1,5 @@
 /**
- * Copyright (c) Facebook, Inc. and its affiliates.
+ * Copyright (c) Meta Platforms, Inc. and affiliates.
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE file in the root directory of this source tree.

commit 451736b557ebf53dd6d6b92c55cad14f7eba864c
Author: Mengdi Chen <mengdi@fb.com>
Date:   Mon Apr 10 17:07:05 2023 -0400

    [DevTools][BE] move shared types & constants to consolidated locations (#26572)
    
    ## Summary
    
    This pull request aims to improve the maintainability of the codebase by
    consolidating types and constants that are shared between the backend
    and frontend. This consolidation will allow us to maintain backwards
    compatibility in the frontend in the future.
    
    To achieve this, we have moved the shared types and constants to the
    following blessed files:
    
    - react-devtools-shared/src/constants
    - react-devtools-shared/src/types
    - react-devtools-shared/src/backend/types
    - react-devtools-shared/src/backend/NativeStyleEditor/types
    
    Please note that the inclusion of NativeStyleEditor in this list is
    temporary, and we plan to remove it once we have a better plugin system
    in place.
    
    ## How did you test this change?
    
    I have tested it by running `yarn flow dom-node`, which reports no
    errors.

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 59a2ab55fe..ea7a996d32 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -40,6 +40,7 @@ import WarnIfLegacyBackendDetected from './WarnIfLegacyBackendDetected';
 import {useLocalStorage} from './hooks';
 import ThemeProvider from './ThemeProvider';
 import {LOCAL_STORAGE_DEFAULT_TAB_KEY} from '../../constants';
+import {logEvent} from '../../Logger';
 
 import styles from './DevTools.css';
 
@@ -49,9 +50,8 @@ import type {InspectedElement} from 'react-devtools-shared/src/devtools/views/Co
 import type {FetchFileWithCaching} from './Components/FetchFileWithCachingContext';
 import type {HookNamesModuleLoaderFunction} from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
-import {logEvent} from '../../Logger';
+import type {BrowserTheme} from 'react-devtools-shared/src/types';
 
-export type BrowserTheme = 'dark' | 'light';
 export type TabID = 'components' | 'profiler';
 
 export type ViewElementSource = (

commit 8fbd3079425eaff85ec1b52b0eefecdd44ba7289
Author: Ruslan Lesiutin <rdlesyutin@gmail.com>
Date:   Tue Aug 29 12:09:26 2023 +0100

    refactor: refactored devtools browser extension scripts to improve port management and service worker lifetime (#27215)
    
    Fixes https://github.com/facebook/react/issues/27119,
    https://github.com/facebook/react/issues/27185.
    
    Fixed:
    - React DevTools now works as expected when user performs in-tab
    navigation, previously it was just stuck.
    
    
    https://github.com/facebook/react/assets/28902667/b11c5f84-7155-47a5-8b5a-7e90baca5347
    
    - When user closes browser DevTools panel, we now do some cleanup to
    disconnect ports and emit shutdown event for bridge. This should fix the
    issue with registering duplicated fibers with the same id in Store.
    
    Changed:
    - We reconnect proxy port once in 25 seconds, in order to [keep service
    worker
    alive](https://developer.chrome.com/docs/extensions/whatsnew/#m110-sw-idle).
    - Instead of unregistering dynamically injected content scripts, wen now
    get list of already registered scripts and filter them out from scripts
    that we want to inject again, see dynamicallyInjectContentScripts.js.
    - Split `main.js` and `background.js` into multiple files.
    
    Tested on Chromium and Firefox browsers.

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index ea7a996d32..3eef04ece7 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -269,6 +269,7 @@ export default function DevTools({
   useEffect(() => {
     logEvent({event_name: 'loaded-dev-tools'});
   }, []);
+
   return (
     <BridgeContext.Provider value={bridge}>
       <StoreContext.Provider value={store}>

commit 77ec61885fb19607cdd116a6790095afa40b5a94
Author: Ruslan Lesiutin <rdlesyutin@gmail.com>
Date:   Tue Oct 10 18:10:17 2023 +0100

    fix[devtools/inspectElement]: dont pause initial inspectElement call when user switches tabs (#27488)
    
    There are not so many changes, most of them are changing imports,
    because I've moved types for UI in a single file.
    
    In https://github.com/facebook/react/pull/27357 I've added support for
    pausing polling events: when user inspects an element, we start polling
    React DevTools backend for updates in props / state. If user switches
    tabs, extension's service worker can be killed by browser and this
    polling will start spamming errors.
    
    What I've missed is that we also have a separate call for this API, but
    which is executed only once when user selects an element. We don't
    handle promise rejection here and this can lead to some errors when user
    selects an element and switches tabs right after it.
    
    The only change here is that this API now has
    `shouldListenToPauseEvents` param, which is `true` for polling, so we
    will pause polling once user switches tabs. It is `false` by default, so
    we won't pause initial call by accident.
    
    
    https://github.com/hoxyq/react/blob/af8beeebf63b5824497fcd0bb35b7c0ac8fe60a0/packages/react-devtools-shared/src/backendAPI.js#L96

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 3eef04ece7..934ebd6928 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -46,11 +46,11 @@ import styles from './DevTools.css';
 
 import './root.css';
 
-import type {InspectedElement} from 'react-devtools-shared/src/devtools/views/Components/types';
+import type {InspectedElement} from 'react-devtools-shared/src/frontend/types';
 import type {FetchFileWithCaching} from './Components/FetchFileWithCachingContext';
 import type {HookNamesModuleLoaderFunction} from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
-import type {BrowserTheme} from 'react-devtools-shared/src/types';
+import type {BrowserTheme} from 'react-devtools-shared/src/frontend/types';
 
 export type TabID = 'components' | 'profiler';
 

commit e5287287aacd3c51d24e223651b7f38ece584c49
Author: Ruslan Lesiutin <rdlesyutin@gmail.com>
Date:   Tue Mar 5 12:32:11 2024 +0000

    feat[devtools]: symbolicate source for inspected element (#28471)
    
    Stacked on https://github.com/facebook/react/pull/28351, please review
    only the last commit.
    
    Top-level description of the approach:
    1. Once user selects an element from the tree, frontend asks backend to
    return the inspected element, this is where we simulate an error
    happening in `render` function of the component and then we parse the
    error stack. As an improvement, we should probably migrate from custom
    implementation of error stack parser to `error-stack-parser` from npm.
    2. When frontend receives the inspected element and this object is being
    propagated, we create a Promise for symbolicated source, which is then
    passed down to all components, which are using `source`.
    3. These components use `use` hook for this promise and are wrapped in
    Suspense.
    
    Caching:
    1. For browser extension, we cache Promises based on requested resource
    + key + column, also added use of
    `chrome.devtools.inspectedWindow.getResource` API.
    2. For standalone case (RN), we cache based on requested resource url,
    we cache the content of it.

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 934ebd6928..9bee64ff95 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -27,7 +27,6 @@ import TabBar from './TabBar';
 import {SettingsContextController} from './Settings/SettingsContext';
 import {TreeContextController} from './Components/TreeContext';
 import ViewElementSourceContext from './Components/ViewElementSourceContext';
-import ViewSourceContext from './Components/ViewSourceContext';
 import FetchFileWithCachingContext from './Components/FetchFileWithCachingContext';
 import HookNamesModuleLoaderContext from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
@@ -46,25 +45,25 @@ import styles from './DevTools.css';
 
 import './root.css';
 
-import type {InspectedElement} from 'react-devtools-shared/src/frontend/types';
 import type {FetchFileWithCaching} from './Components/FetchFileWithCachingContext';
 import type {HookNamesModuleLoaderFunction} from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
 import type {BrowserTheme} from 'react-devtools-shared/src/frontend/types';
+import type {Source} from 'react-devtools-shared/src/shared/types';
 
 export type TabID = 'components' | 'profiler';
 
 export type ViewElementSource = (
-  id: number,
-  inspectedElement: InspectedElement,
+  source: Source,
+  symbolicatedSource: Source | null,
 ) => void;
-export type ViewUrlSource = (url: string, row: number, column: number) => void;
 export type ViewAttributeSource = (
   id: number,
   path: Array<string | number>,
 ) => void;
 export type CanViewElementSource = (
-  inspectedElement: InspectedElement,
+  source: Source,
+  symbolicatedSource: Source | null,
 ) => boolean;
 
 export type Props = {
@@ -79,7 +78,6 @@ export type Props = {
   warnIfUnsupportedVersionDetected?: boolean,
   viewAttributeSourceFunction?: ?ViewAttributeSource,
   viewElementSourceFunction?: ?ViewElementSource,
-  viewUrlSourceFunction?: ?ViewUrlSource,
   readOnly?: boolean,
   hideSettings?: boolean,
   hideToggleErrorAction?: boolean,
@@ -139,7 +137,6 @@ export default function DevTools({
   warnIfUnsupportedVersionDetected = false,
   viewAttributeSourceFunction,
   viewElementSourceFunction,
-  viewUrlSourceFunction,
   readOnly,
   hideSettings,
   hideToggleErrorAction,
@@ -203,15 +200,6 @@ export default function DevTools({
     [canViewElementSourceFunction, viewElementSourceFunction],
   );
 
-  const viewSource = useMemo(
-    () => ({
-      viewUrlSourceFunction: viewUrlSourceFunction || null,
-      // todo(blakef): Add inspect(...) method here and remove viewElementSource
-      // to consolidate source code inspection.
-    }),
-    [viewUrlSourceFunction],
-  );
-
   const contextMenu = useMemo(
     () => ({
       isEnabledForInspectedElement: enabledInspectedElementContextMenu,
@@ -281,59 +269,55 @@ export default function DevTools({
                 componentsPortalContainer={componentsPortalContainer}
                 profilerPortalContainer={profilerPortalContainer}>
                 <ViewElementSourceContext.Provider value={viewElementSource}>
-                  <ViewSourceContext.Provider value={viewSource}>
-                    <HookNamesModuleLoaderContext.Provider
-                      value={hookNamesModuleLoaderFunction || null}>
-                      <FetchFileWithCachingContext.Provider
-                        value={fetchFileWithCaching || null}>
-                        <TreeContextController>
-                          <ProfilerContextController>
-                            <TimelineContextController>
-                              <ThemeProvider>
-                                <div
-                                  className={styles.DevTools}
-                                  ref={devToolsRef}
-                                  data-react-devtools-portal-root={true}>
-                                  {showTabBar && (
-                                    <div className={styles.TabBar}>
-                                      <ReactLogo />
-                                      <span className={styles.DevToolsVersion}>
-                                        {process.env.DEVTOOLS_VERSION}
-                                      </span>
-                                      <div className={styles.Spacer} />
-                                      <TabBar
-                                        currentTab={tab}
-                                        id="DevTools"
-                                        selectTab={selectTab}
-                                        tabs={tabs}
-                                        type="navigation"
-                                      />
-                                    </div>
-                                  )}
-                                  <div
-                                    className={styles.TabContent}
-                                    hidden={tab !== 'components'}>
-                                    <Components
-                                      portalContainer={
-                                        componentsPortalContainer
-                                      }
-                                    />
-                                  </div>
-                                  <div
-                                    className={styles.TabContent}
-                                    hidden={tab !== 'profiler'}>
-                                    <Profiler
-                                      portalContainer={profilerPortalContainer}
+                  <HookNamesModuleLoaderContext.Provider
+                    value={hookNamesModuleLoaderFunction || null}>
+                    <FetchFileWithCachingContext.Provider
+                      value={fetchFileWithCaching || null}>
+                      <TreeContextController>
+                        <ProfilerContextController>
+                          <TimelineContextController>
+                            <ThemeProvider>
+                              <div
+                                className={styles.DevTools}
+                                ref={devToolsRef}
+                                data-react-devtools-portal-root={true}>
+                                {showTabBar && (
+                                  <div className={styles.TabBar}>
+                                    <ReactLogo />
+                                    <span className={styles.DevToolsVersion}>
+                                      {process.env.DEVTOOLS_VERSION}
+                                    </span>
+                                    <div className={styles.Spacer} />
+                                    <TabBar
+                                      currentTab={tab}
+                                      id="DevTools"
+                                      selectTab={selectTab}
+                                      tabs={tabs}
+                                      type="navigation"
                                     />
                                   </div>
+                                )}
+                                <div
+                                  className={styles.TabContent}
+                                  hidden={tab !== 'components'}>
+                                  <Components
+                                    portalContainer={componentsPortalContainer}
+                                  />
+                                </div>
+                                <div
+                                  className={styles.TabContent}
+                                  hidden={tab !== 'profiler'}>
+                                  <Profiler
+                                    portalContainer={profilerPortalContainer}
+                                  />
                                 </div>
-                              </ThemeProvider>
-                            </TimelineContextController>
-                          </ProfilerContextController>
-                        </TreeContextController>
-                      </FetchFileWithCachingContext.Provider>
-                    </HookNamesModuleLoaderContext.Provider>
-                  </ViewSourceContext.Provider>
+                              </div>
+                            </ThemeProvider>
+                          </TimelineContextController>
+                        </ProfilerContextController>
+                      </TreeContextController>
+                    </FetchFileWithCachingContext.Provider>
+                  </HookNamesModuleLoaderContext.Provider>
                 </ViewElementSourceContext.Provider>
               </SettingsContextController>
               <UnsupportedBridgeProtocolDialog />

commit 7ff4d057b69683dd6c512c7940dbadd10788306f
Author: Piotr Tomczewski <piotr.tomczewski@callstack.com>
Date:   Tue Apr 15 12:10:00 2025 +0200

    [DevTools] feat: show changed hooks names in the Profiler tab (#31398)
    
    <!--
      Thanks for submitting a pull request!
    We appreciate you spending the time to work on these changes. Please
    provide enough information so that others can review your pull request.
    The three fields below are mandatory.
    
    Before submitting a pull request, please make sure the following is
    done:
    
    1. Fork [the repository](https://github.com/facebook/react) and create
    your branch from `main`.
      2. Run `yarn` in the repository root.
    3. If you've fixed a bug or added code that should be tested, add tests!
    4. Ensure the test suite passes (`yarn test`). Tip: `yarn test --watch
    TestName` is helpful in development.
    5. Run `yarn test --prod` to test in the production environment. It
    supports the same options as `yarn test`.
    6. If you need a debugger, run `yarn test --debug --watch TestName`,
    open `chrome://inspect`, and press "Inspect".
    7. Format your code with
    [prettier](https://github.com/prettier/prettier) (`yarn prettier`).
    8. Make sure your code lints (`yarn lint`). Tip: `yarn linc` to only
    check changed files.
      9. Run the [Flow](https://flowtype.org/) type checks (`yarn flow`).
      10. If you haven't already, complete the CLA.
    
    Learn more about contributing:
    https://reactjs.org/docs/how-to-contribute.html
    -->
    
    ## Summary
    
    This PR adds support for displaying the names of changed hooks directly
    in the Profiler tab, making it easier to identify specific updates.
    
    A `HookChangeSummary` component has been introduced to show these hook
    names, with a `displayMode` prop that toggles between `“compact”` for
    tooltips and `“detailed”` for more in-depth views. This keeps tooltip
    summaries concise while allowing for a full breakdown where needed.
    
    This functionality also respects the `“Always parse hook names from
    source”` setting from the Component inspector, as it uses the same
    caching mechanism already in place for the Components tab. Additionally,
    even without hook names parsed, the Profiler will now display hook types
    (like `State`, `Callback`, etc.) based on data from `inspectedElement`.
    
    To enable this across the DevTools, `InspectedElementContext` has been
    moved higher in the component tree, allowing it to be shared between the
    Profiler and Components tabs. This update allows hook name data to be
    reused across tabs without duplication.
    
    Additionally, a `getAlreadyLoadedHookNames` helper function was added to
    efficiently access cached hook names, reducing the need for repeated
    fetching when displaying changes.
    
    These changes improve the ability to track specific hook updates within
    the Profiler tab, making it clearer to see what’s changed.
    
    ### Before
    Previously, the Profiler tab displayed only the IDs of changed hooks, as
    shown below:
    <img width="350" alt="Screenshot 2024-11-01 at 12 02 21_cropped"
    src="https://github.com/user-attachments/assets/7a5f5f67-f1c8-4261-9ba3-1c76c9a88af3">
    
    ### After (without hook names parsed)
    When hook names aren’t parsed, custom hooks and hook types are displayed
    based on the inspectedElement data:
    <img width="350" alt="Screenshot 2024-11-01 at 12 03 09_cropped"
    src="https://github.com/user-attachments/assets/ed857a6d-e6ef-4e5b-982c-bf30c2d8a7e2">
    
    ### After (with hook names parsed)
    Once hook names are fully parsed, the Profiler tab provides a complete
    breakdown of specific hooks that have changed:
    <img width="350" alt="Screenshot 2024-11-01 at 12 03 14_cropped"
    src="https://github.com/user-attachments/assets/1ddfcc35-7474-4f4d-a084-f4e9f993a5bf">
    
    This should resolve #21856 🎉

diff --git a/packages/react-devtools-shared/src/devtools/views/DevTools.js b/packages/react-devtools-shared/src/devtools/views/DevTools.js
index 9bee64ff95..bd14bdda0f 100644
--- a/packages/react-devtools-shared/src/devtools/views/DevTools.js
+++ b/packages/react-devtools-shared/src/devtools/views/DevTools.js
@@ -28,6 +28,7 @@ import {SettingsContextController} from './Settings/SettingsContext';
 import {TreeContextController} from './Components/TreeContext';
 import ViewElementSourceContext from './Components/ViewElementSourceContext';
 import FetchFileWithCachingContext from './Components/FetchFileWithCachingContext';
+import {InspectedElementContextController} from './Components/InspectedElementContext';
 import HookNamesModuleLoaderContext from 'react-devtools-shared/src/devtools/views/Components/HookNamesModuleLoaderContext';
 import {ProfilerContextController} from './Profiler/ProfilerContext';
 import {TimelineContextController} from 'react-devtools-timeline/src/TimelineContext';
@@ -276,43 +277,47 @@ export default function DevTools({
                       <TreeContextController>
                         <ProfilerContextController>
                           <TimelineContextController>
-                            <ThemeProvider>
-                              <div
-                                className={styles.DevTools}
-                                ref={devToolsRef}
-                                data-react-devtools-portal-root={true}>
-                                {showTabBar && (
-                                  <div className={styles.TabBar}>
-                                    <ReactLogo />
-                                    <span className={styles.DevToolsVersion}>
-                                      {process.env.DEVTOOLS_VERSION}
-                                    </span>
-                                    <div className={styles.Spacer} />
-                                    <TabBar
-                                      currentTab={tab}
-                                      id="DevTools"
-                                      selectTab={selectTab}
-                                      tabs={tabs}
-                                      type="navigation"
+                            <InspectedElementContextController>
+                              <ThemeProvider>
+                                <div
+                                  className={styles.DevTools}
+                                  ref={devToolsRef}
+                                  data-react-devtools-portal-root={true}>
+                                  {showTabBar && (
+                                    <div className={styles.TabBar}>
+                                      <ReactLogo />
+                                      <span className={styles.DevToolsVersion}>
+                                        {process.env.DEVTOOLS_VERSION}
+                                      </span>
+                                      <div className={styles.Spacer} />
+                                      <TabBar
+                                        currentTab={tab}
+                                        id="DevTools"
+                                        selectTab={selectTab}
+                                        tabs={tabs}
+                                        type="navigation"
+                                      />
+                                    </div>
+                                  )}
+                                  <div
+                                    className={styles.TabContent}
+                                    hidden={tab !== 'components'}>
+                                    <Components
+                                      portalContainer={
+                                        componentsPortalContainer
+                                      }
+                                    />
+                                  </div>
+                                  <div
+                                    className={styles.TabContent}
+                                    hidden={tab !== 'profiler'}>
+                                    <Profiler
+                                      portalContainer={profilerPortalContainer}
                                     />
                                   </div>
-                                )}
-                                <div
-                                  className={styles.TabContent}
-                                  hidden={tab !== 'components'}>
-                                  <Components
-                                    portalContainer={componentsPortalContainer}
-                                  />
-                                </div>
-                                <div
-                                  className={styles.TabContent}
-                                  hidden={tab !== 'profiler'}>
-                                  <Profiler
-                                    portalContainer={profilerPortalContainer}
-                                  />
                                 </div>
-                              </div>
-                            </ThemeProvider>
+                              </ThemeProvider>
+                            </InspectedElementContextController>
                           </TimelineContextController>
                         </ProfilerContextController>
                       </TreeContextController>

