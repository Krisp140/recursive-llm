# Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- packages/react-dom/src/__tests__/ReactDOMOption-test.js

commit 313611572b6567d229367ed20ff63d1bca8610bb
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Oct 19 19:50:24 2017 +0100

    Reorganize code structure (#11288)
    
    * Move files and tests to more meaningful places
    
    * Fix the build
    
    Now that we import reconciler via react-reconciler, I needed to make a few tweaks.
    
    * Update sizes
    
    * Move @preventMunge directive to FB header
    
    * Revert unintentional change
    
    * Fix Flow coverage
    
    I forgot to @flow-ify those files. This uncovered some issues.
    
    * Prettier, I love you but you're bringing me down
    Prettier, I love you but you're bringing me down
    
    Like a rat in a cage
    Pulling minimum wage
    Prettier, I love you but you're bringing me down
    
    Prettier, you're safer and you're wasting my time
    Our records all show you were filthy but fine
    But they shuttered your stores
    When you opened the doors
    To the cops who were bored once they'd run out of crime
    
    Prettier, you're perfect, oh, please don't change a thing
    Your mild billionaire mayor's now convinced he's a king
    So the boring collect
    I mean all disrespect
    In the neighborhood bars I'd once dreamt I would drink
    
    Prettier, I love you but you're freaking me out
    There's a ton of the twist but we're fresh out of shout
    Like a death in the hall
    That you hear through your wall
    Prettier, I love you but you're freaking me out
    
    Prettier, I love you but you're bringing me down
    Prettier, I love you but you're bringing me down
    Like a death of the heart
    Jesus, where do I start?
    But you're still the one pool where I'd happily drown
    
    And oh! Take me off your mailing list
    For kids who think it still exists
    Yes, for those who think it still exists
    Maybe I'm wrong and maybe you're right
    Maybe I'm wrong and maybe you're right
    Maybe you're right, maybe I'm wrong
    And just maybe you're right
    
    And oh! Maybe mother told you true
    And there'll always be somebody there for you
    And you'll never be alone
    But maybe she's wrong and maybe I'm right
    And just maybe she's wrong
    Maybe she's wrong and maybe I'm right
    And if so, here's this song!

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
new file mode 100644
index 0000000000..d8719ceba8
--- /dev/null
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -0,0 +1,101 @@
+/**
+ * Copyright (c) 2013-present, Facebook, Inc.
+ *
+ * This source code is licensed under the MIT license found in the
+ * LICENSE file in the root directory of this source tree.
+ *
+ * @emails react-core
+ */
+
+'use strict';
+
+describe('ReactDOMOption', () => {
+  function normalizeCodeLocInfo(str) {
+    return str && str.replace(/\(at .+?:\d+\)/g, '(at **)');
+  }
+
+  var React;
+  var ReactDOM;
+  var ReactTestUtils;
+
+  beforeEach(() => {
+    React = require('react');
+    ReactDOM = require('react-dom');
+    ReactTestUtils = require('react-dom/test-utils');
+  });
+
+  it('should flatten children to a string', () => {
+    var stub = <option>{1} {'foo'}</option>;
+    stub = ReactTestUtils.renderIntoDocument(stub);
+    var node = ReactDOM.findDOMNode(stub);
+
+    expect(node.innerHTML).toBe('1 foo');
+  });
+
+  it('should ignore and warn invalid children types', () => {
+    spyOn(console, 'error');
+    var el = <option>{1} <div /> {2}</option>;
+    var node = ReactTestUtils.renderIntoDocument(el);
+    expect(node.innerHTML).toBe('1  2');
+    ReactTestUtils.renderIntoDocument(el);
+    // only warn once
+    expectDev(console.error.calls.count()).toBe(1);
+    expectDev(
+      normalizeCodeLocInfo(console.error.calls.argsFor(0)[0]),
+    ).toContain(
+      '<div> cannot appear as a child of <option>.\n' +
+        '    in div (at **)\n' +
+        '    in option (at **)',
+    );
+  });
+
+  it('should ignore null/undefined/false children without warning', () => {
+    var stub = <option>{1} {false}{true}{null}{undefined} {2}</option>;
+    spyOn(console, 'error');
+    stub = ReactTestUtils.renderIntoDocument(stub);
+
+    var node = ReactDOM.findDOMNode(stub);
+
+    expectDev(console.error.calls.count()).toBe(0);
+    expect(node.innerHTML).toBe('1  2');
+  });
+
+  it('should be able to use dangerouslySetInnerHTML on option', () => {
+    var stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
+    stub = ReactTestUtils.renderIntoDocument(stub);
+
+    var node = ReactDOM.findDOMNode(stub);
+    expect(node.innerHTML).toBe('foobar');
+  });
+
+  it('should set attribute for empty value', () => {
+    var container = document.createElement('div');
+    var option = ReactDOM.render(<option value="" />, container);
+    expect(option.hasAttribute('value')).toBe(true);
+    expect(option.getAttribute('value')).toBe('');
+
+    ReactDOM.render(<option value="lava" />, container);
+    expect(option.hasAttribute('value')).toBe(true);
+    expect(option.getAttribute('value')).toBe('lava');
+  });
+
+  it('should allow ignoring `value` on option', () => {
+    var a = 'a';
+    var stub = (
+      <select value="giraffe" onChange={() => {}}>
+        <option>monkey</option>
+        <option>gir{a}ffe</option>
+        <option>gorill{a}</option>
+      </select>
+    );
+    var options = stub.props.children;
+    var container = document.createElement('div');
+    stub = ReactDOM.render(stub, container);
+    var node = ReactDOM.findDOMNode(stub);
+
+    expect(node.selectedIndex).toBe(1);
+
+    ReactDOM.render(<select value="gorilla">{options}</select>, container);
+    expect(node.selectedIndex).toEqual(2);
+  });
+});

commit 94f44aeba72eacb04443974c2c6c91a050d61b1c
Author: Clement Hoang <clement.hoang24@gmail.com>
Date:   Tue Nov 7 18:09:33 2017 +0000

    Update prettier to 1.8.1 (#10785)
    
    * Change prettier dependency in package.json version 1.8.1
    
    * Update yarn.lock
    
    * Apply prettier changes
    
    * Fix ReactDOMServerIntegration-test.js
    
    * Fix test for ReactDOMComponent-test.js

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index d8719ceba8..b05ae5edb6 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -25,7 +25,11 @@ describe('ReactDOMOption', () => {
   });
 
   it('should flatten children to a string', () => {
-    var stub = <option>{1} {'foo'}</option>;
+    var stub = (
+      <option>
+        {1} {'foo'}
+      </option>
+    );
     stub = ReactTestUtils.renderIntoDocument(stub);
     var node = ReactDOM.findDOMNode(stub);
 
@@ -34,7 +38,11 @@ describe('ReactDOMOption', () => {
 
   it('should ignore and warn invalid children types', () => {
     spyOn(console, 'error');
-    var el = <option>{1} <div /> {2}</option>;
+    var el = (
+      <option>
+        {1} <div /> {2}
+      </option>
+    );
     var node = ReactTestUtils.renderIntoDocument(el);
     expect(node.innerHTML).toBe('1  2');
     ReactTestUtils.renderIntoDocument(el);
@@ -50,7 +58,14 @@ describe('ReactDOMOption', () => {
   });
 
   it('should ignore null/undefined/false children without warning', () => {
-    var stub = <option>{1} {false}{true}{null}{undefined} {2}</option>;
+    var stub = (
+      <option>
+        {1} {false}
+        {true}
+        {null}
+        {undefined} {2}
+      </option>
+    );
     spyOn(console, 'error');
     stub = ReactTestUtils.renderIntoDocument(stub);
 

commit 6041f481b7851d75649630eea489628d399cc3cf
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Wed Nov 22 13:02:26 2017 +0000

    Run Jest in production mode (#11616)
    
    * Move Jest setup files to /dev/ subdirectory
    
    * Clone Jest /dev/ files into /prod/
    
    * Move shared code into scripts/jest
    
    * Move Jest config into the scripts folder
    
    * Fix the equivalence test
    
    It fails because the config is now passed to Jest explicitly.
    But the test doesn't know about the config.
    
    To fix this, we just run it via `yarn test` (which includes the config).
    We already depend on Yarn for development anyway.
    
    * Add yarn test-prod to run Jest with production environment
    
    * Actually flip the production tests to run in prod environment
    
    This produces a bunch of errors:
    
    Test Suites: 64 failed, 58 passed, 122 total
    Tests:       740 failed, 26 skipped, 1809 passed, 2575 total
    Snapshots:   16 failed, 4 passed, 20 total
    
    * Ignore expectDev() calls in production
    
    Down from 740 to 175 failed.
    
    Test Suites: 44 failed, 78 passed, 122 total
    Tests:       175 failed, 26 skipped, 2374 passed, 2575 total
    Snapshots:   16 failed, 4 passed, 20 total
    
    * Decode errors so tests can assert on their messages
    
    Down from 175 to 129.
    
    Test Suites: 33 failed, 89 passed, 122 total
    Tests:       129 failed, 1029 skipped, 1417 passed, 2575 total
    Snapshots:   16 failed, 4 passed, 20 total
    
    * Remove ReactDOMProduction-test
    
    There is no need for it now. The only test that was special is moved into ReactDOM-test.
    
    * Remove production switches from ReactErrorUtils
    
    The tests now run in production in a separate pass.
    
    * Add and use spyOnDev() for warnings
    
    This ensures that by default we expect no warnings in production bundles.
    If the warning *is* expected, use the regular spyOn() method.
    
    This currently breaks all expectDev() assertions without __DEV__ blocks so we go back to:
    
    Test Suites: 56 failed, 65 passed, 121 total
    Tests:       379 failed, 1029 skipped, 1148 passed, 2556 total
    Snapshots:   16 failed, 4 passed, 20 total
    
    * Replace expectDev() with expect() in __DEV__ blocks
    
    We started using spyOnDev() for console warnings to ensure we don't *expect* them to occur in production. As a consequence, expectDev() assertions on console.error.calls fail because console.error.calls doesn't exist. This is actually good because it would help catch accidental warnings in production.
    
    To solve this, we are getting rid of expectDev() altogether, and instead introduce explicit expectation branches. We'd need them anyway for testing intentional behavior differences.
    
    This commit replaces all expectDev() calls with expect() calls in __DEV__ blocks. It also removes a few unnecessary expect() checks that no warnings were produced (by also removing the corresponding spyOnDev() calls).
    
    Some DEV-only assertions used plain expect(). Those were also moved into __DEV__ blocks.
    
    ReactFiberErrorLogger was special because it console.error()'s in production too. So in that case I intentionally used spyOn() instead of spyOnDev(), and added extra assertions.
    
    This gets us down to:
    
    Test Suites: 21 failed, 100 passed, 121 total
    Tests:       72 failed, 26 skipped, 2458 passed, 2556 total
    Snapshots:   16 failed, 4 passed, 20 total
    
    * Enable User Timing API for production testing
    
    We could've disabled it, but seems like a good idea to test since we use it at FB.
    
    * Test for explicit Object.freeze() differences between PROD and DEV
    
    This is one of the few places where DEV and PROD behavior differs for performance reasons.
    Now we explicitly test both branches.
    
    * Run Jest via "yarn test" on CI
    
    * Remove unused variable
    
    * Assert different error messages
    
    * Fix error handling tests
    
    This logic is really complicated because of the global ReactFiberErrorLogger mock.
    I understand it now, so I added TODOs for later.
    
    It can be much simpler if we change the rest of the tests that assert uncaught errors to also assert they are logged as warnings.
    Which mirrors what happens in practice anyway.
    
    * Fix more assertions
    
    * Change tests to document the DEV/PROD difference for state invariant
    
    It is very likely unintentional but I don't want to change behavior in this PR.
    Filed a follow up as https://github.com/facebook/react/issues/11618.
    
    * Remove unnecessary split between DEV/PROD ref tests
    
    * Fix more test message assertions
    
    * Make validateDOMNesting tests DEV-only
    
    * Fix error message assertions
    
    * Document existing DEV/PROD message difference (possible bug)
    
    * Change mocking assertions to be DEV-only
    
    * Fix the error code test
    
    * Fix more error message assertions
    
    * Fix the last failing test due to known issue
    
    * Run production tests on CI
    
    * Unify configuration
    
    * Fix coverage script
    
    * Remove expectDev from eslintrc
    
    * Run everything in band
    
    We used to before, too. I just forgot to add the arguments after deleting the script.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index b05ae5edb6..8a28a32297 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -37,7 +37,7 @@ describe('ReactDOMOption', () => {
   });
 
   it('should ignore and warn invalid children types', () => {
-    spyOn(console, 'error');
+    spyOnDev(console, 'error');
     var el = (
       <option>
         {1} <div /> {2}
@@ -46,15 +46,15 @@ describe('ReactDOMOption', () => {
     var node = ReactTestUtils.renderIntoDocument(el);
     expect(node.innerHTML).toBe('1  2');
     ReactTestUtils.renderIntoDocument(el);
-    // only warn once
-    expectDev(console.error.calls.count()).toBe(1);
-    expectDev(
-      normalizeCodeLocInfo(console.error.calls.argsFor(0)[0]),
-    ).toContain(
-      '<div> cannot appear as a child of <option>.\n' +
-        '    in div (at **)\n' +
-        '    in option (at **)',
-    );
+    if (__DEV__) {
+      // only warn once
+      expect(console.error.calls.count()).toBe(1);
+      expect(normalizeCodeLocInfo(console.error.calls.argsFor(0)[0])).toContain(
+        '<div> cannot appear as a child of <option>.\n' +
+          '    in div (at **)\n' +
+          '    in option (at **)',
+      );
+    }
   });
 
   it('should ignore null/undefined/false children without warning', () => {
@@ -66,12 +66,14 @@ describe('ReactDOMOption', () => {
         {undefined} {2}
       </option>
     );
-    spyOn(console, 'error');
+    spyOnDev(console, 'error');
     stub = ReactTestUtils.renderIntoDocument(stub);
 
     var node = ReactDOM.findDOMNode(stub);
 
-    expectDev(console.error.calls.count()).toBe(0);
+    if (__DEV__) {
+      expect(console.error.calls.count()).toBe(0);
+    }
     expect(node.innerHTML).toBe('1  2');
   });
 

commit 48616e591fe23c0b89b0823c3ec99bae2d7b6853
Author: Raphael Amorim <rapha850@gmail.com>
Date:   Tue Dec 5 16:29:22 2017 -0200

    react-dom: convert packages/react-dom/src/__tests__ (#11776)

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 8a28a32297..72e4361113 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -14,9 +14,9 @@ describe('ReactDOMOption', () => {
     return str && str.replace(/\(at .+?:\d+\)/g, '(at **)');
   }
 
-  var React;
-  var ReactDOM;
-  var ReactTestUtils;
+  let React;
+  let ReactDOM;
+  let ReactTestUtils;
 
   beforeEach(() => {
     React = require('react');
@@ -25,25 +25,25 @@ describe('ReactDOMOption', () => {
   });
 
   it('should flatten children to a string', () => {
-    var stub = (
+    let stub = (
       <option>
         {1} {'foo'}
       </option>
     );
     stub = ReactTestUtils.renderIntoDocument(stub);
-    var node = ReactDOM.findDOMNode(stub);
+    const node = ReactDOM.findDOMNode(stub);
 
     expect(node.innerHTML).toBe('1 foo');
   });
 
   it('should ignore and warn invalid children types', () => {
     spyOnDev(console, 'error');
-    var el = (
+    const el = (
       <option>
         {1} <div /> {2}
       </option>
     );
-    var node = ReactTestUtils.renderIntoDocument(el);
+    const node = ReactTestUtils.renderIntoDocument(el);
     expect(node.innerHTML).toBe('1  2');
     ReactTestUtils.renderIntoDocument(el);
     if (__DEV__) {
@@ -58,7 +58,7 @@ describe('ReactDOMOption', () => {
   });
 
   it('should ignore null/undefined/false children without warning', () => {
-    var stub = (
+    let stub = (
       <option>
         {1} {false}
         {true}
@@ -69,7 +69,7 @@ describe('ReactDOMOption', () => {
     spyOnDev(console, 'error');
     stub = ReactTestUtils.renderIntoDocument(stub);
 
-    var node = ReactDOM.findDOMNode(stub);
+    const node = ReactDOM.findDOMNode(stub);
 
     if (__DEV__) {
       expect(console.error.calls.count()).toBe(0);
@@ -78,16 +78,16 @@ describe('ReactDOMOption', () => {
   });
 
   it('should be able to use dangerouslySetInnerHTML on option', () => {
-    var stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
+    let stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
     stub = ReactTestUtils.renderIntoDocument(stub);
 
-    var node = ReactDOM.findDOMNode(stub);
+    const node = ReactDOM.findDOMNode(stub);
     expect(node.innerHTML).toBe('foobar');
   });
 
   it('should set attribute for empty value', () => {
-    var container = document.createElement('div');
-    var option = ReactDOM.render(<option value="" />, container);
+    const container = document.createElement('div');
+    const option = ReactDOM.render(<option value="" />, container);
     expect(option.hasAttribute('value')).toBe(true);
     expect(option.getAttribute('value')).toBe('');
 
@@ -97,18 +97,18 @@ describe('ReactDOMOption', () => {
   });
 
   it('should allow ignoring `value` on option', () => {
-    var a = 'a';
-    var stub = (
+    const a = 'a';
+    let stub = (
       <select value="giraffe" onChange={() => {}}>
         <option>monkey</option>
         <option>gir{a}ffe</option>
         <option>gorill{a}</option>
       </select>
     );
-    var options = stub.props.children;
-    var container = document.createElement('div');
+    const options = stub.props.children;
+    const container = document.createElement('div');
     stub = ReactDOM.render(stub, container);
-    var node = ReactDOM.findDOMNode(stub);
+    const node = ReactDOM.findDOMNode(stub);
 
     expect(node.selectedIndex).toBe(1);
 

commit a442d9bc082878ccf66872b1eeed3465927801b6
Author: Brian Vaughn <brian.david.vaughn@gmail.com>
Date:   Wed Jan 3 10:08:24 2018 -0800

    Update additional tests to use .toWarnDev() matcher (#11952)
    
    * Migrated several additional tests to use new .toWarnDev() matcher
    
    * Migrated ReactDOMComponent-test to use .toWarnDev() matcher
    
    Note this test previous had some hacky logic to verify errors were reported against unique line numbers. Since the new matcher doesn't suppor this, I replaced this check with an equivalent (I think) comparison of unique DOM elements (eg div -> span)
    
    * Updated several additional tests to use the new .toWarnDev() matcher
    
    * Updated many more tests to use .toWarnDev()

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 72e4361113..02e1f662c0 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -10,10 +10,6 @@
 'use strict';
 
 describe('ReactDOMOption', () => {
-  function normalizeCodeLocInfo(str) {
-    return str && str.replace(/\(at .+?:\d+\)/g, '(at **)');
-  }
-
   let React;
   let ReactDOM;
   let ReactTestUtils;
@@ -37,24 +33,21 @@ describe('ReactDOMOption', () => {
   });
 
   it('should ignore and warn invalid children types', () => {
-    spyOnDev(console, 'error');
     const el = (
       <option>
         {1} <div /> {2}
       </option>
     );
-    const node = ReactTestUtils.renderIntoDocument(el);
+    let node;
+    expect(() => {
+      node = ReactTestUtils.renderIntoDocument(el);
+    }).toWarnDev(
+      '<div> cannot appear as a child of <option>.\n' +
+        '    in div (at **)\n' +
+        '    in option (at **)',
+    );
     expect(node.innerHTML).toBe('1  2');
     ReactTestUtils.renderIntoDocument(el);
-    if (__DEV__) {
-      // only warn once
-      expect(console.error.calls.count()).toBe(1);
-      expect(normalizeCodeLocInfo(console.error.calls.argsFor(0)[0])).toContain(
-        '<div> cannot appear as a child of <option>.\n' +
-          '    in div (at **)\n' +
-          '    in option (at **)',
-      );
-    }
   });
 
   it('should ignore null/undefined/false children without warning', () => {
@@ -66,14 +59,9 @@ describe('ReactDOMOption', () => {
         {undefined} {2}
       </option>
     );
-    spyOnDev(console, 'error');
     stub = ReactTestUtils.renderIntoDocument(stub);
 
     const node = ReactDOM.findDOMNode(stub);
-
-    if (__DEV__) {
-      expect(console.error.calls.count()).toBe(0);
-    }
     expect(node.innerHTML).toBe('1  2');
   });
 

commit 036ae3c6e2f056adffc31dfb78d1b6f0c63272f0
Author: Philipp Spie√ü <hello@philippspiess.com>
Date:   Wed Jun 13 13:41:23 2018 +0200

    Use native event dispatching instead of Simulate or SimulateNative (#13023)
    
    * Use native event dispatching instead of Simulate or SimulateNative
    
    In #12629 @gaearon suggested that it would be better to drop usage of
    `ReactTestUtils.Simulate` and `ReactTestUtils.SimulateNative`. In this
    PR I‚Äôm attempting at removing it from a lot of places with only a few
    leftovers.
    
    Those leftovers can be categorized into three groups:
    
    1. Anything that tests that `SimulateNative` throws. This is a property
       that native event dispatching doesn‚Äôt have so I can‚Äôt convert that
       easily. Affected test suites: `EventPluginHub-test`,
       `ReactBrowserEventEmitter-test`.
    2. Anything that tests `ReactTestUtils` directly. Affected test suites:
       `ReactBrowserEventEmitter-test` (this file has one test that reads
        "should have mouse enter simulated by test utils"),
        `ReactTestUtils-test`.
    3. Anything that dispatches a `change` event. The reason here goes a bit
       deeper and is rooted in the way we shim onChange. Usually when using
       native event dispatching, you would set the node‚Äôs `.value` and then
       dispatch the event. However inside [`inputValueTracking.js`][] we
       install a setter on the node‚Äôs `.value` that will ignore the next
       `change` event (I found [this][near-perfect-oninput-shim] article
       from Sophie that explains that this is to avoid onChange when
       updating the value via JavaScript).
    
    All remaining usages of `Simulate` or `SimulateNative` can be avoided
    by mounting the containers inside the `document` and dispatching native
    events.
    
    Here some remarks:
    
    1. I‚Äôm using `Element#click()` instead of `dispatchEvent`. In the jsdom
       changelog I read that `click()` now properly sets the correct values
       (you can also verify it does the same thing by looking at the
       [source][jsdom-source]).
    2. I had to update jsdom in order to get `TouchEvent` constructors
       working (and while doing so also updated jest). There was one
       unexpected surprise: `ReactScheduler-test` was relying on not having
       `window.performance` available. I‚Äôve recreated the previous
       environment by deleting this property from the global object.
    3. I was a bit confused that `ReactTestUtils.renderIntoDocument()` does
       not render into the document ü§∑‚Äç
    
    [`inputValueTracking.js`]: https://github.com/facebook/react/blob/392530104c00c25074ce38e1f7e1dd363018c7ce/packages/react-dom/src/client/inputValueTracking.js#L79
    [near-perfect-oninput-shim]: https://sophiebits.com/2013/06/18/a-near-perfect-oninput-shim-for-ie-8-and-9.html
    [jsdom-source]: https://github.com/jsdom/jsdom/blob/45b77f5d21cef74cad278d089937d8462c29acce/lib/jsdom/living/nodes/HTMLElement-impl.js#L43-L76
    
    * Make sure contains are unlinked from the document even if the test fails
    
    * Remove unnecessary findDOMNode calls

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 02e1f662c0..8cbd0118d2 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -26,8 +26,7 @@ describe('ReactDOMOption', () => {
         {1} {'foo'}
       </option>
     );
-    stub = ReactTestUtils.renderIntoDocument(stub);
-    const node = ReactDOM.findDOMNode(stub);
+    const node = ReactTestUtils.renderIntoDocument(stub);
 
     expect(node.innerHTML).toBe('1 foo');
   });
@@ -59,17 +58,15 @@ describe('ReactDOMOption', () => {
         {undefined} {2}
       </option>
     );
-    stub = ReactTestUtils.renderIntoDocument(stub);
+    const node = ReactTestUtils.renderIntoDocument(stub);
 
-    const node = ReactDOM.findDOMNode(stub);
     expect(node.innerHTML).toBe('1  2');
   });
 
   it('should be able to use dangerouslySetInnerHTML on option', () => {
     let stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
-    stub = ReactTestUtils.renderIntoDocument(stub);
+    const node = ReactTestUtils.renderIntoDocument(stub);
 
-    const node = ReactDOM.findDOMNode(stub);
     expect(node.innerHTML).toBe('foobar');
   });
 
@@ -95,8 +92,7 @@ describe('ReactDOMOption', () => {
     );
     const options = stub.props.children;
     const container = document.createElement('div');
-    stub = ReactDOM.render(stub, container);
-    const node = ReactDOM.findDOMNode(stub);
+    const node = ReactDOM.render(stub, container);
 
     expect(node.selectedIndex).toBe(1);
 

commit 0182a74632b66a226921ca13dcfe359c67e15c6f
Author: Konstantin Yakushin <y231966mdk@gmail.com>
Date:   Wed Aug 1 18:16:34 2018 +0300

    Fix a crash when using dynamic children in <option> tag (#13261)
    
    * Make option children a text content by default
    
    fix #11911
    
    * Apply requested changes
    
    - Remove meaningless comments
    - revert scripts/rollup/results.json
    
    * remove empty row
    
    * Update comment
    
    * Add a simple unit-test
    
    * [WIP: no flow] Pass through hostContext
    
    * [WIP: no flow] Give better description for test
    
    * Fixes
    
    * Don't pass hostContext through
    
    It ended up being more complicated than I thought.
    
    * Also warn on hydration

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 8cbd0118d2..bd30ae23a1 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -41,9 +41,7 @@ describe('ReactDOMOption', () => {
     expect(() => {
       node = ReactTestUtils.renderIntoDocument(el);
     }).toWarnDev(
-      '<div> cannot appear as a child of <option>.\n' +
-        '    in div (at **)\n' +
-        '    in option (at **)',
+      '<div> cannot appear as a child of <option>.\n' + '    in option (at **)',
     );
     expect(node.innerHTML).toBe('1  2');
     ReactTestUtils.renderIntoDocument(el);

commit 5cefd9b1e230fbf680ffbe86362387749f584386
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Thu Aug 23 00:24:05 2018 +0100

    Stringify <option> children (#13465)

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index bd30ae23a1..09df9137ce 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -15,6 +15,7 @@ describe('ReactDOMOption', () => {
   let ReactTestUtils;
 
   beforeEach(() => {
+    jest.resetModules();
     React = require('react');
     ReactDOM = require('react-dom');
     ReactTestUtils = require('react-dom/test-utils');
@@ -41,9 +42,10 @@ describe('ReactDOMOption', () => {
     expect(() => {
       node = ReactTestUtils.renderIntoDocument(el);
     }).toWarnDev(
-      '<div> cannot appear as a child of <option>.\n' + '    in option (at **)',
+      'Only strings and numbers are supported as <option> children.\n' +
+        '    in option (at **)',
     );
-    expect(node.innerHTML).toBe('1  2');
+    expect(node.innerHTML).toBe('1 [object Object] 2');
     ReactTestUtils.renderIntoDocument(el);
   });
 
@@ -61,6 +63,76 @@ describe('ReactDOMOption', () => {
     expect(node.innerHTML).toBe('1  2');
   });
 
+  it('should throw on object children', () => {
+    expect(() => {
+      ReactTestUtils.renderIntoDocument(<option>{{}}</option>);
+    }).toThrow('Objects are not valid as a React child');
+    expect(() => {
+      ReactTestUtils.renderIntoDocument(<option>{[{}]}</option>);
+    }).toThrow('Objects are not valid as a React child');
+    expect(() => {
+      ReactTestUtils.renderIntoDocument(
+        <option>
+          {{}}
+          <span />
+        </option>,
+      );
+    }).toThrow('Objects are not valid as a React child');
+    expect(() => {
+      ReactTestUtils.renderIntoDocument(
+        <option>
+          {'1'}
+          {{}}
+          {2}
+        </option>,
+      );
+    }).toThrow('Objects are not valid as a React child');
+  });
+
+  it('should support element-ish child', () => {
+    // This is similar to <fbt>.
+    // It's important that we toString it.
+    let obj = {
+      $$typeof: Symbol.for('react.element'),
+      type: props => props.content,
+      ref: null,
+      key: null,
+      props: {
+        content: 'hello',
+      },
+      toString() {
+        return this.props.content;
+      },
+    };
+
+    let node = ReactTestUtils.renderIntoDocument(<option>{obj}</option>);
+    expect(node.innerHTML).toBe('hello');
+
+    node = ReactTestUtils.renderIntoDocument(<option>{[obj]}</option>);
+    expect(node.innerHTML).toBe('hello');
+
+    expect(() => {
+      node = ReactTestUtils.renderIntoDocument(
+        <option>
+          {obj}
+          <span />
+        </option>,
+      );
+    }).toWarnDev(
+      'Only strings and numbers are supported as <option> children.',
+    );
+    expect(node.innerHTML).toBe('hello[object Object]');
+
+    node = ReactTestUtils.renderIntoDocument(
+      <option>
+        {'1'}
+        {obj}
+        {2}
+      </option>,
+    );
+    expect(node.innerHTML).toBe('1hello2');
+  });
+
   it('should be able to use dangerouslySetInnerHTML on option', () => {
     let stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
     const node = ReactTestUtils.renderIntoDocument(stub);

commit b87aabdfe1b7461e7331abb3601d9e6bb27544bc
Author: H√©ctor Ramos <165856+hramos@users.noreply.github.com>
Date:   Fri Sep 7 15:11:23 2018 -0700

    Drop the year from Facebook copyright headers and the LICENSE file. (#13593)

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 09df9137ce..4f514cadef 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -1,5 +1,5 @@
 /**
- * Copyright (c) 2013-present, Facebook, Inc.
+ * Copyright (c) Facebook, Inc. and its affiliates.
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE file in the root directory of this source tree.

commit 0b5a26a4895261894f04e50d5a700e83b9c0dcf6
Author: Dan Abramov <dan.abramov@gmail.com>
Date:   Mon Dec 16 12:48:16 2019 +0000

    Rename toWarnDev -> toErrorDev, toLowPriorityWarnDev -> toWarnDev (#17605)
    
    * Rename toWarnDev -> toErrorDev in tests
    
    * Rename toWarnDev matcher implementation to toErrorDev
    
    * Rename toLowPriorityWarnDev -> toWarnDev in tests and implementation

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 4f514cadef..6d66655bf6 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -41,7 +41,7 @@ describe('ReactDOMOption', () => {
     let node;
     expect(() => {
       node = ReactTestUtils.renderIntoDocument(el);
-    }).toWarnDev(
+    }).toErrorDev(
       'Only strings and numbers are supported as <option> children.\n' +
         '    in option (at **)',
     );
@@ -118,7 +118,7 @@ describe('ReactDOMOption', () => {
           <span />
         </option>,
       );
-    }).toWarnDev(
+    }).toErrorDev(
       'Only strings and numbers are supported as <option> children.',
     );
     expect(node.innerHTML).toBe('hello[object Object]');

commit 3e94bce765d355d74f6a60feb4addb6d196e3482
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Wed Apr 1 12:35:52 2020 -0700

    Enable prefer-const lint rules (#18451)
    
    * Enable prefer-const rule
    
    Stylistically I don't like this but Closure Compiler takes advantage of
    this information.
    
    * Auto-fix lints
    
    * Manually fix the remaining callsites

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 6d66655bf6..a81dd32f1f 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -22,7 +22,7 @@ describe('ReactDOMOption', () => {
   });
 
   it('should flatten children to a string', () => {
-    let stub = (
+    const stub = (
       <option>
         {1} {'foo'}
       </option>
@@ -50,7 +50,7 @@ describe('ReactDOMOption', () => {
   });
 
   it('should ignore null/undefined/false children without warning', () => {
-    let stub = (
+    const stub = (
       <option>
         {1} {false}
         {true}
@@ -92,7 +92,7 @@ describe('ReactDOMOption', () => {
   it('should support element-ish child', () => {
     // This is similar to <fbt>.
     // It's important that we toString it.
-    let obj = {
+    const obj = {
       $$typeof: Symbol.for('react.element'),
       type: props => props.content,
       ref: null,
@@ -134,7 +134,7 @@ describe('ReactDOMOption', () => {
   });
 
   it('should be able to use dangerouslySetInnerHTML on option', () => {
-    let stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
+    const stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
     const node = ReactTestUtils.renderIntoDocument(stub);
 
     expect(node.innerHTML).toBe('foobar');
@@ -153,7 +153,7 @@ describe('ReactDOMOption', () => {
 
   it('should allow ignoring `value` on option', () => {
     const a = 'a';
-    let stub = (
+    const stub = (
       <select value="giraffe" onChange={() => {}}>
         <option>monkey</option>
         <option>gir{a}ffe</option>

commit 8ea11306ad473b26a2c899ef7a893d25413f3510
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Wed May 5 11:40:54 2021 -0400

    Allow complex objects as children of option only if value is provided (#21431)

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index a81dd32f1f..4271b87386 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -12,12 +12,14 @@
 describe('ReactDOMOption', () => {
   let React;
   let ReactDOM;
+  let ReactDOMServer;
   let ReactTestUtils;
 
   beforeEach(() => {
     jest.resetModules();
     React = require('react');
     ReactDOM = require('react-dom');
+    ReactDOMServer = require('react-dom/server');
     ReactTestUtils = require('react-dom/test-utils');
   });
 
@@ -32,9 +34,9 @@ describe('ReactDOMOption', () => {
     expect(node.innerHTML).toBe('1 foo');
   });
 
-  it('should ignore and warn invalid children types', () => {
+  it('should warn for invalid child tags', () => {
     const el = (
-      <option>
+      <option value="12">
         {1} <div /> {2}
       </option>
     );
@@ -42,10 +44,45 @@ describe('ReactDOMOption', () => {
     expect(() => {
       node = ReactTestUtils.renderIntoDocument(el);
     }).toErrorDev(
-      'Only strings and numbers are supported as <option> children.\n' +
+      'validateDOMNesting(...): <div> cannot appear as a child of <option>.\n' +
+        '    in div (at **)\n' +
         '    in option (at **)',
     );
-    expect(node.innerHTML).toBe('1 [object Object] 2');
+    expect(node.innerHTML).toBe('1 <div></div> 2');
+    ReactTestUtils.renderIntoDocument(el);
+  });
+
+  it('should warn for component child if no value prop is provided', () => {
+    function Foo() {
+      return '2';
+    }
+    const el = (
+      <option>
+        {1} <Foo /> {3}
+      </option>
+    );
+    let node;
+    expect(() => {
+      node = ReactTestUtils.renderIntoDocument(el);
+    }).toErrorDev(
+      'Cannot infer the option value of complex children. ' +
+        'Pass a `value` prop or use a plain string as children to <option>.',
+    );
+    expect(node.innerHTML).toBe('1 2 3');
+    ReactTestUtils.renderIntoDocument(el);
+  });
+
+  it('should not warn for component child if value prop is provided', () => {
+    function Foo() {
+      return '2';
+    }
+    const el = (
+      <option value="123">
+        {1} <Foo /> {3}
+      </option>
+    );
+    const node = ReactTestUtils.renderIntoDocument(el);
+    expect(node.innerHTML).toBe('1 2 3');
     ReactTestUtils.renderIntoDocument(el);
   });
 
@@ -91,7 +128,7 @@ describe('ReactDOMOption', () => {
 
   it('should support element-ish child', () => {
     // This is similar to <fbt>.
-    // It's important that we toString it.
+    // We don't toString it because you must instead provide a value prop.
     const obj = {
       $$typeof: Symbol.for('react.element'),
       type: props => props.content,
@@ -105,37 +142,42 @@ describe('ReactDOMOption', () => {
       },
     };
 
-    let node = ReactTestUtils.renderIntoDocument(<option>{obj}</option>);
+    let node = ReactTestUtils.renderIntoDocument(
+      <option value="a">{obj}</option>,
+    );
     expect(node.innerHTML).toBe('hello');
 
-    node = ReactTestUtils.renderIntoDocument(<option>{[obj]}</option>);
+    node = ReactTestUtils.renderIntoDocument(
+      <option value="b">{[obj]}</option>,
+    );
     expect(node.innerHTML).toBe('hello');
 
-    expect(() => {
-      node = ReactTestUtils.renderIntoDocument(
-        <option>
-          {obj}
-          <span />
-        </option>,
-      );
-    }).toErrorDev(
-      'Only strings and numbers are supported as <option> children.',
+    node = ReactTestUtils.renderIntoDocument(
+      <option value={obj}>{obj}</option>,
     );
-    expect(node.innerHTML).toBe('hello[object Object]');
+    expect(node.innerHTML).toBe('hello');
+    expect(node.value).toBe('hello');
 
     node = ReactTestUtils.renderIntoDocument(
-      <option>
+      <option value={obj}>
         {'1'}
         {obj}
         {2}
       </option>,
     );
     expect(node.innerHTML).toBe('1hello2');
+    expect(node.value).toBe('hello');
   });
 
   it('should be able to use dangerouslySetInnerHTML on option', () => {
     const stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
-    const node = ReactTestUtils.renderIntoDocument(stub);
+    let node;
+    expect(() => {
+      node = ReactTestUtils.renderIntoDocument(stub);
+    }).toErrorDev(
+      'Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected.\n' +
+        '    in option (at **)',
+    );
 
     expect(node.innerHTML).toBe('foobar');
   });
@@ -169,4 +211,39 @@ describe('ReactDOMOption', () => {
     ReactDOM.render(<select value="gorilla">{options}</select>, container);
     expect(node.selectedIndex).toEqual(2);
   });
+
+  it('generates a warning and hydration error when an invalid nested tag is used as a child', () => {
+    const ref = React.createRef();
+    const children = (
+      <select readOnly={true} value="bar">
+        <option value="bar">
+          {['Bar', false, 'Foo', <div key="1" ref={ref} />, 'Baz']}
+        </option>
+      </select>
+    );
+
+    const container = document.createElement('div');
+
+    container.innerHTML = ReactDOMServer.renderToString(children);
+
+    expect(container.firstChild.getAttribute('value')).toBe(null);
+    expect(container.firstChild.getAttribute('defaultValue')).toBe(null);
+
+    const option = container.firstChild.firstChild;
+    expect(option.nodeName).toBe('OPTION');
+
+    expect(option.textContent).toBe('BarFooBaz');
+    expect(option.selected).toBe(true);
+
+    expect(() => ReactDOM.hydrate(children, container)).toErrorDev([
+      'Text content did not match. Server: "FooBaz" Client: "Foo"',
+      'validateDOMNesting(...): <div> cannot appear as a child of <option>.',
+    ]);
+
+    expect(option.textContent).toBe('BarFooBaz');
+    expect(option.selected).toBe(true);
+
+    expect(ref.current.nodeName).toBe('DIV');
+    expect(ref.current.parentNode).toBe(option);
+  });
 });

commit 9cdf8a99edcfd94d7420835ea663edca04237527
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Oct 18 11:19:24 2022 -0400

    [Codemod] Update copyright header to Meta (#25315)
    
    * Facebook -> Meta in copyright
    
    rg --files | xargs sed -i 's#Copyright (c) Facebook, Inc. and its affiliates.#Copyright (c) Meta Platforms, Inc. and affiliates.#g'
    
    * Manual tweaks

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 4271b87386..b8dc69b3f6 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -1,5 +1,5 @@
 /**
- * Copyright (c) Facebook, Inc. and its affiliates.
+ * Copyright (c) Meta Platforms, Inc. and affiliates.
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE file in the root directory of this source tree.

commit 206934f0270d248b9eec186e2f70b0c7a4f99e1d
Author: Sebastian Silbermann <silbermann.sebastian@gmail.com>
Date:   Mon Jan 22 09:21:40 2024 +0100

    Convert ReactDOMOption to createRoot (#28002)

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index b8dc69b3f6..c0597c36b2 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -11,16 +11,18 @@
 
 describe('ReactDOMOption', () => {
   let React;
-  let ReactDOM;
+  let ReactDOMClient;
   let ReactDOMServer;
   let ReactTestUtils;
+  let act;
 
   beforeEach(() => {
     jest.resetModules();
     React = require('react');
-    ReactDOM = require('react-dom');
+    ReactDOMClient = require('react-dom/client');
     ReactDOMServer = require('react-dom/server');
     ReactTestUtils = require('react-dom/test-utils');
+    act = require('internal-test-utils').act;
   });
 
   it('should flatten children to a string', () => {
@@ -182,19 +184,28 @@ describe('ReactDOMOption', () => {
     expect(node.innerHTML).toBe('foobar');
   });
 
-  it('should set attribute for empty value', () => {
+  it('should set attribute for empty value', async () => {
     const container = document.createElement('div');
-    const option = ReactDOM.render(<option value="" />, container);
+    const root = ReactDOMClient.createRoot(container);
+    let option;
+    await act(() => {
+      root.render(<option value="" />);
+    });
+    option = container.firstChild;
     expect(option.hasAttribute('value')).toBe(true);
     expect(option.getAttribute('value')).toBe('');
 
-    ReactDOM.render(<option value="lava" />, container);
+    await act(() => {
+      root.render(<option value="lava" />);
+    });
+    option = container.firstChild;
     expect(option.hasAttribute('value')).toBe(true);
     expect(option.getAttribute('value')).toBe('lava');
   });
 
-  it('should allow ignoring `value` on option', () => {
+  it('should allow ignoring `value` on option', async () => {
     const a = 'a';
+    let node;
     const stub = (
       <select value="giraffe" onChange={() => {}}>
         <option>monkey</option>
@@ -204,15 +215,22 @@ describe('ReactDOMOption', () => {
     );
     const options = stub.props.children;
     const container = document.createElement('div');
-    const node = ReactDOM.render(stub, container);
+    const root = ReactDOMClient.createRoot(container);
+    await act(() => {
+      root.render(stub);
+    });
+    node = container.firstChild;
 
     expect(node.selectedIndex).toBe(1);
 
-    ReactDOM.render(<select value="gorilla">{options}</select>, container);
+    await act(() => {
+      root.render(<select value="gorilla">{options}</select>);
+    });
+    node = container.firstChild;
     expect(node.selectedIndex).toEqual(2);
   });
 
-  it('generates a warning and hydration error when an invalid nested tag is used as a child', () => {
+  it('generates a warning and hydration error when an invalid nested tag is used as a child', async () => {
     const ref = React.createRef();
     const children = (
       <select readOnly={true} value="bar">
@@ -229,16 +247,27 @@ describe('ReactDOMOption', () => {
     expect(container.firstChild.getAttribute('value')).toBe(null);
     expect(container.firstChild.getAttribute('defaultValue')).toBe(null);
 
-    const option = container.firstChild.firstChild;
+    let option = container.firstChild.firstChild;
     expect(option.nodeName).toBe('OPTION');
 
     expect(option.textContent).toBe('BarFooBaz');
     expect(option.selected).toBe(true);
 
-    expect(() => ReactDOM.hydrate(children, container)).toErrorDev([
-      'Text content did not match. Server: "FooBaz" Client: "Foo"',
-      'validateDOMNesting(...): <div> cannot appear as a child of <option>.',
-    ]);
+    await expect(async () => {
+      await act(async () => {
+        ReactDOMClient.hydrateRoot(container, children, {
+          onRecoverableError: () => {},
+        });
+      });
+    }).toErrorDev(
+      [
+        'Warning: Text content did not match. Server: "FooBaz" Client: "Foo"',
+        'Warning: An error occurred during hydration. The server HTML was replaced with client content in <div>',
+        'Warning: validateDOMNesting(...): <div> cannot appear as a child of <option>',
+      ],
+      {withoutStack: 1},
+    );
+    option = container.firstChild.firstChild;
 
     expect(option.textContent).toBe('BarFooBaz');
     expect(option.selected).toBe(true);

commit 30e2938e04c8cf51688509a457a494d36bcc4269
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Feb 6 12:43:27 2024 -0500

    [Tests] Reset modules by default (#28254)
    
    ## Overview
    
    Sets `resetModules: true` in the base Jest config, and deletes all the
    `jest.resetModule()` calls we don't need.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index c0597c36b2..8d6849e32e 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -17,7 +17,6 @@ describe('ReactDOMOption', () => {
   let act;
 
   beforeEach(() => {
-    jest.resetModules();
     React = require('react');
     ReactDOMClient = require('react-dom/client');
     ReactDOMServer = require('react-dom/server');

commit 015ff2ed66c1d164111752263682d1d757c97f3e
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Feb 13 11:39:45 2024 -0500

    Revert "[Tests] Reset modules by default" (#28318)
    
    This was causing a slowdown in one of the tests
    ESLintRuleExhaustiveDeps-test.js. Reverting until we figure out why.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 8d6849e32e..c0597c36b2 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -17,6 +17,7 @@ describe('ReactDOMOption', () => {
   let act;
 
   beforeEach(() => {
+    jest.resetModules();
     React = require('react');
     ReactDOMClient = require('react-dom/client');
     ReactDOMServer = require('react-dom/server');

commit d579e7748218920331252b0528850943d5e2dd31
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Fri Feb 23 15:16:54 2024 -0500

    Remove method name prefix from warnings and errors (#28432)
    
    This pattern is a petpeeve of mine. I don't consider this best practice
    and so most don't have these prefixes. Very inconsistent.
    
    At best this is useless and noisey that you have to parse because the
    information is also in the stack trace.
    
    At worse these are misleading because they're highlighting something
    internal (like validateDOMNesting) which even suggests an internal bug.
    Even the ones public to React aren't necessarily what you called because
    you might be calling a wrapper around it.
    
    That would be properly reflected in a stack trace - which can also
    properly ignore list so that the first stack you see is your callsite,
    
    Which might be like `render()` in react-testing-library rather than
    `createRoot()` for example.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index c0597c36b2..66ab2b247e 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -46,7 +46,7 @@ describe('ReactDOMOption', () => {
     expect(() => {
       node = ReactTestUtils.renderIntoDocument(el);
     }).toErrorDev(
-      'validateDOMNesting(...): <div> cannot appear as a child of <option>.\n' +
+      '<div> cannot appear as a child of <option>.\n' +
         '    in div (at **)\n' +
         '    in option (at **)',
     );
@@ -263,7 +263,7 @@ describe('ReactDOMOption', () => {
       [
         'Warning: Text content did not match. Server: "FooBaz" Client: "Foo"',
         'Warning: An error occurred during hydration. The server HTML was replaced with client content in <div>',
-        'Warning: validateDOMNesting(...): <div> cannot appear as a child of <option>',
+        'Warning: <div> cannot appear as a child of <option>',
       ],
       {withoutStack: 1},
     );

commit 118ad2afa75a44fe3715ad7fb0023c408125bef7
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Sat Feb 24 00:45:42 2024 -0500

    Validate DOM nesting for hydration before the hydration warns / errors (#28434)
    
    If there's invalid dom nesting, there will be mismatches following but
    the nesting is the most important cause of the problem.
    
    Previously we would include the DOM nesting when rerendering thanks to
    the new model of throw and recovery. However, the log would come during
    the recovery phase which is after we've already logged that there was a
    hydration mismatch.
    
    People would consistently miss this log. Which is fair because you
    should always look at the first log first as the most probable cause.
    
    This ensures that we log in the hydration phase if there's a dom nesting
    issue. This assumes that the consequence of nesting will appear such
    that the won't have a mismatch before this. That's typically the case
    because the node will move up and to be a later sibling. So as long as
    that happens and we keep hydrating depth first, it should hold true.
    There might be an issue if there's a suspense boundary between the nodes
    we'll find discover the new child in the outer path since suspense
    boundaries as breadth first.
    
    Before:
    
    <img width="996" alt="Screenshot 2024-02-23 at 7 34 01‚ÄØPM"
    src="https://github.com/facebook/react/assets/63648/af70cf7f-898b-477f-be39-13b01cfe585f">
    
    After:
    
    <img width="853" alt="Screenshot 2024-02-23 at 7 22 24‚ÄØPM"
    src="https://github.com/facebook/react/assets/63648/896c6348-1620-4f99-881d-b6069263925e">
    
    Cameo: RSC stacks.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 66ab2b247e..abeae80125 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -46,7 +46,8 @@ describe('ReactDOMOption', () => {
     expect(() => {
       node = ReactTestUtils.renderIntoDocument(el);
     }).toErrorDev(
-      '<div> cannot appear as a child of <option>.\n' +
+      'In HTML, <div> cannot be a child of <option>.\n' +
+        'This will cause a hydration error.\n' +
         '    in div (at **)\n' +
         '    in option (at **)',
     );
@@ -263,7 +264,7 @@ describe('ReactDOMOption', () => {
       [
         'Warning: Text content did not match. Server: "FooBaz" Client: "Foo"',
         'Warning: An error occurred during hydration. The server HTML was replaced with client content in <div>',
-        'Warning: <div> cannot appear as a child of <option>',
+        'Warning: In HTML, <div> cannot be a child of <option>',
       ],
       {withoutStack: 1},
     );

commit 2f240c91ed54900adee213565cb2039e161629e9
Author: Sebastian Silbermann <silbermann.sebastian@gmail.com>
Date:   Mon Feb 26 19:18:50 2024 +0100

    Add support for rendering BigInt (#24580)

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index abeae80125..a75ce87500 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -172,6 +172,13 @@ describe('ReactDOMOption', () => {
     expect(node.value).toBe('hello');
   });
 
+  // @gate enableBigIntSupport
+  it('should support bigint values', () => {
+    const node = ReactTestUtils.renderIntoDocument(<option>{5n}</option>);
+    expect(node.innerHTML).toBe('5');
+    expect(node.value).toBe('5');
+  });
+
   it('should be able to use dangerouslySetInnerHTML on option', () => {
     const stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
     let node;

commit 1c02b9d2bdc18091cc6afec810fc1b361f00abdd
Author: Josh Story <story@hey.com>
Date:   Mon Mar 4 08:19:17 2024 -0800

    [DOM] disable legacy mode behind flag (#28468)
    
    Adds a flag to disable legacy mode. Currently this flag is used to cause
    legacy mode apis like render and hydrate to throw. This change also
    removes render, hydrate, unmountComponentAtNode, and
    unstable_renderSubtreeIntoContainer from the experiemntal entrypoint.
    Right now for Meta builds this flag is off (legacy mode is still
    supported). In OSS builds this flag matches __NEXT_MAJOR__ which means
    it currently is on in experiemental. This means that after merging
    legacy mode is effectively removed from experimental builds. While this
    is a breaking change, experimental builds are not stable and users can
    pin to older versions or update their use of react-dom to no longer use
    legacy mode APIs.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index a75ce87500..873aad71d2 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -13,7 +13,6 @@ describe('ReactDOMOption', () => {
   let React;
   let ReactDOMClient;
   let ReactDOMServer;
-  let ReactTestUtils;
   let act;
 
   beforeEach(() => {
@@ -21,41 +20,47 @@ describe('ReactDOMOption', () => {
     React = require('react');
     ReactDOMClient = require('react-dom/client');
     ReactDOMServer = require('react-dom/server');
-    ReactTestUtils = require('react-dom/test-utils');
     act = require('internal-test-utils').act;
   });
 
-  it('should flatten children to a string', () => {
+  async function renderIntoDocument(children) {
+    const container = document.createElement('div');
+    const root = ReactDOMClient.createRoot(container);
+    await act(async () => root.render(children));
+    return container;
+  }
+
+  it('should flatten children to a string', async () => {
     const stub = (
       <option>
         {1} {'foo'}
       </option>
     );
-    const node = ReactTestUtils.renderIntoDocument(stub);
+    const container = await renderIntoDocument(stub);
 
-    expect(node.innerHTML).toBe('1 foo');
+    expect(container.firstChild.innerHTML).toBe('1 foo');
   });
 
-  it('should warn for invalid child tags', () => {
+  it('should warn for invalid child tags', async () => {
     const el = (
       <option value="12">
         {1} <div /> {2}
       </option>
     );
-    let node;
-    expect(() => {
-      node = ReactTestUtils.renderIntoDocument(el);
+    let container;
+    await expect(async () => {
+      container = await renderIntoDocument(el);
     }).toErrorDev(
       'In HTML, <div> cannot be a child of <option>.\n' +
         'This will cause a hydration error.\n' +
         '    in div (at **)\n' +
         '    in option (at **)',
     );
-    expect(node.innerHTML).toBe('1 <div></div> 2');
-    ReactTestUtils.renderIntoDocument(el);
+    expect(container.firstChild.innerHTML).toBe('1 <div></div> 2');
+    await renderIntoDocument(el);
   });
 
-  it('should warn for component child if no value prop is provided', () => {
+  it('should warn for component child if no value prop is provided', async () => {
     function Foo() {
       return '2';
     }
@@ -64,18 +69,18 @@ describe('ReactDOMOption', () => {
         {1} <Foo /> {3}
       </option>
     );
-    let node;
-    expect(() => {
-      node = ReactTestUtils.renderIntoDocument(el);
+    let container;
+    await expect(async () => {
+      container = await renderIntoDocument(el);
     }).toErrorDev(
       'Cannot infer the option value of complex children. ' +
         'Pass a `value` prop or use a plain string as children to <option>.',
     );
-    expect(node.innerHTML).toBe('1 2 3');
-    ReactTestUtils.renderIntoDocument(el);
+    expect(container.firstChild.innerHTML).toBe('1 2 3');
+    await renderIntoDocument(el);
   });
 
-  it('should not warn for component child if value prop is provided', () => {
+  it('should not warn for component child if value prop is provided', async () => {
     function Foo() {
       return '2';
     }
@@ -84,12 +89,12 @@ describe('ReactDOMOption', () => {
         {1} <Foo /> {3}
       </option>
     );
-    const node = ReactTestUtils.renderIntoDocument(el);
-    expect(node.innerHTML).toBe('1 2 3');
-    ReactTestUtils.renderIntoDocument(el);
+    const container = await renderIntoDocument(el);
+    expect(container.firstChild.innerHTML).toBe('1 2 3');
+    await renderIntoDocument(el);
   });
 
-  it('should ignore null/undefined/false children without warning', () => {
+  it('should ignore null/undefined/false children without warning', async () => {
     const stub = (
       <option>
         {1} {false}
@@ -98,38 +103,38 @@ describe('ReactDOMOption', () => {
         {undefined} {2}
       </option>
     );
-    const node = ReactTestUtils.renderIntoDocument(stub);
+    const container = await renderIntoDocument(stub);
 
-    expect(node.innerHTML).toBe('1  2');
+    expect(container.firstChild.innerHTML).toBe('1  2');
   });
 
-  it('should throw on object children', () => {
-    expect(() => {
-      ReactTestUtils.renderIntoDocument(<option>{{}}</option>);
-    }).toThrow('Objects are not valid as a React child');
-    expect(() => {
-      ReactTestUtils.renderIntoDocument(<option>{[{}]}</option>);
-    }).toThrow('Objects are not valid as a React child');
-    expect(() => {
-      ReactTestUtils.renderIntoDocument(
+  it('should throw on object children', async () => {
+    await expect(async () =>
+      renderIntoDocument(<option>{{}}</option>),
+    ).rejects.toThrow('Objects are not valid as a React child');
+    await expect(async () => {
+      await renderIntoDocument(<option>{[{}]}</option>);
+    }).rejects.toThrow('Objects are not valid as a React child');
+    await expect(async () => {
+      await renderIntoDocument(
         <option>
           {{}}
           <span />
         </option>,
       );
-    }).toThrow('Objects are not valid as a React child');
-    expect(() => {
-      ReactTestUtils.renderIntoDocument(
+    }).rejects.toThrow('Objects are not valid as a React child');
+    await expect(async () => {
+      await renderIntoDocument(
         <option>
           {'1'}
           {{}}
           {2}
         </option>,
       );
-    }).toThrow('Objects are not valid as a React child');
+    }).rejects.toThrow('Objects are not valid as a React child');
   });
 
-  it('should support element-ish child', () => {
+  it('should support element-ish child', async () => {
     // This is similar to <fbt>.
     // We don't toString it because you must instead provide a value prop.
     const obj = {
@@ -145,51 +150,45 @@ describe('ReactDOMOption', () => {
       },
     };
 
-    let node = ReactTestUtils.renderIntoDocument(
-      <option value="a">{obj}</option>,
-    );
-    expect(node.innerHTML).toBe('hello');
+    let container = await renderIntoDocument(<option value="a">{obj}</option>);
+    expect(container.firstChild.innerHTML).toBe('hello');
 
-    node = ReactTestUtils.renderIntoDocument(
-      <option value="b">{[obj]}</option>,
-    );
-    expect(node.innerHTML).toBe('hello');
+    container = await renderIntoDocument(<option value="b">{[obj]}</option>);
+    expect(container.firstChild.innerHTML).toBe('hello');
 
-    node = ReactTestUtils.renderIntoDocument(
-      <option value={obj}>{obj}</option>,
-    );
-    expect(node.innerHTML).toBe('hello');
-    expect(node.value).toBe('hello');
+    container = await renderIntoDocument(<option value={obj}>{obj}</option>);
+    expect(container.firstChild.innerHTML).toBe('hello');
+    expect(container.firstChild.value).toBe('hello');
 
-    node = ReactTestUtils.renderIntoDocument(
+    container = await renderIntoDocument(
       <option value={obj}>
         {'1'}
         {obj}
         {2}
       </option>,
     );
-    expect(node.innerHTML).toBe('1hello2');
-    expect(node.value).toBe('hello');
+    expect(container.firstChild.innerHTML).toBe('1hello2');
+    expect(container.firstChild.value).toBe('hello');
   });
 
   // @gate enableBigIntSupport
-  it('should support bigint values', () => {
-    const node = ReactTestUtils.renderIntoDocument(<option>{5n}</option>);
-    expect(node.innerHTML).toBe('5');
-    expect(node.value).toBe('5');
+  it('should support bigint values', async () => {
+    const container = await renderIntoDocument(<option>{5n}</option>);
+    expect(container.firstChild.innerHTML).toBe('5');
+    expect(container.firstChild.value).toBe('5');
   });
 
-  it('should be able to use dangerouslySetInnerHTML on option', () => {
+  it('should be able to use dangerouslySetInnerHTML on option', async () => {
     const stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
-    let node;
-    expect(() => {
-      node = ReactTestUtils.renderIntoDocument(stub);
+    let container;
+    await expect(async () => {
+      container = await renderIntoDocument(stub);
     }).toErrorDev(
       'Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected.\n' +
         '    in option (at **)',
     );
 
-    expect(node.innerHTML).toBe('foobar');
+    expect(container.firstChild.innerHTML).toBe('foobar');
   });
 
   it('should set attribute for empty value', async () => {

commit 4b8dfd6215bf855402ae1a94cb0ae4f467afca9a
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Tue Mar 26 16:04:18 2024 -0700

    Move Hydration Warnings from the DOM Config into the Fiber reconciliation (#28476)
    
    Stacked on #28458.
    
    This doesn't actually really change the messages yet, it's just a
    refactor.
    
    Hydration warnings can be presented either as HTML or React JSX format.
    If presented as HTML it makes more sense to make that a DOM specific
    concept, however, I think it's actually better to present it in terms of
    React JSX.
    
    Most of the time the errors aren't going to be something messing with
    them at the HTML/HTTP layer. It's because the JS code does something
    different. Most of the time you're working in just React. People don't
    necessarily even know what the HTML form of it looks like. So this takes
    the approach that the warnings are presented in React JSX in their rich
    object form.
    
    Therefore, I'm moving the approach to yield diff data to the reconciler
    but it's the reconciler that's actually printing all the warnings.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 873aad71d2..3815b413a6 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -269,7 +269,7 @@ describe('ReactDOMOption', () => {
     }).toErrorDev(
       [
         'Warning: Text content did not match. Server: "FooBaz" Client: "Foo"',
-        'Warning: An error occurred during hydration. The server HTML was replaced with client content in <div>',
+        'Warning: An error occurred during hydration. The server HTML was replaced with client content.',
         'Warning: In HTML, <div> cannot be a child of <option>',
       ],
       {withoutStack: 1},

commit f7aa5e0aa3e2aa51279af4b6cb5413912cacd7f5
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Tue Mar 26 17:01:41 2024 -0700

    Move Hydration Mismatch Errors to Throw or Log Once (Kind of) (#28502)
    
    Stacked on #28476.
    
    We used to `console.error` for every mismatch we found, up until the
    error we threw for the hydration mismatch.
    
    This changes it so that we build up a set of diffs up until we either
    throw or complete hydrating the root/suspense boundary. If we throw, we
    append the diff to the error message which gets passed to
    onRecoverableError (which by default is also logged to console). If we
    complete, we append it to a `console.error`.
    
    Since we early abort when something throws, it effectively means that we
    can only collect multiple diffs if there were preceding non-throwing
    mismatches - i.e. only properties mismatched but tag name matched.
    
    There can still be multiple logs if multiple siblings Suspense
    boundaries all error hydrating but then they're separate errors
    entirely.
    
    We still log an extra line about something erroring but I think the goal
    should be that it leads to a single recoverable or console.error.
    
    This doesn't yet actually print the diff as part of this message. That's
    in a follow up PR.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 3815b413a6..d5225893ac 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -268,7 +268,6 @@ describe('ReactDOMOption', () => {
       });
     }).toErrorDev(
       [
-        'Warning: Text content did not match. Server: "FooBaz" Client: "Foo"',
         'Warning: An error occurred during hydration. The server HTML was replaced with client content.',
         'Warning: In HTML, <div> cannot be a child of <option>',
       ],

commit 323b6e98a76fe6ee721f10d327a9a682334d1a97
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Wed Mar 27 23:48:18 2024 -0400

    Remove errorHydratingContainer (#28664)
    
    I originally added this in #21021 but I didn't mention why and I don't
    quite remember why. Maybe because there were no other message? However
    at the time the recoverable errors mechanism didn't exist.
    
    Today I believe all cases where this happens will trigger another
    recoverable error. Namely these two:
    
    
    https://github.com/facebook/react/blob/9f33f699e4f832971dc0f2047129f832655a3b6d/packages/react-reconciler/src/ReactFiberBeginWork.js#L1442-L1446
    
    
    https://github.com/facebook/react/blob/9f33f699e4f832971dc0f2047129f832655a3b6d/packages/react-reconciler/src/ReactFiberBeginWork.js#L2962-L2965
    
    Therefore this is just an extra unnecessary log.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index d5225893ac..8743c5993d 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -237,7 +237,7 @@ describe('ReactDOMOption', () => {
     expect(node.selectedIndex).toEqual(2);
   });
 
-  it('generates a warning and hydration error when an invalid nested tag is used as a child', async () => {
+  it('generates a hydration error when an invalid nested tag is used as a child', async () => {
     const ref = React.createRef();
     const children = (
       <select readOnly={true} value="bar">
@@ -266,13 +266,7 @@ describe('ReactDOMOption', () => {
           onRecoverableError: () => {},
         });
       });
-    }).toErrorDev(
-      [
-        'Warning: An error occurred during hydration. The server HTML was replaced with client content.',
-        'Warning: In HTML, <div> cannot be a child of <option>',
-      ],
-      {withoutStack: 1},
-    );
+    }).toErrorDev(['Warning: In HTML, <div> cannot be a child of <option>']);
     option = container.firstChild.firstChild;
 
     expect(option.textContent).toBe('BarFooBaz');

commit 7a2609eedc571049a3272e60d5f7d84601ffca3f
Author: Jan Kassens <jkassens@meta.com>
Date:   Wed Apr 3 09:25:02 2024 -0400

    Cleanup enableBigIntSupport flag (#28711)
    
    Cleanup enableBigIntSupport flag

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 8743c5993d..1661a98b1a 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -171,7 +171,6 @@ describe('ReactDOMOption', () => {
     expect(container.firstChild.value).toBe('hello');
   });
 
-  // @gate enableBigIntSupport
   it('should support bigint values', async () => {
     const container = await renderIntoDocument(<option>{5n}</option>);
     expect(container.firstChild.innerHTML).toBe('5');

commit 3b551c82844bcfde51f0febb8e42c1a0d777df2c
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Mon Apr 22 12:39:56 2024 -0400

    Rename the react.element symbol to react.transitional.element (#28813)
    
    We have changed the shape (and the runtime) of React Elements. To help
    avoid precompiled or inlined JSX having subtle breakages or deopting
    hidden classes, I renamed the symbol so that we can early error if
    private implementation details are used or mismatching versions are
    used.
    
    Why "transitional"? Well, because this is not the last time we'll change
    the shape. This is just a stepping stone to removing the `ref` field on
    the elements in the next version so we'll likely have to do it again.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 1661a98b1a..4b431a85bb 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -134,6 +134,7 @@ describe('ReactDOMOption', () => {
     }).rejects.toThrow('Objects are not valid as a React child');
   });
 
+  // @gate www
   it('should support element-ish child', async () => {
     // This is similar to <fbt>.
     // We don't toString it because you must instead provide a value prop.

commit 277420803947724b43c47bbc47d3a353553868f1
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Mon Jun 10 18:41:56 2024 -0400

    Remove Warning: prefix and toString on console Arguments (#29839)
    
    Basically make `console.error` and `console.warn` behave like normal -
    when a component stack isn't appended. I need this because I need to be
    able to print rich logs with the component stack option and to be able
    to disable instrumentation completely in `console.createTask`
    environments that don't need it.
    
    Currently we can't print logs with richer objects because they're
    toString:ed first. In practice, pretty much all arguments we log are
    already toString:ed so it's not necessary anyway. Some might be like a
    number. So it would only be a problem if some environment can't handle
    proper consoles but then it's up to that environment to toString it
    before logging.
    
    The `Warning: ` prefix is historic and is both noisy and confusing. It's
    mostly unnecessary since the UI surrounding `console.error` and
    `console.warn` tend to have visual treatment around it anyway. However,
    it's actively misleading when `console.error` gets prefixed with a
    Warning that we consider an error level. There's an argument to be made
    that some of our `console.error` don't make the bar for an error but
    then the argument is to downgrade each of those to `console.warn` - not
    to brand all our actual error logging with `Warning: `.
    
    Apparently something needs to change in React Native before landing this
    because it depends on the prefix somehow which probably doesn't make
    sense already.

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index 4b431a85bb..ee54bac0c3 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -266,7 +266,7 @@ describe('ReactDOMOption', () => {
           onRecoverableError: () => {},
         });
       });
-    }).toErrorDev(['Warning: In HTML, <div> cannot be a child of <option>']);
+    }).toErrorDev(['In HTML, <div> cannot be a child of <option>']);
     option = container.firstChild.firstChild;
 
     expect(option.textContent).toBe('BarFooBaz');

commit 89580f209ce68ae9e266e309dfeb1625b434fb58
Author: Jack Pope <jackpope1@gmail.com>
Date:   Mon Jun 24 12:28:39 2024 -0400

    Set renameElementSymbol to dynamic value (#30066)
    
    Prepare to roll this out with dynamic flag
    
    `yarn flags --diff www canary`
    
    <img width="514" alt="Screenshot 2024-06-24 at 11 33 55‚ÄØAM"
    src="https://github.com/facebook/react/assets/8965173/31508fdc-4cb1-4ce0-8e22-c02a034377b0">

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index ee54bac0c3..dab7f69b27 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -134,7 +134,7 @@ describe('ReactDOMOption', () => {
     }).rejects.toThrow('Objects are not valid as a React child');
   });
 
-  // @gate www
+  // @gate www && !renameElementSymbol
   it('should support element-ish child', async () => {
     // This is similar to <fbt>.
     // We don't toString it because you must instead provide a value prop.

commit 2d3f81bb6a650386832d885d7b63a7d0d517ba15
Author: Sebastian Markb√•ge <sebastian@calyptus.eu>
Date:   Wed Jul 10 12:17:13 2024 -0400

    Format DOM Nesting Warning as Diff View + An Additional Log for Stack Trace (#30302)
    
    Currently we're printing parent stacks at the end of DOM nesting even
    with owner stacks enabled. That's because the context of parent tree is
    relevant for determining why two things are nested. It might not be
    sufficient to see the owner stack alone.
    
    I'm trying to get rid of parent stacks and rely on more of the plain
    owner stacks or ideally console.createTask. These are generally better
    anyway since the exact line for creating the JSX is available. It also
    lets you find a parent stack frame that is most relevant e.g. if it's
    hidden inside internals.
    
    For DOM nesting there's really only two stacks that are relevant. The
    creation of the parent and the creation of the child. Sometimes they're
    close enough to be the same thing. Such as for parents that can't have
    text children or when the ancestor is the direct parent created at the
    same place (same owner).
    
    Sometimes they're far apart. In this case I add a second console.error
    within the context of the ancestor. That way the second stack trace can
    be used to read the stack trace for where it was created.
    
    To preserve some parent context I now print the parent stack in a diff
    view format using the logic from hydration diffs. This includes some
    siblings and props for context.
    
    <img width="756" alt="Screenshot 2024-07-10 at 12 21 38‚ÄØAM"
    src="https://github.com/facebook/react/assets/63648/0843133d-cc7a-4ecc-91c0-f46ae8e99f20">
    
    Text Nodes:
    
    <img width="749" alt="Screenshot 2024-07-10 at 12 37 40‚ÄØAM"
    src="https://github.com/facebook/react/assets/63648/ee377d82-54ee-450a-99d1-fcc3ef290d59">
    
    ---------
    
    Co-authored-by: tjallingt <tjallingt@gmail.com>

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index dab7f69b27..ce5e3c65bc 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -53,8 +53,15 @@ describe('ReactDOMOption', () => {
     }).toErrorDev(
       'In HTML, <div> cannot be a child of <option>.\n' +
         'This will cause a hydration error.\n' +
-        '    in div (at **)\n' +
-        '    in option (at **)',
+        '\n' +
+        '> <option value="12">\n' +
+        '>   <div>\n' +
+        '    ...\n' +
+        '\n' +
+        '    in div (at **)' +
+        (gate(flags => flags.enableOwnerStacks)
+          ? ''
+          : '\n    in option (at **)'),
     );
     expect(container.firstChild.innerHTML).toBe('1 <div></div> 2');
     await renderIntoDocument(el);
@@ -266,7 +273,20 @@ describe('ReactDOMOption', () => {
           onRecoverableError: () => {},
         });
       });
-    }).toErrorDev(['In HTML, <div> cannot be a child of <option>']);
+    }).toErrorDev(
+      'In HTML, <div> cannot be a child of <option>.\n' +
+        'This will cause a hydration error.\n' +
+        '\n' +
+        '  <select readOnly={true} value="bar">\n' +
+        '>   <option value="bar">\n' +
+        '>     <div ref={{current:null}}>\n' +
+        '      ...\n' +
+        '\n' +
+        '    in div (at **)' +
+        (gate(flags => flags.enableOwnerStacks)
+          ? ''
+          : '\n    in option (at **)'),
+    );
     option = container.firstChild.firstChild;
 
     expect(option.textContent).toBe('BarFooBaz');

commit 03e4ec2d0fe7cd854d28634ba035dc8996ff244d
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Sun Jan 5 17:10:29 2025 -0500

    [assert helpers] react-dom (pt3) (#31983)
    
    moar assert helpers
    
    this finishes all of react-dom except the server integration tests which
    are tricky to convert

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index ce5e3c65bc..cb4270cd1e 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -14,6 +14,7 @@ describe('ReactDOMOption', () => {
   let ReactDOMClient;
   let ReactDOMServer;
   let act;
+  let assertConsoleErrorDev;
 
   beforeEach(() => {
     jest.resetModules();
@@ -21,6 +22,8 @@ describe('ReactDOMOption', () => {
     ReactDOMClient = require('react-dom/client');
     ReactDOMServer = require('react-dom/server');
     act = require('internal-test-utils').act;
+    assertConsoleErrorDev =
+      require('internal-test-utils').assertConsoleErrorDev;
   });
 
   async function renderIntoDocument(children) {
@@ -47,10 +50,8 @@ describe('ReactDOMOption', () => {
         {1} <div /> {2}
       </option>
     );
-    let container;
-    await expect(async () => {
-      container = await renderIntoDocument(el);
-    }).toErrorDev(
+    const container = await renderIntoDocument(el);
+    assertConsoleErrorDev([
       'In HTML, <div> cannot be a child of <option>.\n' +
         'This will cause a hydration error.\n' +
         '\n' +
@@ -62,7 +63,7 @@ describe('ReactDOMOption', () => {
         (gate(flags => flags.enableOwnerStacks)
           ? ''
           : '\n    in option (at **)'),
-    );
+    ]);
     expect(container.firstChild.innerHTML).toBe('1 <div></div> 2');
     await renderIntoDocument(el);
   });
@@ -76,13 +77,12 @@ describe('ReactDOMOption', () => {
         {1} <Foo /> {3}
       </option>
     );
-    let container;
-    await expect(async () => {
-      container = await renderIntoDocument(el);
-    }).toErrorDev(
+    const container = await renderIntoDocument(el);
+    assertConsoleErrorDev([
       'Cannot infer the option value of complex children. ' +
-        'Pass a `value` prop or use a plain string as children to <option>.',
-    );
+        'Pass a `value` prop or use a plain string as children to <option>.\n' +
+        '    in option (at **)',
+    ]);
     expect(container.firstChild.innerHTML).toBe('1 2 3');
     await renderIntoDocument(el);
   });
@@ -187,13 +187,11 @@ describe('ReactDOMOption', () => {
 
   it('should be able to use dangerouslySetInnerHTML on option', async () => {
     const stub = <option dangerouslySetInnerHTML={{__html: 'foobar'}} />;
-    let container;
-    await expect(async () => {
-      container = await renderIntoDocument(stub);
-    }).toErrorDev(
+    const container = await renderIntoDocument(stub);
+    assertConsoleErrorDev([
       'Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected.\n' +
         '    in option (at **)',
-    );
+    ]);
 
     expect(container.firstChild.innerHTML).toBe('foobar');
   });
@@ -267,13 +265,12 @@ describe('ReactDOMOption', () => {
     expect(option.textContent).toBe('BarFooBaz');
     expect(option.selected).toBe(true);
 
-    await expect(async () => {
-      await act(async () => {
-        ReactDOMClient.hydrateRoot(container, children, {
-          onRecoverableError: () => {},
-        });
+    await act(async () => {
+      ReactDOMClient.hydrateRoot(container, children, {
+        onRecoverableError: () => {},
       });
-    }).toErrorDev(
+    });
+    assertConsoleErrorDev([
       'In HTML, <div> cannot be a child of <option>.\n' +
         'This will cause a hydration error.\n' +
         '\n' +
@@ -285,8 +282,8 @@ describe('ReactDOMOption', () => {
         '    in div (at **)' +
         (gate(flags => flags.enableOwnerStacks)
           ? ''
-          : '\n    in option (at **)'),
-    );
+          : '\n    in option (at **)' + '\n    in select (at **)'),
+    ]);
     option = container.firstChild.firstChild;
 
     expect(option.textContent).toBe('BarFooBaz');

commit e0fe3479671555e01531dbc3d2fd85d5bd4c5a56
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Tue Mar 4 12:34:34 2025 -0500

    [flags] remove enableOwnerStacks (#32426)
    
    Bassed off: https://github.com/facebook/react/pull/32425
    
    Wait to land internally.
    
    [Commit to
    review.](https://github.com/facebook/react/pull/32426/commits/66aa6a4dbb78106b4f3d3eb367f5c27eb8f30c66)
    
    This has landed everywhere

diff --git a/packages/react-dom/src/__tests__/ReactDOMOption-test.js b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
index cb4270cd1e..9859fb67f1 100644
--- a/packages/react-dom/src/__tests__/ReactDOMOption-test.js
+++ b/packages/react-dom/src/__tests__/ReactDOMOption-test.js
@@ -59,10 +59,7 @@ describe('ReactDOMOption', () => {
         '>   <div>\n' +
         '    ...\n' +
         '\n' +
-        '    in div (at **)' +
-        (gate(flags => flags.enableOwnerStacks)
-          ? ''
-          : '\n    in option (at **)'),
+        '    in div (at **)',
     ]);
     expect(container.firstChild.innerHTML).toBe('1 <div></div> 2');
     await renderIntoDocument(el);
@@ -279,10 +276,7 @@ describe('ReactDOMOption', () => {
         '>     <div ref={{current:null}}>\n' +
         '      ...\n' +
         '\n' +
-        '    in div (at **)' +
-        (gate(flags => flags.enableOwnerStacks)
-          ? ''
-          : '\n    in option (at **)' + '\n    in select (at **)'),
+        '    in div (at **)',
     ]);
     option = container.firstChild.firstChild;
 

