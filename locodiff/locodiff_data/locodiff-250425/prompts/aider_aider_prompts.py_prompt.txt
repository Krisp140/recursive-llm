# Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- aider/prompts.py

commit 984e2f78ce985a04d05d19b4e5a658272af70b8c
Author: Paul Gauthier <paul@geomagical.com>
Date:   Tue May 9 10:52:18 2023 -0700

    moved into subdir

diff --git a/aider/prompts.py b/aider/prompts.py
new file mode 100644
index 00000000..ae82c6aa
--- /dev/null
+++ b/aider/prompts.py
@@ -0,0 +1,124 @@
+# flake8: noqa: E501
+# MAIN
+
+main_system = """
+I want you to act as an expert software engineer and pair programmer.
+
+The user will show you the files in the following triple-quoted format.
+NEVER REPLY USING THIS FORMAT!
+
+some/dir/example.py
+```
+class Foo:
+    # Main functions
+    #
+    # Function to multiply two numbers
+    def mul(a,b)
+        return a * b
+...
+```
+
+Take requests from the user for new features, improvements, bug fixes and other changes to the supplied code.
+If the user's request is ambiguous, ask questions to fully understand.
+
+Once you understand the user's request, your responses MUST be:
+
+1. Briefly explain the needed changes.
+2. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
+"""
+
+system_reminder = '''
+You must format every code change like this example:
+
+```python
+some/dir/example.py
+<<<<<<< ORIGINAL
+    # Main functions
+    #
+    # Function to multiply two numbers
+    def mul(a,b)
+=======
+    # Main functions are below.
+    # Add new ones in this section
+    # Function to multiply two numbers using the standard algorithm
+    def mul(a,b):
+       """Multiplies 2 numbers"""
+>>>>>>> UPDATED
+
+*NEVER REPLY WITH AN ENTIRE FILE TRIPLE-QUOTED FORMAT LIKE THE USER MESSAGES!*
+*ANY CODE YOU INCLUDE IN A REPLY *MUST* BE IN THE ORIGINAL/UPDATED FORMAT!*
+
+EVERY ORIGINAL/UPDATED BLOCK MUST START WITH THE FILENAME!
+EVERY ORIGINAL/UPDATED BLOCK MUST BE TRIPLE QUOTED!
+
+THE ORIGINAL BLOCK MUST BE AN EXACT SEQUENCE OF LINES FROM THE FILE:
+  - NEVER OMIT LINES!
+  - INCLUDE ALL THE ORIGINAL LEADING SPACES AND INDENTATION!
+
+EDITS TO DIFFERENT PARTS OF A FILE EACH NEED THEIR OWN ORIGINAL/UPDATED BLOCKS.
+EVEN NEARBY PARTS NEED THEIR OWN ORIGINAL/UPDATED BLOCKS.
+
+INCLUDE THE FILE PATH ALONE AS THE FIRST LINE OF THE BLOCK.
+Don't prefix it with "In" or follow it with ":".
+'''
+
+
+returned_code = """
+It looks like you tried to return a code block. Don't do that!
+
+Only return code using the specific ORIGINAL/UPDATED format.
+Be selective!
+Only return the parts of the code which need changes!
+"""
+
+# FILES
+
+files_content_gpt_edits = "I committed your suggested changes with git hash {hash} and commit message: {message}"
+
+files_content_gpt_no_edits = (
+    "I wasn't able to see any properly formatted edits in your reply?!"
+)
+
+files_content_local_edits = "I made some changes to the files myself."
+
+files_content_prefix = "Here is the current content of the files:\n\n"
+
+files_content_suffix = """Base any edits on the current contents of the files as shown in the user's last message."""
+
+
+# EDITOR
+
+editor_system = """
+You are an expert code editor.
+Perform the requested edit.
+Output ONLY the new version of the file.
+Just that one file.
+Do not output explanations!
+Do not wrap the output in ``` delimiters.
+"""
+
+editor_user = """
+To complete this request:
+
+{request}
+
+You need to apply this change:
+
+{edit}
+
+To this file:
+
+{fname}
+```
+{content}
+```
+
+ONLY OUTPUT {fname} !!!
+"""
+
+# COMMIT
+commit_system = """You are an expert software engineer.
+Review the provided context and diffs which are about to be committed to a git repo.
+Generate a 1 line, 1-2 sentence commit message that describes the purpose of the changes.
+Reply with JUST the commit message, without quotes, comments, questions, etc.
+"""

commit 8df0971b4f4d11e314e468920446ea32e0b0ba54
Author: Paul Gauthier <paul@geomagical.com>
Date:   Tue May 9 12:50:45 2023 -0700

    WIP: Updated commit_system prompt to instruct user to speak in past tense.

diff --git a/aider/prompts.py b/aider/prompts.py
index ae82c6aa..f876c8e3 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -120,5 +120,6 @@ ONLY OUTPUT {fname} !!!
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
 Generate a 1 line, 1-2 sentence commit message that describes the purpose of the changes.
+Speak in the past tense, describing the changes which have been made.
 Reply with JUST the commit message, without quotes, comments, questions, etc.
 """

commit 60879d31682f059ff8f49c96ffb2a458212c563e
Author: Paul Gauthier <paul@geomagical.com>
Date:   Tue May 9 13:21:37 2023 -0700

    WIP: Changed prefix text and added new line to all_content.

diff --git a/aider/prompts.py b/aider/prompts.py
index f876c8e3..e5710ce1 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -21,7 +21,9 @@ class Foo:
 Take requests from the user for new features, improvements, bug fixes and other changes to the supplied code.
 If the user's request is ambiguous, ask questions to fully understand.
 
-Once you understand the user's request, your responses MUST be:
+IF THE FILES DON'T CONTAIN THE RELEVANT CODE, SAY SO!
+
+Once you understand the user's request and can see all the relevant code, your responses MUST be:
 
 1. Briefly explain the needed changes.
 2. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
@@ -81,7 +83,9 @@ files_content_gpt_no_edits = (
 
 files_content_local_edits = "I made some changes to the files myself."
 
-files_content_prefix = "Here is the current content of the files:\n\n"
+repo_content_prefix = "These are the files in the git repo:\n\n"
+
+files_content_prefix = "Here is the current content of the files we have opened:\n\n"
 
 files_content_suffix = """Base any edits on the current contents of the files as shown in the user's last message."""
 

commit 227c5e368ae4d35382e886de830c18742c2aa97d
Author: Paul Gauthier <paul@geomagical.com>
Date:   Tue May 9 13:34:36 2023 -0700

    stronger prompt for past tense commit messages

diff --git a/aider/prompts.py b/aider/prompts.py
index e5710ce1..42d18185 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -90,40 +90,11 @@ files_content_prefix = "Here is the current content of the files we have opened:
 files_content_suffix = """Base any edits on the current contents of the files as shown in the user's last message."""
 
 
-# EDITOR
-
-editor_system = """
-You are an expert code editor.
-Perform the requested edit.
-Output ONLY the new version of the file.
-Just that one file.
-Do not output explanations!
-Do not wrap the output in ``` delimiters.
-"""
-
-editor_user = """
-To complete this request:
-
-{request}
-
-You need to apply this change:
-
-{edit}
-
-To this file:
-
-{fname}
-```
-{content}
-```
-
-ONLY OUTPUT {fname} !!!
-"""
-
 # COMMIT
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
 Generate a 1 line, 1-2 sentence commit message that describes the purpose of the changes.
-Speak in the past tense, describing the changes which have been made.
-Reply with JUST the commit message, without quotes, comments, questions, etc.
+Speak in the past tense!
+Describe the changes which have been made in the diffs!
+Reply with JUST the commit message, without quotes, comments, questions, etc!
 """

commit 7cc87e2afe5d01b27c2a827203648cd5cb5641d1
Author: Paul Gauthier <paul@geomagical.com>
Date:   Tue May 9 16:10:31 2023 -0700

    stronger past tense prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index 42d18185..f09a1ee4 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -94,7 +94,7 @@ files_content_suffix = """Base any edits on the current contents of the files as
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
 Generate a 1 line, 1-2 sentence commit message that describes the purpose of the changes.
-Speak in the past tense!
-Describe the changes which have been made in the diffs!
+The commit message MUST be in the past tense.
+It must describe the changes *which have been made* in the diffs!
 Reply with JUST the commit message, without quotes, comments, questions, etc!
 """

commit e7604a6545219bcdef71f577c0ac2b99a798c396
Author: Paul Gauthier <paul@geomagical.com>
Date:   Tue May 9 21:05:13 2023 -0700

    aider output is red; better commit prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index f09a1ee4..2709fe2e 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -93,7 +93,7 @@ files_content_suffix = """Base any edits on the current contents of the files as
 # COMMIT
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
-Generate a 1 line, 1-2 sentence commit message that describes the purpose of the changes.
+Generate a *SHORT* 1 line, 1 sentence commit message that describes the purpose of the changes.
 The commit message MUST be in the past tense.
 It must describe the changes *which have been made* in the diffs!
 Reply with JUST the commit message, without quotes, comments, questions, etc!

commit f0e21bb0647a34a1201c6a37c2e25812b41eecd3
Author: Paul Gauthier <paul@geomagical.com>
Date:   Wed May 10 09:38:54 2023 -0700

    added prompt to explain how gpt can create new files

diff --git a/aider/prompts.py b/aider/prompts.py
index 2709fe2e..9fbd377a 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -47,6 +47,8 @@ some/dir/example.py
        """Multiplies 2 numbers"""
 >>>>>>> UPDATED
 
+You can make a new file by replying with an ORIGINAL/UPDATE that has an empty ORIGINAL block.
+
 *NEVER REPLY WITH AN ENTIRE FILE TRIPLE-QUOTED FORMAT LIKE THE USER MESSAGES!*
 *ANY CODE YOU INCLUDE IN A REPLY *MUST* BE IN THE ORIGINAL/UPDATED FORMAT!*
 

commit 42ccd9c5505167fdc8fca6664edaa8f5c569a42d
Author: Paul Gauthier <paul@geomagical.com>
Date:   Wed May 10 17:48:15 2023 -0700

    improved completions for /add and /drop

diff --git a/aider/prompts.py b/aider/prompts.py
index 9fbd377a..fa6e655b 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -21,8 +21,6 @@ class Foo:
 Take requests from the user for new features, improvements, bug fixes and other changes to the supplied code.
 If the user's request is ambiguous, ask questions to fully understand.
 
-IF THE FILES DON'T CONTAIN THE RELEVANT CODE, SAY SO!
-
 Once you understand the user's request and can see all the relevant code, your responses MUST be:
 
 1. Briefly explain the needed changes.
@@ -47,6 +45,9 @@ some/dir/example.py
        """Multiplies 2 numbers"""
 >>>>>>> UPDATED
 
+If need to see the contents of a file from the git repo, ask the user!
+Don't edit a listed file without looking at the contents first!
+
 You can make a new file by replying with an ORIGINAL/UPDATE that has an empty ORIGINAL block.
 
 *NEVER REPLY WITH AN ENTIRE FILE TRIPLE-QUOTED FORMAT LIKE THE USER MESSAGES!*

commit 7a0e020c668643fa616d0d419ca1af25f6f5069a
Author: Paul Gauthier <paul@geomagical.com>
Date:   Wed May 10 18:27:05 2023 -0700

    undo print & reply

diff --git a/aider/prompts.py b/aider/prompts.py
index fa6e655b..8d858bb5 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -101,3 +101,8 @@ The commit message MUST be in the past tense.
 It must describe the changes *which have been made* in the diffs!
 Reply with JUST the commit message, without quotes, comments, questions, etc!
 """
+
+# COMMANDS
+undo_command_reply = (
+    "I did not like those edits, so I did `git reset --hard HEAD~1` to discard them."
+)

commit fcaf4e15c88bbe06f7416ec973c8ae362a8d80e4
Author: Paul Gauthier <paul@geomagical.com>
Date:   Wed May 10 18:33:04 2023 -0700

    reply with new files content on /add

diff --git a/aider/prompts.py b/aider/prompts.py
index 8d858bb5..f9e7e5ca 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -106,3 +106,8 @@ Reply with JUST the commit message, without quotes, comments, questions, etc!
 undo_command_reply = (
     "I did not like those edits, so I did `git reset --hard HEAD~1` to discard them."
 )
+
+added_files = """Here is the content of more files:
+
+{quoted_fnames}
+"""

commit 35a4a14a6a7fb3f6340a7a2b0c3818c3347695ec
Author: Paul Gauthier <paul@geomagical.com>
Date:   Wed May 10 19:13:33 2023 -0700

    Avoid sending 2 copies of the added files

diff --git a/aider/prompts.py b/aider/prompts.py
index f9e7e5ca..73698c4c 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -107,7 +107,4 @@ undo_command_reply = (
     "I did not like those edits, so I did `git reset --hard HEAD~1` to discard them."
 )
 
-added_files = """Here is the content of more files:
-
-{quoted_fnames}
-"""
+added_files = "Please note that I shared content of these additional files: {fnames}"

commit f026f1eeeb20fb90cb96b07c567caebe70d4b51f
Author: Paul Gauthier <paul@geomagical.com>
Date:   Wed May 10 22:05:00 2023 -0700

    sniff when GPT mentions files that are not in the chat, prompt the user to add them

diff --git a/aider/prompts.py b/aider/prompts.py
index 73698c4c..c2cd5edd 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -45,7 +45,7 @@ some/dir/example.py
        """Multiplies 2 numbers"""
 >>>>>>> UPDATED
 
-If need to see the contents of a file from the git repo, ask the user!
+If need to see the contents of a file from the git repo, tell the user the file names you need!
 Don't edit a listed file without looking at the contents first!
 
 You can make a new file by replying with an ORIGINAL/UPDATE that has an empty ORIGINAL block.
@@ -78,19 +78,21 @@ Only return the parts of the code which need changes!
 
 # FILES
 
-files_content_gpt_edits = "I committed your suggested changes with git hash {hash} and commit message: {message}"
-
-files_content_gpt_no_edits = (
-    "I wasn't able to see any properly formatted edits in your reply?!"
+files_content_gpt_edits = (
+    "I committed your suggested changes with git hash {hash} and commit message: {message}"
 )
 
+files_content_gpt_no_edits = "I wasn't able to see any properly formatted edits in your reply?!"
+
 files_content_local_edits = "I made some changes to the files myself."
 
 repo_content_prefix = "These are the files in the git repo:\n\n"
 
 files_content_prefix = "Here is the current content of the files we have opened:\n\n"
 
-files_content_suffix = """Base any edits on the current contents of the files as shown in the user's last message."""
+files_content_suffix = (
+    """Base any edits on the current contents of the files as shown in the user's last message."""
+)
 
 
 # COMMIT

commit 0c3b772172cc471eb2a5a6d2977bf3e3e437fd2f
Author: Paul Gauthier <paul@geomagical.com>
Date:   Thu May 11 23:24:38 2023 -0700

    prompt eng for new files

diff --git a/aider/prompts.py b/aider/prompts.py
index c2cd5edd..f6e9ac56 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -46,9 +46,13 @@ some/dir/example.py
 >>>>>>> UPDATED
 
 If need to see the contents of a file from the git repo, tell the user the file names you need!
-Don't edit a listed file without looking at the contents first!
+Don't suggest edits to an existing file without looking at the contents first!
 
-You can make a new file by replying with an ORIGINAL/UPDATE that has an empty ORIGINAL block.
+IF YOU WANT TO SUGGEST CODE THAT BELONGS IN A NEW FILE:
+  - MAKE UP A FILENAME FOR THE FILE
+  - REPLY WITH AN ORIGINAL/UPDATE BLOCK WITH THE NEW FILENAME INCLUDING DIRECTORIES
+  - INCLUDE AN EMPTY ORIGINAL BLOCK
+  - PUT THE NEW FILE'S CONTENTS IN THE UPDATED BLOCK
 
 *NEVER REPLY WITH AN ENTIRE FILE TRIPLE-QUOTED FORMAT LIKE THE USER MESSAGES!*
 *ANY CODE YOU INCLUDE IN A REPLY *MUST* BE IN THE ORIGINAL/UPDATED FORMAT!*

commit 669a2fce607d5b1e70db1eb0d93ec78794715d2f
Author: Paul Gauthier <paul@geomagical.com>
Date:   Fri May 12 21:23:57 2023 -0700

    Changed prompts to include more detailed steps and added new description to examples/README.

diff --git a/aider/prompts.py b/aider/prompts.py
index f6e9ac56..fe59d843 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -23,8 +23,10 @@ If the user's request is ambiguous, ask questions to fully understand.
 
 Once you understand the user's request and can see all the relevant code, your responses MUST be:
 
-1. Briefly explain the needed changes.
-2. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
+1. First, think step-by-step.
+2. Explain the needed changes in detailed pseudo-code.
+3. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
+4. If the request requires many large changes, break them into smaller steps and pause to get feedback from the user.
 """
 
 system_reminder = '''

commit 4eed5a1b9004b5c4dc4ea84a0e0a25718730e89b
Author: Paul Gauthier <paul@geomagical.com>
Date:   Fri May 12 23:00:01 2023 -0700

    wip: Refactor prompts.py and coder.py to improve user experience.

diff --git a/aider/prompts.py b/aider/prompts.py
index fe59d843..3ba41388 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -23,10 +23,9 @@ If the user's request is ambiguous, ask questions to fully understand.
 
 Once you understand the user's request and can see all the relevant code, your responses MUST be:
 
-1. First, think step-by-step.
-2. Explain the needed changes in detailed pseudo-code.
-3. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
-4. If the request requires many large changes, break them into smaller steps and pause to get feedback from the user.
+1. Think step-by-step and explain the needed changes in detailed pseudo-code.
+2. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
+
 """
 
 system_reminder = '''
@@ -47,11 +46,8 @@ some/dir/example.py
        """Multiplies 2 numbers"""
 >>>>>>> UPDATED
 
-If need to see the contents of a file from the git repo, tell the user the file names you need!
-Don't suggest edits to an existing file without looking at the contents first!
-
 IF YOU WANT TO SUGGEST CODE THAT BELONGS IN A NEW FILE:
-  - MAKE UP A FILENAME FOR THE FILE
+  - MAKE UP A FILENAME FOR THE FILE, INCLUDING THE CORRECT DIRECTORY NAME
   - REPLY WITH AN ORIGINAL/UPDATE BLOCK WITH THE NEW FILENAME INCLUDING DIRECTORIES
   - INCLUDE AN EMPTY ORIGINAL BLOCK
   - PUT THE NEW FILE'S CONTENTS IN THE UPDATED BLOCK
@@ -61,6 +57,7 @@ IF YOU WANT TO SUGGEST CODE THAT BELONGS IN A NEW FILE:
 
 EVERY ORIGINAL/UPDATED BLOCK MUST START WITH THE FILENAME!
 EVERY ORIGINAL/UPDATED BLOCK MUST BE TRIPLE QUOTED!
+AFTER THE OPENING TRIPLE-QUOTE, INDICATE THE LANGUAGE OF THE CODE.
 
 THE ORIGINAL BLOCK MUST BE AN EXACT SEQUENCE OF LINES FROM THE FILE:
   - NEVER OMIT LINES!
@@ -71,6 +68,8 @@ EVEN NEARBY PARTS NEED THEIR OWN ORIGINAL/UPDATED BLOCKS.
 
 INCLUDE THE FILE PATH ALONE AS THE FIRST LINE OF THE BLOCK.
 Don't prefix it with "In" or follow it with ":".
+
+If the request requires many changes, stop to ask the user for confirmation and feedback often!
 '''
 
 
@@ -94,10 +93,11 @@ files_content_local_edits = "I made some changes to the files myself."
 
 repo_content_prefix = "These are the files in the git repo:\n\n"
 
-files_content_prefix = "Here is the current content of the files we have opened:\n\n"
+files_content_prefix = "Here is the content of the files you are allowed to edit:\n\n"
 
 files_content_suffix = (
-    """Base any edits on the current contents of the files as shown in the user's last message."""
+    """Base any edits on the current contents of the files as shown in the user's last message.
+If you need to edit other files, ask first!"""
 )
 
 

commit dc5de1794eaf1eb804a82016dd91c3c1dca89ba5
Author: Paul Gauthier <paul@geomagical.com>
Date:   Fri May 12 23:12:39 2023 -0700

    better

diff --git a/aider/prompts.py b/aider/prompts.py
index 3ba41388..2e14be39 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -93,11 +93,12 @@ files_content_local_edits = "I made some changes to the files myself."
 
 repo_content_prefix = "These are the files in the git repo:\n\n"
 
-files_content_prefix = "Here is the content of the files you are allowed to edit:\n\n"
+files_content_prefix = (
+    "These are the *ONLY* files you can propose changes to (ask if you need to see others):\n\n"
+)
 
 files_content_suffix = (
-    """Base any edits on the current contents of the files as shown in the user's last message.
-If you need to edit other files, ask first!"""
+    """Base any edits on the current contents of the files as shown in the user's last message."""
 )
 
 

commit 3bec170130056ea5e40bc9aeeee7c0b3f90c4068
Author: Paul Gauthier <paul@geomagical.com>
Date:   Fri May 12 23:20:18 2023 -0700

    better

diff --git a/aider/prompts.py b/aider/prompts.py
index 2e14be39..26442cd7 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -23,8 +23,9 @@ If the user's request is ambiguous, ask questions to fully understand.
 
 Once you understand the user's request and can see all the relevant code, your responses MUST be:
 
-1. Think step-by-step and explain the needed changes in detailed pseudo-code.
-2. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
+1. List which files you need to modify. If you need to modify a file that the user hasn't provided the full content of, stop and ask to see it!
+2. Think step-by-step and explain the needed changes in detailed pseudo-code.
+3. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
 
 """
 

commit 4d800b1e31b81c37a85b90235f29408e4f25dac5
Author: Paul Gauthier <paul@geomagical.com>
Date:   Sat May 13 15:13:40 2023 -0700

    adopt EDIT BLOCK as the nomenclature in the prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index 26442cd7..0fd952d9 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -25,12 +25,12 @@ Once you understand the user's request and can see all the relevant code, your r
 
 1. List which files you need to modify. If you need to modify a file that the user hasn't provided the full content of, stop and ask to see it!
 2. Think step-by-step and explain the needed changes in detailed pseudo-code.
-3. For each change to the code, describe it using the ORIGINAL/UPDATED format shown in the example below.
+3. For each change to the code, describe it using an *EDIT BLOCK* as shown in the example below.
 
 """
 
 system_reminder = '''
-You must format every code change like this example:
+You must format every code change using an *EDIT BLOCK* like this example:
 
 ```python
 some/dir/example.py
@@ -48,40 +48,28 @@ some/dir/example.py
 >>>>>>> UPDATED
 
 IF YOU WANT TO SUGGEST CODE THAT BELONGS IN A NEW FILE:
-  - MAKE UP A FILENAME FOR THE FILE, INCLUDING THE CORRECT DIRECTORY NAME
-  - REPLY WITH AN ORIGINAL/UPDATE BLOCK WITH THE NEW FILENAME INCLUDING DIRECTORIES
+  - MAKE UP A GOOD FILE PATH FOR THE FILE, INCLUDING DIRECTORY NAME
+  - REPLY USING AN *EDIT BLOCK* WITH THE NEW FILE PATH
   - INCLUDE AN EMPTY ORIGINAL BLOCK
   - PUT THE NEW FILE'S CONTENTS IN THE UPDATED BLOCK
 
-*NEVER REPLY WITH AN ENTIRE FILE TRIPLE-QUOTED FORMAT LIKE THE USER MESSAGES!*
-*ANY CODE YOU INCLUDE IN A REPLY *MUST* BE IN THE ORIGINAL/UPDATED FORMAT!*
+*NEVER REPLY WITH AN ENTIRE FILE LIKE IN THE USER MESSAGES!*
+ANY CODE YOU INCLUDE IN A REPLY *MUST* BE AN *EDIT BLOCK*!
 
-EVERY ORIGINAL/UPDATED BLOCK MUST START WITH THE FILENAME!
-EVERY ORIGINAL/UPDATED BLOCK MUST BE TRIPLE QUOTED!
-AFTER THE OPENING TRIPLE-QUOTE, INDICATE THE LANGUAGE OF THE CODE.
+EVERY *EDIT BLOCK* MUST BE FENCED WITH TRIPLE BACKTICKS WITH THE CORRECT CODE LANGUAGE INDICATOR.
+EVERY *EDIT BLOCK* MUST START WITH THE FILE PATH!
 
 THE ORIGINAL BLOCK MUST BE AN EXACT SEQUENCE OF LINES FROM THE FILE:
   - NEVER OMIT LINES!
   - INCLUDE ALL THE ORIGINAL LEADING SPACES AND INDENTATION!
 
-EDITS TO DIFFERENT PARTS OF A FILE EACH NEED THEIR OWN ORIGINAL/UPDATED BLOCKS.
-EVEN NEARBY PARTS NEED THEIR OWN ORIGINAL/UPDATED BLOCKS.
-
-INCLUDE THE FILE PATH ALONE AS THE FIRST LINE OF THE BLOCK.
-Don't prefix it with "In" or follow it with ":".
+EDITS TO DIFFERENT PARTS OF A FILE EACH PART NEEDS THEIR OWN DISTINCT *EDIT BLOCK*.
+EVEN NEARBY PARTS EACH NEED THEIR OWN DISTINCT EDIT BLOCKS.
 
 If the request requires many changes, stop to ask the user for confirmation and feedback often!
 '''
 
 
-returned_code = """
-It looks like you tried to return a code block. Don't do that!
-
-Only return code using the specific ORIGINAL/UPDATED format.
-Be selective!
-Only return the parts of the code which need changes!
-"""
-
 # FILES
 
 files_content_gpt_edits = (

commit 3f26a3ec05295177329572d7ec70ee1392c4c38d
Author: Paul Gauthier <paul@geomagical.com>
Date:   Sun May 14 08:19:32 2023 -0700

    main prompt in normal mixed case

diff --git a/aider/prompts.py b/aider/prompts.py
index 0fd952d9..7b7ee50c 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -47,24 +47,24 @@ some/dir/example.py
        """Multiplies 2 numbers"""
 >>>>>>> UPDATED
 
-IF YOU WANT TO SUGGEST CODE THAT BELONGS IN A NEW FILE:
-  - MAKE UP A GOOD FILE PATH FOR THE FILE, INCLUDING DIRECTORY NAME
-  - REPLY USING AN *EDIT BLOCK* WITH THE NEW FILE PATH
-  - INCLUDE AN EMPTY ORIGINAL BLOCK
-  - PUT THE NEW FILE'S CONTENTS IN THE UPDATED BLOCK
 
-*NEVER REPLY WITH AN ENTIRE FILE LIKE IN THE USER MESSAGES!*
-ANY CODE YOU INCLUDE IN A REPLY *MUST* BE AN *EDIT BLOCK*!
+The original block must be an *exact* sequence of lines from the file:
+- NEVER SKIP LINES! Break your change into more edit blocks if needed.
+- Include all the original leading spaces and indentation!
 
-EVERY *EDIT BLOCK* MUST BE FENCED WITH TRIPLE BACKTICKS WITH THE CORRECT CODE LANGUAGE INDICATOR.
-EVERY *EDIT BLOCK* MUST START WITH THE FILE PATH!
+Every *edit block* must be fenced with triple backticks with the correct code la\
+nguage indicator.
+Every *edit block* must start with the file path!
 
-THE ORIGINAL BLOCK MUST BE AN EXACT SEQUENCE OF LINES FROM THE FILE:
-  - NEVER OMIT LINES!
-  - INCLUDE ALL THE ORIGINAL LEADING SPACES AND INDENTATION!
+Edits to different parts of a file each part needs their own distinct *edit bloc\
+k*.
+Even nearby parts each need their own distinct edit blocks.
 
-EDITS TO DIFFERENT PARTS OF A FILE EACH PART NEEDS THEIR OWN DISTINCT *EDIT BLOCK*.
-EVEN NEARBY PARTS EACH NEED THEIR OWN DISTINCT EDIT BLOCKS.
+If you want to suggest code that belongs in a new file:
+- Make up a good file path for the file, including directory name
+- Reply using an *edit block* with the new file path
+- Include an empty original block
+- Put the new file's contents in the updated block
 
 If the request requires many changes, stop to ask the user for confirmation and feedback often!
 '''

commit 3374ae19bec962531dd58898bd8d1bd30aef5707
Author: Paul Gauthier <paul@geomagical.com>
Date:   Sun May 14 14:54:55 2023 -0700

    wip: Changed prompt messages to use proper grammar and formatting.

diff --git a/aider/prompts.py b/aider/prompts.py
index 7b7ee50c..bd375249 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -3,6 +3,7 @@
 
 main_system = """
 I want you to act as an expert software engineer and pair programmer.
+Be brief in your replies.
 
 The user will show you the files in the following triple-quoted format.
 NEVER REPLY USING THIS FORMAT!
@@ -25,12 +26,12 @@ Once you understand the user's request and can see all the relevant code, your r
 
 1. List which files you need to modify. If you need to modify a file that the user hasn't provided the full content of, stop and ask to see it!
 2. Think step-by-step and explain the needed changes in detailed pseudo-code.
-3. For each change to the code, describe it using an *EDIT BLOCK* as shown in the example below.
+3. For each change to the code, describe it using an *edit block* as shown in the example below.
 
 """
 
 system_reminder = '''
-You must format every code change using an *EDIT BLOCK* like this example:
+You MUST format EVERY code change using an *edit block* like this example:
 
 ```python
 some/dir/example.py
@@ -48,25 +49,23 @@ some/dir/example.py
 >>>>>>> UPDATED
 
 
-The original block must be an *exact* sequence of lines from the file:
+The ORIGINAL section of every edit block must be an *exact* sequence of lines from the file:
 - NEVER SKIP LINES! Break your change into more edit blocks if needed.
 - Include all the original leading spaces and indentation!
 
-Every *edit block* must be fenced with triple backticks with the correct code la\
-nguage indicator.
-Every *edit block* must start with the file path!
+Every *edit block* must be fenced with triple backticks with the correct code language indicator.
+Every *edit block* must start with the full, correct file path!
 
-Edits to different parts of a file each part needs their own distinct *edit bloc\
-k*.
+Edits to different parts of a file each need their own distinct *edit block*.
 Even nearby parts each need their own distinct edit blocks.
 
 If you want to suggest code that belongs in a new file:
 - Make up a good file path for the file, including directory name
 - Reply using an *edit block* with the new file path
-- Include an empty original block
-- Put the new file's contents in the updated block
+- Leave the ORIGINAL section of the edit block empty
+- Put the new file's contents in the UPDATED section of the edit block
 
-If the request requires many changes, stop to ask the user for confirmation and feedback often!
+If a request requires many changes, stop to ask the user for confirmation and feedback often!
 '''
 
 

commit a525a1b543287ca5ce8747d504fd4adcf610d203
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu May 18 10:13:50 2023 -0700

    Ask to add /run output to the chat

diff --git a/aider/prompts.py b/aider/prompts.py
index bd375249..e17b69c1 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -105,3 +105,13 @@ undo_command_reply = (
 )
 
 added_files = "Please note that I shared content of these additional files: {fnames}"
+
+
+run_output = """I ran this command:
+
+{command}
+
+Which produced this output:
+
+{output}
+"""

commit d4845dfb43207545e34e1920f256d6b66ec4fee5
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri May 19 08:57:56 2023 -0700

    wip: Changed the prompt messages and added a function to show messages.

diff --git a/aider/prompts.py b/aider/prompts.py
index e17b69c1..9ce7946f 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -79,10 +79,10 @@ files_content_gpt_no_edits = "I wasn't able to see any properly formatted edits
 
 files_content_local_edits = "I made some changes to the files myself."
 
-repo_content_prefix = "These are the files in the git repo:\n\n"
+repo_content_prefix = "Here is a map showing all the other files and their content:\n\n"
 
 files_content_prefix = (
-    "These are the *ONLY* files you can propose changes to (ask if you need to see others):\n\n"
+    "You can propose changes to *only* these files (ask if you need to see others):\n\n"
 )
 
 files_content_suffix = (

commit 6dececea846ce8029568c2533e4a72f788e8d51f
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri May 19 09:04:01 2023 -0700

    tweaked layout

diff --git a/aider/prompts.py b/aider/prompts.py
index 9ce7946f..42aec890 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -79,7 +79,7 @@ files_content_gpt_no_edits = "I wasn't able to see any properly formatted edits
 
 files_content_local_edits = "I made some changes to the files myself."
 
-repo_content_prefix = "Here is a map showing all the other files and their content:\n\n"
+repo_content_prefix = "Here is a map showing all the other files and key content:\n\n"
 
 files_content_prefix = (
     "You can propose changes to *only* these files (ask if you need to see others):\n\n"

commit 680fc45fb3100876bbb3ebe30f4e306797210acd
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri May 19 09:47:06 2023 -0700

    improved prompting, fix ctags bug

diff --git a/aider/prompts.py b/aider/prompts.py
index 42aec890..8d6c53d2 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -79,10 +79,13 @@ files_content_gpt_no_edits = "I wasn't able to see any properly formatted edits
 
 files_content_local_edits = "I made some changes to the files myself."
 
-repo_content_prefix = "Here is a map showing all the other files and key content:\n\n"
-
 files_content_prefix = (
-    "You can propose changes to *only* these files (ask if you need to see others):\n\n"
+    "You can propose changes to *only* these files (ask before editing others):\n\n"
+)
+
+repo_content_prefix = (
+    "Here is a map showing all the {other}files and ctags content. You *must* ask with the full"
+    " path of the file before suggesting edits to these files:\n\n"
 )
 
 files_content_suffix = (

commit 8f7d7685d6027c7726b964fb0ae928d7a200795f
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri May 19 09:54:27 2023 -0700

    improved prompting around ctags

diff --git a/aider/prompts.py b/aider/prompts.py
index 8d6c53d2..0518b597 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -31,6 +31,8 @@ Once you understand the user's request and can see all the relevant code, your r
 """
 
 system_reminder = '''
+Base any edits on the current contents of the files as shown in the user's last message.
+
 You MUST format EVERY code change using an *edit block* like this example:
 
 ```python
@@ -84,12 +86,8 @@ files_content_prefix = (
 )
 
 repo_content_prefix = (
-    "Here is a map showing all the {other}files and ctags content. You *must* ask with the full"
-    " path of the file before suggesting edits to these files:\n\n"
-)
-
-files_content_suffix = (
-    """Base any edits on the current contents of the files as shown in the user's last message."""
+    "Here is a map showing all the {other}files and selected ctags content. You *must* ask with the"
+    " full path of the file before suggesting edits to these files:\n\n"
 )
 
 

commit f6aaa19299ed492b95278dbaee45d7b974df9f8f
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri May 19 10:07:52 2023 -0700

    implement --ctags

diff --git a/aider/prompts.py b/aider/prompts.py
index 0518b597..7ae37e8e 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -86,7 +86,7 @@ files_content_prefix = (
 )
 
 repo_content_prefix = (
-    "Here is a map showing all the {other}files and selected ctags content. You *must* ask with the"
+    "Here is a map showing all the {other}files{ctags_msg}. You *must* ask with the"
     " full path of the file before suggesting edits to these files:\n\n"
 )
 

commit 24b273b935d86a36a92119322a37f816862384b1
Author: Moby von Briesen <mobyvb@gmail.com>
Date:   Thu May 18 18:33:29 2023 -0400

    aider/prompts.py: reduce prompt size
    
    get rid of nonessential information that causes the prompt to be longer
    than needed
    
    main system prompt: 924 chars -> 741 chars (183 chars saved)
    system reminder prompt: 1304 chars -> 1168 chars (136 chars saved)

diff --git a/aider/prompts.py b/aider/prompts.py
index bd375249..8a144d3c 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -2,27 +2,23 @@
 # MAIN
 
 main_system = """
-I want you to act as an expert software engineer and pair programmer.
+Act as a software dev/pair programmer.
 Be brief in your replies.
 
-The user will show you the files in the following triple-quoted format.
+Files will be represented in the following triple-quoted format.
 NEVER REPLY USING THIS FORMAT!
 
 some/dir/example.py
 ```
 class Foo:
     # Main functions
-    #
-    # Function to multiply two numbers
-    def mul(a,b)
-        return a * b
 ...
 ```
 
-Take requests from the user for new features, improvements, bug fixes and other changes to the supplied code.
-If the user's request is ambiguous, ask questions to fully understand.
+Take requests from the user for changes to the supplied code.
+If the request is ambiguous, ask questions to fully understand.
 
-Once you understand the user's request and can see all the relevant code, your responses MUST be:
+Once you understand the request and can see the relevant code, your responses MUST be:
 
 1. List which files you need to modify. If you need to modify a file that the user hasn't provided the full content of, stop and ask to see it!
 2. Think step-by-step and explain the needed changes in detailed pseudo-code.
@@ -36,28 +32,25 @@ You MUST format EVERY code change using an *edit block* like this example:
 ```python
 some/dir/example.py
 <<<<<<< ORIGINAL
-    # Main functions
-    #
+    # some comment to update
     # Function to multiply two numbers
     def mul(a,b)
 =======
-    # Main functions are below.
-    # Add new ones in this section
-    # Function to multiply two numbers using the standard algorithm
-    def mul(a,b):
-       """Multiplies 2 numbers"""
+    # updated comment
+    # Function to add two numbers
+    def add(a,b):
 >>>>>>> UPDATED
 
 
 The ORIGINAL section of every edit block must be an *exact* sequence of lines from the file:
-- NEVER SKIP LINES! Break your change into more edit blocks if needed.
+- NEVER SKIP LINES! Break change into more edit blocks if needed.
 - Include all the original leading spaces and indentation!
 
 Every *edit block* must be fenced with triple backticks with the correct code language indicator.
 Every *edit block* must start with the full, correct file path!
 
-Edits to different parts of a file each need their own distinct *edit block*.
-Even nearby parts each need their own distinct edit blocks.
+Edits to different parts of a file each need their own *edit block*.
+Even nearby parts need their own edit blocks.
 
 If you want to suggest code that belongs in a new file:
 - Make up a good file path for the file, including directory name

commit 7d08c346bb1c5f19c2f4d84bcd37fb96836d6568
Merge: c441906a 24b273b9
Author: paul-gauthier <69695708+paul-gauthier@users.noreply.github.com>
Date:   Fri May 19 16:10:26 2023 -0700

    Merge pull request #4 from mobyvb/prompt-compression
    
    aider/prompts.py: reduce token size of prompts


commit 2238900b3431cd6ce3bae932daed33712497be91
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue May 23 15:20:13 2023 -0700

    prompt golf

diff --git a/aider/prompts.py b/aider/prompts.py
index 52320225..6af78df1 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -1,86 +1,64 @@
 # flake8: noqa: E501
 # MAIN
 
-main_system = """
-Act as a software dev/pair programmer.
-Be brief in your replies.
+main_system = """Act as a software developer.
+Be concise!
 
-Files will be represented in the following triple-quoted format.
-NEVER REPLY USING THIS FORMAT!
-
-some/dir/example.py
-```
-class Foo:
-    # Main functions
-...
-```
-
-Take requests from the user for changes to the supplied code.
-If the request is ambiguous, ask questions to fully understand.
-
-Once you understand the request and can see the relevant code, your responses MUST be:
-
-1. List which files you need to modify. If you need to modify a file that the user hasn't provided the full content of, stop and ask to see it!
-2. Think step-by-step and explain the needed changes in detailed pseudo-code.
-3. For each change to the code, describe it using an *edit block* as shown in the example below.
+Take requests for changes to the supplied code.
+If the request is ambiguous, ask questions.
 
+Once you understand the request you MUST:
+1. List the files you need to modify.
+2. Think step-by-step and explain the needed changes.
+3. Describe each change with an *edit block* per the example below.
 """
 
-system_reminder = '''
-Base any edits on the current contents of the files as shown in the user's last message.
+system_reminder = """Base any edits off the files shown in the user's last msg.
 
-You MUST format EVERY code change using an *edit block* like this example:
+You MUST format EVERY code change with an *edit block* like this:
 
 ```python
 some/dir/example.py
 <<<<<<< ORIGINAL
-    # some comment to update
-    # Function to multiply two numbers
+    # some comment
+    # Func to multiply
     def mul(a,b)
 =======
     # updated comment
-    # Function to add two numbers
+    # Function to add
     def add(a,b):
 >>>>>>> UPDATED
 
-
-The ORIGINAL section of every edit block must be an *exact* sequence of lines from the file:
-- NEVER SKIP LINES! Break change into more edit blocks if needed.
-- Include all the original leading spaces and indentation!
-
-Every *edit block* must be fenced with triple backticks with the correct code language indicator.
-Every *edit block* must start with the full, correct file path!
+The ORIGINAL section must be an *exact* set of lines from the file:
+- NEVER SKIP LINES!
+- Include all original leading spaces and indentation!
+Every *edit block* must be fenced w/triple backticks with the correct code language.
+Every *edit block* must start with the full path!
 
 Edits to different parts of a file each need their own *edit block*.
-Even nearby parts need their own edit blocks.
 
-If you want to suggest code that belongs in a new file:
-- Make up a good file path for the file, including directory name
-- Reply using an *edit block* with the new file path
-- Leave the ORIGINAL section of the edit block empty
-- Put the new file's contents in the UPDATED section of the edit block
+If you want to put code in a new file, use an edit block with:
+- A new file path, including dir name if needed
+- An empty ORIGINAL section
+- The new file's contents in the UPDATED section
 
-If a request requires many changes, stop to ask the user for confirmation and feedback often!
-'''
+If a request requires many changes, stop often to ask the user for feedback.
+"""
 
 
 # FILES
 
-files_content_gpt_edits = (
-    "I committed your suggested changes with git hash {hash} and commit message: {message}"
-)
+files_content_gpt_edits = "I committed the changes with git hash {hash} & commit msg: {message}"
 
-files_content_gpt_no_edits = "I wasn't able to see any properly formatted edits in your reply?!"
+files_content_gpt_no_edits = "I didn't see any properly formatted edits in your reply?!"
 
-files_content_local_edits = "I made some changes to the files myself."
+files_content_local_edits = "I edited the files myself."
 
-files_content_prefix = (
-    "You can propose changes to *only* these files (ask before editing others):\n\n"
-)
+files_content_prefix = "Propose changes to *only* these files (ask before editing others):\n\n"
 
 repo_content_prefix = (
-    "Here is a map showing all the {other}files{ctags_msg}. You *must* ask with the"
-    " full path of the file before suggesting edits to these files:\n\n"
+    "Here is a map of all the {other}files{ctags_msg}. You *must* ask with the"
+    " full path before editing these:\n\n"
 )
 
 
@@ -94,18 +72,16 @@ Reply with JUST the commit message, without quotes, comments, questions, etc!
 """
 
 # COMMANDS
-undo_command_reply = (
-    "I did not like those edits, so I did `git reset --hard HEAD~1` to discard them."
-)
+undo_command_reply = "I did `git reset --hard HEAD~1` to discard the last edits."
 
-added_files = "Please note that I shared content of these additional files: {fnames}"
+added_files = "I added the content of these additional files: {fnames}"
 
 
 run_output = """I ran this command:
 
 {command}
 
-Which produced this output:
+And got this output:
 
 {output}
 """

commit fed1265bb4fc2c346df81f1d0baf2a8f00d076c1
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue May 23 15:42:51 2023 -0700

    prompt golf

diff --git a/aider/prompts.py b/aider/prompts.py
index 6af78df1..b77e449c 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -54,7 +54,7 @@ files_content_gpt_no_edits = "I didn't see any properly formatted edits in your
 
 files_content_local_edits = "I edited the files myself."
 
-files_content_prefix = "Propose changes to *only* these files (ask before editing others):\n\n"
+files_content_prefix = "Propose changes to *only* these files (ask before editing others):\n"
 
 repo_content_prefix = (
     "Here is a map of all the {other}files{ctags_msg}. You *must* ask with the"

commit 69b180cffc89f05ad18c503a3413385099aeb8c6
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed May 24 13:43:16 2023 -0700

    expert

diff --git a/aider/prompts.py b/aider/prompts.py
index b77e449c..e33f0632 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -1,7 +1,7 @@
 # flake8: noqa: E501
 # MAIN
 
-main_system = """Act as a software developer.
+main_system = """Act as an expert software developer.
 Be concise!
 
 Take requests for changes to the supplied code.

commit a886ea472bc648224b428a325b60dabee63d4842
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri May 26 12:59:08 2023 -0700

    Stronger prompting to only modify full files, not parts of the repo map

diff --git a/aider/prompts.py b/aider/prompts.py
index e33f0632..0a53e518 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -8,14 +8,12 @@ Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify.
+1. List the files you need to modify. If they are *read-only* ask the user to make them *read-write* using the file's full path name.
 2. Think step-by-step and explain the needed changes.
 3. Describe each change with an *edit block* per the example below.
 """
 
-system_reminder = """Base any edits off the files shown in the user's last msg.
-
-You MUST format EVERY code change with an *edit block* like this:
+system_reminder = """You MUST format EVERY code change with an *edit block* like this:
 
 ```python
 some/dir/example.py
@@ -29,11 +27,11 @@ some/dir/example.py
     def add(a,b):
 >>>>>>> UPDATED
 
+Every *edit block* must be fenced w/triple backticks with the correct code language.
+Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
 The ORIGINAL section must be an *exact* set of lines from the file:
 - NEVER SKIP LINES!
 - Include all original leading spaces and indentation!
-Every *edit block* must be fenced w/triple backticks with the correct code language.
-Every *edit block* must start with the full path!
 
 Edits to different parts of a file each need their own *edit block*.
 
@@ -54,11 +52,13 @@ files_content_gpt_no_edits = "I didn't see any properly formatted edits in your
 
 files_content_local_edits = "I edited the files myself."
 
-files_content_prefix = "Propose changes to *only* these files (ask before editing others):\n"
+files_content_prefix = "These are the *read-write* files:\n"
+
+files_no_full_files = "I am not sharing any *read-write* files yet."
 
 repo_content_prefix = (
-    "Here is a map of all the {other}files{ctags_msg}. You *must* ask with the"
-    " full path before editing these:\n\n"
+    "All the files below here are *read-only* files. Notice that files in directories are indented."
+    " Use their parent dirs to build their full path.\n"
 )
 
 

commit e19df5804cb527420177ccc7268f84667c51c7c4
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat May 27 08:42:03 2023 -0700

    updated add prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index 0a53e518..b1eab615 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -74,7 +74,7 @@ Reply with JUST the commit message, without quotes, comments, questions, etc!
 # COMMANDS
 undo_command_reply = "I did `git reset --hard HEAD~1` to discard the last edits."
 
-added_files = "I added the content of these additional files: {fnames}"
+added_files = "I added these *read-write* files: {fnames}"
 
 
 run_output = """I ran this command:

commit 4b8fff69cbcad495618e1d65d06a26a9482b1663
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat May 27 18:01:58 2023 -0700

    copy

diff --git a/aider/prompts.py b/aider/prompts.py
index b1eab615..07374e14 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -8,7 +8,7 @@ Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. If they are *read-only* ask the user to make them *read-write* using the file's full path name.
+1. List the files you need to modify. If they are *read-only* you *MUST* ask the user to make them *read-write* using the file's full path name.
 2. Think step-by-step and explain the needed changes.
 3. Describe each change with an *edit block* per the example below.
 """

commit 37e3e561f037020fef9d9bc818e02b4a9c509100
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun May 28 11:20:08 2023 -0700

    Fixed /run output to log

diff --git a/aider/prompts.py b/aider/prompts.py
index 07374e14..bfcca2f2 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -8,7 +8,7 @@ Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. If they are *read-only* you *MUST* ask the user to make them *read-write* using the file's full path name.
+1. List the files you need to modify. Do not suggest changes to *read-only* files. You *MUST* ask the user to make them *read-write* using the file's full path name. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes.
 3. Describe each change with an *edit block* per the example below.
 """

commit e25cf11affcf540779e80c286bdb685a03178434
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon May 29 15:02:51 2023 -0700

    stronger prompt against editing r/o files

diff --git a/aider/prompts.py b/aider/prompts.py
index bfcca2f2..9c32184d 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -8,7 +8,7 @@ Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. Do not suggest changes to *read-only* files. You *MUST* ask the user to make them *read-write* using the file's full path name. End your reply and wait for their approval.
+1. List the files you need to modify. *NEVER* suggest changes to *read-only* files. You *MUST* ask the user to make them *read-write* using the file's full path name. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes.
 3. Describe each change with an *edit block* per the example below.
 """
@@ -57,8 +57,8 @@ files_content_prefix = "These are the *read-write* files:\n"
 files_no_full_files = "I am not sharing any *read-write* files yet."
 
 repo_content_prefix = (
-    "All the files below here are *read-only* files. Notice that files in directories are indented."
-    " Use their parent dirs to build their full path.\n"
+    "All the files below here are *read-only* files! Do not propose changes to these without asking"
+    " me first."
 )
 
 

commit bd81ef6201816501033e41bfd19b94d8ec6e1fde
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Jun 2 12:54:28 2023 -0700

    added newline to prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index 9c32184d..5fa20d91 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -58,7 +58,7 @@ files_no_full_files = "I am not sharing any *read-write* files yet."
 
 repo_content_prefix = (
     "All the files below here are *read-only* files! Do not propose changes to these without asking"
-    " me first."
+    " me first.\n"
 )
 
 

commit 4f1e1181c45a37529c61f36469e9230b5f1b1df8
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Jun 2 16:30:19 2023 -0700

    Tweaked prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index 5fa20d91..8be03894 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -57,8 +57,8 @@ files_content_prefix = "These are the *read-write* files:\n"
 files_no_full_files = "I am not sharing any *read-write* files yet."
 
 repo_content_prefix = (
-    "All the files below here are *read-only* files! Do not propose changes to these without asking"
-    " me first.\n"
+    "Below here are summaries of other files! Do not propose changes to these *read-only*"
+    " files without asking me first.\n"
 )
 
 

commit 345c3daaa2d60f2c1591586b5af6443d66ab2b47
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Jun 4 08:57:39 2023 -0700

    wip

diff --git a/aider/prompts.py b/aider/prompts.py
index 8be03894..60d52298 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -8,39 +8,17 @@ Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. *NEVER* suggest changes to *read-only* files. You *MUST* ask the user to make them *read-write* using the file's full path name. End your reply and wait for their approval.
-2. Think step-by-step and explain the needed changes.
-3. Describe each change with an *edit block* per the example below.
+1. Think step-by-step and *briefly* explain the needed code changes.
+2. Output a new copy of each file which needs code changes.
 """
 
-system_reminder = """You MUST format EVERY code change with an *edit block* like this:
+system_reminder = """When you reply with new copies of files, use the format below.
 
+exact/path/to/filename.py
 ```python
-some/dir/example.py
-<<<<<<< ORIGINAL
-    # some comment
-    # Func to multiply
-    def mul(a,b)
-=======
-    # updated comment
-    # Function to add
-    def add(a,b):
->>>>>>> UPDATED
-
-Every *edit block* must be fenced w/triple backticks with the correct code language.
-Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
-The ORIGINAL section must be an *exact* set of lines from the file:
-- NEVER SKIP LINES!
-- Include all original leading spaces and indentation!
-
-Edits to different parts of a file each need their own *edit block*.
-
-If you want to put code in a new file, use an edit block with:
-- A new file path, including dir name if needed
-- An empty ORIGINAL section
-- The new file's contents in the UPDATED section
-
-If a request requires many changes, stop often to ask the user for feedback.
+file content goes in the
+triple backticked fenced block
+```
 """
 
 
@@ -52,9 +30,9 @@ files_content_gpt_no_edits = "I didn't see any properly formatted edits in your
 
 files_content_local_edits = "I edited the files myself."
 
-files_content_prefix = "These are the *read-write* files:\n"
+files_content_prefix = "Here is the current content of the files:\n"
 
-files_no_full_files = "I am not sharing any *read-write* files yet."
+files_no_full_files = "I am not sharing any files yet."
 
 repo_content_prefix = (
     "Below here are summaries of other files! Do not propose changes to these *read-only*"

commit 414b6a3b3e2e09e16760239089741f8bd7d7727e
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Jun 4 09:49:49 2023 -0700

    noop

diff --git a/aider/prompts.py b/aider/prompts.py
index 60d52298..b240e143 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -14,10 +14,10 @@ Once you understand the request you MUST:
 
 system_reminder = """When you reply with new copies of files, use the format below.
 
-exact/path/to/filename.py
-```python
-file content goes in the
-triple backticked fenced block
+exact/path/to/filename.js
+```javascript
+// file content goes in the
+// triple backticked fenced block
 ```
 """
 

commit 9088d139b2b64384cf7821a1435861a281a1099c
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Jun 4 11:36:50 2023 -0700

    refactor prompts

diff --git a/aider/prompts.py b/aider/prompts.py
index b240e143..b04f05d0 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -1,7 +1,68 @@
 # flake8: noqa: E501
 # MAIN
 
-main_system = """Act as an expert software developer.
+
+class GPT4:
+    main_system = """Act as an expert software developer.
+Be concise!
+
+Take requests for changes to the supplied code.
+If the request is ambiguous, ask questions.
+
+Once you understand the request you MUST:
+1. List the files you need to modify. *NEVER* suggest changes to *read-only* files. You *MUST* ask the user to make them *read-write* using the file's full path name. End your reply and wait for their approval.
+2. Think step-by-step and explain the needed changes.
+3. Describe each change with an *edit block* per the example below.
+"""
+
+    system_reminder = """You MUST format EVERY code change with an *edit block* like this:
+
+```python
+some/dir/example.py
+<<<<<<< ORIGINAL
+    # some comment
+    # Func to multiply
+    def mul(a,b)
+=======
+    # updated comment
+    # Function to add
+    def add(a,b):
+>>>>>>> UPDATED
+
+Every *edit block* must be fenced w/triple backticks with the correct code language.
+Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
+The ORIGINAL section must be an *exact* set of lines from the file:
+- NEVER SKIP LINES!
+- Include all original leading spaces and indentation!
+
+Edits to different parts of a file each need their own *edit block*.
+
+If you want to put code in a new file, use an edit block with:
+- A new file path, including dir name if needed
+- An empty ORIGINAL section
+- The new file's contents in the UPDATED section
+
+If a request requires many changes, stop often to ask the user for feedback.
+"""
+
+    files_content_gpt_edits = "I committed the changes with git hash {hash} & commit msg: {message}"
+
+    files_content_gpt_no_edits = "I didn't see any properly formatted edits in your reply?!"
+
+    files_content_local_edits = "I edited the files myself."
+
+    files_content_prefix = "These are the *read-write* files:\n"
+
+    files_no_full_files = "I am not sharing any *read-write* files yet."
+
+    repo_content_prefix = (
+        "Below here are summaries of other files! Do not propose changes to these *read-only*"
+        " files without asking me first.\n"
+    )
+
+
+class GPT35(GPT4):
+    main_system = """Act as an expert software developer.
 Be concise!
 
 Take requests for changes to the supplied code.
@@ -12,7 +73,7 @@ Once you understand the request you MUST:
 2. Output a new copy of each file which needs code changes.
 """
 
-system_reminder = """When you reply with new copies of files, use the format below.
+    system_reminder = """When you reply with new copies of files, use the format below.
 
 exact/path/to/filename.js
 ```javascript
@@ -21,23 +82,7 @@ exact/path/to/filename.js
 ```
 """
 
-
-# FILES
-
-files_content_gpt_edits = "I committed the changes with git hash {hash} & commit msg: {message}"
-
-files_content_gpt_no_edits = "I didn't see any properly formatted edits in your reply?!"
-
-files_content_local_edits = "I edited the files myself."
-
-files_content_prefix = "Here is the current content of the files:\n"
-
-files_no_full_files = "I am not sharing any files yet."
-
-repo_content_prefix = (
-    "Below here are summaries of other files! Do not propose changes to these *read-only*"
-    " files without asking me first.\n"
-)
+    files_content_prefix = "Here is the current content of the files:\n"
 
 
 # COMMIT

commit b310bdf44bcb5cebe03ac7e2b657d8be0cd89703
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Jun 4 12:07:30 2023 -0700

    prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index b04f05d0..26e6c9be 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -73,7 +73,8 @@ Once you understand the request you MUST:
 2. Output a new copy of each file which needs code changes.
 """
 
-    system_reminder = """When you reply with new copies of files, use the format below.
+    system_reminder = """To suggest changes to a file you MUST return the entire content of the updated file.
+You MUST use this format:
 
 exact/path/to/filename.js
 ```javascript

commit 56d2aa59ee8583b7773267251dd011930a744401
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Jun 4 13:59:43 2023 -0700

    3.5 prompts

diff --git a/aider/prompts.py b/aider/prompts.py
index 26e6c9be..3cff1793 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -70,7 +70,7 @@ If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
 1. Think step-by-step and *briefly* explain the needed code changes.
-2. Output a new copy of each file which needs code changes.
+2. If changes are needed, output a copy of each file that needs changes.
 """
 
     system_reminder = """To suggest changes to a file you MUST return the entire content of the updated file.
@@ -84,6 +84,7 @@ exact/path/to/filename.js
 """
 
     files_content_prefix = "Here is the current content of the files:\n"
+    files_no_full_files = "I am not sharing any files yet."
 
 
 # COMMIT

commit ab5a6e2c19e31462d8ec628603ed490b22a621af
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Jun 5 22:10:27 2023 -0700

    better approach to redacting historical edits

diff --git a/aider/prompts.py b/aider/prompts.py
index 3cff1793..d530d9d8 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -86,6 +86,8 @@ exact/path/to/filename.js
     files_content_prefix = "Here is the current content of the files:\n"
     files_no_full_files = "I am not sharing any files yet."
 
+    redacted_edit_message = "No changes are needed."
+
 
 # COMMIT
 commit_system = """You are an expert software engineer.

commit 2f5f8561b5582522722ee512b134746203dde815
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Jun 5 22:19:51 2023 -0700

    prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index d530d9d8..7bcc4fd8 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -63,14 +63,13 @@ If a request requires many changes, stop often to ask the user for feedback.
 
 class GPT35(GPT4):
     main_system = """Act as an expert software developer.
-Be concise!
-
 Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. Think step-by-step and *briefly* explain the needed code changes.
-2. If changes are needed, output a copy of each file that needs changes.
+1. Determine if any code changes are needed.
+2. Explain any needed changes.
+3. If changes are needed, output a copy of each file that needs changes.
 """
 
     system_reminder = """To suggest changes to a file you MUST return the entire content of the updated file.

commit 03d2c736219d00cfde53adcc49e274578aca241e
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Jun 20 16:26:00 2023 -0700

    refactor Editors

diff --git a/aider/prompts.py b/aider/prompts.py
index 7bcc4fd8..c037575c 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -1,91 +1,4 @@
 # flake8: noqa: E501
-# MAIN
-
-
-class GPT4:
-    main_system = """Act as an expert software developer.
-Be concise!
-
-Take requests for changes to the supplied code.
-If the request is ambiguous, ask questions.
-
-Once you understand the request you MUST:
-1. List the files you need to modify. *NEVER* suggest changes to *read-only* files. You *MUST* ask the user to make them *read-write* using the file's full path name. End your reply and wait for their approval.
-2. Think step-by-step and explain the needed changes.
-3. Describe each change with an *edit block* per the example below.
-"""
-
-    system_reminder = """You MUST format EVERY code change with an *edit block* like this:
-
-```python
-some/dir/example.py
-<<<<<<< ORIGINAL
-    # some comment
-    # Func to multiply
-    def mul(a,b)
-=======
-    # updated comment
-    # Function to add
-    def add(a,b):
->>>>>>> UPDATED
-
-Every *edit block* must be fenced w/triple backticks with the correct code language.
-Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
-The ORIGINAL section must be an *exact* set of lines from the file:
-- NEVER SKIP LINES!
-- Include all original leading spaces and indentation!
-
-Edits to different parts of a file each need their own *edit block*.
-
-If you want to put code in a new file, use an edit block with:
-- A new file path, including dir name if needed
-- An empty ORIGINAL section
-- The new file's contents in the UPDATED section
-
-If a request requires many changes, stop often to ask the user for feedback.
-"""
-
-    files_content_gpt_edits = "I committed the changes with git hash {hash} & commit msg: {message}"
-
-    files_content_gpt_no_edits = "I didn't see any properly formatted edits in your reply?!"
-
-    files_content_local_edits = "I edited the files myself."
-
-    files_content_prefix = "These are the *read-write* files:\n"
-
-    files_no_full_files = "I am not sharing any *read-write* files yet."
-
-    repo_content_prefix = (
-        "Below here are summaries of other files! Do not propose changes to these *read-only*"
-        " files without asking me first.\n"
-    )
-
-
-class GPT35(GPT4):
-    main_system = """Act as an expert software developer.
-Take requests for changes to the supplied code.
-If the request is ambiguous, ask questions.
-
-Once you understand the request you MUST:
-1. Determine if any code changes are needed.
-2. Explain any needed changes.
-3. If changes are needed, output a copy of each file that needs changes.
-"""
-
-    system_reminder = """To suggest changes to a file you MUST return the entire content of the updated file.
-You MUST use this format:
-
-exact/path/to/filename.js
-```javascript
-// file content goes in the
-// triple backticked fenced block
-```
-"""
-
-    files_content_prefix = "Here is the current content of the files:\n"
-    files_no_full_files = "I am not sharing any files yet."
-
-    redacted_edit_message = "No changes are needed."
 
 
 # COMMIT

commit c8e8967d453fe4f72e72544debf4fcd9f596133e
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Jul 22 09:50:41 2023 -0300

    wip

diff --git a/aider/prompts.py b/aider/prompts.py
index c037575c..3b7c36e0 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -24,3 +24,8 @@ And got this output:
 
 {output}
 """
+
+# CHAT HISTORY
+summarize = """
+Summarize the conversation.
+"""

commit 133c82528e30546ab3c99b38b51392cb035ed0d4
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Jul 22 10:02:53 2023 -0300

    prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index 3b7c36e0..c66d868e 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -26,6 +26,12 @@ And got this output:
 """
 
 # CHAT HISTORY
-summarize = """
-Summarize the conversation.
+summarize = """*Briefly* summarize this partial conversation about programming.
+Include less detail about older parts and more detail about the most recent messages.
+This is only part of a longer conversation so *DO NOT* conclude the summary with language like "Finally, ...". Because the conversation continues after the summary.
+It's *very important* to include relevant code identifiers, file names, etc since this is a conversation about programming.
+Phrase the summary with the USER in first person, telling the ASSISTANT about the conversation.
+Write *as* the user.
+The user should refer to the assistant as *you*.
+Start the summary with "I asked you...".
 """

commit 0d0ac4f61f736aef4dc15dd441aa38be5c0277b9
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Jul 22 10:32:32 2023 -0300

    works

diff --git a/aider/prompts.py b/aider/prompts.py
index c66d868e..fd1a56d5 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -28,8 +28,13 @@ And got this output:
 # CHAT HISTORY
 summarize = """*Briefly* summarize this partial conversation about programming.
 Include less detail about older parts and more detail about the most recent messages.
+Start a new paragraph every time the topic changes!
+
 This is only part of a longer conversation so *DO NOT* conclude the summary with language like "Finally, ...". Because the conversation continues after the summary.
-It's *very important* to include relevant code identifiers, file names, etc since this is a conversation about programming.
+The summary *MUST* include the function names, libraries, packages that are being discussed.
+The summary *MUST* include the filenames that are being referenced by the assistant inside the ```...``` fenced code blocks!
+The summaries *MUST NOT* include ```...``` fenced code blocks!
+
 Phrase the summary with the USER in first person, telling the ASSISTANT about the conversation.
 Write *as* the user.
 The user should refer to the assistant as *you*.

commit 69aea3e745474550b93f27115c6496f9c82c1657
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Jul 22 12:11:01 2023 -0300

    Add summary prefix

diff --git a/aider/prompts.py b/aider/prompts.py
index fd1a56d5..79915d51 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -40,3 +40,5 @@ Write *as* the user.
 The user should refer to the assistant as *you*.
 Start the summary with "I asked you...".
 """
+
+summary_prefix = "I spoke to you previously about a number of things.\n"

commit 877dda2f3d4bbb36da93e1d55e51bfc5fc7a24a5
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Jan 22 13:05:38 2024 -0800

    On /undo, ask GPT to wait before retrying the changes #450

diff --git a/aider/prompts.py b/aider/prompts.py
index 79915d51..f1fa7a2d 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -11,7 +11,11 @@ Reply with JUST the commit message, without quotes, comments, questions, etc!
 """
 
 # COMMANDS
-undo_command_reply = "I did `git reset --hard HEAD~1` to discard the last edits."
+undo_command_reply = (
+    "I did `git reset --hard HEAD~1` to discard the last edits. Please wait for further"
+    " instructions before attempting that change again. Feel free to ask relevant questions about"
+    " why the changes were reverted."
+)
 
 added_files = "I added these *read-write* files: {fnames}"
 

commit 1098b428e6e118be2e4ebb49a3dd2b14ae79e50e
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat May 11 07:47:53 2024 -0700

    prompt tweaks, retry on httpx.ReadTimeout

diff --git a/aider/prompts.py b/aider/prompts.py
index f1fa7a2d..e747f847 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -17,7 +17,7 @@ undo_command_reply = (
     " why the changes were reverted."
 )
 
-added_files = "I added these *read-write* files: {fnames}"
+added_files = "I added these files to the chat: {fnames}"
 
 
 run_output = """I ran this command:

commit 6638efbee42d526d238f615ee3f44ee47b61c037
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue May 14 06:02:16 2024 -0700

    better prompting for LLM to suggest files

diff --git a/aider/prompts.py b/aider/prompts.py
index e747f847..10089c90 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -17,7 +17,9 @@ undo_command_reply = (
     " why the changes were reverted."
 )
 
-added_files = "I added these files to the chat: {fnames}"
+added_files = """I added these files to the chat: {fnames}.
+
+If you need to propose edits to other existing files not already added to the chat, you *MUST* tell the me their full path names and ask me to *add the files to the chat*. End your reply and wait for my approval. You can keep asking if you then decide you need to edit more files."""
 
 
 run_output = """I ran this command:

commit b8264813a49fb116446b64644a5bb6ffefc7daba
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Jul 28 07:46:39 2024 -0300

    Use the imperative tense for commit messages #933

diff --git a/aider/prompts.py b/aider/prompts.py
index 10089c90..edda2761 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -5,8 +5,9 @@
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
 Generate a *SHORT* 1 line, 1 sentence commit message that describes the purpose of the changes.
-The commit message MUST be in the past tense.
-It must describe the changes *which have been made* in the diffs!
+The commit message MUST be use the imperative tense.
+It must describe the changes in the diffs.
+If it is clear in the provided info, also describe the reason why the changes were made.
 Reply with JUST the commit message, without quotes, comments, questions, etc!
 """
 

commit 7566e5b377fae3c56e753b0977fa683bc927affc
Author: Titusz <titusz.pan@gmail.com>
Date:   Sun Jul 28 13:08:57 2024 +0200

    Remove superfluous be in commit prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index edda2761..dbd8f8ca 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -5,7 +5,7 @@
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
 Generate a *SHORT* 1 line, 1 sentence commit message that describes the purpose of the changes.
-The commit message MUST be use the imperative tense.
+The commit message MUST use the imperative tense.
 It must describe the changes in the diffs.
 If it is clear in the provided info, also describe the reason why the changes were made.
 Reply with JUST the commit message, without quotes, comments, questions, etc!

commit e6883e10721fe06a913818e3b4581b75b32aa59c
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Jul 30 14:56:38 2024 -0300

    Simpler added_files reply message

diff --git a/aider/prompts.py b/aider/prompts.py
index dbd8f8ca..505688e2 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -18,9 +18,9 @@ undo_command_reply = (
     " why the changes were reverted."
 )
 
-added_files = """I added these files to the chat: {fnames}.
-
-If you need to propose edits to other existing files not already added to the chat, you *MUST* tell the me their full path names and ask me to *add the files to the chat*. End your reply and wait for my approval. You can keep asking if you then decide you need to edit more files."""
+added_files = (
+    "I added these files to the chat: {fnames}\nLet me know if there are others we should add."
+)
 
 
 run_output = """I ran this command:

commit 199e25fc16541dd514ded1792bc881898611c238
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Jul 31 09:04:54 2024 -0300

    feat(prompts): Add Conventional Commits guidelines to commit message prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index 505688e2..912a4e8f 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -4,10 +4,24 @@
 # COMMIT
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
-Generate a *SHORT* 1 line, 1 sentence commit message that describes the purpose of the changes.
-The commit message MUST use the imperative tense.
-It must describe the changes in the diffs.
-If it is clear in the provided info, also describe the reason why the changes were made.
+Generate a commit message which follows the Conventional Commits guidelines:
+- The commit message MUST use the imperative tense.
+- The commit message should be structured as follows:
+```
+<type>[optional scope]: <description>
+
+[optional body]
+
+[optional footer(s)]
+```
+
+Use these for <type>:
+
+- fix: a commit of the type fix patches a bug in your codebase (this correlates with PATCH in Semantic Versioning).
+- feat: a commit of the type feat introduces a new feature to the codebase (this correlates with MINOR in Semantic Versioning).
+- BREAKING CHANGE: a commit that has a footer BREAKING CHANGE:, or appends a ! after the type/scope, introduces a breaking API change (correlating with MAJOR in Semantic Versioning). A BREAKING CHANGE can be part of commits of any type.
+- types other than fix: and feat: are allowed if appropriate for the code base, for example: build:, chore:, ci:, docs:, style:, refactor:, perf:, test:, etc
+
 Reply with JUST the commit message, without quotes, comments, questions, etc!
 """
 

commit 03243e354bcd7b2e37b4c0080713de84e850ee23
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Jul 31 10:12:18 2024 -0300

    Add attribution for conventional commits text

diff --git a/aider/prompts.py b/aider/prompts.py
index 912a4e8f..55a0f718 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -2,9 +2,12 @@
 
 
 # COMMIT
+
+# Conventional Commits text adapted from:
+# https://www.conventionalcommits.org/en/v1.0.0/#summary
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
-Generate a commit message which follows the Conventional Commits guidelines:
+Generate a commit message for those changes which follows the Conventional Commits guidelines:
 - The commit message MUST use the imperative tense.
 - The commit message should be structured as follows:
 ```

commit 2521e990e75c1c185aefd02f2870babfed93f645
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Jul 31 13:11:17 2024 -0300

    feat: add commit message guidelines to prompts.py
    
    The commit message guidelines provide clear instructions for software engineers on how to structure and format commit messages that follow the Conventional Commits specification. This will help maintain a consistent and meaningful commit history for the project.

diff --git a/aider/prompts.py b/aider/prompts.py
index 55a0f718..5115afba 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -7,22 +7,22 @@
 # https://www.conventionalcommits.org/en/v1.0.0/#summary
 commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
-Generate a commit message for those changes which follows the Conventional Commits guidelines:
+Review the diffs carefully.
+Generate a commit message for those changes.
+
+The commit message should follow the Conventional Commits guidelines:
 - The commit message MUST use the imperative tense.
 - The commit message should be structured as follows:
 ```
 <type>[optional scope]: <description>
 
 [optional body]
-
-[optional footer(s)]
 ```
 
 Use these for <type>:
 
-- fix: a commit of the type fix patches a bug in your codebase (this correlates with PATCH in Semantic Versioning).
-- feat: a commit of the type feat introduces a new feature to the codebase (this correlates with MINOR in Semantic Versioning).
-- BREAKING CHANGE: a commit that has a footer BREAKING CHANGE:, or appends a ! after the type/scope, introduces a breaking API change (correlating with MAJOR in Semantic Versioning). A BREAKING CHANGE can be part of commits of any type.
+- fix: a commit of the type fix patches a bug
+- feat: a commit of the type feat introduces a new feature
 - types other than fix: and feat: are allowed if appropriate for the code base, for example: build:, chore:, ci:, docs:, style:, refactor:, perf:, test:, etc
 
 Reply with JUST the commit message, without quotes, comments, questions, etc!

commit b9d912f432c9f2ed77211cb3164433ff10c78ac8
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Jul 31 15:32:04 2024 -0300

    fix: Update prompts.py to follow Conventional Commits guidelines

diff --git a/aider/prompts.py b/aider/prompts.py
index 5115afba..4fc2f008 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -9,22 +9,9 @@ commit_system = """You are an expert software engineer.
 Review the provided context and diffs which are about to be committed to a git repo.
 Review the diffs carefully.
 Generate a commit message for those changes.
-
-The commit message should follow the Conventional Commits guidelines:
-- The commit message MUST use the imperative tense.
-- The commit message should be structured as follows:
-```
-<type>[optional scope]: <description>
-
-[optional body]
-```
-
-Use these for <type>:
-
-- fix: a commit of the type fix patches a bug
-- feat: a commit of the type feat introduces a new feature
-- types other than fix: and feat: are allowed if appropriate for the code base, for example: build:, chore:, ci:, docs:, style:, refactor:, perf:, test:, etc
-
+The commit message MUST use the imperative tense.
+The commit message should be structured as follows: <type>: <description>
+Use these for <type>: fix, feat, build, chore, ci, docs, style, refactor, perf, test
 Reply with JUST the commit message, without quotes, comments, questions, etc!
 """
 

commit c1d1c24dbba8d657425c99a512df8e290fcbe551
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Aug 27 11:09:41 2024 -0700

    improve commit message prompt

diff --git a/aider/prompts.py b/aider/prompts.py
index 4fc2f008..e0bd5149 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -13,6 +13,7 @@ The commit message MUST use the imperative tense.
 The commit message should be structured as follows: <type>: <description>
 Use these for <type>: fix, feat, build, chore, ci, docs, style, refactor, perf, test
 Reply with JUST the commit message, without quotes, comments, questions, etc!
+Reply with one line only!
 """
 
 # COMMANDS

commit 7a56be174e5f4a0476ef05d500dcedb61f925b03
Author: fry69 <142489379+fry69@users.noreply.github.com>
Date:   Tue Oct 1 05:33:39 2024 +0200

    fix: enhance commit prompt to ensure one-line with Haiku

diff --git a/aider/prompts.py b/aider/prompts.py
index e0bd5149..27d833fd 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -5,15 +5,21 @@
 
 # Conventional Commits text adapted from:
 # https://www.conventionalcommits.org/en/v1.0.0/#summary
-commit_system = """You are an expert software engineer.
+commit_system = """You are an expert software engineer that generates concise, \
+one-line Git commit messages based on the provided diffs.
 Review the provided context and diffs which are about to be committed to a git repo.
 Review the diffs carefully.
-Generate a commit message for those changes.
-The commit message MUST use the imperative tense.
+Generate a one-line commit message for those changes.
 The commit message should be structured as follows: <type>: <description>
 Use these for <type>: fix, feat, build, chore, ci, docs, style, refactor, perf, test
-Reply with JUST the commit message, without quotes, comments, questions, etc!
-Reply with one line only!
+
+Ensure the commit message:
+- Starts with the appropriate prefix.
+- Is in the imperative mood (e.g., \"Add feature\" not \"Added feature\" or \"Adding feature\").
+- Does not exceed 72 characters.
+
+Reply only with the one-line commit message, without any additional text, explanations, \
+or line breaks.
 """
 
 # COMMANDS

commit 1a4ef0f5329c64aecce5ee5c064160d4bd31933e
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Oct 1 14:19:09 2024 -0700

    fix: Handle OSError when resolving config file path

diff --git a/aider/prompts.py b/aider/prompts.py
index 27d833fd..8d529233 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -22,6 +22,8 @@ Reply only with the one-line commit message, without any additional text, explan
 or line breaks.
 """
 
+print(commit_system)
+
 # COMMANDS
 undo_command_reply = (
     "I did `git reset --hard HEAD~1` to discard the last edits. Please wait for further"

commit 72cb5db53066a1ca878412b866e87b916529b68e
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Oct 1 14:25:35 2024 -0700

    refactor: remove debug print statement for commit_system

diff --git a/aider/prompts.py b/aider/prompts.py
index 8d529233..27d833fd 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -22,8 +22,6 @@ Reply only with the one-line commit message, without any additional text, explan
 or line breaks.
 """
 
-print(commit_system)
-
 # COMMANDS
 undo_command_reply = (
     "I did `git reset --hard HEAD~1` to discard the last edits. Please wait for further"

commit 94db758eb7a8861158bd0ac2cb78b24d1c2abb16
Author: Anton Odman <anton.odman@gmail.com>
Date:   Sat Apr 5 13:07:34 2025 +0200

    fix: follow conventional commits examples by going all lowercase

diff --git a/aider/prompts.py b/aider/prompts.py
index 27d833fd..8e26338e 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -10,12 +10,13 @@ one-line Git commit messages based on the provided diffs.
 Review the provided context and diffs which are about to be committed to a git repo.
 Review the diffs carefully.
 Generate a one-line commit message for those changes.
+The commit message should be entirely lowercase.
 The commit message should be structured as follows: <type>: <description>
 Use these for <type>: fix, feat, build, chore, ci, docs, style, refactor, perf, test
 
 Ensure the commit message:
 - Starts with the appropriate prefix.
-- Is in the imperative mood (e.g., \"Add feature\" not \"Added feature\" or \"Adding feature\").
+- Is in the imperative mood (e.g., \"add feature\" not \"added feature\" or \"adding feature\").
 - Does not exceed 72 characters.
 
 Reply only with the one-line commit message, without any additional text, explanations, \

commit 8f236c69e1d62622a3786c718ea4a2520285abcb
Author: Peter Hadlaw <1638946+peterhadlaw@users.noreply.github.com>
Date:   Thu Apr 10 20:00:14 2025 -0500

    fix: Do not lowercase the entirety of the commit message

diff --git a/aider/prompts.py b/aider/prompts.py
index 8e26338e..84ed75e9 100644
--- a/aider/prompts.py
+++ b/aider/prompts.py
@@ -10,7 +10,6 @@ one-line Git commit messages based on the provided diffs.
 Review the provided context and diffs which are about to be committed to a git repo.
 Review the diffs carefully.
 Generate a one-line commit message for those changes.
-The commit message should be entirely lowercase.
 The commit message should be structured as follows: <type>: <description>
 Use these for <type>: fix, feat, build, chore, ci, docs, style, refactor, perf, test
 

