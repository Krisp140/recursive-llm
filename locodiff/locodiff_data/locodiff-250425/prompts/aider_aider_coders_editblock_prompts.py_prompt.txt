# Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- aider/coders/editblock_prompts.py

commit e22373b55abd92ad35c5c37c66eeddc2e5ad984a
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Jun 20 17:41:56 2023 -0700

    refac

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
new file mode 100644
index 00000000..d12296d9
--- /dev/null
+++ b/aider/coders/editblock_prompts.py
@@ -0,0 +1,56 @@
+# flake8: noqa: E501
+
+from .prompts_base import EditorPrompts
+
+
+class EditBlockPrompts(EditorPrompts):
+    main_system = """Act as an expert software developer.
+Be concise!
+
+Take requests for changes to the supplied code.
+If the request is ambiguous, ask questions.
+
+Once you understand the request you MUST:
+1. List the files you need to modify. *NEVER* suggest changes to *read-only* files. You *MUST* ask the user to make them *read-write* using the file's full path name. End your reply and wait for their approval.
+2. Think step-by-step and explain the needed changes.
+3. Describe each change with an *edit block* per the example below.
+"""
+
+    system_reminder = """You MUST format EVERY code change with an *edit block* like this:
+
+```python
+some/dir/example.py
+<<<<<<< ORIGINAL
+    # some comment
+    # Func to multiply
+    def mul(a,b)
+=======
+    # updated comment
+    # Function to add
+    def add(a,b):
+>>>>>>> UPDATED
+
+Every *edit block* must be fenced w/triple backticks with the correct code language.
+Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
+The ORIGINAL section must be an *exact* set of lines from the file:
+- NEVER SKIP LINES!
+- Include all original leading spaces and indentation!
+
+Edits to different parts of a file each need their own *edit block*.
+
+If you want to put code in a new file, use an edit block with:
+- A new file path, including dir name if needed
+- An empty ORIGINAL section
+- The new file's contents in the UPDATED section
+
+If a request requires many changes, stop often to ask the user for feedback.
+"""
+
+    files_content_prefix = "These are the *read-write* files:\n"
+
+    files_no_full_files = "I am not sharing any *read-write* files yet."
+
+    repo_content_prefix = (
+        "Below here are summaries of other files! Do not propose changes to these *read-only*"
+        " files without asking me first.\n"
+    )

commit 0f5264b196ff46201e17077787117cd05018df9c
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Jun 22 08:17:12 2023 -0700

    renamed EditorPrompts -> CoderPrompts

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index d12296d9..0e8483e4 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -1,9 +1,9 @@
 # flake8: noqa: E501
 
-from .prompts_base import EditorPrompts
+from .prompts_base import CoderPrompts
 
 
-class EditBlockPrompts(EditorPrompts):
+class EditBlockPrompts(CoderPrompts):
     main_system = """Act as an expert software developer.
 Be concise!
 

commit e8e2ea9d898452e74ff2979fe3764eda88d709d2
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Jun 22 11:56:55 2023 -0700

    rename

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 0e8483e4..6a365b34 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -1,6 +1,6 @@
 # flake8: noqa: E501
 
-from .prompts_base import CoderPrompts
+from .base_prompts import CoderPrompts
 
 
 class EditBlockPrompts(CoderPrompts):

commit 15336eeb0409b0e0719e80ea89d71f1a90295807
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Jul 7 16:32:49 2023 -0700

    added missing fence closing

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 6a365b34..ee418663 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -29,6 +29,7 @@ some/dir/example.py
     # Function to add
     def add(a,b):
 >>>>>>> UPDATED
+```
 
 Every *edit block* must be fenced w/triple backticks with the correct code language.
 Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.

commit 12c3c1ed68bf1d73f2bf76f5fb24fe3e6c5255cf
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Jul 13 15:48:13 2023 -0700

    updated editblock to use all the fences

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index ee418663..5b9d8ce9 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -18,7 +18,7 @@ Once you understand the request you MUST:
 
     system_reminder = """You MUST format EVERY code change with an *edit block* like this:
 
-```python
+{fence[0]}python
 some/dir/example.py
 <<<<<<< ORIGINAL
     # some comment
@@ -29,9 +29,9 @@ some/dir/example.py
     # Function to add
     def add(a,b):
 >>>>>>> UPDATED
-```
+{fence[1]}
 
-Every *edit block* must be fenced w/triple backticks with the correct code language.
+Every *edit block* must be fenced with {fence[0]}...{fence[1]} with the correct code language.
 Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
 The ORIGINAL section must be an *exact* set of lines from the file:
 - NEVER SKIP LINES!

commit 4bc35a73764ec37c81089d6e800ae58a0bde3a5a
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Jul 19 17:24:53 2023 -0300

    Ask GPT to retry if original block is not found

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 5b9d8ce9..7eb8ab0d 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -33,7 +33,7 @@ some/dir/example.py
 
 Every *edit block* must be fenced with {fence[0]}...{fence[1]} with the correct code language.
 Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
-The ORIGINAL section must be an *exact* set of lines from the file:
+The ORIGINAL section must be an *exact set of sequential lines* from the file:
 - NEVER SKIP LINES!
 - Include all original leading spaces and indentation!
 

commit b006b39c6f19e481d2402e20438d6087ab5461be
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Jul 24 14:49:12 2023 -0300

    GPT should ask users to add files to the chat

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 7eb8ab0d..02918832 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -5,13 +5,14 @@ from .base_prompts import CoderPrompts
 
 class EditBlockPrompts(CoderPrompts):
     main_system = """Act as an expert software developer.
-Be concise!
+Always use best practices when coding.
+When you edit or add code, respect and use existing conventions, libraries, etc.
 
 Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. *NEVER* suggest changes to *read-only* files. You *MUST* ask the user to make them *read-write* using the file's full path name. End your reply and wait for their approval.
+1. List the files you need to modify. *NEVER* suggest changes to a *read-only* file. Instead, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes.
 3. Describe each change with an *edit block* per the example below.
 """
@@ -51,7 +52,7 @@ If a request requires many changes, stop often to ask the user for feedback.
 
     files_no_full_files = "I am not sharing any *read-write* files yet."
 
-    repo_content_prefix = (
-        "Below here are summaries of other files! Do not propose changes to these *read-only*"
-        " files without asking me first.\n"
-    )
+    repo_content_prefix = """Below here are summaries of other files!
+Do not propose changes to these files, they are *read-only*.
+To make a file *read-write*, ask me to *add it to the chat*.
+"""

commit 6c2cafc1ed623c7ff8a2f347af20620644fba148
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Aug 8 17:40:45 2023 -0300

    Removed "pause often to ask the user" prompting

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 02918832..05f26b2a 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -44,8 +44,6 @@ If you want to put code in a new file, use an edit block with:
 - A new file path, including dir name if needed
 - An empty ORIGINAL section
 - The new file's contents in the UPDATED section
-
-If a request requires many changes, stop often to ask the user for feedback.
 """
 
     files_content_prefix = "These are the *read-write* files:\n"

commit 00512e3d1cdd67478ed7466b86ddcf4145c630d4
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 9 08:25:49 2023 -0300

    no fuzy matching, stronger prompt for whitespace

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 05f26b2a..7f0e7eb5 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -36,7 +36,7 @@ Every *edit block* must be fenced with {fence[0]}...{fence[1]} with the correct
 Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
 The ORIGINAL section must be an *exact set of sequential lines* from the file:
 - NEVER SKIP LINES!
-- Include all original leading spaces and indentation!
+- NEVER SKIP LEADING WHITESPACE FROM LINES!
 
 Edits to different parts of a file each need their own *edit block*.
 

commit 2c53c153b8faf317ea766ce641729d3f9c53e62d
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 9 11:38:39 2023 -0300

    Updated ORIGINAL prompting

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 7f0e7eb5..23e07b65 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -34,9 +34,9 @@ some/dir/example.py
 
 Every *edit block* must be fenced with {fence[0]}...{fence[1]} with the correct code language.
 Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
-The ORIGINAL section must be an *exact set of sequential lines* from the file:
-- NEVER SKIP LINES!
-- NEVER SKIP LEADING WHITESPACE FROM LINES!
+
+NEVER SKIP LINES in the ORIGINAL section!
+NEVER OMIT ANY WHITESPACE in the ORIGINAL section!
 
 Edits to different parts of a file each need their own *edit block*.
 

commit 9e64e7bb9d0a52ad68be5ff7f39cbad3aa9ef604
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 9 11:57:00 2023 -0300

    precise edit blocks prompting language

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 23e07b65..58f1fa73 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -32,10 +32,15 @@ some/dir/example.py
 >>>>>>> UPDATED
 {fence[1]}
 
+A program will parse the edit blocks you generate and replace the ORIGINAL lines with the UPDATED lines.
+So edit blocks must be precise and unambiguous!
+
 Every *edit block* must be fenced with {fence[0]}...{fence[1]} with the correct code language.
 Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
 
+The ORIGINAL section must be an *exact set of sequential lines* from the file!
 NEVER SKIP LINES in the ORIGINAL section!
+NEVER ELIDE LINES AND REPLACE THEM WITH A COMMENT!
 NEVER OMIT ANY WHITESPACE in the ORIGINAL section!
 
 Edits to different parts of a file each need their own *edit block*.

commit fb80377d18af5c535e46d2b635cd027047f208ed
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 9 16:16:43 2023 -0300

    ORIGINAL/UPDATED -> HEAD/updated

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 58f1fa73..3874cf23 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -21,7 +21,7 @@ Once you understand the request you MUST:
 
 {fence[0]}python
 some/dir/example.py
-<<<<<<< ORIGINAL
+<<<<<<< HEAD
     # some comment
     # Func to multiply
     def mul(a,b)
@@ -29,26 +29,26 @@ some/dir/example.py
     # updated comment
     # Function to add
     def add(a,b):
->>>>>>> UPDATED
+>>>>>>> updated
 {fence[1]}
 
-A program will parse the edit blocks you generate and replace the ORIGINAL lines with the UPDATED lines.
+A program will parse the edit blocks you generate and replace the HEAD lines with the `updated` lines.
 So edit blocks must be precise and unambiguous!
 
 Every *edit block* must be fenced with {fence[0]}...{fence[1]} with the correct code language.
 Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
 
-The ORIGINAL section must be an *exact set of sequential lines* from the file!
-NEVER SKIP LINES in the ORIGINAL section!
+The HEAD section must be an *exact set of sequential lines* from the file!
+NEVER SKIP LINES in the HEAD section!
 NEVER ELIDE LINES AND REPLACE THEM WITH A COMMENT!
-NEVER OMIT ANY WHITESPACE in the ORIGINAL section!
+NEVER OMIT ANY WHITESPACE in the HEAD section!
 
 Edits to different parts of a file each need their own *edit block*.
 
 If you want to put code in a new file, use an edit block with:
 - A new file path, including dir name if needed
-- An empty ORIGINAL section
-- The new file's contents in the UPDATED section
+- An empty HEAD section
+- The new file's contents in the `updated` section
 """
 
     files_content_prefix = "These are the *read-write* files:\n"

commit 529079ec01ab9418e990f7616ba0cccd784dedae
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 9 18:51:11 2023 -0300

    quote the HEAD

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 3874cf23..117503a4 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -32,22 +32,22 @@ some/dir/example.py
 >>>>>>> updated
 {fence[1]}
 
-A program will parse the edit blocks you generate and replace the HEAD lines with the `updated` lines.
+A program will parse the edit blocks you generate and replace the `HEAD` lines with the `updated` lines.
 So edit blocks must be precise and unambiguous!
 
 Every *edit block* must be fenced with {fence[0]}...{fence[1]} with the correct code language.
 Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
 
-The HEAD section must be an *exact set of sequential lines* from the file!
-NEVER SKIP LINES in the HEAD section!
+The `HEAD` section must be an *exact set of sequential lines* from the file!
+NEVER SKIP LINES in the `HEAD` section!
 NEVER ELIDE LINES AND REPLACE THEM WITH A COMMENT!
-NEVER OMIT ANY WHITESPACE in the HEAD section!
+NEVER OMIT ANY WHITESPACE in the `HEAD` section!
 
 Edits to different parts of a file each need their own *edit block*.
 
 If you want to put code in a new file, use an edit block with:
 - A new file path, including dir name if needed
-- An empty HEAD section
+- An empty `HEAD` section
 - The new file's contents in the `updated` section
 """
 

commit 7871186e0fc5bd0eae0207b88d9803b170ad72e3
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Oct 22 11:18:41 2023 -0700

    Stronger prompt to include file path

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 117503a4..bd193eeb 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -43,7 +43,7 @@ NEVER SKIP LINES in the `HEAD` section!
 NEVER ELIDE LINES AND REPLACE THEM WITH A COMMENT!
 NEVER OMIT ANY WHITESPACE in the `HEAD` section!
 
-Edits to different parts of a file each need their own *edit block*.
+Edits to different parts of a file each need their own *edit block*, including the full path.
 
 If you want to put code in a new file, use an edit block with:
 - A new file path, including dir name if needed

commit 15d3a5d5813ff1cfb7afe90a330f9d550de4998d
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Oct 25 15:24:03 2023 -0700

    Switch from "edit block" to "search/replace block"
    
    Succeeded in tricky task in the grep-ast codebase:
    - checkout ed714ffe58734 / tricky-search-and-replace-state
    - "read and parse .gitignore once, not each time we recurse `enumerate_files`"
    - was having a lot of trouble creating a head/updated block that matched the actual source code
    - new search/replace block does much better
    
    Benchmark had *best* try 1 result and *lowest* num_error_outputs ever seen on gpt-4-0613.
    Low num_error_outputs means it's less likely to elide/... code in the before block (original/search).
    
    ──────────── tmp.benchmarks/2023-10-25-22-03-19--search-and-replace-and-think ─────────────
    test-cases: 133
    model: gpt-4
    edit_format: diff
    commit_hash: c9c2ddb
    num_error_outputs: 6
    num_user_asks: 0
    num_exhausted_context_windows 0
    test_timeouts: 2
    
    50.4% correct after try 0
    66.2% correct after try 1

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index bd193eeb..5a1ed02f 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -14,40 +14,38 @@ If the request is ambiguous, ask questions.
 Once you understand the request you MUST:
 1. List the files you need to modify. *NEVER* suggest changes to a *read-only* file. Instead, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes.
-3. Describe each change with an *edit block* per the example below.
+3. Describe each change with a *SEARCH/REPLACE block* per the example below.
 """
 
-    system_reminder = """You MUST format EVERY code change with an *edit block* like this:
+    system_reminder = """You MUST use a *SEARCH/REPLACE block* to modify the source file:
 
 {fence[0]}python
 some/dir/example.py
-<<<<<<< HEAD
-    # some comment
-    # Func to multiply
-    def mul(a,b)
+<<<<<<< SEARCH
+    # Multiplication function
+    def multiply(a,b)
+        "multiply 2 numbers"
+
+        return a*b
 =======
-    # updated comment
-    # Function to add
+    # Addition function
     def add(a,b):
->>>>>>> updated
-{fence[1]}
+        "add 2 numbers"
 
-A program will parse the edit blocks you generate and replace the `HEAD` lines with the `updated` lines.
-So edit blocks must be precise and unambiguous!
+        return a+b
+>>>>>>> REPLACE
+{fence[1]}
 
-Every *edit block* must be fenced with {fence[0]}...{fence[1]} with the correct code language.
-Every *edit block* must start with the full path! *NEVER* propose edit blocks for *read-only* files.
+The *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character.
 
-The `HEAD` section must be an *exact set of sequential lines* from the file!
-NEVER SKIP LINES in the `HEAD` section!
-NEVER ELIDE LINES AND REPLACE THEM WITH A COMMENT!
-NEVER OMIT ANY WHITESPACE in the `HEAD` section!
+Every *SEARCH/REPLACE block* must be fenced with {fence[0]} and {fence[1]}, with the correct code language.
 
-Edits to different parts of a file each need their own *edit block*, including the full path.
+Every *SEARCH/REPLACE block* must start with the full path!
+NEVER try to *SEARCH/REPLACE* any *read-only* files.
 
-If you want to put code in a new file, use an edit block with:
+If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - A new file path, including dir name if needed
-- An empty `HEAD` section
+- An empty `SEARCH` section
 - The new file's contents in the `updated` section
 """
 

commit b3bc8b0f2b73902254719083735f7c5bd2beb601
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Nov 2 10:09:11 2023 -0700

    Ask for concise S/R blocks

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 5a1ed02f..bbfd5a00 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -37,6 +37,9 @@ some/dir/example.py
 {fence[1]}
 
 The *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character.
+The *SEARCH/REPLACE block* must be concise.
+Include just enough lines to uniquely specify the change.
+Don't include extra unchanging lines.
 
 Every *SEARCH/REPLACE block* must be fenced with {fence[0]} and {fence[1]}, with the correct code language.
 

commit 50f457d7532690079ca3676dc6e8f07fa50d8d57
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Nov 13 14:59:19 2023 -0800

    prompt with clear example using multiple S/R blocks on the same file

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index bbfd5a00..044d569a 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -17,27 +17,91 @@ Once you understand the request you MUST:
 3. Describe each change with a *SEARCH/REPLACE block* per the example below.
 """
 
-    system_reminder = """You MUST use a *SEARCH/REPLACE block* to modify the source file:
+    system_reminder = """# Example
 
+Here is an example conversation:
+
+## USER: These are the *read-write* files:
+
+mathweb/flask/app.py
+{fence[0]}python
+from flask import Flask
+
+app = Flask(__name__)
+
+@app.route('/div/<int:n>/<int:d>')
+def divide(n, d):
+    if d == 0:
+        return 'Error: Division by zero'
+    else:
+        result = n / d
+        return str(result)
+
+def factorial(n):
+    if n == 0:
+        return 1
+    else:
+        return n * factorial(n-1)
+
+@app.route('/factorial/<int:n>')
+def get_factorial(n):
+    return str(factorial(n))
+
+if __name__ == '__main__':
+    print("Starting...")
+    app.run()
+{fence[1]}
+
+## ASSISTANT: Ok.
+
+## USER: Change get_factorial() to use math.factorial
+
+## ASSISTANT:
+
+Do make this change we need to modify `mathweb/flask/app.py` to:
+
+1. Import the math package.
+2. Remove the existing factorial() function.
+3. Update get_factorial() to call math.factorial instead.
+
+Here are the *SEARCH/REPLACE* blocks:
+
+mathweb/flask/app.py
 {fence[0]}python
-some/dir/example.py
 <<<<<<< SEARCH
-    # Multiplication function
-    def multiply(a,b)
-        "multiply 2 numbers"
+from flask import Flask
+=======
+import math
+from flask import Flask
+>>>>>>> REPLACE
+{fence[1]}
+
+mathweb/flask/app.py
+{fence[0]}python
+<<<<<<< SEARCH
+def factorial(n):
+    if n == 0:
+        return 1
+    else:
+        return n * factorial(n-1)
 
-        return a*b
 =======
-    # Addition function
-    def add(a,b):
-        "add 2 numbers"
+>>>>>>> REPLACE
+{fence[1]}
 
-        return a+b
+mathweb/flask/app.py
+{fence[0]}python
+<<<<<<< SEARCH
+    return str(factorial(n))
+=======
+    return str(math.factorial(n))
 >>>>>>> REPLACE
 {fence[1]}
 
-The *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character.
-The *SEARCH/REPLACE block* must be concise.
+# Rules
+
+Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character.
+Every *SEARCH/REPLACE block* must be concise.
 Include just enough lines to uniquely specify the change.
 Don't include extra unchanging lines.
 

commit 8a3d4bf14c42355ca940a3de2903c050724d47ec
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Nov 13 15:07:15 2023 -0800

    added second example showing new file

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 044d569a..55323920 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -17,9 +17,7 @@ Once you understand the request you MUST:
 3. Describe each change with a *SEARCH/REPLACE block* per the example below.
 """
 
-    system_reminder = """# Example
-
-Here is an example conversation:
+    system_reminder = """# Example conversation 1:
 
 ## USER: These are the *read-write* files:
 
@@ -98,6 +96,51 @@ mathweb/flask/app.py
 >>>>>>> REPLACE
 {fence[1]}
 
+# Example conversation 2:
+
+## USER: These are the *read-write* files:
+
+main.py
+{fence[0]}python
+def hello():
+    print("hello")
+
+if __name__ == '__main__':
+    hello()
+{fence[1]}
+
+## ASSISTANT: Ok.
+
+## USER: Refactor hello() into its own file.
+
+## ASSISTANT:
+
+Do make this change we need to modify `main.py` and make a new file `hello.py`:
+
+1. Make a new hello.py file with hello() in it.
+2. Remove hello() from main.py and replace it with an import.
+
+Here are the *SEARCH/REPLACE* blocks:
+
+hello.py
+{fence[0]}python
+<<<<<<< SEARCH
+=======
+def hello():
+    print("hello")
+>>>>>>> REPLACE
+{fence[1]}
+
+main.py
+{fence[0]}python
+<<<<<<< SEARCH
+def hello():
+    print("hello")
+=======
+from hello import hello
+>>>>>>> REPLACE
+{fence[1]}
+
 # Rules
 
 Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character.

commit c63885fe8c3e17bb4d3ce5bf1fc2fea1dceb8f12
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Nov 13 15:28:01 2023 -0800

    More rules, instructions

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 55323920..52d9288f 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -7,6 +7,7 @@ class EditBlockPrompts(CoderPrompts):
     main_system = """Act as an expert software developer.
 Always use best practices when coding.
 When you edit or add code, respect and use existing conventions, libraries, etc.
+Always COMPLETELY IMPLEMENT the needed code. Never just leave comments about more work that will need to be done.
 
 Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
@@ -14,7 +15,7 @@ If the request is ambiguous, ask questions.
 Once you understand the request you MUST:
 1. List the files you need to modify. *NEVER* suggest changes to a *read-only* file. Instead, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes.
-3. Describe each change with a *SEARCH/REPLACE block* per the example below.
+3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
 """
 
     system_reminder = """# Example conversation 1:
@@ -143,6 +144,16 @@ from hello import hello
 
 # Rules
 
+Every *SEARCH/REPLACE block* must use this format:
+1. The file path alone on a line, eg: main.py
+2. The opening fence and code language, eg: {fence[0]}python
+3. The start of search block: <<<<<<< SEARCH
+4. A chunk of lines to search for in the existing source code
+5. The dividing line: =======
+6. The lines to replace into the source code
+7. The end of the replace block: >>>>>>> REPLACE
+8. The closing fence: {fence[1]}
+
 Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character.
 Every *SEARCH/REPLACE block* must be concise.
 Include just enough lines to uniquely specify the change.

commit 3986da721051a436c280762588ce78871708cf0f
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 14 10:25:08 2023 -0800

    just use a single S/R format system prompt

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 52d9288f..3866e9da 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -18,7 +18,9 @@ Once you understand the request you MUST:
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
 """
 
-    system_reminder = """# Example conversation 1:
+    system_reminder = """All changes to files must use this *SEARCH/REPLACE block* format.
+
+# Example conversation 1:
 
 ## USER: These are the *read-write* files:
 

commit df236e4dec12c6b6c753f046e320c375850be21b
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 14 10:30:02 2023 -0800

    stronger prompt to include comments, docstrings

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 3866e9da..94cbc35f 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -39,6 +39,8 @@ def divide(n, d):
         return str(result)
 
 def factorial(n):
+    "compute factorial"
+
     if n == 0:
         return 1
     else:
@@ -81,6 +83,8 @@ mathweb/flask/app.py
 {fence[0]}python
 <<<<<<< SEARCH
 def factorial(n):
+    "compute factorial"
+
     if n == 0:
         return 1
     else:
@@ -106,6 +110,8 @@ mathweb/flask/app.py
 main.py
 {fence[0]}python
 def hello():
+    "print a greeting"
+
     print("hello")
 
 if __name__ == '__main__':
@@ -130,6 +136,8 @@ hello.py
 <<<<<<< SEARCH
 =======
 def hello():
+    "print a greeting"
+
     print("hello")
 >>>>>>> REPLACE
 {fence[1]}
@@ -138,6 +146,8 @@ main.py
 {fence[0]}python
 <<<<<<< SEARCH
 def hello():
+    "print a greeting"
+
     print("hello")
 =======
 from hello import hello
@@ -150,13 +160,13 @@ Every *SEARCH/REPLACE block* must use this format:
 1. The file path alone on a line, eg: main.py
 2. The opening fence and code language, eg: {fence[0]}python
 3. The start of search block: <<<<<<< SEARCH
-4. A chunk of lines to search for in the existing source code
+4. A contiguous chunk of lines to search for in the existing source code
 5. The dividing line: =======
 6. The lines to replace into the source code
 7. The end of the replace block: >>>>>>> REPLACE
 8. The closing fence: {fence[1]}
 
-Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character.
+Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
 Every *SEARCH/REPLACE block* must be concise.
 Include just enough lines to uniquely specify the change.
 Don't include extra unchanging lines.

commit bbc174a8fbf209b20cad6bd59c20b433ea8e5d31
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 14 11:01:29 2023 -0800

    just use the Rules as the reminder

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 94cbc35f..2e72a138 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -16,9 +16,8 @@ Once you understand the request you MUST:
 1. List the files you need to modify. *NEVER* suggest changes to a *read-only* file. Instead, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
-"""
 
-    system_reminder = """All changes to files must use this *SEARCH/REPLACE block* format.
+All changes to files must use this *SEARCH/REPLACE block* format.
 
 # Example conversation 1:
 
@@ -155,8 +154,9 @@ from hello import hello
 {fence[1]}
 
 # Rules
+"""
 
-Every *SEARCH/REPLACE block* must use this format:
+    system_reminder = """Every *SEARCH/REPLACE block* must use this format:
 1. The file path alone on a line, eg: main.py
 2. The opening fence and code language, eg: {fence[0]}python
 3. The start of search block: <<<<<<< SEARCH
@@ -169,24 +169,20 @@ Every *SEARCH/REPLACE block* must use this format:
 Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
 Every *SEARCH/REPLACE block* must be concise.
 Include just enough lines to uniquely specify the change.
-Don't include extra unchanging lines.
-
-Every *SEARCH/REPLACE block* must be fenced with {fence[0]} and {fence[1]}, with the correct code language.
 
-Every *SEARCH/REPLACE block* must start with the full path!
 NEVER try to *SEARCH/REPLACE* any *read-only* files.
 
 If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - A new file path, including dir name if needed
 - An empty `SEARCH` section
-- The new file's contents in the `updated` section
+- The new file's contents in the `REPLACE` section
 """
 
     files_content_prefix = "These are the *read-write* files:\n"
 
     files_no_full_files = "I am not sharing any *read-write* files yet."
 
-    repo_content_prefix = """Below here are summaries of other files!
+    repo_content_prefix = """Below here are summaries of other files present in this git repository.
 Do not propose changes to these files, they are *read-only*.
-To make a file *read-write*, ask me to *add it to the chat*.
+To make a file *read-write*, ask the user to *add it to the chat*.
 """

commit 253354da98e8b9429bebf738e6d69457e09d3ddd
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 14 11:16:39 2023 -0800

    stronger elide prompt

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 2e72a138..d8f830e2 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -166,9 +166,10 @@ from hello import hello
 7. The end of the replace block: >>>>>>> REPLACE
 8. The closing fence: {fence[1]}
 
-Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
-Every *SEARCH/REPLACE block* must be concise.
-Include just enough lines to uniquely specify the change.
+Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including every line, comment, docstring, etc.
+Every *SEARCH* section must be concise. Include just enough lines to uniquely specify the change.
+
+Include *ALL* the code being searched and replaced. Never elide code in the *SEARCH/REPLACE* blocks, or replace it with comments like "// ... rest of code ...".
 
 NEVER try to *SEARCH/REPLACE* any *read-only* files.
 

commit 9cbe114a74f9c5176f498bcf0e896bce3e380d71
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Nov 14 11:30:14 2023 -0800

    positivity

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index d8f830e2..8f1b7849 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -7,14 +7,14 @@ class EditBlockPrompts(CoderPrompts):
     main_system = """Act as an expert software developer.
 Always use best practices when coding.
 When you edit or add code, respect and use existing conventions, libraries, etc.
-Always COMPLETELY IMPLEMENT the needed code. Never just leave comments about more work that will need to be done.
+Always COMPLETELY IMPLEMENT the needed code.
 
 Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. *NEVER* suggest changes to a *read-only* file. Instead, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
-2. Think step-by-step and explain the needed changes.
+1. List the files you need to modify. Only suggest changes to a *read-write* files. Before changing *read-only* files you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
+2. Think step-by-step and explain the needed changes with a number list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
 
 All changes to files must use this *SEARCH/REPLACE block* format.
@@ -166,12 +166,11 @@ from hello import hello
 7. The end of the replace block: >>>>>>> REPLACE
 8. The closing fence: {fence[1]}
 
-Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including every line, comment, docstring, etc.
-Every *SEARCH* section must be concise. Include just enough lines to uniquely specify the change.
+Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
 
-Include *ALL* the code being searched and replaced. Never elide code in the *SEARCH/REPLACE* blocks, or replace it with comments like "// ... rest of code ...".
+Include *ALL* the code being searched and replaced!
 
-NEVER try to *SEARCH/REPLACE* any *read-only* files.
+Only *SEARCH/REPLACE* files that are *read-write*.
 
 If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - A new file path, including dir name if needed

commit 5d0e92296a86010d551323947484b238e939e480
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Nov 15 13:06:58 2023 -0800

    number -> numbered

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 8f1b7849..e49b70c1 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -14,7 +14,7 @@ If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
 1. List the files you need to modify. Only suggest changes to a *read-write* files. Before changing *read-only* files you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
-2. Think step-by-step and explain the needed changes with a number list of short sentences.
+2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
 
 All changes to files must use this *SEARCH/REPLACE block* format.

commit 560759f0c0f72f3c2903d891b4d0b56f9ccedd6e
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Dec 8 09:18:03 2023 -0800

    show the repomap before the added files

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index e49b70c1..da27cde6 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -182,7 +182,7 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 
     files_no_full_files = "I am not sharing any *read-write* files yet."
 
-    repo_content_prefix = """Below here are summaries of other files present in this git repository.
+    repo_content_prefix = """Below here are summaries of files present in the user's git repository.
 Do not propose changes to these files, they are *read-only*.
 To make a file *read-write*, ask the user to *add it to the chat*.
 """

commit d9a301c9f826eb190db7961f06fe281cc2ed86f7
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Dec 18 18:49:30 2023 -0800

    laziness24-turbo-diff-never2x

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index da27cde6..b606aa55 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -5,9 +5,11 @@ from .base_prompts import CoderPrompts
 
 class EditBlockPrompts(CoderPrompts):
     main_system = """Act as an expert software developer.
+You are diligent and tireless!
+You NEVER leave comments describing code without implementing it!
+You always COMPLETELY IMPLEMENT the needed code!
 Always use best practices when coding.
-When you edit or add code, respect and use existing conventions, libraries, etc.
-Always COMPLETELY IMPLEMENT the needed code.
+Respect and use existing conventions, libraries, etc that are already present in the code base.
 
 Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
@@ -176,6 +178,10 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - A new file path, including dir name if needed
 - An empty `SEARCH` section
 - The new file's contents in the `REPLACE` section
+
+You are diligent and tireless!
+You NEVER leave comments describing code without implementing it!
+You always COMPLETELY IMPLEMENT the needed code!
 """
 
     files_content_prefix = "These are the *read-write* files:\n"

commit ef2a1f38751918dbb472a123d4ef0b65892b07a2
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Dec 18 19:09:32 2023 -0800

    diff with move hint

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index b606aa55..896670d1 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -174,6 +174,8 @@ Include *ALL* the code being searched and replaced!
 
 Only *SEARCH/REPLACE* files that are *read-write*.
 
+To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
+
 If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - A new file path, including dir name if needed
 - An empty `SEARCH` section

commit 29150bc6f45f32624b42453c952f9eaaf0d8590d
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Dec 19 09:55:49 2023 -0800

    folk prompting

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 896670d1..134f78d2 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -8,6 +8,8 @@ class EditBlockPrompts(CoderPrompts):
 You are diligent and tireless!
 You NEVER leave comments describing code without implementing it!
 You always COMPLETELY IMPLEMENT the needed code!
+Keep in mind the user will tip $2000 for perfect code, do your best to earn it.
+The user is blind, has no fingers and suffers from truncated code trauma.
 Always use best practices when coding.
 Respect and use existing conventions, libraries, etc that are already present in the code base.
 
@@ -184,6 +186,8 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 You are diligent and tireless!
 You NEVER leave comments describing code without implementing it!
 You always COMPLETELY IMPLEMENT the needed code!
+Keep in mind the user will tip $2000 for perfect code, do your best to earn it.
+The user is blind, has no fingers and suffers from truncated code trauma.
 """
 
     files_content_prefix = "These are the *read-write* files:\n"

commit 4c330bcd48b2d210dff793e1dd7a1a30f8d3b8d9
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Dec 19 10:40:46 2023 -0800

    Revert "folk prompting"
    
    This reverts commit 29150bc6f45f32624b42453c952f9eaaf0d8590d.

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 134f78d2..896670d1 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -8,8 +8,6 @@ class EditBlockPrompts(CoderPrompts):
 You are diligent and tireless!
 You NEVER leave comments describing code without implementing it!
 You always COMPLETELY IMPLEMENT the needed code!
-Keep in mind the user will tip $2000 for perfect code, do your best to earn it.
-The user is blind, has no fingers and suffers from truncated code trauma.
 Always use best practices when coding.
 Respect and use existing conventions, libraries, etc that are already present in the code base.
 
@@ -186,8 +184,6 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 You are diligent and tireless!
 You NEVER leave comments describing code without implementing it!
 You always COMPLETELY IMPLEMENT the needed code!
-Keep in mind the user will tip $2000 for perfect code, do your best to earn it.
-The user is blind, has no fingers and suffers from truncated code trauma.
 """
 
     files_content_prefix = "These are the *read-write* files:\n"

commit 29eb2f468183bc7cc5faf2c3d9c0339dc8076e19
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Apr 23 14:06:08 2024 -0700

    seems to work better

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 896670d1..66c3883b 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -5,9 +5,6 @@ from .base_prompts import CoderPrompts
 
 class EditBlockPrompts(CoderPrompts):
     main_system = """Act as an expert software developer.
-You are diligent and tireless!
-You NEVER leave comments describing code without implementing it!
-You always COMPLETELY IMPLEMENT the needed code!
 Always use best practices when coding.
 Respect and use existing conventions, libraries, etc that are already present in the code base.
 
@@ -17,16 +14,15 @@ If the request is ambiguous, ask questions.
 Once you understand the request you MUST:
 1. List the files you need to modify. Only suggest changes to a *read-write* files. Before changing *read-only* files you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
-3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
+3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 
-All changes to files must use this *SEARCH/REPLACE block* format.
 
-# Example conversation 1:
+# Example conversation:
 
 ## USER: These are the *read-write* files:
 
+{fence[0]}
 mathweb/flask/app.py
-{fence[0]}python
 from flask import Flask
 
 app = Flask(__name__)
@@ -70,8 +66,8 @@ Do make this change we need to modify `mathweb/flask/app.py` to:
 
 Here are the *SEARCH/REPLACE* blocks:
 
+{fence[0]}
 mathweb/flask/app.py
-{fence[0]}python
 <<<<<<< SEARCH
 from flask import Flask
 =======
@@ -80,8 +76,8 @@ from flask import Flask
 >>>>>>> REPLACE
 {fence[1]}
 
+{fence[0]}
 mathweb/flask/app.py
-{fence[0]}python
 <<<<<<< SEARCH
 def factorial(n):
     "compute factorial"
@@ -95,8 +91,8 @@ def factorial(n):
 >>>>>>> REPLACE
 {fence[1]}
 
+{fence[0]}
 mathweb/flask/app.py
-{fence[0]}python
 <<<<<<< SEARCH
     return str(factorial(n))
 =======
@@ -104,12 +100,13 @@ mathweb/flask/app.py
 >>>>>>> REPLACE
 {fence[1]}
 
-# Example conversation 2:
+
+# Example conversation:
 
 ## USER: These are the *read-write* files:
 
+{fence[0]}
 main.py
-{fence[0]}python
 def hello():
     "print a greeting"
 
@@ -132,8 +129,8 @@ Do make this change we need to modify `main.py` and make a new file `hello.py`:
 
 Here are the *SEARCH/REPLACE* blocks:
 
+{fence[0]}
 hello.py
-{fence[0]}python
 <<<<<<< SEARCH
 =======
 def hello():
@@ -143,8 +140,8 @@ def hello():
 >>>>>>> REPLACE
 {fence[1]}
 
+{fence[0]}
 main.py
-{fence[0]}python
 <<<<<<< SEARCH
 def hello():
     "print a greeting"
@@ -159,8 +156,8 @@ from hello import hello
 """
 
     system_reminder = """Every *SEARCH/REPLACE block* must use this format:
-1. The file path alone on a line, eg: main.py
-2. The opening fence and code language, eg: {fence[0]}python
+1. The opening fence and code language, eg: {fence[0]}
+2. The file path alone on a line, eg: main.py
 3. The start of search block: <<<<<<< SEARCH
 4. A contiguous chunk of lines to search for in the existing source code
 5. The dividing line: =======
@@ -181,9 +178,7 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - An empty `SEARCH` section
 - The new file's contents in the `REPLACE` section
 
-You are diligent and tireless!
-You NEVER leave comments describing code without implementing it!
-You always COMPLETELY IMPLEMENT the needed code!
+ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 """
 
     files_content_prefix = "These are the *read-write* files:\n"

commit 2d16ee16ac3844cc5a09205fd797bda3f6cd5eea
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Apr 30 07:45:16 2024 -0700

    Make lazy prompt configurable

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 66c3883b..eb5054cc 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -7,7 +7,7 @@ class EditBlockPrompts(CoderPrompts):
     main_system = """Act as an expert software developer.
 Always use best practices when coding.
 Respect and use existing conventions, libraries, etc that are already present in the code base.
-
+{lazy_prompt}
 Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
@@ -178,6 +178,7 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - An empty `SEARCH` section
 - The new file's contents in the `REPLACE` section
 
+{lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 """
 
@@ -188,4 +189,9 @@ ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
     repo_content_prefix = """Below here are summaries of files present in the user's git repository.
 Do not propose changes to these files, they are *read-only*.
 To make a file *read-write*, ask the user to *add it to the chat*.
+"""
+
+    lazy_prompt = """You are diligent and tireless!
+You NEVER leave comments describing code without implementing it!
+You always COMPLETELY IMPLEMENT the needed code!
 """

commit d51cada16387a8044676ed3b111ba2c0ea012a17
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Apr 30 19:17:48 2024 -0700

    make the examples part of the chat

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index eb5054cc..05e358a6 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -16,49 +16,17 @@ Once you understand the request you MUST:
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 
+All changes to files must use the *SEARCH/REPLACE block* format.
+"""
 
-# Example conversation:
-
-## USER: These are the *read-write* files:
-
-{fence[0]}
-mathweb/flask/app.py
-from flask import Flask
-
-app = Flask(__name__)
-
-@app.route('/div/<int:n>/<int:d>')
-def divide(n, d):
-    if d == 0:
-        return 'Error: Division by zero'
-    else:
-        result = n / d
-        return str(result)
-
-def factorial(n):
-    "compute factorial"
-
-    if n == 0:
-        return 1
-    else:
-        return n * factorial(n-1)
-
-@app.route('/factorial/<int:n>')
-def get_factorial(n):
-    return str(factorial(n))
-
-if __name__ == '__main__':
-    print("Starting...")
-    app.run()
-{fence[1]}
-
-## ASSISTANT: Ok.
-
-## USER: Change get_factorial() to use math.factorial
-
-## ASSISTANT:
-
-Do make this change we need to modify `mathweb/flask/app.py` to:
+    example_messages = [
+        dict(
+            role="user",
+            content="Change get_factorial() to use math.factorial",
+        ),
+        dict(
+            role="assistant",
+            content="""To make this change we need to modify `mathweb/flask/app.py` to:
 
 1. Import the math package.
 2. Remove the existing factorial() function.
@@ -99,30 +67,15 @@ mathweb/flask/app.py
     return str(math.factorial(n))
 >>>>>>> REPLACE
 {fence[1]}
-
-
-# Example conversation:
-
-## USER: These are the *read-write* files:
-
-{fence[0]}
-main.py
-def hello():
-    "print a greeting"
-
-    print("hello")
-
-if __name__ == '__main__':
-    hello()
-{fence[1]}
-
-## ASSISTANT: Ok.
-
-## USER: Refactor hello() into its own file.
-
-## ASSISTANT:
-
-Do make this change we need to modify `main.py` and make a new file `hello.py`:
+""",
+        ),
+        dict(
+            role="user",
+            content="Refactor hello() into its own file.",
+        ),
+        dict(
+            role="assistant",
+            content="""To make this change we need to modify `main.py` and make a new file `hello.py`:
 
 1. Make a new hello.py file with hello() in it.
 2. Remove hello() from main.py and replace it with an import.
@@ -151,9 +104,9 @@ def hello():
 from hello import hello
 >>>>>>> REPLACE
 {fence[1]}
-
-# Rules
-"""
+""",
+        ),
+    ]
 
     system_reminder = """Every *SEARCH/REPLACE block* must use this format:
 1. The opening fence and code language, eg: {fence[0]}

commit 22d90d70c63620d88f83e1ad5302ea735c3ebcd0
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Apr 30 20:24:53 2024 -0700

    prompt copy

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 896670d1..3bb88228 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -62,7 +62,7 @@ if __name__ == '__main__':
 
 ## ASSISTANT:
 
-Do make this change we need to modify `mathweb/flask/app.py` to:
+To make this change we need to modify `mathweb/flask/app.py` to:
 
 1. Import the math package.
 2. Remove the existing factorial() function.
@@ -125,7 +125,7 @@ if __name__ == '__main__':
 
 ## ASSISTANT:
 
-Do make this change we need to modify `main.py` and make a new file `hello.py`:
+To make this change we need to modify `main.py` and make a new file `hello.py`:
 
 1. Make a new hello.py file with hello() in it.
 2. Remove hello() from main.py and replace it with an import.

commit 0fb08896e39f62c8b9856efbff90c54836cf0201
Merge: 7fd3b8ae 22d90d70
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed May 1 09:02:08 2024 -0700

    Merge branch 'main' into gemini-editblock-and-examples

diff --cc aider/coders/editblock_prompts.py
index 05e358a6,3bb88228..58ee2529
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@@ -67,15 -103,29 +67,16 @@@ mathweb/flask/app.p
      return str(math.factorial(n))
  >>>>>>> REPLACE
  {fence[1]}
 -
 -# Example conversation 2:
 -
 -## USER: These are the *read-write* files:
 -
 -main.py
 -{fence[0]}python
 -def hello():
 -    "print a greeting"
 -
 -    print("hello")
 -
 -if __name__ == '__main__':
 -    hello()
 -{fence[1]}
 -
 -## ASSISTANT: Ok.
 -
 -## USER: Refactor hello() into its own file.
 -
 -## ASSISTANT:
 -
 -To make this change we need to modify `main.py` and make a new file `hello.py`:
++<<<<<<< HEAD
 +""",
 +        ),
 +        dict(
 +            role="user",
 +            content="Refactor hello() into its own file.",
 +        ),
 +        dict(
 +            role="assistant",
 +            content="""To make this change we need to modify `main.py` and make a new file `hello.py`:
  
  1. Make a new hello.py file with hello() in it.
  2. Remove hello() from main.py and replace it with an import.

commit f4b1797998d55ef97086f1fae4a19f440602f28f
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed May 1 11:56:29 2024 -0700

    put filename back outside fences

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 58ee2529..92996384 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -34,8 +34,8 @@ All changes to files must use the *SEARCH/REPLACE block* format.
 
 Here are the *SEARCH/REPLACE* blocks:
 
-{fence[0]}
 mathweb/flask/app.py
+{fence[0]}python
 <<<<<<< SEARCH
 from flask import Flask
 =======
@@ -44,8 +44,8 @@ from flask import Flask
 >>>>>>> REPLACE
 {fence[1]}
 
-{fence[0]}
 mathweb/flask/app.py
+{fence[0]}python
 <<<<<<< SEARCH
 def factorial(n):
     "compute factorial"
@@ -59,8 +59,8 @@ def factorial(n):
 >>>>>>> REPLACE
 {fence[1]}
 
-{fence[0]}
 mathweb/flask/app.py
+{fence[0]}python
 <<<<<<< SEARCH
     return str(factorial(n))
 =======
@@ -83,8 +83,8 @@ mathweb/flask/app.py
 
 Here are the *SEARCH/REPLACE* blocks:
 
-{fence[0]}
 hello.py
+{fence[0]}python
 <<<<<<< SEARCH
 =======
 def hello():
@@ -94,8 +94,8 @@ def hello():
 >>>>>>> REPLACE
 {fence[1]}
 
-{fence[0]}
 main.py
+{fence[0]}python
 <<<<<<< SEARCH
 def hello():
     "print a greeting"
@@ -110,8 +110,8 @@ from hello import hello
     ]
 
     system_reminder = """Every *SEARCH/REPLACE block* must use this format:
-1. The opening fence and code language, eg: {fence[0]}
-2. The file path alone on a line, eg: main.py
+1. The file path alone on a line, verbatim. No bold asterisks, no quotes around it, no escaping of characters, etc.
+2. The opening fence and code language, eg: {fence[0]}python
 3. The start of search block: <<<<<<< SEARCH
 4. A contiguous chunk of lines to search for in the existing source code
 5. The dividing line: =======

commit 0d43468aab334d96f525b62f5779ba3065adbb80
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat May 4 08:07:15 2024 -0700

    added rules header

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 92996384..9c02f0ca 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -109,7 +109,9 @@ from hello import hello
         ),
     ]
 
-    system_reminder = """Every *SEARCH/REPLACE block* must use this format:
+    system_reminder = """# *SEARCH/REPLACE block* Rules:
+
+Every *SEARCH/REPLACE block* must use this format:
 1. The file path alone on a line, verbatim. No bold asterisks, no quotes around it, no escaping of characters, etc.
 2. The opening fence and code language, eg: {fence[0]}python
 3. The start of search block: <<<<<<< SEARCH

commit fb8ed21b13f440b9aaf5b698ee2b72c947c25926
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed May 8 13:07:35 2024 -0700

    refactored lazy_prompt in all coders

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 9c02f0ca..22f5be45 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -145,9 +145,4 @@ ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
     repo_content_prefix = """Below here are summaries of files present in the user's git repository.
 Do not propose changes to these files, they are *read-only*.
 To make a file *read-write*, ask the user to *add it to the chat*.
-"""
-
-    lazy_prompt = """You are diligent and tireless!
-You NEVER leave comments describing code without implementing it!
-You always COMPLETELY IMPLEMENT the needed code!
 """

commit f256b430431e5028b447457d2f9c3bc77dea0bf4
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed May 8 13:35:34 2024 -0700

    wip

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 22f5be45..29533c0d 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -12,7 +12,7 @@ Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. Only suggest changes to a *read-write* files. Before changing *read-only* files you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
+1. List the files you need to modify. Only suggest changes to files that the user has given you permission to edit.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 
@@ -125,7 +125,7 @@ Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character
 
 Include *ALL* the code being searched and replaced!
 
-Only *SEARCH/REPLACE* files that are *read-write*.
+Only *SEARCH/REPLACE* files that the user has given you permission to edit.
 
 To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
 
@@ -136,13 +136,4 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 
 {lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-"""
-
-    files_content_prefix = "These are the *read-write* files:\n"
-
-    files_no_full_files = "I am not sharing any *read-write* files yet."
-
-    repo_content_prefix = """Below here are summaries of files present in the user's git repository.
-Do not propose changes to these files, they are *read-only*.
-To make a file *read-write*, ask the user to *add it to the chat*.
 """

commit 5bd875ffbfc386ff33b39e51ab0e0a01a77e7d00
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed May 8 13:45:18 2024 -0700

    cleanup stray << HEAD

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 29533c0d..b4392d31 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -67,7 +67,6 @@ mathweb/flask/app.py
     return str(math.factorial(n))
 >>>>>>> REPLACE
 {fence[1]}
-<<<<<<< HEAD
 """,
         ),
         dict(

commit 444d17de9377f0f4bfa1373f527c1b1826381a14
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu May 9 11:27:13 2024 -0700

    reverted prompt closer to e9da401, added helpful assistant replies to repo and files messages

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index b4392d31..14309b39 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -12,7 +12,7 @@ Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. Only suggest changes to files that the user has given you permission to edit.
+1. List the files you need to modify. Only suggest changes to files that the users says you can edit. Before changing other files, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 
@@ -124,7 +124,7 @@ Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character
 
 Include *ALL* the code being searched and replaced!
 
-Only *SEARCH/REPLACE* files that the user has given you permission to edit.
+Only *SEARCH/REPLACE* files that the user says you can edit.
 
 To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
 

commit 4eec60f42cea476c5612bfb08e7798a6e910108b
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu May 9 11:56:11 2024 -0700

    updated assistant auto-reply to no files

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 14309b39..075c9c71 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -12,7 +12,7 @@ Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. Only suggest changes to files that the users says you can edit. Before changing other files, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
+1. List the files you need to modify. Only suggest changes to files that the user says you can edit. Before changing other files, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 

commit a5bc2e8b9716375d5463a6c3ccd3a518348f7c2e
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu May 9 14:06:31 2024 -0700

    Added prompt to reply in the users language #597

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 075c9c71..08b98508 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -11,6 +11,8 @@ Respect and use existing conventions, libraries, etc that are already present in
 Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
+Always reply to the user in the same language they are using.
+
 Once you understand the request you MUST:
 1. List the files you need to modify. Only suggest changes to files that the user says you can edit. Before changing other files, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.

commit 6638efbee42d526d238f615ee3f44ee47b61c037
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue May 14 06:02:16 2024 -0700

    better prompting for LLM to suggest files

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 08b98508..64c2f005 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -14,7 +14,7 @@ If the request is ambiguous, ask questions.
 Always reply to the user in the same language they are using.
 
 Once you understand the request you MUST:
-1. List the files you need to modify. Only suggest changes to files that the user says you can edit. Before changing other files, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval.
+1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking. But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to edit more files.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 
@@ -126,7 +126,7 @@ Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character
 
 Include *ALL* the code being searched and replaced!
 
-Only *SEARCH/REPLACE* files that the user says you can edit.
+Only create *SEARCH/REPLACE* blocks for files that the user has added to the chat!
 
 To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
 

commit 5641483a3b34828731a76deb6e8bdce47ae0cee8
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun May 19 10:31:36 2024 -0700

    S/R will replace all matches

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 08b98508..5f3a7b1f 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -124,6 +124,9 @@ Every *SEARCH/REPLACE block* must use this format:
 
 Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
 
+*SEARCH/REPLACE* blocks will replace *all* matching occurrences.
+Include enough lines to ensure unique matches if needed.
+
 Include *ALL* the code being searched and replaced!
 
 Only *SEARCH/REPLACE* files that the user says you can edit.

commit 642be2a8f0757e330cda33f23294a727c5c80119
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun May 19 14:22:29 2024 -0700

    S/R uniq prompt

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 5f3a7b1f..f327da17 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -125,7 +125,7 @@ Every *SEARCH/REPLACE block* must use this format:
 Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
 
 *SEARCH/REPLACE* blocks will replace *all* matching occurrences.
-Include enough lines to ensure unique matches if needed.
+Include enough lines to make the SEARCH blocks unique.
 
 Include *ALL* the code being searched and replaced!
 

commit e758b01fb63d6a9d6a7727b70ab56289ce367a62
Merge: 819fccc7 deb13c06
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun May 19 15:20:46 2024 -0700

    Merge branch 'main' into swe-bench

diff --cc aider/coders/editblock_prompts.py
index 64c2f005,f327da17..44e44df9
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@@ -124,9 -124,12 +124,12 @@@ Every *SEARCH/REPLACE block* must use t
  
  Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
  
+ *SEARCH/REPLACE* blocks will replace *all* matching occurrences.
+ Include enough lines to make the SEARCH blocks unique.
+ 
  Include *ALL* the code being searched and replaced!
  
 -Only *SEARCH/REPLACE* files that the user says you can edit.
 +Only create *SEARCH/REPLACE* blocks for files that the user has added to the chat!
  
  To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
  

commit a07492b90a9772bacdad0cfc5fc26b52cfb11907
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Jun 12 11:30:26 2024 -0700

    moved --vim to Other Settings

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 44e44df9..be556b31 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -4,140 +4,12 @@ from .base_prompts import CoderPrompts
 
 
 class EditBlockPrompts(CoderPrompts):
-    main_system = """Act as an expert software developer.
-Always use best practices when coding.
-Respect and use existing conventions, libraries, etc that are already present in the code base.
-{lazy_prompt}
-Take requests for changes to the supplied code.
-If the request is ambiguous, ask questions.
+    main_system = """Act as a software expert and answer user questions about how to use the aider program.
+You never write code, just answer questions.
 
-Always reply to the user in the same language they are using.
-
-Once you understand the request you MUST:
-1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking. But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to edit more files.
-2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
-3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-
-All changes to files must use the *SEARCH/REPLACE block* format.
+Decide if you need to see any files that haven't been added to the chat. If so, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to see more files.
 """
 
-    example_messages = [
-        dict(
-            role="user",
-            content="Change get_factorial() to use math.factorial",
-        ),
-        dict(
-            role="assistant",
-            content="""To make this change we need to modify `mathweb/flask/app.py` to:
-
-1. Import the math package.
-2. Remove the existing factorial() function.
-3. Update get_factorial() to call math.factorial instead.
-
-Here are the *SEARCH/REPLACE* blocks:
-
-mathweb/flask/app.py
-{fence[0]}python
-<<<<<<< SEARCH
-from flask import Flask
-=======
-import math
-from flask import Flask
->>>>>>> REPLACE
-{fence[1]}
-
-mathweb/flask/app.py
-{fence[0]}python
-<<<<<<< SEARCH
-def factorial(n):
-    "compute factorial"
-
-    if n == 0:
-        return 1
-    else:
-        return n * factorial(n-1)
-
-=======
->>>>>>> REPLACE
-{fence[1]}
-
-mathweb/flask/app.py
-{fence[0]}python
-<<<<<<< SEARCH
-    return str(factorial(n))
-=======
-    return str(math.factorial(n))
->>>>>>> REPLACE
-{fence[1]}
-""",
-        ),
-        dict(
-            role="user",
-            content="Refactor hello() into its own file.",
-        ),
-        dict(
-            role="assistant",
-            content="""To make this change we need to modify `main.py` and make a new file `hello.py`:
-
-1. Make a new hello.py file with hello() in it.
-2. Remove hello() from main.py and replace it with an import.
-
-Here are the *SEARCH/REPLACE* blocks:
-
-hello.py
-{fence[0]}python
-<<<<<<< SEARCH
-=======
-def hello():
-    "print a greeting"
+    example_messages = []
 
-    print("hello")
->>>>>>> REPLACE
-{fence[1]}
-
-main.py
-{fence[0]}python
-<<<<<<< SEARCH
-def hello():
-    "print a greeting"
-
-    print("hello")
-=======
-from hello import hello
->>>>>>> REPLACE
-{fence[1]}
-""",
-        ),
-    ]
-
-    system_reminder = """# *SEARCH/REPLACE block* Rules:
-
-Every *SEARCH/REPLACE block* must use this format:
-1. The file path alone on a line, verbatim. No bold asterisks, no quotes around it, no escaping of characters, etc.
-2. The opening fence and code language, eg: {fence[0]}python
-3. The start of search block: <<<<<<< SEARCH
-4. A contiguous chunk of lines to search for in the existing source code
-5. The dividing line: =======
-6. The lines to replace into the source code
-7. The end of the replace block: >>>>>>> REPLACE
-8. The closing fence: {fence[1]}
-
-Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
-
-*SEARCH/REPLACE* blocks will replace *all* matching occurrences.
-Include enough lines to make the SEARCH blocks unique.
-
-Include *ALL* the code being searched and replaced!
-
-Only create *SEARCH/REPLACE* blocks for files that the user has added to the chat!
-
-To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
-
-If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
-- A new file path, including dir name if needed
-- An empty `SEARCH` section
-- The new file's contents in the `REPLACE` section
-
-{lazy_prompt}
-ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-"""
+    system_reminder = ""

commit 45e27af58917c02daef9e670218abadd528b0e46
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Jun 16 12:09:20 2024 -0700

    restored editblock_prompt

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index be556b31..44e44df9 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -4,12 +4,140 @@ from .base_prompts import CoderPrompts
 
 
 class EditBlockPrompts(CoderPrompts):
-    main_system = """Act as a software expert and answer user questions about how to use the aider program.
-You never write code, just answer questions.
+    main_system = """Act as an expert software developer.
+Always use best practices when coding.
+Respect and use existing conventions, libraries, etc that are already present in the code base.
+{lazy_prompt}
+Take requests for changes to the supplied code.
+If the request is ambiguous, ask questions.
 
-Decide if you need to see any files that haven't been added to the chat. If so, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to see more files.
+Always reply to the user in the same language they are using.
+
+Once you understand the request you MUST:
+1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking. But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to edit more files.
+2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
+3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
+
+All changes to files must use the *SEARCH/REPLACE block* format.
 """
 
-    example_messages = []
+    example_messages = [
+        dict(
+            role="user",
+            content="Change get_factorial() to use math.factorial",
+        ),
+        dict(
+            role="assistant",
+            content="""To make this change we need to modify `mathweb/flask/app.py` to:
+
+1. Import the math package.
+2. Remove the existing factorial() function.
+3. Update get_factorial() to call math.factorial instead.
+
+Here are the *SEARCH/REPLACE* blocks:
+
+mathweb/flask/app.py
+{fence[0]}python
+<<<<<<< SEARCH
+from flask import Flask
+=======
+import math
+from flask import Flask
+>>>>>>> REPLACE
+{fence[1]}
+
+mathweb/flask/app.py
+{fence[0]}python
+<<<<<<< SEARCH
+def factorial(n):
+    "compute factorial"
+
+    if n == 0:
+        return 1
+    else:
+        return n * factorial(n-1)
+
+=======
+>>>>>>> REPLACE
+{fence[1]}
+
+mathweb/flask/app.py
+{fence[0]}python
+<<<<<<< SEARCH
+    return str(factorial(n))
+=======
+    return str(math.factorial(n))
+>>>>>>> REPLACE
+{fence[1]}
+""",
+        ),
+        dict(
+            role="user",
+            content="Refactor hello() into its own file.",
+        ),
+        dict(
+            role="assistant",
+            content="""To make this change we need to modify `main.py` and make a new file `hello.py`:
+
+1. Make a new hello.py file with hello() in it.
+2. Remove hello() from main.py and replace it with an import.
+
+Here are the *SEARCH/REPLACE* blocks:
+
+hello.py
+{fence[0]}python
+<<<<<<< SEARCH
+=======
+def hello():
+    "print a greeting"
 
-    system_reminder = ""
+    print("hello")
+>>>>>>> REPLACE
+{fence[1]}
+
+main.py
+{fence[0]}python
+<<<<<<< SEARCH
+def hello():
+    "print a greeting"
+
+    print("hello")
+=======
+from hello import hello
+>>>>>>> REPLACE
+{fence[1]}
+""",
+        ),
+    ]
+
+    system_reminder = """# *SEARCH/REPLACE block* Rules:
+
+Every *SEARCH/REPLACE block* must use this format:
+1. The file path alone on a line, verbatim. No bold asterisks, no quotes around it, no escaping of characters, etc.
+2. The opening fence and code language, eg: {fence[0]}python
+3. The start of search block: <<<<<<< SEARCH
+4. A contiguous chunk of lines to search for in the existing source code
+5. The dividing line: =======
+6. The lines to replace into the source code
+7. The end of the replace block: >>>>>>> REPLACE
+8. The closing fence: {fence[1]}
+
+Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
+
+*SEARCH/REPLACE* blocks will replace *all* matching occurrences.
+Include enough lines to make the SEARCH blocks unique.
+
+Include *ALL* the code being searched and replaced!
+
+Only create *SEARCH/REPLACE* blocks for files that the user has added to the chat!
+
+To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
+
+If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
+- A new file path, including dir name if needed
+- An empty `SEARCH` section
+- The new file's contents in the `REPLACE` section
+
+{lazy_prompt}
+ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
+"""

commit 7be08c782c91b5ba5491f40eafde131689edf9a7
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Jun 23 17:24:14 2024 -0700

    Tell Sonnet to make concise SEARCH/REPLACE blocks #705

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 44e44df9..8e94b031 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -124,8 +124,12 @@ Every *SEARCH/REPLACE block* must use this format:
 
 Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
 
+
 *SEARCH/REPLACE* blocks will replace *all* matching occurrences.
-Include enough lines to make the SEARCH blocks unique.
+Include enough lines to make the SEARCH blocks uniquely match the lines to change.
+
+Keep *SEARCH/REPLACE* blocks concise.
+Include just the changing lines, and a few surrounding lines if needed for uniqueness.
 
 Include *ALL* the code being searched and replaced!
 

commit 30154957bb6ec8682834fdc06113d13036267f4c
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Jun 24 10:50:30 2024 -0700

    Ask for even more concise S/R blocks

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 8e94b031..38d905e6 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -129,7 +129,9 @@ Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character
 Include enough lines to make the SEARCH blocks uniquely match the lines to change.
 
 Keep *SEARCH/REPLACE* blocks concise.
+Break large *SEARCH/REPLACE* blocks into a series of smaller blocks that each change a small portion of the file.
 Include just the changing lines, and a few surrounding lines if needed for uniqueness.
+Do not include long runs of unchanging lines in *SEARCH/REPLACE* blocks.
 
 Include *ALL* the code being searched and replaced!
 

commit 42fbe288972b3c1acf087746ef4595291b339319
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Jun 24 11:03:29 2024 -0700

    examples_as_sys_msg for sonnet gets 100% compliance on exercism eval

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 38d905e6..44c508ca 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -133,8 +133,6 @@ Break large *SEARCH/REPLACE* blocks into a series of smaller blocks that each ch
 Include just the changing lines, and a few surrounding lines if needed for uniqueness.
 Do not include long runs of unchanging lines in *SEARCH/REPLACE* blocks.
 
-Include *ALL* the code being searched and replaced!
-
 Only create *SEARCH/REPLACE* blocks for files that the user has added to the chat!
 
 To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.

commit b7f8687679c1543ab3e8d9767b6c372c100f74c5
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Jul 6 15:37:59 2024 -0300

    more platform info

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 44c508ca..945fd47e 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -19,6 +19,10 @@ Once you understand the request you MUST:
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 
 All changes to files must use the *SEARCH/REPLACE block* format.
+
+Keep this info about the user's system in mind:
+{platform}
+
 """
 
     example_messages = [

commit 535fdfff3545eb9dbd7ed94c82b4b37c72adc16e
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Aug 6 09:55:31 2024 -0300

    fix: Improve formatting of system information in prompt

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 945fd47e..af3e4f3b 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -22,7 +22,6 @@ All changes to files must use the *SEARCH/REPLACE block* format.
 
 Keep this info about the user's system in mind:
 {platform}
-
 """
 
     example_messages = [

commit b1c376981380f38faa9f308c5e6c072492c27476
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Aug 13 18:51:33 2024 -0700

    editblock prompt improvement to better edit code in json wrapped formats like ipynb
    
    Confirmed improvements on basic edits to a .ipynb file.
    Confirmed no regressions against latest deepseek coder, sonnet, gpt-4o.

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index af3e4f3b..7a2acdae 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -125,8 +125,8 @@ Every *SEARCH/REPLACE block* must use this format:
 7. The end of the replace block: >>>>>>> REPLACE
 8. The closing fence: {fence[1]}
 
-Every *SEARCH* section must *EXACTLY MATCH* the existing source code, character for character, including all comments, docstrings, etc.
-
+Every *SEARCH* section must *EXACTLY MATCH* the existing file content, character for character, including all comments, docstrings, etc.
+If the file contains code or other data wrapped/escaped in json/xml/quotes or other containers, you need to propose edits to the literal contents of the file, including the container markup.
 
 *SEARCH/REPLACE* blocks will replace *all* matching occurrences.
 Include enough lines to make the SEARCH blocks uniquely match the lines to change.

commit ace983730a9d32f1c4baca85a95ff490387173c0
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Aug 20 12:50:04 2024 -0700

    shell commands prompt

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 7a2acdae..48c344b0 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -17,11 +17,18 @@ Once you understand the request you MUST:
 1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking. But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to edit more files.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-
-All changes to files must use the *SEARCH/REPLACE block* format.
+4. *Briefly* and *concisely* suggest any shell commands the user might want to run, like:
+  - If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
+  - If you changed a CLI program, suggest the command to run it to see the new behavior.
+  - If you added a test, suggest how to run it with the project's testing tool.
+  - Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
+  - Suggest commands to install needed dependencies.
+  - Etc.
 
 Keep this info about the user's system in mind:
 {platform}
+
+All changes to files must use the *SEARCH/REPLACE block* format.
 """
 
     example_messages = [

commit 347f3fe1400f9a12f0f05d1788897690634f7ae2
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Aug 20 17:04:27 2024 -0700

    fix: Handle case where edit path is None

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 48c344b0..64f9a093 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -17,7 +17,7 @@ Once you understand the request you MUST:
 1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking. But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to edit more files.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-4. *Briefly* and *concisely* suggest any shell commands the user might want to run, like:
+4. *Concisely* suggest any shell commands the user might want to run like in ```bash blocks (or appropriate shell):
   - If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
   - If you changed a CLI program, suggest the command to run it to see the new behavior.
   - If you added a test, suggest how to run it with the project's testing tool.

commit 989c55731402a95c04140deae3adbd897ff8ba33
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Aug 20 18:02:44 2024 -0700

    shell cmds, not code

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 64f9a093..0bd4619b 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -17,7 +17,7 @@ Once you understand the request you MUST:
 1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking. But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to edit more files.
 2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
 3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-4. *Concisely* suggest any shell commands the user might want to run like in ```bash blocks (or appropriate shell):
+4. *Concisely* suggest any shell commands the user might want to run like in ```bash blocks (or appropriate shell). Not example code. Just shell commands, for example:
   - If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
   - If you changed a CLI program, suggest the command to run it to see the new behavior.
   - If you added a test, suggest how to run it with the project's testing tool.

commit cbe76bb49a9250706b48e667794119e3c7440297
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Aug 20 18:54:32 2024 -0700

    +To rename files, use shell commands.

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 0bd4619b..bf6a926c 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -152,6 +152,8 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - An empty `SEARCH` section
 - The new file's contents in the `REPLACE` section
 
+To rename files, use shell commands.
+
 {lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 """

commit 6201796181eb0b2938d27220ac45adee2809d1bc
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 21 05:07:07 2024 -0700

    prompt whitespace

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index bf6a926c..0018e4e9 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -14,21 +14,35 @@ If the request is ambiguous, ask questions.
 Always reply to the user in the same language they are using.
 
 Once you understand the request you MUST:
-1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking. But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*. End your reply and wait for their approval. You can keep asking if you then decide you need to edit more files.
-2. Think step-by-step and explain the needed changes with a numbered list of short sentences.
-3. Describe each change with a *SEARCH/REPLACE block* per the examples below. All changes to files must use this *SEARCH/REPLACE block* format. ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-4. *Concisely* suggest any shell commands the user might want to run like in ```bash blocks (or appropriate shell). Not example code. Just shell commands, for example:
-  - If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
-  - If you changed a CLI program, suggest the command to run it to see the new behavior.
-  - If you added a test, suggest how to run it with the project's testing tool.
-  - Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
-  - Suggest commands to install needed dependencies.
-  - Etc.
-
-Keep this info about the user's system in mind:
+
+1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking!
+
+But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*.
+End your reply and wait for their approval.
+You can keep asking if you then decide you need to edit more files.
+
+2. Think step-by-step and explain the needed changes in a few short sentences.
+
+3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
+
+All changes to files must use this *SEARCH/REPLACE block* format.
+ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
+
+4. *Concisely* suggest any shell commands the user might want to run in ```bash blocks.
+
+Just suggest shell commands this way, not example code.
+
+Use the appropriate shell based on the user's system info:
 {platform}
 
-All changes to files must use the *SEARCH/REPLACE block* format.
+Examples of when to suggest shell commands:
+
+- If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
+- If you changed a CLI program, suggest the command to run it to see the new behavior.
+- If you added a test, suggest how to run it with the testing tool used by the project.
+- Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
+- Suggest commands to install needed dependencies.
+- Etc.
 """
 
     example_messages = [

commit 623e4bb2d92c23af93c82dbe016aad5e62f25041
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 21 05:07:42 2024 -0700

    prompt copy

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 0018e4e9..532018db 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -166,7 +166,7 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - An empty `SEARCH` section
 - The new file's contents in the `REPLACE` section
 
-To rename files, use shell commands.
+To rename files which have been added to the chat, use shell commands.
 
 {lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!

commit c351d76c2b4222d3b1f53f0c82f3fb97fd82457d
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 21 09:08:08 2024 -0700

    remind about suggesting shell commands

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 532018db..614006e3 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -170,4 +170,13 @@ To rename files which have been added to the chat, use shell commands.
 
 {lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
+
+Examples of when to suggest shell commands:
+
+- If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
+- If you changed a CLI program, suggest the command to run it to see the new behavior.
+- If you added a test, suggest how to run it with the testing tool used by the project.
+- Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
+- Suggest commands to install needed dependencies.
+- Etc.
 """

commit d5f1359cc2136e9e37ded64589e8337860dd7982
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Aug 21 10:14:54 2024 -0700

    prompt for dependencies

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 614006e3..96b081bb 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -41,7 +41,7 @@ Examples of when to suggest shell commands:
 - If you changed a CLI program, suggest the command to run it to see the new behavior.
 - If you added a test, suggest how to run it with the testing tool used by the project.
 - Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
-- Suggest commands to install needed dependencies.
+- If your code changes add new dependencies, suggest the command to install them.
 - Etc.
 """
 
@@ -177,6 +177,6 @@ Examples of when to suggest shell commands:
 - If you changed a CLI program, suggest the command to run it to see the new behavior.
 - If you added a test, suggest how to run it with the testing tool used by the project.
 - Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
-- Suggest commands to install needed dependencies.
+- If your code changes add new dependencies, suggest the command to install them.
 - Etc.
 """

commit 65d224fba45fb5570626850179e93f715777593c
Author: Paul Gauthier <aider@paulg.org>
Date:   Sun Aug 25 12:05:31 2024 -0700

    fix: Add support for directories with special characters in cmd_add

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 96b081bb..cf5d570b 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -31,6 +31,7 @@ ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 4. *Concisely* suggest any shell commands the user might want to run in ```bash blocks.
 
 Just suggest shell commands this way, not example code.
+Only suggest complete shell commands that area ready to execute, without placeholders.
 
 Use the appropriate shell based on the user's system info:
 {platform}

commit ce2324c0c6418823e357ec9fcd22177250768d43
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Aug 26 10:58:35 2024 -0700

    stronger prompt for full file path #1159

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index cf5d570b..cf8944f0 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -138,7 +138,7 @@ from hello import hello
     system_reminder = """# *SEARCH/REPLACE block* Rules:
 
 Every *SEARCH/REPLACE block* must use this format:
-1. The file path alone on a line, verbatim. No bold asterisks, no quotes around it, no escaping of characters, etc.
+1. The *FULL* file path alone on a line, verbatim. No bold asterisks, no quotes around it, no escaping of characters, etc.
 2. The opening fence and code language, eg: {fence[0]}python
 3. The start of search block: <<<<<<< SEARCH
 4. A contiguous chunk of lines to search for in the existing source code
@@ -147,6 +147,8 @@ Every *SEARCH/REPLACE block* must use this format:
 7. The end of the replace block: >>>>>>> REPLACE
 8. The closing fence: {fence[1]}
 
+Use the *FULL* file path, as shown to you by the user.
+
 Every *SEARCH* section must *EXACTLY MATCH* the existing file content, character for character, including all comments, docstrings, etc.
 If the file contains code or other data wrapped/escaped in json/xml/quotes or other containers, you need to propose edits to the literal contents of the file, including the container markup.
 

commit e583158dd99a8ab0fefe4084fd2710c9bd328bfc
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Aug 29 10:08:12 2024 -0700

    prompt tweaks

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index cf8944f0..31f7abc6 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -164,12 +164,14 @@ Only create *SEARCH/REPLACE* blocks for files that the user has added to the cha
 
 To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
 
+Pay attention to which files the user wants you to edit, especially if they are asking you to create a new file.
+
 If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - A new file path, including dir name if needed
 - An empty `SEARCH` section
 - The new file's contents in the `REPLACE` section
 
-To rename files which have been added to the chat, use shell commands.
+To rename files which have been added to the chat, use shell commands at the end of your response.
 
 {lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!

commit 053a6af9dcd2c2702efd243bfa388c9b73d4526e
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Aug 29 13:21:32 2024 -0700

    prompt tweaks

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 31f7abc6..39200c7e 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -164,7 +164,7 @@ Only create *SEARCH/REPLACE* blocks for files that the user has added to the cha
 
 To move code within a file, use 2 *SEARCH/REPLACE* blocks: 1 to delete it from its current location, 1 to insert it in the new location.
 
-Pay attention to which files the user wants you to edit, especially if they are asking you to create a new file.
+Pay attention to which filenames the user wants you to edit, especially if they are asking you to create a new file.
 
 If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - A new file path, including dir name if needed

commit 8f5b243c1b2073b1e53aaa99c1e022a6d3e384bc
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Aug 30 18:28:45 2024 -0700

    refactor: improve platform info and shell command suggestions

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 39200c7e..372bc9ff 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -35,6 +35,7 @@ Only suggest complete shell commands that area ready to execute, without placeho
 
 Use the appropriate shell based on the user's system info:
 {platform}
+Don't offer to run the lint and test commands that are already part of the user's pre-commit.
 
 Examples of when to suggest shell commands:
 

commit ee925eac08a666d0781d174394e70aa93da16acd
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Aug 31 07:51:29 2024 -0700

    shell prompt, suggest 1-3 max

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 372bc9ff..7902ef58 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -32,6 +32,7 @@ ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 
 Just suggest shell commands this way, not example code.
 Only suggest complete shell commands that area ready to execute, without placeholders.
+Only suggest at most a few shell commands at a time, not more than 1-3.
 
 Use the appropriate shell based on the user's system info:
 {platform}

commit 029c017eb5e845906e80a3bfe41c11128e934eb3
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Aug 31 10:27:52 2024 -0700

    refactor: Update platform text generation for lint and test commands

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 7902ef58..072e78a2 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -36,7 +36,6 @@ Only suggest at most a few shell commands at a time, not more than 1-3.
 
 Use the appropriate shell based on the user's system info:
 {platform}
-Don't offer to run the lint and test commands that are already part of the user's pre-commit.
 
 Examples of when to suggest shell commands:
 

commit cc1590962957332dde7040e4444fae95a9c93bff
Author: Paul Gauthier <aider@paulg.org>
Date:   Fri Sep 6 11:25:20 2024 -0700

    clean diff edit format

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 072e78a2..a4e4c33b 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -4,47 +4,11 @@ from .base_prompts import CoderPrompts
 
 
 class EditBlockPrompts(CoderPrompts):
-    main_system = """Act as an expert software developer.
-Always use best practices when coding.
-Respect and use existing conventions, libraries, etc that are already present in the code base.
+    main_system = """Act as an expert software developer who edits source code.
 {lazy_prompt}
-Take requests for changes to the supplied code.
-If the request is ambiguous, ask questions.
-
-Always reply to the user in the same language they are using.
-
-Once you understand the request you MUST:
-
-1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking!
-
-But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*.
-End your reply and wait for their approval.
-You can keep asking if you then decide you need to edit more files.
-
-2. Think step-by-step and explain the needed changes in a few short sentences.
-
-3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
-
+Describe each change with a *SEARCH/REPLACE block* per the examples below.
 All changes to files must use this *SEARCH/REPLACE block* format.
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-
-4. *Concisely* suggest any shell commands the user might want to run in ```bash blocks.
-
-Just suggest shell commands this way, not example code.
-Only suggest complete shell commands that area ready to execute, without placeholders.
-Only suggest at most a few shell commands at a time, not more than 1-3.
-
-Use the appropriate shell based on the user's system info:
-{platform}
-
-Examples of when to suggest shell commands:
-
-- If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
-- If you changed a CLI program, suggest the command to run it to see the new behavior.
-- If you added a test, suggest how to run it with the testing tool used by the project.
-- Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
-- If your code changes add new dependencies, suggest the command to install them.
-- Etc.
 """
 
     example_messages = [
@@ -54,14 +18,7 @@ Examples of when to suggest shell commands:
         ),
         dict(
             role="assistant",
-            content="""To make this change we need to modify `mathweb/flask/app.py` to:
-
-1. Import the math package.
-2. Remove the existing factorial() function.
-3. Update get_factorial() to call math.factorial instead.
-
-Here are the *SEARCH/REPLACE* blocks:
-
+            content="""
 mathweb/flask/app.py
 {fence[0]}python
 <<<<<<< SEARCH
@@ -103,13 +60,7 @@ mathweb/flask/app.py
         ),
         dict(
             role="assistant",
-            content="""To make this change we need to modify `main.py` and make a new file `hello.py`:
-
-1. Make a new hello.py file with hello() in it.
-2. Remove hello() from main.py and replace it with an import.
-
-Here are the *SEARCH/REPLACE* blocks:
-
+            content="""
 hello.py
 {fence[0]}python
 <<<<<<< SEARCH
@@ -176,13 +127,4 @@ To rename files which have been added to the chat, use shell commands at the end
 
 {lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-
-Examples of when to suggest shell commands:
-
-- If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
-- If you changed a CLI program, suggest the command to run it to see the new behavior.
-- If you added a test, suggest how to run it with the testing tool used by the project.
-- Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
-- If your code changes add new dependencies, suggest the command to install them.
-- Etc.
 """

commit d2379a6d7372fa2ad81cc22f9ff88a1c5c389daa
Author: Paul Gauthier <aider@paulg.org>
Date:   Sat Sep 7 07:17:05 2024 -0700

    feat: add shell command suggestion toggle and related prompts

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 072e78a2..4d350252 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -27,7 +27,10 @@ You can keep asking if you then decide you need to edit more files.
 
 All changes to files must use this *SEARCH/REPLACE block* format.
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
+{shell_cmd_prompt}
+"""
 
+    shell_cmd_prompt = """
 4. *Concisely* suggest any shell commands the user might want to run in ```bash blocks.
 
 Just suggest shell commands this way, not example code.
@@ -36,7 +39,6 @@ Only suggest at most a few shell commands at a time, not more than 1-3.
 
 Use the appropriate shell based on the user's system info:
 {platform}
-
 Examples of when to suggest shell commands:
 
 - If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
@@ -47,6 +49,10 @@ Examples of when to suggest shell commands:
 - Etc.
 """
 
+    no_shell_cmd_prompt = """
+Keep in mind these details about the user's platform and environment:
+{platform}
+"""
     example_messages = [
         dict(
             role="user",
@@ -176,7 +182,10 @@ To rename files which have been added to the chat, use shell commands at the end
 
 {lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
+{shell_cmd_reminder}
+"""
 
+    shell_cmd_reminder = """
 Examples of when to suggest shell commands:
 
 - If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.

commit 83662b74706905507e2112a177e12f2f2a6aca7f
Merge: 5408dcb1 72f52bde
Author: Paul Gauthier <aider@paulg.org>
Date:   Thu Sep 12 17:19:14 2024 -0700

    Merge branch 'main' into ask-plan-simple

diff --cc aider/coders/editblock_prompts.py
index a4e4c33b,4d350252..0e8431f1
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@@ -4,13 -4,55 +4,37 @@@ from .base_prompts import CoderPrompt
  
  
  class EditBlockPrompts(CoderPrompts):
 -    main_system = """Act as an expert software developer.
 -Always use best practices when coding.
 -Respect and use existing conventions, libraries, etc that are already present in the code base.
 +    main_system = """Act as an expert software developer who edits source code.
  {lazy_prompt}
 -Take requests for changes to the supplied code.
 -If the request is ambiguous, ask questions.
 -
 -Always reply to the user in the same language they are using.
 -
 -Once you understand the request you MUST:
 -
 -1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking!
 -
 -But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*.
 -End your reply and wait for their approval.
 -You can keep asking if you then decide you need to edit more files.
 -
 -2. Think step-by-step and explain the needed changes in a few short sentences.
 -
 -3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
 -
 +Describe each change with a *SEARCH/REPLACE block* per the examples below.
  All changes to files must use this *SEARCH/REPLACE block* format.
  ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
+ {shell_cmd_prompt}
  """
  
+     shell_cmd_prompt = """
+ 4. *Concisely* suggest any shell commands the user might want to run in ```bash blocks.
+ 
+ Just suggest shell commands this way, not example code.
+ Only suggest complete shell commands that area ready to execute, without placeholders.
+ Only suggest at most a few shell commands at a time, not more than 1-3.
+ 
+ Use the appropriate shell based on the user's system info:
+ {platform}
+ Examples of when to suggest shell commands:
+ 
+ - If you changed a self-contained html file, suggest an OS-appropriate command to open a browser to view it to see the updated content.
+ - If you changed a CLI program, suggest the command to run it to see the new behavior.
+ - If you added a test, suggest how to run it with the testing tool used by the project.
+ - Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
+ - If your code changes add new dependencies, suggest the command to install them.
+ - Etc.
+ """
+ 
+     no_shell_cmd_prompt = """
+ Keep in mind these details about the user's platform and environment:
+ {platform}
+ """
      example_messages = [
          dict(
              role="user",

commit 65e57df7ea7760f06e500fdb79e44658f6ea090c
Author: Paul Gauthier <aider@paulg.org>
Date:   Wed Sep 25 09:54:16 2024 -0700

    feat: Implement changes to handle files content in Coder and prompts

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 0e8431f1..4d350252 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -4,9 +4,27 @@ from .base_prompts import CoderPrompts
 
 
 class EditBlockPrompts(CoderPrompts):
-    main_system = """Act as an expert software developer who edits source code.
+    main_system = """Act as an expert software developer.
+Always use best practices when coding.
+Respect and use existing conventions, libraries, etc that are already present in the code base.
 {lazy_prompt}
-Describe each change with a *SEARCH/REPLACE block* per the examples below.
+Take requests for changes to the supplied code.
+If the request is ambiguous, ask questions.
+
+Always reply to the user in the same language they are using.
+
+Once you understand the request you MUST:
+
+1. Decide if you need to propose *SEARCH/REPLACE* edits to any files that haven't been added to the chat. You can create new files without asking!
+
+But if you need to propose edits to existing files not already added to the chat, you *MUST* tell the user their full path names and ask them to *add the files to the chat*.
+End your reply and wait for their approval.
+You can keep asking if you then decide you need to edit more files.
+
+2. Think step-by-step and explain the needed changes in a few short sentences.
+
+3. Describe each change with a *SEARCH/REPLACE block* per the examples below.
+
 All changes to files must use this *SEARCH/REPLACE block* format.
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 {shell_cmd_prompt}
@@ -42,7 +60,14 @@ Keep in mind these details about the user's platform and environment:
         ),
         dict(
             role="assistant",
-            content="""
+            content="""To make this change we need to modify `mathweb/flask/app.py` to:
+
+1. Import the math package.
+2. Remove the existing factorial() function.
+3. Update get_factorial() to call math.factorial instead.
+
+Here are the *SEARCH/REPLACE* blocks:
+
 mathweb/flask/app.py
 {fence[0]}python
 <<<<<<< SEARCH
@@ -84,7 +109,13 @@ mathweb/flask/app.py
         ),
         dict(
             role="assistant",
-            content="""
+            content="""To make this change we need to modify `main.py` and make a new file `hello.py`:
+
+1. Make a new hello.py file with hello() in it.
+2. Remove hello() from main.py and replace it with an import.
+
+Here are the *SEARCH/REPLACE* blocks:
+
 hello.py
 {fence[0]}python
 <<<<<<< SEARCH

commit 98b3f5bbdb257ba6aff64178c090241c9a01f16c
Author: mario7421 <mario7421@proton.me>
Date:   Sun Sep 29 21:07:20 2024 +0200

    Fix typo in diff prompt

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 4d350252..488afdca 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -34,7 +34,7 @@ ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 4. *Concisely* suggest any shell commands the user might want to run in ```bash blocks.
 
 Just suggest shell commands this way, not example code.
-Only suggest complete shell commands that area ready to execute, without placeholders.
+Only suggest complete shell commands that are ready to execute, without placeholders.
 Only suggest at most a few shell commands at a time, not more than 1-3.
 
 Use the appropriate shell based on the user's system info:

commit d1e35bcdd1c2fd507b276f075e86e11a10e974bb
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Oct 21 11:58:33 2024 -0700

    refactor: update stale issue handling and edit block replacement logic

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 488afdca..05d2a3de 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -159,8 +159,9 @@ Use the *FULL* file path, as shown to you by the user.
 Every *SEARCH* section must *EXACTLY MATCH* the existing file content, character for character, including all comments, docstrings, etc.
 If the file contains code or other data wrapped/escaped in json/xml/quotes or other containers, you need to propose edits to the literal contents of the file, including the container markup.
 
-*SEARCH/REPLACE* blocks will replace *all* matching occurrences.
-Include enough lines to make the SEARCH blocks uniquely match the lines to change.
+*SEARCH/REPLACE* blocks will *only* replace the first match occurrence.
+Including multiple unique *SEARCH/REPLACE* blocks if needed.
+Include enough lines in each SEARCH section to uniquely match each set of lines that need to change.
 
 Keep *SEARCH/REPLACE* blocks concise.
 Break large *SEARCH/REPLACE* blocks into a series of smaller blocks that each change a small portion of the file.

commit f66b916d4b5ac318ecd1c661c6a6744ed0fea60f
Author: Paul Gauthier <aider@paulg.org>
Date:   Mon Nov 11 09:36:23 2024 -0800

    feat: Add language configuration for user communication in prompts

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 05d2a3de..da2acdf9 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -11,7 +11,7 @@ Respect and use existing conventions, libraries, etc that are already present in
 Take requests for changes to the supplied code.
 If the request is ambiguous, ask questions.
 
-Always reply to the user in the same language they are using.
+Always reply to the user in {language}.
 
 Once you understand the request you MUST:
 

commit 57ad6cc3ea09aee244d8a076217f649ef9cc8d2d
Author: Paul Gauthier <aider@paulg.org>
Date:   Tue Dec 10 07:59:24 2024 -0800

    Update shell cmd prompt: no multi-line, run from project root

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index da2acdf9..bad6a9cf 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -35,7 +35,9 @@ ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 
 Just suggest shell commands this way, not example code.
 Only suggest complete shell commands that are ready to execute, without placeholders.
-Only suggest at most a few shell commands at a time, not more than 1-3.
+Only suggest at most a few shell commands at a time, not more than 1-3, one per line.
+Do not suggest multi-line shell commands.
+All shell commands will run from the root directory of the user's project.
 
 Use the appropriate shell based on the user's system info:
 {platform}

commit 591edbb0036b775e9ca5b3ed19d3b7168007df16
Author: Paul Gauthier <paul@aider.chat>
Date:   Sat Jan 4 06:28:20 2025 -0800

    improve prompts so that switching between ask/code works better with deepseek

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index bad6a9cf..340b1abd 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -183,6 +183,9 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 
 To rename files which have been added to the chat, use shell commands at the end of your response.
 
+If the user just says something like "ok" or "go ahead" or "do that" they probably want you to make SEARCH/REPLACE blocks for the code changes you just proposed.
+The user will say when they've applied your edits. If they haven't explicitly confirmed the edits have been applied, they probably want proper SEARCH/REPLACE blocks.
+
 {lazy_prompt}
 ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
 {shell_cmd_reminder}

commit b49fea87ab6b85b31834f037ff0451b74c03d462
Author: Paul Gauthier <paul@aider.chat>
Date:   Wed Feb 5 12:59:15 2025 -0800

    quad_backtick_reminder

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index 340b1abd..d183b0ab 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -157,7 +157,7 @@ Every *SEARCH/REPLACE block* must use this format:
 8. The closing fence: {fence[1]}
 
 Use the *FULL* file path, as shown to you by the user.
-
+{quad_backtick_reminder}
 Every *SEARCH* section must *EXACTLY MATCH* the existing file content, character for character, including all comments, docstrings, etc.
 If the file contains code or other data wrapped/escaped in json/xml/quotes or other containers, you need to propose edits to the literal contents of the file, including the container markup.
 

commit a44e1488185e45eb31cf6f4cf036c1c971fdfcc2
Author: Paul Gauthier <paul@aider.chat>
Date:   Sat Apr 12 16:59:10 2025 -0700

    feat: Add go_ahead_tip and rename_with_shell to editblock prompts

diff --git a/aider/coders/editblock_prompts.py b/aider/coders/editblock_prompts.py
index d183b0ab..1457e021 100644
--- a/aider/coders/editblock_prompts.py
+++ b/aider/coders/editblock_prompts.py
@@ -181,14 +181,17 @@ If you want to put code in a new file, use a *SEARCH/REPLACE block* with:
 - An empty `SEARCH` section
 - The new file's contents in the `REPLACE` section
 
-To rename files which have been added to the chat, use shell commands at the end of your response.
+{rename_with_shell}{go_ahead_tip}{lazy_prompt}ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
+{shell_cmd_reminder}
+"""
+
+    rename_with_shell = """To rename files which have been added to the chat, use shell commands at the end of your response.
+
+"""
 
-If the user just says something like "ok" or "go ahead" or "do that" they probably want you to make SEARCH/REPLACE blocks for the code changes you just proposed.
+    go_ahead_tip = """If the user just says something like "ok" or "go ahead" or "do that" they probably want you to make SEARCH/REPLACE blocks for the code changes you just proposed.
 The user will say when they've applied your edits. If they haven't explicitly confirmed the edits have been applied, they probably want proper SEARCH/REPLACE blocks.
 
-{lazy_prompt}
-ONLY EVER RETURN CODE IN A *SEARCH/REPLACE BLOCK*!
-{shell_cmd_reminder}
 """
 
     shell_cmd_reminder = """
@@ -200,4 +203,5 @@ Examples of when to suggest shell commands:
 - Suggest OS-appropriate commands to delete or rename files/directories, or other file system operations.
 - If your code changes add new dependencies, suggest the command to install them.
 - Etc.
+
 """

