# Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js

commit ec7ef50e8b7a61639d5b622e9e675602120e2e96
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 13 11:37:25 2019 -0700

    Reorganized things again into packages

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
new file mode 100644
index 0000000000..5e2385b33b
--- /dev/null
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -0,0 +1,223 @@
+// @flow
+
+import type { FrontendBridge } from 'src/bridge';
+import type Store from 'src/devtools/store';
+
+describe('Store component filters', () => {
+  let React;
+  let ReactDOM;
+  let TestUtils;
+  let Types;
+  let bridge: FrontendBridge;
+  let store: Store;
+  let utils;
+
+  const act = (callback: Function) => {
+    TestUtils.act(() => {
+      callback();
+    });
+    jest.runAllTimers(); // Flush Bridge operations
+  };
+
+  beforeEach(() => {
+    bridge = global.bridge;
+    store = global.store;
+    store.collapseNodesByDefault = false;
+    store.componentFilters = [];
+    store.recordChangeDescriptions = true;
+
+    React = require('react');
+    ReactDOM = require('react-dom');
+    TestUtils = require('react-dom/test-utils');
+    Types = require('src/types');
+    utils = require('./utils');
+  });
+
+  it('should throw if filters are updated while profiling', () => {
+    act(() => store.profilerStore.startProfiling());
+    expect(() => (store.componentFilters = [])).toThrow(
+      'Cannot modify filter preferences while profiling'
+    );
+  });
+
+  it('should support filtering by element type', () => {
+    class Root extends React.Component<{| children: React$Node |}> {
+      render() {
+        return <div>{this.props.children}</div>;
+      }
+    }
+    const Component = () => <div>Hi</div>;
+
+    act(() =>
+      ReactDOM.render(
+        <Root>
+          <Component />
+        </Root>,
+        document.createElement('div')
+      )
+    );
+    expect(store).toMatchSnapshot('1: mount');
+
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createElementTypeFilter(Types.ElementTypeHostComponent),
+        ])
+    );
+
+    expect(store).toMatchSnapshot('2: hide host components');
+
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createElementTypeFilter(Types.ElementTypeClass),
+        ])
+    );
+
+    expect(store).toMatchSnapshot('3: hide class components');
+
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createElementTypeFilter(Types.ElementTypeClass),
+          utils.createElementTypeFilter(Types.ElementTypeFunction),
+        ])
+    );
+
+    expect(store).toMatchSnapshot('4: hide class and function components');
+
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createElementTypeFilter(Types.ElementTypeClass, false),
+          utils.createElementTypeFilter(Types.ElementTypeFunction, false),
+        ])
+    );
+
+    expect(store).toMatchSnapshot('5: disable all filters');
+  });
+
+  it('should ignore invalid ElementTypeRoot filter', () => {
+    const Root = () => <div>Hi</div>;
+
+    act(() => ReactDOM.render(<Root />, document.createElement('div')));
+    expect(store).toMatchSnapshot('1: mount');
+
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createElementTypeFilter(Types.ElementTypeRoot),
+        ])
+    );
+
+    expect(store).toMatchSnapshot('2: add invalid filter');
+  });
+
+  it('should filter by display name', () => {
+    const Text = ({ label }) => label;
+    const Foo = () => <Text label="foo" />;
+    const Bar = () => <Text label="bar" />;
+    const Baz = () => <Text label="baz" />;
+
+    act(() =>
+      ReactDOM.render(
+        <React.Fragment>
+          <Foo />
+          <Bar />
+          <Baz />
+        </React.Fragment>,
+        document.createElement('div')
+      )
+    );
+    expect(store).toMatchSnapshot('1: mount');
+
+    act(
+      () => (store.componentFilters = [utils.createDisplayNameFilter('Foo')])
+    );
+    expect(store).toMatchSnapshot('2: filter "Foo"');
+
+    act(() => (store.componentFilters = [utils.createDisplayNameFilter('Ba')]));
+    expect(store).toMatchSnapshot('3: filter "Ba"');
+
+    act(
+      () => (store.componentFilters = [utils.createDisplayNameFilter('B.z')])
+    );
+    expect(store).toMatchSnapshot('4: filter "B.z"');
+  });
+
+  it('should filter by path', () => {
+    const Component = () => <div>Hi</div>;
+
+    act(() => ReactDOM.render(<Component />, document.createElement('div')));
+    expect(store).toMatchSnapshot('1: mount');
+
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createLocationFilter(__filename.replace(__dirname, '')),
+        ])
+    );
+
+    expect(store).toMatchSnapshot(
+      '2: hide all components declared within this test filed'
+    );
+
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createLocationFilter('this:is:a:made:up:path'),
+        ])
+    );
+
+    expect(store).toMatchSnapshot('3: hide components in a made up fake path');
+  });
+
+  it('should filter HOCs', () => {
+    const Component = () => <div>Hi</div>;
+    const Foo = () => <Component />;
+    Foo.displayName = 'Foo(Component)';
+    const Bar = () => <Foo />;
+    Bar.displayName = 'Bar(Foo(Component))';
+
+    act(() => ReactDOM.render(<Bar />, document.createElement('div')));
+    expect(store).toMatchSnapshot('1: mount');
+
+    act(() => (store.componentFilters = [utils.createHOCFilter(true)]));
+
+    expect(store).toMatchSnapshot('2: hide all HOCs');
+
+    act(() => (store.componentFilters = [utils.createHOCFilter(false)]));
+
+    expect(store).toMatchSnapshot('3: disable HOC filter');
+  });
+
+  it('should not send a bridge update if the set of enabled filters has not changed', () => {
+    act(() => (store.componentFilters = [utils.createHOCFilter(true)]));
+
+    bridge.addListener('updateComponentFilters', componentFilters => {
+      throw Error('Unexpected component update');
+    });
+
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createHOCFilter(false),
+          utils.createHOCFilter(true),
+        ])
+    );
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createHOCFilter(true),
+          utils.createLocationFilter('abc', false),
+        ])
+    );
+    act(
+      () =>
+        (store.componentFilters = [
+          utils.createHOCFilter(true),
+          utils.createElementTypeFilter(Types.ElementTypeHostComponent, false),
+        ])
+    );
+  });
+});

commit 08743b1a8e012c1a36ba99391c6332e462b808b2
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 13 15:59:43 2019 -0700

    Reorganized folders into packages/*

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 5e2385b33b..11f54ad301 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -1,7 +1,7 @@
 // @flow
 
-import type { FrontendBridge } from 'src/bridge';
-import type Store from 'src/devtools/store';
+import type { FrontendBridge } from 'react-devtools-shared/src/bridge';
+import type Store from 'react-devtools-shared/src/devtools/store';
 
 describe('Store component filters', () => {
   let React;
@@ -29,7 +29,7 @@ describe('Store component filters', () => {
     React = require('react');
     ReactDOM = require('react-dom');
     TestUtils = require('react-dom/test-utils');
-    Types = require('src/types');
+    Types = require('react-devtools-shared/src/types');
     utils = require('./utils');
   });
 

commit 183f96f2ac35c36772781cb37bc3ce842e2dc78b
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 13 17:58:03 2019 -0700

    Prettier

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 11f54ad301..a5dcfdb5a3 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -1,6 +1,6 @@
 // @flow
 
-import type { FrontendBridge } from 'react-devtools-shared/src/bridge';
+import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
 import type Store from 'react-devtools-shared/src/devtools/store';
 
 describe('Store component filters', () => {
@@ -36,12 +36,12 @@ describe('Store component filters', () => {
   it('should throw if filters are updated while profiling', () => {
     act(() => store.profilerStore.startProfiling());
     expect(() => (store.componentFilters = [])).toThrow(
-      'Cannot modify filter preferences while profiling'
+      'Cannot modify filter preferences while profiling',
     );
   });
 
   it('should support filtering by element type', () => {
-    class Root extends React.Component<{| children: React$Node |}> {
+    class Root extends React.Component<{|children: React$Node|}> {
       render() {
         return <div>{this.props.children}</div>;
       }
@@ -53,8 +53,8 @@ describe('Store component filters', () => {
         <Root>
           <Component />
         </Root>,
-        document.createElement('div')
-      )
+        document.createElement('div'),
+      ),
     );
     expect(store).toMatchSnapshot('1: mount');
 
@@ -62,7 +62,7 @@ describe('Store component filters', () => {
       () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeHostComponent),
-        ])
+        ]),
     );
 
     expect(store).toMatchSnapshot('2: hide host components');
@@ -71,7 +71,7 @@ describe('Store component filters', () => {
       () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass),
-        ])
+        ]),
     );
 
     expect(store).toMatchSnapshot('3: hide class components');
@@ -81,7 +81,7 @@ describe('Store component filters', () => {
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass),
           utils.createElementTypeFilter(Types.ElementTypeFunction),
-        ])
+        ]),
     );
 
     expect(store).toMatchSnapshot('4: hide class and function components');
@@ -91,7 +91,7 @@ describe('Store component filters', () => {
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass, false),
           utils.createElementTypeFilter(Types.ElementTypeFunction, false),
-        ])
+        ]),
     );
 
     expect(store).toMatchSnapshot('5: disable all filters');
@@ -107,14 +107,14 @@ describe('Store component filters', () => {
       () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeRoot),
-        ])
+        ]),
     );
 
     expect(store).toMatchSnapshot('2: add invalid filter');
   });
 
   it('should filter by display name', () => {
-    const Text = ({ label }) => label;
+    const Text = ({label}) => label;
     const Foo = () => <Text label="foo" />;
     const Bar = () => <Text label="bar" />;
     const Baz = () => <Text label="baz" />;
@@ -126,13 +126,13 @@ describe('Store component filters', () => {
           <Bar />
           <Baz />
         </React.Fragment>,
-        document.createElement('div')
-      )
+        document.createElement('div'),
+      ),
     );
     expect(store).toMatchSnapshot('1: mount');
 
     act(
-      () => (store.componentFilters = [utils.createDisplayNameFilter('Foo')])
+      () => (store.componentFilters = [utils.createDisplayNameFilter('Foo')]),
     );
     expect(store).toMatchSnapshot('2: filter "Foo"');
 
@@ -140,7 +140,7 @@ describe('Store component filters', () => {
     expect(store).toMatchSnapshot('3: filter "Ba"');
 
     act(
-      () => (store.componentFilters = [utils.createDisplayNameFilter('B.z')])
+      () => (store.componentFilters = [utils.createDisplayNameFilter('B.z')]),
     );
     expect(store).toMatchSnapshot('4: filter "B.z"');
   });
@@ -155,18 +155,18 @@ describe('Store component filters', () => {
       () =>
         (store.componentFilters = [
           utils.createLocationFilter(__filename.replace(__dirname, '')),
-        ])
+        ]),
     );
 
     expect(store).toMatchSnapshot(
-      '2: hide all components declared within this test filed'
+      '2: hide all components declared within this test filed',
     );
 
     act(
       () =>
         (store.componentFilters = [
           utils.createLocationFilter('this:is:a:made:up:path'),
-        ])
+        ]),
     );
 
     expect(store).toMatchSnapshot('3: hide components in a made up fake path');
@@ -203,21 +203,21 @@ describe('Store component filters', () => {
         (store.componentFilters = [
           utils.createHOCFilter(false),
           utils.createHOCFilter(true),
-        ])
+        ]),
     );
     act(
       () =>
         (store.componentFilters = [
           utils.createHOCFilter(true),
           utils.createLocationFilter('abc', false),
-        ])
+        ]),
     );
     act(
       () =>
         (store.componentFilters = [
           utils.createHOCFilter(true),
           utils.createElementTypeFilter(Types.ElementTypeHostComponent, false),
-        ])
+        ]),
     );
   });
 });

commit 8e1434e80e203ebd2cd066772d68f121808c83aa
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Tue Aug 27 10:54:01 2019 -0700

    Added FB copyright header

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index a5dcfdb5a3..341e06b04d 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -1,4 +1,11 @@
-// @flow
+/**
+ * Copyright (c) Facebook, Inc. and its affiliates.
+ *
+ * This source code is licensed under the MIT license found in the
+ * LICENSE file in the root directory of this source tree.
+ *
+ * @flow
+ */
 
 import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
 import type Store from 'react-devtools-shared/src/devtools/store';

commit d17086c7c813402a550d15a2f56dc43f1dbd1735
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Sep 8 10:11:45 2020 -0500

    Decouple public, internal act implementation (#19745)
    
    In the next major release, we intend to drop support for using the `act`
    testing helper in production. (It already fires a warning.) The
    rationale is that, in order for `act` to work, you must either mock the
    testing environment or add extra logic at runtime. Mocking the testing
    environment isn't ideal because it requires extra set up for the user.
    Extra logic at runtime is fine only in development mode — we don't want
    to slow down the production builds.
    
    Since most people only run their tests in development mode, dropping
    support for production should be fine; if there's demand, we can add it
    back later using a special testing build that is identical to the
    production build except for the additional testing logic.
    
    One blocker for removing production support is that we currently use
    `act` to test React itself. We must test React in both development and
    production modes.
    
    So, the solution is to fork `act` into separate public and
    internal implementations:
    
    - *public implementation of `act`* – exposed to users, only works in
      development mode, uses special runtime logic, does not support partial
      rendering
    - *internal implementation of `act`* – private, works in both
      development and productionm modes, only used by the React Core test
      suite, uses no special runtime logic, supports partial rendering (i.e.
      `toFlushAndYieldThrough`)
    
    The internal implementation should mostly match the public
    implementation's behavior, but since it's a private API, it doesn't have
    to match exactly. It works by mocking the test environment: it uses a
    mock build of Scheduler to flush rendering tasks, and Jest's mock timers
    to flush Suspense placeholders.
    
    ---
    
    In this first commit, I've added the internal forks of `act` and
    migrated our tests to use them. The public `act` implementation is
    unaffected for now; I will leave refactoring/clean-up for a later step.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 341e06b04d..1a5be03f09 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -20,7 +20,7 @@ describe('Store component filters', () => {
   let utils;
 
   const act = (callback: Function) => {
-    TestUtils.act(() => {
+    TestUtils.unstable_concurrentAct(() => {
       callback();
     });
     jest.runAllTimers(); // Flush Bridge operations

commit e614e6965749c096c9db0e6ad2844a2803ebdcb6
Author: IDrissAitHafid <31975500+IDrissAitHafid@users.noreply.github.com>
Date:   Tue Oct 13 18:38:58 2020 +0100

    handled a missing suspense fiber when suspense is filtered on the profiler (#19987)
    
    Co-authored-by: Brian Vaughn <bvaughn@fb.com>

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 1a5be03f09..bfbf3e9821 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -227,4 +227,34 @@ describe('Store component filters', () => {
         ]),
     );
   });
+
+  it('should not break when Suspense nodes are filtered from the tree', () => {
+    const promise = new Promise(() => {});
+
+    const Loading = () => <div>Loading...</div>;
+
+    const Component = ({shouldSuspend}) => {
+      if (shouldSuspend) {
+        throw promise;
+      }
+      return null;
+    };
+
+    const Wrapper = ({shouldSuspend}) => (
+      <React.Suspense fallback={<Loading />}>
+        <Component shouldSuspend={shouldSuspend} />
+      </React.Suspense>
+    );
+
+    store.componentFilters = [
+      utils.createElementTypeFilter(Types.ElementTypeSuspense),
+    ];
+
+    const container = document.createElement('div');
+    act(() => ReactDOM.render(<Wrapper shouldSuspend={true} />, container));
+    expect(store).toMatchSnapshot('1: suspended');
+
+    act(() => ReactDOM.render(<Wrapper shouldSuspend={false} />, container));
+    expect(store).toMatchSnapshot('2: resolved');
+  });
 });

commit 2eb3181eb4247077eafc4df98d06d7a999ecf5d8
Author: IDrissAitHafid <31975500+IDrissAitHafid@users.noreply.github.com>
Date:   Thu Oct 15 19:45:23 2020 +0100

    fixed unfound node error when Suspense is filtered (#20019)
    
    * fixed unfound node error when Suspense is filtered
    
    * added a test for filtered Suspense node

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index bfbf3e9821..a8a0e151ef 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -256,5 +256,8 @@ describe('Store component filters', () => {
 
     act(() => ReactDOM.render(<Wrapper shouldSuspend={false} />, container));
     expect(store).toMatchSnapshot('2: resolved');
+
+    act(() => ReactDOM.render(<Wrapper shouldSuspend={true} />, container));
+    expect(store).toMatchSnapshot('3: suspended');
   });
 });

commit 09a2c363a5175291ecdcbf7f39b0d165bc7da8ec
Author: Sebastian Silbermann <silbermann.sebastian@gmail.com>
Date:   Tue Dec 22 17:09:29 2020 +0100

    Expose DEV-mode warnings in devtools UI (#20463)
    
    Co-authored-by: Brian Vaughn <bvaughn@fb.com>

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index a8a0e151ef..4a365acb0e 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -48,22 +48,28 @@ describe('Store component filters', () => {
   });
 
   it('should support filtering by element type', () => {
-    class Root extends React.Component<{|children: React$Node|}> {
+    class ClassComponent extends React.Component<{|children: React$Node|}> {
       render() {
         return <div>{this.props.children}</div>;
       }
     }
-    const Component = () => <div>Hi</div>;
+    const FunctionComponent = () => <div>Hi</div>;
 
     act(() =>
       ReactDOM.render(
-        <Root>
-          <Component />
-        </Root>,
+        <ClassComponent>
+          <FunctionComponent />
+        </ClassComponent>,
         document.createElement('div'),
       ),
     );
-    expect(store).toMatchSnapshot('1: mount');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <ClassComponent>
+          ▾ <div>
+            ▾ <FunctionComponent>
+                <div>
+    `);
 
     act(
       () =>
@@ -71,8 +77,11 @@ describe('Store component filters', () => {
           utils.createElementTypeFilter(Types.ElementTypeHostComponent),
         ]),
     );
-
-    expect(store).toMatchSnapshot('2: hide host components');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <ClassComponent>
+            <FunctionComponent>
+    `);
 
     act(
       () =>
@@ -80,8 +89,12 @@ describe('Store component filters', () => {
           utils.createElementTypeFilter(Types.ElementTypeClass),
         ]),
     );
-
-    expect(store).toMatchSnapshot('3: hide class components');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <div>
+          ▾ <FunctionComponent>
+              <div>
+    `);
 
     act(
       () =>
@@ -90,8 +103,11 @@ describe('Store component filters', () => {
           utils.createElementTypeFilter(Types.ElementTypeFunction),
         ]),
     );
-
-    expect(store).toMatchSnapshot('4: hide class and function components');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <div>
+            <div>
+    `);
 
     act(
       () =>
@@ -100,15 +116,33 @@ describe('Store component filters', () => {
           utils.createElementTypeFilter(Types.ElementTypeFunction, false),
         ]),
     );
-
-    expect(store).toMatchSnapshot('5: disable all filters');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <ClassComponent>
+          ▾ <div>
+            ▾ <FunctionComponent>
+                <div>
+    `);
+
+    act(() => (store.componentFilters = []));
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <ClassComponent>
+          ▾ <div>
+            ▾ <FunctionComponent>
+                <div>
+    `);
   });
 
   it('should ignore invalid ElementTypeRoot filter', () => {
-    const Root = () => <div>Hi</div>;
+    const Component = () => <div>Hi</div>;
 
-    act(() => ReactDOM.render(<Root />, document.createElement('div')));
-    expect(store).toMatchSnapshot('1: mount');
+    act(() => ReactDOM.render(<Component />, document.createElement('div')));
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Component>
+            <div>
+    `);
 
     act(
       () =>
@@ -117,7 +151,11 @@ describe('Store component filters', () => {
         ]),
     );
 
-    expect(store).toMatchSnapshot('2: add invalid filter');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Component>
+            <div>
+    `);
   });
 
   it('should filter by display name', () => {
@@ -136,27 +174,59 @@ describe('Store component filters', () => {
         document.createElement('div'),
       ),
     );
-    expect(store).toMatchSnapshot('1: mount');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Foo>
+            <Text>
+        ▾ <Bar>
+            <Text>
+        ▾ <Baz>
+            <Text>
+    `);
 
     act(
       () => (store.componentFilters = [utils.createDisplayNameFilter('Foo')]),
     );
-    expect(store).toMatchSnapshot('2: filter "Foo"');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+          <Text>
+        ▾ <Bar>
+            <Text>
+        ▾ <Baz>
+            <Text>
+    `);
 
     act(() => (store.componentFilters = [utils.createDisplayNameFilter('Ba')]));
-    expect(store).toMatchSnapshot('3: filter "Ba"');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Foo>
+            <Text>
+          <Text>
+          <Text>
+    `);
 
     act(
       () => (store.componentFilters = [utils.createDisplayNameFilter('B.z')]),
     );
-    expect(store).toMatchSnapshot('4: filter "B.z"');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Foo>
+            <Text>
+        ▾ <Bar>
+            <Text>
+          <Text>
+    `);
   });
 
   it('should filter by path', () => {
     const Component = () => <div>Hi</div>;
 
     act(() => ReactDOM.render(<Component />, document.createElement('div')));
-    expect(store).toMatchSnapshot('1: mount');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Component>
+            <div>
+    `);
 
     act(
       () =>
@@ -165,9 +235,7 @@ describe('Store component filters', () => {
         ]),
     );
 
-    expect(store).toMatchSnapshot(
-      '2: hide all components declared within this test filed',
-    );
+    expect(store).toMatchInlineSnapshot(`[root]`);
 
     act(
       () =>
@@ -176,7 +244,11 @@ describe('Store component filters', () => {
         ]),
     );
 
-    expect(store).toMatchSnapshot('3: hide components in a made up fake path');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Component>
+            <div>
+    `);
   });
 
   it('should filter HOCs', () => {
@@ -187,15 +259,29 @@ describe('Store component filters', () => {
     Bar.displayName = 'Bar(Foo(Component))';
 
     act(() => ReactDOM.render(<Bar />, document.createElement('div')));
-    expect(store).toMatchSnapshot('1: mount');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Component> [Bar][Foo]
+          ▾ <Component> [Foo]
+            ▾ <Component>
+                <div>
+    `);
 
     act(() => (store.componentFilters = [utils.createHOCFilter(true)]));
-
-    expect(store).toMatchSnapshot('2: hide all HOCs');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Component>
+            <div>
+    `);
 
     act(() => (store.componentFilters = [utils.createHOCFilter(false)]));
-
-    expect(store).toMatchSnapshot('3: disable HOC filter');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Component> [Bar][Foo]
+          ▾ <Component> [Foo]
+            ▾ <Component>
+                <div>
+    `);
   });
 
   it('should not send a bridge update if the set of enabled filters has not changed', () => {
@@ -252,12 +338,117 @@ describe('Store component filters', () => {
 
     const container = document.createElement('div');
     act(() => ReactDOM.render(<Wrapper shouldSuspend={true} />, container));
-    expect(store).toMatchSnapshot('1: suspended');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Wrapper>
+          ▾ <Loading>
+              <div>
+    `);
 
     act(() => ReactDOM.render(<Wrapper shouldSuspend={false} />, container));
-    expect(store).toMatchSnapshot('2: resolved');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Wrapper>
+            <Component>
+    `);
 
     act(() => ReactDOM.render(<Wrapper shouldSuspend={true} />, container));
-    expect(store).toMatchSnapshot('3: suspended');
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Wrapper>
+          ▾ <Loading>
+              <div>
+    `);
+  });
+
+  describe('inline errors and warnings', () => {
+    it('only counts for unfiltered components', () => {
+      function ComponentWithWarning() {
+        console.warn('test-only: render warning');
+        return null;
+      }
+      function ComponentWithError() {
+        console.error('test-only: render error');
+        return null;
+      }
+      function ComponentWithWarningAndError() {
+        console.error('test-only: render error');
+        console.warn('test-only: render warning');
+        return null;
+      }
+      const container = document.createElement('div');
+      utils.withErrorsOrWarningsIgnored(['test-only:'], () => {
+        act(
+          () =>
+            (store.componentFilters = [
+              utils.createDisplayNameFilter('Warning'),
+              utils.createDisplayNameFilter('Error'),
+            ]),
+        );
+        act(() =>
+          ReactDOM.render(
+            <React.Fragment>
+              <ComponentWithError />
+              <ComponentWithWarning />
+              <ComponentWithWarningAndError />
+            </React.Fragment>,
+            container,
+          ),
+        );
+      });
+
+      expect(store).toMatchInlineSnapshot(`[root]`);
+      expect(store.errorCount).toBe(0);
+      expect(store.warningCount).toBe(0);
+
+      act(() => (store.componentFilters = []));
+      expect(store).toMatchInlineSnapshot(`
+        ✕ 2, ⚠ 2
+        [root]
+            <ComponentWithError> ✕
+            <ComponentWithWarning> ⚠
+            <ComponentWithWarningAndError> ✕⚠
+      `);
+
+      act(
+        () =>
+          (store.componentFilters = [utils.createDisplayNameFilter('Warning')]),
+      );
+      expect(store).toMatchInlineSnapshot(`
+        ✕ 1, ⚠ 0
+        [root]
+            <ComponentWithError> ✕
+      `);
+
+      act(
+        () =>
+          (store.componentFilters = [utils.createDisplayNameFilter('Error')]),
+      );
+      expect(store).toMatchInlineSnapshot(`
+        ✕ 0, ⚠ 1
+        [root]
+            <ComponentWithWarning> ⚠
+      `);
+
+      act(
+        () =>
+          (store.componentFilters = [
+            utils.createDisplayNameFilter('Warning'),
+            utils.createDisplayNameFilter('Error'),
+          ]),
+      );
+      expect(store).toMatchInlineSnapshot(`[root]`);
+      expect(store.errorCount).toBe(0);
+      expect(store.warningCount).toBe(0);
+
+      act(() => (store.componentFilters = []));
+      expect(store).toMatchInlineSnapshot(`
+        ✕ 2, ⚠ 2
+        [root]
+            <ComponentWithError> ✕
+            <ComponentWithWarning> ⚠
+            <ComponentWithWarningAndError> ✕⚠
+      `);
+    });
   });
 });

commit d7dce572c7453737a685e791e7afcbc7e2b2fe16
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Jun 22 17:29:35 2021 -0400

    Remove internal `act` builds from public modules (#21721)
    
    * Move internal version of act to shared module
    
    No reason to have three different copies of this anymore.
    
    I've left the the renderer-specific `act` entry points because legacy
    mode tests need to also be wrapped in `batchedUpdates`. Next, I'll update
    the tests to use `batchedUpdates` manually when needed.
    
    * Migrates tests to use internal module directly
    
    Instead of the `unstable_concurrentAct` exports. Now we can drop those
    from the public builds.
    
    I put it in the jest-react package since that's where we put our other
    testing utilities (like `toFlushAndYield`). Not so much so it can be
    consumed publicly (nobody uses that package except us), but so it works
    with our build tests.
    
    * Remove unused internal fields
    
    These were used by the old act implementation. No longer needed.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 4a365acb0e..7468eb48d1 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -13,14 +13,14 @@ import type Store from 'react-devtools-shared/src/devtools/store';
 describe('Store component filters', () => {
   let React;
   let ReactDOM;
-  let TestUtils;
   let Types;
   let bridge: FrontendBridge;
   let store: Store;
   let utils;
+  let internalAct;
 
   const act = (callback: Function) => {
-    TestUtils.unstable_concurrentAct(() => {
+    internalAct(() => {
       callback();
     });
     jest.runAllTimers(); // Flush Bridge operations
@@ -35,9 +35,9 @@ describe('Store component filters', () => {
 
     React = require('react');
     ReactDOM = require('react-dom');
-    TestUtils = require('react-dom/test-utils');
     Types = require('react-devtools-shared/src/types');
     utils = require('./utils');
+    internalAct = require('jest-react').act;
   });
 
   it('should throw if filters are updated while profiling', () => {

commit 73ffce1b6fb7eff13414e35e40efe4269664e5ea
Author: Brian Vaughn <bvaughn@fb.com>
Date:   Thu Jun 24 22:42:44 2021 -0400

    DevTools: Update tests to fix warnings/errors (#21748)
    
    Some new ones had slipped in (e.g. deprecated ReactDOM.render message from 18)

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 7468eb48d1..baa19e0787 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -12,9 +12,9 @@ import type Store from 'react-devtools-shared/src/devtools/store';
 
 describe('Store component filters', () => {
   let React;
-  let ReactDOM;
   let Types;
   let bridge: FrontendBridge;
+  let legacyRender;
   let store: Store;
   let utils;
   let internalAct;
@@ -34,10 +34,11 @@ describe('Store component filters', () => {
     store.recordChangeDescriptions = true;
 
     React = require('react');
-    ReactDOM = require('react-dom');
     Types = require('react-devtools-shared/src/types');
     utils = require('./utils');
     internalAct = require('jest-react').act;
+
+    legacyRender = utils.legacyRender;
   });
 
   it('should throw if filters are updated while profiling', () => {
@@ -56,7 +57,7 @@ describe('Store component filters', () => {
     const FunctionComponent = () => <div>Hi</div>;
 
     act(() =>
-      ReactDOM.render(
+      legacyRender(
         <ClassComponent>
           <FunctionComponent />
         </ClassComponent>,
@@ -137,7 +138,7 @@ describe('Store component filters', () => {
   it('should ignore invalid ElementTypeRoot filter', () => {
     const Component = () => <div>Hi</div>;
 
-    act(() => ReactDOM.render(<Component />, document.createElement('div')));
+    act(() => legacyRender(<Component />, document.createElement('div')));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component>
@@ -165,7 +166,7 @@ describe('Store component filters', () => {
     const Baz = () => <Text label="baz" />;
 
     act(() =>
-      ReactDOM.render(
+      legacyRender(
         <React.Fragment>
           <Foo />
           <Bar />
@@ -221,7 +222,7 @@ describe('Store component filters', () => {
   it('should filter by path', () => {
     const Component = () => <div>Hi</div>;
 
-    act(() => ReactDOM.render(<Component />, document.createElement('div')));
+    act(() => legacyRender(<Component />, document.createElement('div')));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component>
@@ -258,7 +259,7 @@ describe('Store component filters', () => {
     const Bar = () => <Foo />;
     Bar.displayName = 'Bar(Foo(Component))';
 
-    act(() => ReactDOM.render(<Bar />, document.createElement('div')));
+    act(() => legacyRender(<Bar />, document.createElement('div')));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component> [Bar][Foo]
@@ -337,7 +338,7 @@ describe('Store component filters', () => {
     ];
 
     const container = document.createElement('div');
-    act(() => ReactDOM.render(<Wrapper shouldSuspend={true} />, container));
+    act(() => legacyRender(<Wrapper shouldSuspend={true} />, container));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Wrapper>
@@ -345,14 +346,14 @@ describe('Store component filters', () => {
               <div>
     `);
 
-    act(() => ReactDOM.render(<Wrapper shouldSuspend={false} />, container));
+    act(() => legacyRender(<Wrapper shouldSuspend={false} />, container));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Wrapper>
             <Component>
     `);
 
-    act(() => ReactDOM.render(<Wrapper shouldSuspend={true} />, container));
+    act(() => legacyRender(<Wrapper shouldSuspend={true} />, container));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Wrapper>
@@ -376,6 +377,14 @@ describe('Store component filters', () => {
         console.warn('test-only: render warning');
         return null;
       }
+
+      // HACK This require() is needed (somewhere in the test) for this case to pass.
+      // Without it, the legacyRender() call below causes this test to fail
+      // because it requires "react-dom" for the first time,
+      // which causes the console error() and warn() methods to be overridden again,
+      // effectively disconnecting the DevTools override in 'react-devtools-shared/src/backend/console'.
+      require('react-dom');
+
       const container = document.createElement('div');
       utils.withErrorsOrWarningsIgnored(['test-only:'], () => {
         act(
@@ -386,7 +395,7 @@ describe('Store component filters', () => {
             ]),
         );
         act(() =>
-          ReactDOM.render(
+          legacyRender(
             <React.Fragment>
               <ComponentWithError />
               <ComponentWithWarning />

commit b77c12576d332d5cee07305a6afee68203d43e9c
Author: Luna Ruan <lunaris.ruan@gmail.com>
Date:   Wed May 18 09:37:17 2022 -0700

    [DevTools] Add React Version Pragma to Tests (#24576)
    
    This PR adds the reactVersion pragma to tests.
    
    Tests without the reactVersion pragma won't be run if the reactVersion pragma isn't specified.
    
    Tested each React version manually with the pragma to make sure the tests pass

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index baa19e0787..e9e30de830 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -41,6 +41,7 @@ describe('Store component filters', () => {
     legacyRender = utils.legacyRender;
   });
 
+  // @reactVersion >= 16.0
   it('should throw if filters are updated while profiling', () => {
     act(() => store.profilerStore.startProfiling());
     expect(() => (store.componentFilters = [])).toThrow(
@@ -48,6 +49,7 @@ describe('Store component filters', () => {
     );
   });
 
+  // @reactVersion >= 16.0
   it('should support filtering by element type', () => {
     class ClassComponent extends React.Component<{|children: React$Node|}> {
       render() {
@@ -135,6 +137,7 @@ describe('Store component filters', () => {
     `);
   });
 
+  // @reactVersion >= 16.0
   it('should ignore invalid ElementTypeRoot filter', () => {
     const Component = () => <div>Hi</div>;
 
@@ -159,6 +162,7 @@ describe('Store component filters', () => {
     `);
   });
 
+  // @reactVersion >= 16.2
   it('should filter by display name', () => {
     const Text = ({label}) => label;
     const Foo = () => <Text label="foo" />;
@@ -219,6 +223,7 @@ describe('Store component filters', () => {
     `);
   });
 
+  // @reactVersion >= 16.0
   it('should filter by path', () => {
     const Component = () => <div>Hi</div>;
 
@@ -252,6 +257,7 @@ describe('Store component filters', () => {
     `);
   });
 
+  // @reactVersion >= 16.0
   it('should filter HOCs', () => {
     const Component = () => <div>Hi</div>;
     const Foo = () => <Component />;
@@ -285,6 +291,7 @@ describe('Store component filters', () => {
     `);
   });
 
+  // @reactVersion >= 16.0
   it('should not send a bridge update if the set of enabled filters has not changed', () => {
     act(() => (store.componentFilters = [utils.createHOCFilter(true)]));
 
@@ -315,6 +322,7 @@ describe('Store component filters', () => {
     );
   });
 
+  // @reactVersion >= 18.0
   it('should not break when Suspense nodes are filtered from the tree', () => {
     const promise = new Promise(() => {});
 
@@ -363,6 +371,7 @@ describe('Store component filters', () => {
   });
 
   describe('inline errors and warnings', () => {
+    // @reactVersion >= 17.0
     it('only counts for unfiltered components', () => {
       function ComponentWithWarning() {
         console.warn('test-only: render warning');

commit 8003ab9cf5c711eb00f741bbd89def56b066b999
Author: Jan Kassens <jan@kassens.net>
Date:   Fri Sep 9 16:03:48 2022 -0400

    Flow: remove explicit object syntax (#25223)

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index e9e30de830..d49f3f3e1b 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -51,7 +51,7 @@ describe('Store component filters', () => {
 
   // @reactVersion >= 16.0
   it('should support filtering by element type', () => {
-    class ClassComponent extends React.Component<{|children: React$Node|}> {
+    class ClassComponent extends React.Component<{children: React$Node}> {
       render() {
         return <div>{this.props.children}</div>;
       }

commit 9cdf8a99edcfd94d7420835ea663edca04237527
Author: Andrew Clark <git@andrewclark.io>
Date:   Tue Oct 18 11:19:24 2022 -0400

    [Codemod] Update copyright header to Meta (#25315)
    
    * Facebook -> Meta in copyright
    
    rg --files | xargs sed -i 's#Copyright (c) Facebook, Inc. and its affiliates.#Copyright (c) Meta Platforms, Inc. and affiliates.#g'
    
    * Manual tweaks

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index d49f3f3e1b..4d8fe6e414 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -1,5 +1,5 @@
 /**
- * Copyright (c) Facebook, Inc. and its affiliates.
+ * Copyright (c) Meta Platforms, Inc. and affiliates.
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE file in the root directory of this source tree.

commit 702fc984e68e852c76e0df608cd631a7c2e7763f
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Mar 8 11:36:05 2023 -0500

    Codemod act -> await act (4/?) (#26338)
    
    Similar to the rationale for `waitFor` (see #26285), we should always
    await the result of an `act` call so that microtasks have a chance to
    fire.
    
    This only affects the internal `act` that we use in our repo, for now.
    In the public `act` API, we don't yet require this; however, we
    effectively will for any update that triggers suspense once `use` lands.
    So we likely will start warning in an upcoming minor.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 4d8fe6e414..14e928ba82 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -19,10 +19,8 @@ describe('Store component filters', () => {
   let utils;
   let internalAct;
 
-  const act = (callback: Function) => {
-    internalAct(() => {
-      callback();
-    });
+  const act = async (callback: Function) => {
+    internalAct(callback);
     jest.runAllTimers(); // Flush Bridge operations
   };
 
@@ -42,15 +40,15 @@ describe('Store component filters', () => {
   });
 
   // @reactVersion >= 16.0
-  it('should throw if filters are updated while profiling', () => {
-    act(() => store.profilerStore.startProfiling());
+  it('should throw if filters are updated while profiling', async () => {
+    await act(async () => store.profilerStore.startProfiling());
     expect(() => (store.componentFilters = [])).toThrow(
       'Cannot modify filter preferences while profiling',
     );
   });
 
   // @reactVersion >= 16.0
-  it('should support filtering by element type', () => {
+  it('should support filtering by element type', async () => {
     class ClassComponent extends React.Component<{children: React$Node}> {
       render() {
         return <div>{this.props.children}</div>;
@@ -58,7 +56,7 @@ describe('Store component filters', () => {
     }
     const FunctionComponent = () => <div>Hi</div>;
 
-    act(() =>
+    await act(async () =>
       legacyRender(
         <ClassComponent>
           <FunctionComponent />
@@ -74,8 +72,8 @@ describe('Store component filters', () => {
                 <div>
     `);
 
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeHostComponent),
         ]),
@@ -86,8 +84,8 @@ describe('Store component filters', () => {
             <FunctionComponent>
     `);
 
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass),
         ]),
@@ -99,8 +97,8 @@ describe('Store component filters', () => {
               <div>
     `);
 
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass),
           utils.createElementTypeFilter(Types.ElementTypeFunction),
@@ -112,8 +110,8 @@ describe('Store component filters', () => {
             <div>
     `);
 
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass, false),
           utils.createElementTypeFilter(Types.ElementTypeFunction, false),
@@ -127,7 +125,7 @@ describe('Store component filters', () => {
                 <div>
     `);
 
-    act(() => (store.componentFilters = []));
+    await act(async () => (store.componentFilters = []));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <ClassComponent>
@@ -138,18 +136,20 @@ describe('Store component filters', () => {
   });
 
   // @reactVersion >= 16.0
-  it('should ignore invalid ElementTypeRoot filter', () => {
+  it('should ignore invalid ElementTypeRoot filter', async () => {
     const Component = () => <div>Hi</div>;
 
-    act(() => legacyRender(<Component />, document.createElement('div')));
+    await act(async () =>
+      legacyRender(<Component />, document.createElement('div')),
+    );
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component>
             <div>
     `);
 
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeRoot),
         ]),
@@ -163,13 +163,13 @@ describe('Store component filters', () => {
   });
 
   // @reactVersion >= 16.2
-  it('should filter by display name', () => {
+  it('should filter by display name', async () => {
     const Text = ({label}) => label;
     const Foo = () => <Text label="foo" />;
     const Bar = () => <Text label="bar" />;
     const Baz = () => <Text label="baz" />;
 
-    act(() =>
+    await act(async () =>
       legacyRender(
         <React.Fragment>
           <Foo />
@@ -189,8 +189,9 @@ describe('Store component filters', () => {
             <Text>
     `);
 
-    act(
-      () => (store.componentFilters = [utils.createDisplayNameFilter('Foo')]),
+    await act(
+      async () =>
+        (store.componentFilters = [utils.createDisplayNameFilter('Foo')]),
     );
     expect(store).toMatchInlineSnapshot(`
       [root]
@@ -201,7 +202,10 @@ describe('Store component filters', () => {
             <Text>
     `);
 
-    act(() => (store.componentFilters = [utils.createDisplayNameFilter('Ba')]));
+    await act(
+      async () =>
+        (store.componentFilters = [utils.createDisplayNameFilter('Ba')]),
+    );
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Foo>
@@ -210,8 +214,9 @@ describe('Store component filters', () => {
           <Text>
     `);
 
-    act(
-      () => (store.componentFilters = [utils.createDisplayNameFilter('B.z')]),
+    await act(
+      async () =>
+        (store.componentFilters = [utils.createDisplayNameFilter('B.z')]),
     );
     expect(store).toMatchInlineSnapshot(`
       [root]
@@ -224,18 +229,20 @@ describe('Store component filters', () => {
   });
 
   // @reactVersion >= 16.0
-  it('should filter by path', () => {
+  it('should filter by path', async () => {
     const Component = () => <div>Hi</div>;
 
-    act(() => legacyRender(<Component />, document.createElement('div')));
+    await act(async () =>
+      legacyRender(<Component />, document.createElement('div')),
+    );
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component>
             <div>
     `);
 
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createLocationFilter(__filename.replace(__dirname, '')),
         ]),
@@ -243,8 +250,8 @@ describe('Store component filters', () => {
 
     expect(store).toMatchInlineSnapshot(`[root]`);
 
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createLocationFilter('this:is:a:made:up:path'),
         ]),
@@ -258,14 +265,14 @@ describe('Store component filters', () => {
   });
 
   // @reactVersion >= 16.0
-  it('should filter HOCs', () => {
+  it('should filter HOCs', async () => {
     const Component = () => <div>Hi</div>;
     const Foo = () => <Component />;
     Foo.displayName = 'Foo(Component)';
     const Bar = () => <Foo />;
     Bar.displayName = 'Bar(Foo(Component))';
 
-    act(() => legacyRender(<Bar />, document.createElement('div')));
+    await act(async () => legacyRender(<Bar />, document.createElement('div')));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component> [Bar][Foo]
@@ -274,14 +281,18 @@ describe('Store component filters', () => {
                 <div>
     `);
 
-    act(() => (store.componentFilters = [utils.createHOCFilter(true)]));
+    await act(
+      async () => (store.componentFilters = [utils.createHOCFilter(true)]),
+    );
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component>
             <div>
     `);
 
-    act(() => (store.componentFilters = [utils.createHOCFilter(false)]));
+    await act(
+      async () => (store.componentFilters = [utils.createHOCFilter(false)]),
+    );
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component> [Bar][Foo]
@@ -292,29 +303,31 @@ describe('Store component filters', () => {
   });
 
   // @reactVersion >= 16.0
-  it('should not send a bridge update if the set of enabled filters has not changed', () => {
-    act(() => (store.componentFilters = [utils.createHOCFilter(true)]));
+  it('should not send a bridge update if the set of enabled filters has not changed', async () => {
+    await act(
+      async () => (store.componentFilters = [utils.createHOCFilter(true)]),
+    );
 
     bridge.addListener('updateComponentFilters', componentFilters => {
       throw Error('Unexpected component update');
     });
 
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createHOCFilter(false),
           utils.createHOCFilter(true),
         ]),
     );
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createHOCFilter(true),
           utils.createLocationFilter('abc', false),
         ]),
     );
-    act(
-      () =>
+    await act(
+      async () =>
         (store.componentFilters = [
           utils.createHOCFilter(true),
           utils.createElementTypeFilter(Types.ElementTypeHostComponent, false),
@@ -323,7 +336,7 @@ describe('Store component filters', () => {
   });
 
   // @reactVersion >= 18.0
-  it('should not break when Suspense nodes are filtered from the tree', () => {
+  it('should not break when Suspense nodes are filtered from the tree', async () => {
     const promise = new Promise(() => {});
 
     const Loading = () => <div>Loading...</div>;
@@ -346,7 +359,9 @@ describe('Store component filters', () => {
     ];
 
     const container = document.createElement('div');
-    act(() => legacyRender(<Wrapper shouldSuspend={true} />, container));
+    await act(async () =>
+      legacyRender(<Wrapper shouldSuspend={true} />, container),
+    );
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Wrapper>
@@ -354,15 +369,21 @@ describe('Store component filters', () => {
               <div>
     `);
 
-    act(() => legacyRender(<Wrapper shouldSuspend={false} />, container));
+    await act(async () =>
+      legacyRender(<Wrapper shouldSuspend={false} />, container),
+    );
     expect(store).toMatchInlineSnapshot(`
+      ✕ 1, ⚠ 0
       [root]
         ▾ <Wrapper>
             <Component>
     `);
 
-    act(() => legacyRender(<Wrapper shouldSuspend={true} />, container));
+    await act(async () =>
+      legacyRender(<Wrapper shouldSuspend={true} />, container),
+    );
     expect(store).toMatchInlineSnapshot(`
+      ✕ 2, ⚠ 0
       [root]
         ▾ <Wrapper>
           ▾ <Loading>
@@ -372,7 +393,7 @@ describe('Store component filters', () => {
 
   describe('inline errors and warnings', () => {
     // @reactVersion >= 17.0
-    it('only counts for unfiltered components', () => {
+    it('only counts for unfiltered components', async () => {
       function ComponentWithWarning() {
         console.warn('test-only: render warning');
         return null;
@@ -395,31 +416,29 @@ describe('Store component filters', () => {
       require('react-dom');
 
       const container = document.createElement('div');
+      await act(
+        async () =>
+          (store.componentFilters = [
+            utils.createDisplayNameFilter('Warning'),
+            utils.createDisplayNameFilter('Error'),
+          ]),
+      );
       utils.withErrorsOrWarningsIgnored(['test-only:'], () => {
-        act(
-          () =>
-            (store.componentFilters = [
-              utils.createDisplayNameFilter('Warning'),
-              utils.createDisplayNameFilter('Error'),
-            ]),
-        );
-        act(() =>
-          legacyRender(
-            <React.Fragment>
-              <ComponentWithError />
-              <ComponentWithWarning />
-              <ComponentWithWarningAndError />
-            </React.Fragment>,
-            container,
-          ),
+        legacyRender(
+          <React.Fragment>
+            <ComponentWithError />
+            <ComponentWithWarning />
+            <ComponentWithWarningAndError />
+          </React.Fragment>,
+          container,
         );
       });
 
-      expect(store).toMatchInlineSnapshot(`[root]`);
+      expect(store).toMatchInlineSnapshot(``);
       expect(store.errorCount).toBe(0);
       expect(store.warningCount).toBe(0);
 
-      act(() => (store.componentFilters = []));
+      await act(async () => (store.componentFilters = []));
       expect(store).toMatchInlineSnapshot(`
         ✕ 2, ⚠ 2
         [root]
@@ -428,8 +447,8 @@ describe('Store component filters', () => {
             <ComponentWithWarningAndError> ✕⚠
       `);
 
-      act(
-        () =>
+      await act(
+        async () =>
           (store.componentFilters = [utils.createDisplayNameFilter('Warning')]),
       );
       expect(store).toMatchInlineSnapshot(`
@@ -438,8 +457,8 @@ describe('Store component filters', () => {
             <ComponentWithError> ✕
       `);
 
-      act(
-        () =>
+      await act(
+        async () =>
           (store.componentFilters = [utils.createDisplayNameFilter('Error')]),
       );
       expect(store).toMatchInlineSnapshot(`
@@ -448,8 +467,8 @@ describe('Store component filters', () => {
             <ComponentWithWarning> ⚠
       `);
 
-      act(
-        () =>
+      await act(
+        async () =>
           (store.componentFilters = [
             utils.createDisplayNameFilter('Warning'),
             utils.createDisplayNameFilter('Error'),
@@ -459,7 +478,7 @@ describe('Store component filters', () => {
       expect(store.errorCount).toBe(0);
       expect(store.warningCount).toBe(0);
 
-      act(() => (store.componentFilters = []));
+      await act(async () => (store.componentFilters = []));
       expect(store).toMatchInlineSnapshot(`
         ✕ 2, ⚠ 2
         [root]

commit 44d3807945700de8bb6bdbbf5c4d1ba513303747
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Mar 8 12:58:31 2023 -0500

    Move internalAct to internal-test-utils package (#26344)
    
    This is not a public API. We only use it for our internal tests, the
    ones in this repo. Let's move it to this private package. Practically
    speaking this will also let us use async/await in the implementation.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 14e928ba82..fd30b41a45 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -34,7 +34,7 @@ describe('Store component filters', () => {
     React = require('react');
     Types = require('react-devtools-shared/src/types');
     utils = require('./utils');
-    internalAct = require('jest-react').act;
+    internalAct = require('internal-test-utils').act;
 
     legacyRender = utils.legacyRender;
   });

commit 037378202f1a99c79ed778a1555b0b2c32974a10
Author: Andrew Clark <git@andrewclark.io>
Date:   Wed Mar 8 16:25:12 2023 -0500

    Internal `act`: Call scope function after an async gap (#26347)
    
    This adds an async gap to our internal implementation of `act` (the one
    used by our repo, not the public API). Rather than call the provided
    scope function synchronously when `act` is called, we call it in a
    separate async task. This is an extra precaution to ensure that our
    tests do not accidentally rely on work being queued synchronously,
    because that is an implementation detail that we should be allowed to
    change. We don't do this in the public version of `act`, though we maybe
    should in the future, for the same rationale. That might be tricky,
    though, because it could break existing tests.
    
    This also fixes the issue where our internal `act` requires an async
    function. You can pass it a regular function, too.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index fd30b41a45..cb13f6cbb5 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -20,7 +20,7 @@ describe('Store component filters', () => {
   let internalAct;
 
   const act = async (callback: Function) => {
-    internalAct(callback);
+    await internalAct(callback);
     jest.runAllTimers(); // Flush Bridge operations
   };
 
@@ -373,7 +373,6 @@ describe('Store component filters', () => {
       legacyRender(<Wrapper shouldSuspend={false} />, container),
     );
     expect(store).toMatchInlineSnapshot(`
-      ✕ 1, ⚠ 0
       [root]
         ▾ <Wrapper>
             <Component>
@@ -383,7 +382,6 @@ describe('Store component filters', () => {
       legacyRender(<Wrapper shouldSuspend={true} />, container),
     );
     expect(store).toMatchInlineSnapshot(`
-      ✕ 2, ⚠ 0
       [root]
         ▾ <Wrapper>
           ▾ <Loading>

commit cd20376f03212c91057c003bcb640ca9568e87e6
Author: Andrew Clark <git@andrewclark.io>
Date:   Sun Mar 12 12:58:58 2023 -0400

    Remove internal `act` from DevTools e2e test (#26376)
    
    For various reasons some of the DevTools e2e tests uses our repo's
    private internal version of `act`. It should really just be using the
    public one.
    
    This converts one of the usages, because it was causing CI to fail.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index cb13f6cbb5..741589ee94 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -17,10 +17,9 @@ describe('Store component filters', () => {
   let legacyRender;
   let store: Store;
   let utils;
-  let internalAct;
 
   const act = async (callback: Function) => {
-    await internalAct(callback);
+    await React.unstable_act(callback);
     jest.runAllTimers(); // Flush Bridge operations
   };
 
@@ -34,7 +33,6 @@ describe('Store component filters', () => {
     React = require('react');
     Types = require('react-devtools-shared/src/types');
     utils = require('./utils');
-    internalAct = require('internal-test-utils').act;
 
     legacyRender = utils.legacyRender;
   });

commit 9941cbacacb81c27a088b0bc2781b990bcbae1cd
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Thu Mar 16 08:14:23 2023 -0400

    Fix devtools tests after internal test changes (#26405)

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 741589ee94..c5dd04865c 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -19,7 +19,12 @@ describe('Store component filters', () => {
   let utils;
 
   const act = async (callback: Function) => {
-    await React.unstable_act(callback);
+    if (React.unstable_act != null) {
+      await React.unstable_act(callback);
+    } else {
+      callback();
+    }
+
     jest.runAllTimers(); // Flush Bridge operations
   };
 

commit 77ec61885fb19607cdd116a6790095afa40b5a94
Author: Ruslan Lesiutin <rdlesyutin@gmail.com>
Date:   Tue Oct 10 18:10:17 2023 +0100

    fix[devtools/inspectElement]: dont pause initial inspectElement call when user switches tabs (#27488)
    
    There are not so many changes, most of them are changing imports,
    because I've moved types for UI in a single file.
    
    In https://github.com/facebook/react/pull/27357 I've added support for
    pausing polling events: when user inspects an element, we start polling
    React DevTools backend for updates in props / state. If user switches
    tabs, extension's service worker can be killed by browser and this
    polling will start spamming errors.
    
    What I've missed is that we also have a separate call for this API, but
    which is executed only once when user selects an element. We don't
    handle promise rejection here and this can lead to some errors when user
    selects an element and switches tabs right after it.
    
    The only change here is that this API now has
    `shouldListenToPauseEvents` param, which is `true` for polling, so we
    will pause polling once user switches tabs. It is `false` by default, so
    we won't pause initial call by accident.
    
    
    https://github.com/hoxyq/react/blob/af8beeebf63b5824497fcd0bb35b7c0ac8fe60a0/packages/react-devtools-shared/src/backendAPI.js#L96

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index c5dd04865c..44c7e85217 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -36,7 +36,7 @@ describe('Store component filters', () => {
     store.recordChangeDescriptions = true;
 
     React = require('react');
-    Types = require('react-devtools-shared/src/types');
+    Types = require('react-devtools-shared/src/frontend/types');
     utils = require('./utils');
 
     legacyRender = utils.legacyRender;

commit 53b12e46a17549ec7644e13c126440ed2f3629fd
Author: Andrew Clark <git@andrewclark.io>
Date:   Thu Feb 1 13:28:14 2024 -0500

    Add stable React.act export (#28160)
    
    Starting in version 19, users can import the `act` testing API from the
    `react` package instead of using a renderer specific API, like
    `react-dom/test-utils`.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 44c7e85217..e2a59177b6 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -19,7 +19,9 @@ describe('Store component filters', () => {
   let utils;
 
   const act = async (callback: Function) => {
-    if (React.unstable_act != null) {
+    if (React.act != null) {
+      await React.act(callback);
+    } else if (React.unstable_act != null) {
       await React.unstable_act(callback);
     } else {
       callback();

commit 12d56fca3da06328ac61d86976afa728b97b49d6
Author: Ruslan Lesiutin <rdlesyutin@gmail.com>
Date:   Tue Feb 6 16:25:03 2024 +0000

    chore: use versioned render in storeComponentFilters test (#28241)

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index e2a59177b6..573ca40cba 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -10,25 +10,18 @@
 import type {FrontendBridge} from 'react-devtools-shared/src/bridge';
 import type Store from 'react-devtools-shared/src/devtools/store';
 
+import {
+  getLegacyRenderImplementation,
+  getVersionedRenderImplementation,
+} from './utils';
+
 describe('Store component filters', () => {
   let React;
   let Types;
   let bridge: FrontendBridge;
-  let legacyRender;
   let store: Store;
   let utils;
-
-  const act = async (callback: Function) => {
-    if (React.act != null) {
-      await React.act(callback);
-    } else if (React.unstable_act != null) {
-      await React.unstable_act(callback);
-    } else {
-      callback();
-    }
-
-    jest.runAllTimers(); // Flush Bridge operations
-  };
+  let actAsync;
 
   beforeEach(() => {
     bridge = global.bridge;
@@ -41,12 +34,14 @@ describe('Store component filters', () => {
     Types = require('react-devtools-shared/src/frontend/types');
     utils = require('./utils');
 
-    legacyRender = utils.legacyRender;
+    actAsync = utils.actAsync;
   });
 
+  const {render} = getVersionedRenderImplementation();
+
   // @reactVersion >= 16.0
   it('should throw if filters are updated while profiling', async () => {
-    await act(async () => store.profilerStore.startProfiling());
+    await actAsync(async () => store.profilerStore.startProfiling());
     expect(() => (store.componentFilters = [])).toThrow(
       'Cannot modify filter preferences while profiling',
     );
@@ -61,12 +56,11 @@ describe('Store component filters', () => {
     }
     const FunctionComponent = () => <div>Hi</div>;
 
-    await act(async () =>
-      legacyRender(
+    await actAsync(async () =>
+      render(
         <ClassComponent>
           <FunctionComponent />
         </ClassComponent>,
-        document.createElement('div'),
       ),
     );
     expect(store).toMatchInlineSnapshot(`
@@ -77,7 +71,7 @@ describe('Store component filters', () => {
                 <div>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeHostComponent),
@@ -89,7 +83,7 @@ describe('Store component filters', () => {
             <FunctionComponent>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass),
@@ -102,7 +96,7 @@ describe('Store component filters', () => {
               <div>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass),
@@ -115,7 +109,7 @@ describe('Store component filters', () => {
             <div>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeClass, false),
@@ -130,7 +124,7 @@ describe('Store component filters', () => {
                 <div>
     `);
 
-    await act(async () => (store.componentFilters = []));
+    await actAsync(async () => (store.componentFilters = []));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <ClassComponent>
@@ -144,16 +138,14 @@ describe('Store component filters', () => {
   it('should ignore invalid ElementTypeRoot filter', async () => {
     const Component = () => <div>Hi</div>;
 
-    await act(async () =>
-      legacyRender(<Component />, document.createElement('div')),
-    );
+    await actAsync(async () => render(<Component />));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component>
             <div>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createElementTypeFilter(Types.ElementTypeRoot),
@@ -174,14 +166,13 @@ describe('Store component filters', () => {
     const Bar = () => <Text label="bar" />;
     const Baz = () => <Text label="baz" />;
 
-    await act(async () =>
-      legacyRender(
+    await actAsync(async () =>
+      render(
         <React.Fragment>
           <Foo />
           <Bar />
           <Baz />
         </React.Fragment>,
-        document.createElement('div'),
       ),
     );
     expect(store).toMatchInlineSnapshot(`
@@ -194,7 +185,7 @@ describe('Store component filters', () => {
             <Text>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [utils.createDisplayNameFilter('Foo')]),
     );
@@ -207,7 +198,7 @@ describe('Store component filters', () => {
             <Text>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [utils.createDisplayNameFilter('Ba')]),
     );
@@ -219,7 +210,7 @@ describe('Store component filters', () => {
           <Text>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [utils.createDisplayNameFilter('B.z')]),
     );
@@ -237,16 +228,14 @@ describe('Store component filters', () => {
   it('should filter by path', async () => {
     const Component = () => <div>Hi</div>;
 
-    await act(async () =>
-      legacyRender(<Component />, document.createElement('div')),
-    );
+    await actAsync(async () => render(<Component />));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component>
             <div>
     `);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createLocationFilter(__filename.replace(__dirname, '')),
@@ -255,7 +244,7 @@ describe('Store component filters', () => {
 
     expect(store).toMatchInlineSnapshot(`[root]`);
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createLocationFilter('this:is:a:made:up:path'),
@@ -277,7 +266,7 @@ describe('Store component filters', () => {
     const Bar = () => <Foo />;
     Bar.displayName = 'Bar(Foo(Component))';
 
-    await act(async () => legacyRender(<Bar />, document.createElement('div')));
+    await actAsync(async () => render(<Bar />));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component> [Bar][Foo]
@@ -286,7 +275,7 @@ describe('Store component filters', () => {
                 <div>
     `);
 
-    await act(
+    await actAsync(
       async () => (store.componentFilters = [utils.createHOCFilter(true)]),
     );
     expect(store).toMatchInlineSnapshot(`
@@ -295,7 +284,7 @@ describe('Store component filters', () => {
             <div>
     `);
 
-    await act(
+    await actAsync(
       async () => (store.componentFilters = [utils.createHOCFilter(false)]),
     );
     expect(store).toMatchInlineSnapshot(`
@@ -309,7 +298,7 @@ describe('Store component filters', () => {
 
   // @reactVersion >= 16.0
   it('should not send a bridge update if the set of enabled filters has not changed', async () => {
-    await act(
+    await actAsync(
       async () => (store.componentFilters = [utils.createHOCFilter(true)]),
     );
 
@@ -317,21 +306,21 @@ describe('Store component filters', () => {
       throw Error('Unexpected component update');
     });
 
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createHOCFilter(false),
           utils.createHOCFilter(true),
         ]),
     );
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createHOCFilter(true),
           utils.createLocationFilter('abc', false),
         ]),
     );
-    await act(
+    await actAsync(
       async () =>
         (store.componentFilters = [
           utils.createHOCFilter(true),
@@ -363,10 +352,7 @@ describe('Store component filters', () => {
       utils.createElementTypeFilter(Types.ElementTypeSuspense),
     ];
 
-    const container = document.createElement('div');
-    await act(async () =>
-      legacyRender(<Wrapper shouldSuspend={true} />, container),
-    );
+    await actAsync(async () => render(<Wrapper shouldSuspend={true} />));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Wrapper>
@@ -374,18 +360,14 @@ describe('Store component filters', () => {
               <div>
     `);
 
-    await act(async () =>
-      legacyRender(<Wrapper shouldSuspend={false} />, container),
-    );
+    await actAsync(async () => render(<Wrapper shouldSuspend={false} />));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Wrapper>
             <Component>
     `);
 
-    await act(async () =>
-      legacyRender(<Wrapper shouldSuspend={true} />, container),
-    );
+    await actAsync(async () => render(<Wrapper shouldSuspend={true} />));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Wrapper>
@@ -395,8 +377,11 @@ describe('Store component filters', () => {
   });
 
   describe('inline errors and warnings', () => {
+    const {render: legacyRender} = getLegacyRenderImplementation();
+
     // @reactVersion >= 17.0
-    it('only counts for unfiltered components', async () => {
+    // @reactVersion <= 18.2
+    it('only counts for unfiltered components (legacy render)', async () => {
       function ComponentWithWarning() {
         console.warn('test-only: render warning');
         return null;
@@ -411,15 +396,7 @@ describe('Store component filters', () => {
         return null;
       }
 
-      // HACK This require() is needed (somewhere in the test) for this case to pass.
-      // Without it, the legacyRender() call below causes this test to fail
-      // because it requires "react-dom" for the first time,
-      // which causes the console error() and warn() methods to be overridden again,
-      // effectively disconnecting the DevTools override in 'react-devtools-shared/src/backend/console'.
-      require('react-dom');
-
-      const container = document.createElement('div');
-      await act(
+      await actAsync(
         async () =>
           (store.componentFilters = [
             utils.createDisplayNameFilter('Warning'),
@@ -433,7 +410,6 @@ describe('Store component filters', () => {
             <ComponentWithWarning />
             <ComponentWithWarningAndError />
           </React.Fragment>,
-          container,
         );
       });
 
@@ -441,7 +417,99 @@ describe('Store component filters', () => {
       expect(store.errorCount).toBe(0);
       expect(store.warningCount).toBe(0);
 
-      await act(async () => (store.componentFilters = []));
+      await actAsync(async () => (store.componentFilters = []));
+      expect(store).toMatchInlineSnapshot(`
+        ✕ 2, ⚠ 2
+        [root]
+            <ComponentWithError> ✕
+            <ComponentWithWarning> ⚠
+            <ComponentWithWarningAndError> ✕⚠
+      `);
+
+      await actAsync(
+        async () =>
+          (store.componentFilters = [utils.createDisplayNameFilter('Warning')]),
+      );
+      expect(store).toMatchInlineSnapshot(`
+        ✕ 1, ⚠ 0
+        [root]
+            <ComponentWithError> ✕
+      `);
+
+      await actAsync(
+        async () =>
+          (store.componentFilters = [utils.createDisplayNameFilter('Error')]),
+      );
+      expect(store).toMatchInlineSnapshot(`
+        ✕ 0, ⚠ 1
+        [root]
+            <ComponentWithWarning> ⚠
+      `);
+
+      await actAsync(
+        async () =>
+          (store.componentFilters = [
+            utils.createDisplayNameFilter('Warning'),
+            utils.createDisplayNameFilter('Error'),
+          ]),
+      );
+      expect(store).toMatchInlineSnapshot(`[root]`);
+      expect(store.errorCount).toBe(0);
+      expect(store.warningCount).toBe(0);
+
+      await actAsync(async () => (store.componentFilters = []));
+      expect(store).toMatchInlineSnapshot(`
+        ✕ 2, ⚠ 2
+        [root]
+            <ComponentWithError> ✕
+            <ComponentWithWarning> ⚠
+            <ComponentWithWarningAndError> ✕⚠
+      `);
+    });
+
+    // @reactVersion >= 18
+    it('only counts for unfiltered components (createRoot)', async () => {
+      function ComponentWithWarning() {
+        console.warn('test-only: render warning');
+        return null;
+      }
+      function ComponentWithError() {
+        console.error('test-only: render error');
+        return null;
+      }
+      function ComponentWithWarningAndError() {
+        console.error('test-only: render error');
+        console.warn('test-only: render warning');
+        return null;
+      }
+
+      await actAsync(
+        async () =>
+          (store.componentFilters = [
+            utils.createDisplayNameFilter('Warning'),
+            utils.createDisplayNameFilter('Error'),
+          ]),
+      );
+
+      utils.act(
+        () =>
+          utils.withErrorsOrWarningsIgnored(['test-only:'], () => {
+            render(
+              <React.Fragment>
+                <ComponentWithError />
+                <ComponentWithWarning />
+                <ComponentWithWarningAndError />
+              </React.Fragment>,
+            );
+          }),
+        false,
+      );
+
+      expect(store).toMatchInlineSnapshot(``);
+      expect(store.errorCount).toBe(0);
+      expect(store.warningCount).toBe(0);
+
+      await actAsync(async () => (store.componentFilters = []));
       expect(store).toMatchInlineSnapshot(`
         ✕ 2, ⚠ 2
         [root]
@@ -450,7 +518,7 @@ describe('Store component filters', () => {
             <ComponentWithWarningAndError> ✕⚠
       `);
 
-      await act(
+      await actAsync(
         async () =>
           (store.componentFilters = [utils.createDisplayNameFilter('Warning')]),
       );
@@ -460,7 +528,7 @@ describe('Store component filters', () => {
             <ComponentWithError> ✕
       `);
 
-      await act(
+      await actAsync(
         async () =>
           (store.componentFilters = [utils.createDisplayNameFilter('Error')]),
       );
@@ -470,7 +538,7 @@ describe('Store component filters', () => {
             <ComponentWithWarning> ⚠
       `);
 
-      await act(
+      await actAsync(
         async () =>
           (store.componentFilters = [
             utils.createDisplayNameFilter('Warning'),
@@ -481,7 +549,7 @@ describe('Store component filters', () => {
       expect(store.errorCount).toBe(0);
       expect(store.warningCount).toBe(0);
 
-      await act(async () => (store.componentFilters = []));
+      await actAsync(async () => (store.componentFilters = []));
       expect(store).toMatchInlineSnapshot(`
         ✕ 2, ⚠ 2
         [root]

commit 37d901e2b81e12d40df7012c6f8681b8272d2555
Author: Sebastian Markbåge <sebastian@calyptus.eu>
Date:   Wed Feb 7 13:38:00 2024 -0800

    Remove __self and __source location from elements (#28265)
    
    Along with all the places using it like the `_debugSource` on Fiber.
    This still lets them be passed into `createElement` (and JSX dev
    runtime) since those can still be used in existing already compiled code
    and we don't want that to start spreading to DOM attributes.
    
    We used to have a DEV mode that compiles the source location of JSX into
    the compiled output. This was nice because we could get the actual call
    site of the JSX (instead of just somewhere in the component). It had a
    bunch of issues though:
    
    - It only works with JSX.
    - The way this source location is compiled is different in all the
    pipelines along the way. It relies on this transform being first and the
    source location we want to extract but it doesn't get preserved along
    source maps and don't have a way to be connected to the source hosted by
    the source maps. Ideally it should just use the mechanism other source
    maps use.
    - Since it's expensive it only works in DEV so if it's used for
    component stacks it would vary between dev and prod.
    - It only captures the callsite of the JSX and not the stack between the
    component and that callsite. In the happy case it's in the component but
    not always.
    
    Instead, we have another zero-cost trick to extract the call site of
    each component lazily only if it's needed. This ensures that component
    stacks are the same in DEV and PROD. At the cost of worse line number
    information.
    
    The better way to get the JSX call site would be to get it from `new
    Error()` or `console.createTask()` inside the JSX runtime which can
    capture the whole stack in a consistent way with other source mappings.
    We might explore that in the future.
    
    This removes source location info from React DevTools and React Native
    Inspector. The "jump to source code" feature or inspection can be made
    lazy instead by invoking the lazy component stack frame generation. That
    way it can be made to work in prod too. The filtering based on file path
    is a bit trickier.
    
    When redesigned this UI should ideally also account for more than one
    stack frame.
    
    With this change the DEV only Babel transforms are effectively
    deprecated since they're not necessary for anything.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 573ca40cba..571302961d 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -242,7 +242,13 @@ describe('Store component filters', () => {
         ]),
     );
 
-    expect(store).toMatchInlineSnapshot(`[root]`);
+    // TODO: Filtering should work on component location.
+    // expect(store).toMatchInlineSnapshot(`[root]`);
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Component>
+            <div>
+    `);
 
     await actAsync(
       async () =>

commit 61bd00498d2a6e23885bac42f3aeb0e02cadb8eb
Author: Ruslan Lesiutin <rdlesyutin@gmail.com>
Date:   Tue Mar 5 12:10:36 2024 +0000

    refactor[devtools]: lazily define source for fiber based on component stacks (#28351)
    
    `_debugSource` was removed in
    https://github.com/facebook/react/pull/28265.
    
    This PR migrates DevTools to define `source` for Fiber based on
    component stacks. This will be done lazily for inspected elements, once
    user clicks on the element in the tree.
    
    `DevToolsComponentStackFrame.js` was just copy-pasted from the
    implementation in `ReactComponentStackFrame`.
    
    Symbolication part is done in
    https://github.com/facebook/react/pull/28471 and stacked on this commit.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 571302961d..895c9d521a 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -224,11 +224,16 @@ describe('Store component filters', () => {
     `);
   });
 
+  // Disabled: filtering by path was removed, source is now determined lazily, including symbolication if applicable
   // @reactVersion >= 16.0
-  it('should filter by path', async () => {
-    const Component = () => <div>Hi</div>;
+  xit('should filter by path', async () => {
+    // This component should use props object in order to throw for component stack generation
+    // See ReactComponentStackFrame:155 or DevToolsComponentStackFrame:147
+    const Component = props => {
+      return <div>{props.message}</div>;
+    };
 
-    await actAsync(async () => render(<Component />));
+    await actAsync(async () => render(<Component message="Hi" />));
     expect(store).toMatchInlineSnapshot(`
       [root]
         ▾ <Component>
@@ -242,13 +247,7 @@ describe('Store component filters', () => {
         ]),
     );
 
-    // TODO: Filtering should work on component location.
-    // expect(store).toMatchInlineSnapshot(`[root]`);
-    expect(store).toMatchInlineSnapshot(`
-      [root]
-        ▾ <Component>
-            <div>
-    `);
+    expect(store).toMatchInlineSnapshot(`[root]`);
 
     await actAsync(
       async () =>
@@ -497,19 +496,17 @@ describe('Store component filters', () => {
           ]),
       );
 
-      utils.act(
-        () =>
-          utils.withErrorsOrWarningsIgnored(['test-only:'], () => {
-            render(
-              <React.Fragment>
-                <ComponentWithError />
-                <ComponentWithWarning />
-                <ComponentWithWarningAndError />
-              </React.Fragment>,
-            );
-          }),
-        false,
-      );
+      utils.withErrorsOrWarningsIgnored(['test-only:'], () => {
+        utils.act(() => {
+          render(
+            <React.Fragment>
+              <ComponentWithError />
+              <ComponentWithWarning />
+              <ComponentWithWarningAndError />
+            </React.Fragment>,
+          );
+        }, false);
+      });
 
       expect(store).toMatchInlineSnapshot(``);
       expect(store.errorCount).toBe(0);

commit d172bdaf95b0be869f7d36b87c95a5f12b229195
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Jun 10 14:31:37 2024 -0400

    Add jest lint rules (#29760)
    
    ## Overview
    
    Updates `eslint-plugin-jest` and enables the recommended rules with some
    turned off that are unhelpful.
    
    The main motivations is:
    a) we have a few duplicated tests, which this found an I deleted
    b) making sure we don't accidentally commit skipped tests

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 895c9d521a..432fb1771b 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -226,7 +226,8 @@ describe('Store component filters', () => {
 
   // Disabled: filtering by path was removed, source is now determined lazily, including symbolication if applicable
   // @reactVersion >= 16.0
-  xit('should filter by path', async () => {
+  // eslint-disable-next-line jest/no-disabled-tests
+  it.skip('should filter by path', async () => {
     // This component should use props object in order to throw for component stack generation
     // See ReactComponentStackFrame:155 or DevToolsComponentStackFrame:147
     const Component = props => {

commit a15bbe14751287cb7ac124ff88f694d0883f3ac6
Author: Ruslan Lesiutin <rdlesyutin@gmail.com>
Date:   Tue Sep 24 19:51:21 2024 +0100

    refactor: data source for errors and warnings tracking is now in Store (#31010)
    
    Stacked on https://github.com/facebook/react/pull/31009.
    
    1. Instead of keeping `showInlineWarningsAndErrors` in `Settings`
    context (which was removed in
    https://github.com/facebook/react/pull/30610), `Store` will now have a
    boolean flag, which controls if the UI should be displaying information
    about errors and warnings.
    2. The errors and warnings counters in the Tree view are now counting
    only unique errors. This makes more sense, because it is part of the
    Elements Tree view, so ideally it should be showing number of components
    with errors and number of components of warnings. Consider this example:
    2.1. Warning for element `A` was emitted once and warning for element
    `B` was emitted twice.
    2.2. With previous implementation, we would show `3 ⚠️`, because in
    total there were 3 warnings in total. If user tries to iterate through
    these, it will only take 2 steps to do the full cycle, because there are
    only 2 elements with warnings (with one having same warning, which was
    emitted twice).
    2.3 With current implementation, we would show `2 ⚠️`. Inspecting the
    element with doubled warning will still show the warning counter (2)
    before the warning message.
    
    With these changes, the feature correctly works.
    https://fburl.com/a7fw92m4

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 432fb1771b..26cd513832 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -420,8 +420,8 @@ describe('Store component filters', () => {
       });
 
       expect(store).toMatchInlineSnapshot(``);
-      expect(store.errorCount).toBe(0);
-      expect(store.warningCount).toBe(0);
+      expect(store.componentWithErrorCount).toBe(0);
+      expect(store.componentWithWarningCount).toBe(0);
 
       await actAsync(async () => (store.componentFilters = []));
       expect(store).toMatchInlineSnapshot(`
@@ -460,8 +460,8 @@ describe('Store component filters', () => {
           ]),
       );
       expect(store).toMatchInlineSnapshot(`[root]`);
-      expect(store.errorCount).toBe(0);
-      expect(store.warningCount).toBe(0);
+      expect(store.componentWithErrorCount).toBe(0);
+      expect(store.componentWithWarningCount).toBe(0);
 
       await actAsync(async () => (store.componentFilters = []));
       expect(store).toMatchInlineSnapshot(`
@@ -510,8 +510,8 @@ describe('Store component filters', () => {
       });
 
       expect(store).toMatchInlineSnapshot(``);
-      expect(store.errorCount).toBe(0);
-      expect(store.warningCount).toBe(0);
+      expect(store.componentWithErrorCount).toBe(0);
+      expect(store.componentWithWarningCount).toBe(0);
 
       await actAsync(async () => (store.componentFilters = []));
       expect(store).toMatchInlineSnapshot(`
@@ -550,8 +550,8 @@ describe('Store component filters', () => {
           ]),
       );
       expect(store).toMatchInlineSnapshot(`[root]`);
-      expect(store.errorCount).toBe(0);
-      expect(store.warningCount).toBe(0);
+      expect(store.componentWithErrorCount).toBe(0);
+      expect(store.componentWithWarningCount).toBe(0);
 
       await actAsync(async () => (store.componentFilters = []));
       expect(store).toMatchInlineSnapshot(`

commit 1a191701fe5000098d23328b2ea9d70457fea1f8
Author: Rick Hanlon <rickhanlonii@gmail.com>
Date:   Mon Mar 17 09:17:00 2025 -0400

    [refactor] Add element type for Activity (#32499)
    
    This PR separates Activity to it's own element type separate from
    Offscreen. The goal is to allow us to add Activity element boundary
    semantics during hydration similar to Suspense semantics, without
    impacting the Offscreen behavior in suspended children.

diff --git a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
index 26cd513832..5f00af92bf 100644
--- a/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
+++ b/packages/react-devtools-shared/src/__tests__/storeComponentFilters-test.js
@@ -135,6 +135,172 @@ describe('Store component filters', () => {
   });
 
   // @reactVersion >= 16.0
+  it('should filter Suspense', async () => {
+    const Suspense = React.Suspense;
+    await actAsync(async () =>
+      render(
+        <React.Fragment>
+          <Suspense>
+            <div>Visible</div>
+          </Suspense>
+          <Suspense>
+            <div>Hidden</div>
+          </Suspense>
+        </React.Fragment>,
+      ),
+    );
+
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Suspense>
+            <div>
+        ▾ <Suspense>
+            <div>
+    `);
+
+    await actAsync(
+      async () =>
+        (store.componentFilters = [
+          utils.createElementTypeFilter(Types.ElementTypeActivity),
+        ]),
+    );
+
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Suspense>
+            <div>
+        ▾ <Suspense>
+            <div>
+    `);
+
+    await actAsync(
+      async () =>
+        (store.componentFilters = [
+          utils.createElementTypeFilter(Types.ElementTypeActivity, false),
+        ]),
+    );
+
+    expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Suspense>
+            <div>
+        ▾ <Suspense>
+            <div>
+    `);
+  });
+
+  it('should filter Activity', async () => {
+    const Activity = React.unstable_Activity;
+
+    if (Activity != null) {
+      await actAsync(async () =>
+        render(
+          <React.Fragment>
+            <Activity mode="visible">
+              <div>Visible</div>
+            </Activity>
+            <Activity mode="hidden">
+              <div>Hidden</div>
+            </Activity>
+          </React.Fragment>,
+        ),
+      );
+
+      expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Activity>
+            <div>
+        ▾ <Activity>
+            <div>
+    `);
+
+      await actAsync(
+        async () =>
+          (store.componentFilters = [
+            utils.createElementTypeFilter(Types.ElementTypeActivity),
+          ]),
+      );
+
+      expect(store).toMatchInlineSnapshot(`
+      [root]
+          <div>
+          <div>
+    `);
+
+      await actAsync(
+        async () =>
+          (store.componentFilters = [
+            utils.createElementTypeFilter(Types.ElementTypeActivity, false),
+          ]),
+      );
+
+      expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <Activity>
+            <div>
+        ▾ <Activity>
+            <div>
+    `);
+    }
+  });
+
+  it('should filter ViewTransition', async () => {
+    const ViewTransition = React.unstable_ViewTransition;
+
+    if (ViewTransition != null) {
+      await actAsync(async () =>
+        render(
+          <React.Fragment>
+            <ViewTransition>
+              <div>Visible</div>
+            </ViewTransition>
+            <ViewTransition>
+              <div>Hidden</div>
+            </ViewTransition>
+          </React.Fragment>,
+        ),
+      );
+
+      expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <ViewTransition>
+            <div>
+        ▾ <ViewTransition>
+            <div>
+    `);
+
+      await actAsync(
+        async () =>
+          (store.componentFilters = [
+            utils.createElementTypeFilter(Types.ElementTypeActivity),
+          ]),
+      );
+
+      expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <ViewTransition>
+            <div>
+        ▾ <ViewTransition>
+            <div>
+    `);
+
+      await actAsync(
+        async () =>
+          (store.componentFilters = [
+            utils.createElementTypeFilter(Types.ElementTypeActivity, false),
+          ]),
+      );
+
+      expect(store).toMatchInlineSnapshot(`
+      [root]
+        ▾ <ViewTransition>
+            <div>
+        ▾ <ViewTransition>
+            <div>
+    `);
+    }
+  });
+
   it('should ignore invalid ElementTypeRoot filter', async () => {
     const Component = () => <div>Hi</div>;
 

