# Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- packages/editor/src/lib/constants.ts

commit 29ed921c6745923dcc8daa72ba6f815a5c4b279a
Author: alex <alex@dytry.ch>
Date:   Tue Apr 25 12:01:25 2023 +0100

    transfer-out: transfer out

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
new file mode 100644
index 000000000..60e0fa8fe
--- /dev/null
+++ b/packages/editor/src/lib/constants.ts
@@ -0,0 +1,291 @@
+import { EASINGS } from '@tldraw/primitives'
+import { TLAlignType, TLFontType, TLSizeType, TLStyleCollections } from '@tldraw/tlschema'
+
+/** @internal */
+export const MAX_SHAPES_PER_PAGE = 2000
+/** @internal */
+export const MAX_PAGES = 40
+
+/** @internal */
+export const REMOVE_SYMBOL = Symbol('remove')
+
+/** @internal */
+export const RICH_TYPES: Record<string, boolean> = {
+	Date: true,
+	RegExp: true,
+	String: true,
+	Number: true,
+}
+
+/** @internal */
+export const ANIMATION_SHORT_MS = 80
+/** @internal */
+export const ANIMATION_MEDIUM_MS = 320
+
+/** @internal */
+export const ZOOMS = [0.1, 0.25, 0.5, 1, 2, 4, 8]
+/** @internal */
+export const MIN_ZOOM = 0.1
+/** @internal */
+export const MAX_ZOOM = 8
+
+/** @internal */
+export const FOLLOW_CHASE_PROPORTION = 0.5
+/** @internal */
+export const FOLLOW_CHASE_PAN_SNAP = 0.1
+/** @internal */
+export const FOLLOW_CHASE_PAN_UNSNAP = 0.2
+/** @internal */
+export const FOLLOW_CHASE_ZOOM_SNAP = 0.005
+/** @internal */
+export const FOLLOW_CHASE_ZOOM_UNSNAP = 0.05
+
+/** @internal */
+export const MAJOR_NUDGE_FACTOR = 10
+/** @internal */
+export const MINOR_NUDGE_FACTOR = 1
+
+/** @internal */
+export const MAX_ASSET_WIDTH = 1000
+/** @internal */
+export const MAX_ASSET_HEIGHT = 1000
+
+/** @internal */
+export const GRID_INCREMENT = 5
+
+/** @internal */
+export const MIN_CROP_SIZE = 8
+
+/** @internal */
+export const DOUBLE_CLICK_DURATION = 450
+/** @internal */
+export const MULTI_CLICK_DURATION = 200
+
+/** @internal */
+export const DRAG_DISTANCE = 4
+
+/** @internal */
+export const SVG_PADDING = 32
+
+/** @internal */
+export const HASH_PATERN_ZOOM_NAMES: Record<string, string> = {}
+
+for (let zoom = 1; zoom <= Math.ceil(MAX_ZOOM); zoom++) {
+	HASH_PATERN_ZOOM_NAMES[zoom + '_dark'] = `hash_pattern_zoom_${zoom}_dark`
+	HASH_PATERN_ZOOM_NAMES[zoom + '_light'] = `hash_pattern_zoom_${zoom}_light`
+}
+
+/** @internal */
+export const DEFAULT_ANIMATION_OPTIONS = {
+	duration: 0,
+	easing: EASINGS.easeInOutCubic,
+}
+
+/** @internal */
+export const HAND_TOOL_FRICTION = 0.09
+
+/** @internal */
+export const MIN_ARROW_LENGTH = 48
+/** @internal */
+export const BOUND_ARROW_OFFSET = 10
+/** @internal */
+export const WAY_TOO_BIG_ARROW_BEND_FACTOR = 10
+
+/** @internal */
+export const DEFAULT_BOOKMARK_WIDTH = 300
+
+/** @internal */
+export const DEFAULT_BOOKMARK_HEIGHT = 320
+
+/** @public */
+export const ROTATING_SHADOWS = [
+	{
+		offsetX: 0,
+		offsetY: 2,
+		blur: 4,
+		spread: 0,
+		color: '#00000029',
+	},
+	{
+		offsetX: 0,
+		offsetY: 3,
+		blur: 6,
+		spread: 0,
+		color: '#0000001f',
+	},
+]
+
+/** @public */
+export const GRID_STEPS = [
+	{ min: -1, mid: 0.15, step: 100 },
+	{ min: 0.05, mid: 0.375, step: 25 },
+	{ min: 0.15, mid: 1, step: 5 },
+	{ min: 0.7, mid: 2.5, step: 1 },
+]
+
+/** @public */
+export const TEXT_PROPS = {
+	lineHeight: 1.35,
+	fontWeight: 'normal',
+	fontVariant: 'normal',
+	fontStyle: 'normal',
+	padding: '0px',
+	maxWidth: 'auto',
+}
+
+/** @public */
+export const FONT_SIZES: Record<TLSizeType, number> = {
+	s: 18,
+	m: 24,
+	l: 36,
+	xl: 44,
+}
+
+/** @public */
+export const LABEL_FONT_SIZES: Record<TLSizeType, number> = {
+	s: 18,
+	m: 22,
+	l: 26,
+	xl: 32,
+}
+
+/** @public */
+export const ARROW_LABEL_FONT_SIZES: Record<TLSizeType, number> = {
+	s: 18,
+	m: 20,
+	l: 24,
+	xl: 28,
+}
+
+/** @public */
+export const ICON_SIZES: Record<TLSizeType, number> = {
+	s: 16,
+	m: 32,
+	l: 48,
+	xl: 64,
+}
+
+/** @public */
+export const FONT_FAMILIES: Record<TLFontType, string> = {
+	draw: 'var(--rs-font-draw)',
+	sans: 'var(--rs-font-sans)',
+	serif: 'var(--rs-font-serif)',
+	mono: 'var(--rs-font-mono)',
+}
+
+/** @public */
+export const FONT_ALIGNMENT: Record<TLAlignType, string> = {
+	middle: 'center',
+	start: 'left',
+	end: 'right',
+}
+
+/** @public */
+export const STYLES: TLStyleCollections = {
+	color: [
+		{ id: 'black', type: 'color', icon: 'color' },
+		{ id: 'grey', type: 'color', icon: 'color' },
+		{ id: 'light-violet', type: 'color', icon: 'color' },
+		{ id: 'violet', type: 'color', icon: 'color' },
+		{ id: 'blue', type: 'color', icon: 'color' },
+		{ id: 'light-blue', type: 'color', icon: 'color' },
+		{ id: 'yellow', type: 'color', icon: 'color' },
+		{ id: 'orange', type: 'color', icon: 'color' },
+		{ id: 'green', type: 'color', icon: 'color' },
+		{ id: 'light-green', type: 'color', icon: 'color' },
+		{ id: 'light-red', type: 'color', icon: 'color' },
+		{ id: 'red', type: 'color', icon: 'color' },
+	],
+	fill: [
+		{ id: 'none', type: 'fill', icon: 'fill-none' },
+		{ id: 'semi', type: 'fill', icon: 'fill-semi' },
+		{ id: 'solid', type: 'fill', icon: 'fill-solid' },
+		{ id: 'pattern', type: 'fill', icon: 'fill-pattern' },
+	],
+	dash: [
+		{ id: 'draw', type: 'dash', icon: 'dash-draw' },
+		{ id: 'dashed', type: 'dash', icon: 'dash-dashed' },
+		{ id: 'dotted', type: 'dash', icon: 'dash-dotted' },
+		{ id: 'solid', type: 'dash', icon: 'dash-solid' },
+	],
+	size: [
+		{ id: 's', type: 'size', icon: 'size-small' },
+		{ id: 'm', type: 'size', icon: 'size-medium' },
+		{ id: 'l', type: 'size', icon: 'size-large' },
+		{ id: 'xl', type: 'size', icon: 'size-extra-large' },
+	],
+	opacity: [
+		{ id: '0.1', type: 'opacity', icon: 'color' },
+		{ id: '0.25', type: 'opacity', icon: 'color' },
+		{ id: '0.5', type: 'opacity', icon: 'color' },
+		{ id: '0.75', type: 'opacity', icon: 'color' },
+		{ id: '1', type: 'opacity', icon: 'color' },
+	],
+	font: [
+		{ id: 'draw', type: 'font', icon: 'font-draw' },
+		{ id: 'sans', type: 'font', icon: 'font-sans' },
+		{ id: 'serif', type: 'font', icon: 'font-serif' },
+		{ id: 'mono', type: 'font', icon: 'font-mono' },
+	],
+	align: [
+		{ id: 'start', type: 'align', icon: 'text-align-left' },
+		{ id: 'middle', type: 'align', icon: 'text-align-center' },
+		{ id: 'end', type: 'align', icon: 'text-align-right' },
+	],
+	geo: [
+		{ id: 'rectangle', type: 'geo', icon: 'geo-rectangle' },
+		{ id: 'ellipse', type: 'geo', icon: 'geo-ellipse' },
+		{ id: 'triangle', type: 'geo', icon: 'geo-triangle' },
+		{ id: 'diamond', type: 'geo', icon: 'geo-diamond' },
+		{ id: 'pentagon', type: 'geo', icon: 'geo-pentagon' },
+		{ id: 'hexagon', type: 'geo', icon: 'geo-hexagon' },
+		{ id: 'octagon', type: 'geo', icon: 'geo-octagon' },
+		{ id: 'star', type: 'geo', icon: 'geo-star' },
+		{ id: 'rhombus', type: 'geo', icon: 'geo-rhombus' },
+		{ id: 'rhombus-2', type: 'geo', icon: 'geo-rhombus-2' },
+		{ id: 'oval', type: 'geo', icon: 'geo-oval' },
+		{ id: 'trapezoid', type: 'geo', icon: 'geo-trapezoid' },
+		{ id: 'arrow-right', type: 'geo', icon: 'geo-arrow-right' },
+		{ id: 'arrow-left', type: 'geo', icon: 'geo-arrow-left' },
+		{ id: 'arrow-up', type: 'geo', icon: 'geo-arrow-up' },
+		{ id: 'arrow-down', type: 'geo', icon: 'geo-arrow-down' },
+		{ id: 'x-box', type: 'geo', icon: 'geo-x-box' },
+	],
+	arrowheadStart: [
+		{ id: 'none', type: 'arrowheadStart', icon: 'arrowhead-none' },
+		{ id: 'arrow', type: 'arrowheadStart', icon: 'arrowhead-arrow' },
+		{ id: 'triangle', type: 'arrowheadStart', icon: 'arrowhead-triangle' },
+		{ id: 'square', type: 'arrowheadStart', icon: 'arrowhead-square' },
+		{ id: 'dot', type: 'arrowheadStart', icon: 'arrowhead-dot' },
+		{ id: 'diamond', type: 'arrowheadStart', icon: 'arrowhead-diamond' },
+		{ id: 'inverted', type: 'arrowheadStart', icon: 'arrowhead-triangle-inverted' },
+		{ id: 'bar', type: 'arrowheadStart', icon: 'arrowhead-bar' },
+	],
+	arrowheadEnd: [
+		{ id: 'none', type: 'arrowheadEnd', icon: 'arrowhead-none' },
+		{ id: 'arrow', type: 'arrowheadEnd', icon: 'arrowhead-arrow' },
+		{ id: 'triangle', type: 'arrowheadEnd', icon: 'arrowhead-triangle' },
+		{ id: 'square', type: 'arrowheadEnd', icon: 'arrowhead-square' },
+		{ id: 'dot', type: 'arrowheadEnd', icon: 'arrowhead-dot' },
+		{ id: 'diamond', type: 'arrowheadEnd', icon: 'arrowhead-diamond' },
+		{ id: 'inverted', type: 'arrowheadEnd', icon: 'arrowhead-triangle-inverted' },
+		{ id: 'bar', type: 'arrowheadEnd', icon: 'arrowhead-bar' },
+	],
+	spline: [
+		{ id: 'line', type: 'spline', icon: 'spline-line' },
+		{ id: 'cubic', type: 'spline', icon: 'spline-cubic' },
+	],
+}
+
+// These props should not cause App.props to update
+export const BLACKLISTED_PROPS = new Set([
+	'bend',
+	'w',
+	'h',
+	'start',
+	'end',
+	'text',
+	'name',
+	'url',
+	'growY',
+])

commit dc16ae1b1267b89b85f501ad2e979f618089a89b
Author: Lu[ke] Wilson <l2wilson94@gmail.com>
Date:   Fri May 5 07:14:42 2023 -0700

    remove svg layer, html all the things, rs to tl (#1227)
    
    This PR has been hijacked! üóëÔ∏èü¶ùü¶ùü¶ù
    
    The <Canvas> component was previously split into an <SVGLayer> and an
    <HTMLLayer>, mainly due to the complexity around translating SVGs.
    However, this was done before we learned that SVGs can have overflow:
    visible, so it turns out that we don't really need the SVGLayer at all.
    This PR now refactors away SVG Layer.
    
    It also updates the class name prefix in editor from `rs-` to `tl-` and
    does a few other small changes.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 60e0fa8fe..c23449613 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -167,10 +167,10 @@ export const ICON_SIZES: Record<TLSizeType, number> = {
 
 /** @public */
 export const FONT_FAMILIES: Record<TLFontType, string> = {
-	draw: 'var(--rs-font-draw)',
-	sans: 'var(--rs-font-sans)',
-	serif: 'var(--rs-font-serif)',
-	mono: 'var(--rs-font-mono)',
+	draw: 'var(--tl-font-draw)',
+	sans: 'var(--tl-font-sans)',
+	serif: 'var(--tl-font-serif)',
+	mono: 'var(--tl-font-mono)',
 }
 
 /** @public */

commit aab47a14743a6bb9fc232ef2b3b5db9800f1bfa7
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri May 5 15:48:49 2023 +0100

    [improvement] dragging start distance on coarse pointer (#1220)
    
    This PR slightly increases the distance needed to initiate a drag when
    using a coarse pointer.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index c23449613..075b542d2 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -61,6 +61,9 @@ export const DOUBLE_CLICK_DURATION = 450
 /** @internal */
 export const MULTI_CLICK_DURATION = 200
 
+/** @internal */
+export const COARSE_DRAG_DISTANCE = 6
+
 /** @internal */
 export const DRAG_DISTANCE = 4
 

commit bb96852b9d11c4ff48b999bfff5eed39d3dc471f
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue May 9 14:32:04 2023 +0100

    [feature] `check-box` geo shape (#1330)
    
    This PR adds a `check-box` geo shape.
    
    ![Kapture 2023-05-08 at 15 31
    49](https://user-images.githubusercontent.com/23072548/236853749-99ba786f-73a4-4b65-86ca-f2cdac61a903.gif)
    
    It also improves some logic around the `onClick` shape util handler and
    some surprisingly related fixes to point hit testing.
    
    ### Test Plan
    
    1. Create a geo shape
    2. Set it as a checkbox style
    3. *easter egg* double click while holding alt to toggle between
    check-box and rectangle
    
    - [x] Unit Tests
    
    ### Release Note
    
    - Adds checkbox geo shape.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 075b542d2..f03e6b14a 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -253,6 +253,7 @@ export const STYLES: TLStyleCollections = {
 		{ id: 'arrow-up', type: 'geo', icon: 'geo-arrow-up' },
 		{ id: 'arrow-down', type: 'geo', icon: 'geo-arrow-down' },
 		{ id: 'x-box', type: 'geo', icon: 'geo-x-box' },
+		{ id: 'check-box', type: 'geo', icon: 'geo-check-box' },
 	],
 	arrowheadStart: [
 		{ id: 'none', type: 'arrowheadStart', icon: 'arrowhead-none' },

commit f59bfe01b18b4bc45d55c88e14d3883e7197d76b
Author: Mitja Bezen≈°ek <mitja.bezensek@gmail.com>
Date:   Fri May 19 12:23:43 2023 +0200

    Vertical text alignment for geo shapes (#1414)
    
    Vertical text alignment for geo shapes.
    
    ### Change Type
    
    - [x] `minor` ‚Äî New Feature
    
    ### Test Plan
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [ ] Unit Tests
    - [ ] Webdriver tests
    
    ### Release Notes
    
    - This adds vertical text alignment property to geo shapes.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index f03e6b14a..eb8dfdc16 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -235,6 +235,11 @@ export const STYLES: TLStyleCollections = {
 		{ id: 'middle', type: 'align', icon: 'text-align-center' },
 		{ id: 'end', type: 'align', icon: 'text-align-right' },
 	],
+	verticalAlign: [
+		{ id: 'start', type: 'verticalAlign', icon: 'vertical-align-start' },
+		{ id: 'middle', type: 'verticalAlign', icon: 'vertical-align-center' },
+		{ id: 'end', type: 'verticalAlign', icon: 'vertical-align-end' },
+	],
 	geo: [
 		{ id: 'rectangle', type: 'geo', icon: 'geo-rectangle' },
 		{ id: 'ellipse', type: 'geo', icon: 'geo-ellipse' },

commit 735f1c41b79a3fcce14446b6384ec796f0298a31
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jun 2 16:21:45 2023 +0100

    rename app to editor (#1503)
    
    This PR renames `App`, `app` and all appy names to `Editor`, `editor`,
    and editorry names.
    
    ### Change Type
    
    - [x] `major` ‚Äî Breaking Change
    
    ### Release Notes
    
    - Rename `App` to `Editor` and many other things that reference `app` to
    `editor`.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index eb8dfdc16..ac23a2d5f 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -286,7 +286,7 @@ export const STYLES: TLStyleCollections = {
 	],
 }
 
-// These props should not cause App.props to update
+// These props should not cause Editor.props to update
 export const BLACKLISTED_PROPS = new Set([
 	'bend',
 	'w',

commit f2d8fae6eaa2b6990210f2d4c42ad976e11e207d
Author: alex <alex@dytry.ch>
Date:   Tue Jun 6 17:15:12 2023 +0100

    hoist opacity out of props (#1526)
    
    This change hoists opacity out of props and changes it to a number
    instead of an enum.
    
    The change to a number is to make tldraw more flexible for library
    consumers who might want more expressivity with opacity than our 5
    possible values allow. the tldraw editor will now happily respect any
    opacity between 0 and 1. The limit to our supported values is enforced
    only in the UI. I think this is limited enough that it's a reasonable
    tradeoff between in-app simplicity and giving external developers the
    flexibility they need.
    
    There's a new `opacityForNextShape` property on the instance. This works
    exactly the same way as propsForNextShape does, except... it's just for
    opacity. With this, there should be no user-facing changes to how
    opacity works in tldraw. There are also new `opacity`/`setOpacity` APIs
    in the editor that work with it/selections similar to how props do.
    
    @ds300 do you mind reviewing the migrations here?
    
    ### Change Type
    
    - [x] `major` ‚Äî Breaking Change
    
    ### Test Plan
    
    - [x] Unit Tests
    - [ ] Webdriver tests
    
    ### Release Notes
    
    [internal only for now]

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index ac23a2d5f..082df50a8 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -217,13 +217,6 @@ export const STYLES: TLStyleCollections = {
 		{ id: 'l', type: 'size', icon: 'size-large' },
 		{ id: 'xl', type: 'size', icon: 'size-extra-large' },
 	],
-	opacity: [
-		{ id: '0.1', type: 'opacity', icon: 'color' },
-		{ id: '0.25', type: 'opacity', icon: 'color' },
-		{ id: '0.5', type: 'opacity', icon: 'color' },
-		{ id: '0.75', type: 'opacity', icon: 'color' },
-		{ id: '1', type: 'opacity', icon: 'color' },
-	],
 	font: [
 		{ id: 'draw', type: 'font', icon: 'font-draw' },
 		{ id: 'sans', type: 'font', icon: 'font-sans' },

commit b65aef5cf21b13d51a1973922eca8ec327312bb1
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jun 13 09:27:54 2023 +0100

    [improvement] Embed shape cleanup (#1569)
    
    This PR does some cleanup around our Embed Shape.
    
    It:
    - removes used `doesResize` and `overridePermissions` props
    - removes the no-longer-needed `tmpOldUrl` prop
    - adds a `canUnmount` property to embed definitions, so that some embeds
    can unmount when desired
    
    ### Change Type
    
    - [x] `patch` ‚Äî Bug Fix
    
    ### Test Plan
    
    1. Create embed shapes
    2. Migrate old data that includes embed shapes?
    
    - [x] Unit Tests
    
    ### Release Notes
    
    - [editor] Remove unused props for `TLEditorShape`
    - [editor] Adds `canUnmount` property to embed definitions

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 082df50a8..dfef18e5d 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -100,24 +100,6 @@ export const DEFAULT_BOOKMARK_WIDTH = 300
 /** @internal */
 export const DEFAULT_BOOKMARK_HEIGHT = 320
 
-/** @public */
-export const ROTATING_SHADOWS = [
-	{
-		offsetX: 0,
-		offsetY: 2,
-		blur: 4,
-		spread: 0,
-		color: '#00000029',
-	},
-	{
-		offsetX: 0,
-		offsetY: 3,
-		blur: 6,
-		spread: 0,
-		color: '#0000001f',
-	},
-]
-
 /** @public */
 export const GRID_STEPS = [
 	{ min: -1, mid: 0.15, step: 100 },

commit f864d0cfbdb067851d3b65a0e9b839f8eb1a375d
Author: Lu Wilson <l2wilson94@gmail.com>
Date:   Thu Jun 15 16:48:47 2023 +0100

    (1/2) Timeout collaborator cursors (#1525)
    
    This PR adds a timeout to collaborator cursors.
    
    It's part 1 of two PRs. The second one is smaller:
    https://github.com/tldraw/brivate/pull/2053
    
    # What is this?
    
    After three seconds of inactivity, collaborator cursors disappear.
    
    ![2023-06-08 at 10 42 43 - Moccasin
    Flamingo](https://github.com/tldraw/tldraw/assets/15892272/93e463aa-0329-4ecb-ada1-4c38b36a655b)
    
    If you're following someone, you can always see their cursor.
    
    ![2023-06-08 at 10 45 42 - Olive
    Crayfish](https://github.com/tldraw/tldraw/assets/15892272/11e8d85a-18a8-4976-85c5-d14f3841c296)
    
    # Is there anything else?
    The PR also adds support for the brivate PR:
    https://github.com/tldraw/brivate/pull/2053
    
    # Admin
    
    ### Change Type
    
    - [x] `minor` ‚Äî New Feature
    
    ### Test Plan
    
    You probably need to test this locally, as we don't do multiplayer
    previews on this repo yet.
    1. Open the same shared project in two browser sessions.
    2. Move around the cursor in one session, while able to see it from the
    other.
    3. Stop moving the cursor.
    4. Make sure that the cursor disappears on the other session after 3
    seconds.
    5. Move the cursor again, and make sure it reappears it.
    6. Make sure that viewport-following the user makes the cursor show
    permanently.
    
    ### Release Notes
    
    - Brought back cursor timeouts. Collaborator cursors now disappear after
    3 seconds of inactivity.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index dfef18e5d..0e7a69c81 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -273,3 +273,17 @@ export const BLACKLISTED_PROPS = new Set([
 	'url',
 	'growY',
 ])
+
+/** @internal */
+export const COLLABORATOR_TIMEOUT = 3000
+
+/** @internal */
+export const COLLABORATOR_CHECK_INTERVAL = 1200
+
+/**
+ * Negative pointer ids are reserved for internal use.
+ *
+ * @internal */
+export const INTERNAL_POINTER_IDS = {
+	CAMERA_MOVE: -10,
+} as const

commit b88a2370b314855237774548d627ed4d3301a1ad
Author: alex <alex@dytry.ch>
Date:   Fri Jun 16 11:33:47 2023 +0100

    Styles API (#1580)
    
    Removes `propsForNextShape` and replaces it with the new styles API.
    
    Changes in here:
    - New custom style example
    - `setProp` is now `setStyle` and takes a `StyleProp` instead of a
    string
    - `Editor.props` and `Editor.opacity` are now `Editor.sharedStyles` and
    `Editor.sharedOpacity`
    - They return an object that flags mixed vs shared types instead of
    using null to signal mixed types
    - `Editor.styles` returns a `SharedStyleMap` - keyed on `StyleProp`
    instead of `string`
    - `StateNode.shapeType` is now the shape util rather than just a string.
    This lets us pull the styles from the shape type directly.
    - `color` is no longer a core part of the editor set on the shape
    parent. Individual child shapes have to use color directly.
    - `propsForNextShape` is now `stylesForNextShape`
    - `InstanceRecordType` is created at runtime in the same way
    `ShapeRecordType` is. This is so it can pull style validators out of
    shape defs for `stylesForNextShape`
    - Shape type are now defined by their props rather than having separate
    validators & type defs
    
    ### Change Type
    
    - [x] `major` ‚Äî Breaking change
    
    ### Test Plan
    
    1. Big time regression testing around styles!
    2. Check UI works as intended for all shape/style/tool combos
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    -
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 0e7a69c81..506bf0cf3 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -1,5 +1,4 @@
 import { EASINGS } from '@tldraw/primitives'
-import { TLAlignType, TLFontType, TLSizeType, TLStyleCollections } from '@tldraw/tlschema'
 
 /** @internal */
 export const MAX_SHAPES_PER_PAGE = 2000
@@ -87,19 +86,6 @@ export const DEFAULT_ANIMATION_OPTIONS = {
 /** @internal */
 export const HAND_TOOL_FRICTION = 0.09
 
-/** @internal */
-export const MIN_ARROW_LENGTH = 48
-/** @internal */
-export const BOUND_ARROW_OFFSET = 10
-/** @internal */
-export const WAY_TOO_BIG_ARROW_BEND_FACTOR = 10
-
-/** @internal */
-export const DEFAULT_BOOKMARK_WIDTH = 300
-
-/** @internal */
-export const DEFAULT_BOOKMARK_HEIGHT = 320
-
 /** @public */
 export const GRID_STEPS = [
 	{ min: -1, mid: 0.15, step: 100 },
@@ -108,172 +94,6 @@ export const GRID_STEPS = [
 	{ min: 0.7, mid: 2.5, step: 1 },
 ]
 
-/** @public */
-export const TEXT_PROPS = {
-	lineHeight: 1.35,
-	fontWeight: 'normal',
-	fontVariant: 'normal',
-	fontStyle: 'normal',
-	padding: '0px',
-	maxWidth: 'auto',
-}
-
-/** @public */
-export const FONT_SIZES: Record<TLSizeType, number> = {
-	s: 18,
-	m: 24,
-	l: 36,
-	xl: 44,
-}
-
-/** @public */
-export const LABEL_FONT_SIZES: Record<TLSizeType, number> = {
-	s: 18,
-	m: 22,
-	l: 26,
-	xl: 32,
-}
-
-/** @public */
-export const ARROW_LABEL_FONT_SIZES: Record<TLSizeType, number> = {
-	s: 18,
-	m: 20,
-	l: 24,
-	xl: 28,
-}
-
-/** @public */
-export const ICON_SIZES: Record<TLSizeType, number> = {
-	s: 16,
-	m: 32,
-	l: 48,
-	xl: 64,
-}
-
-/** @public */
-export const FONT_FAMILIES: Record<TLFontType, string> = {
-	draw: 'var(--tl-font-draw)',
-	sans: 'var(--tl-font-sans)',
-	serif: 'var(--tl-font-serif)',
-	mono: 'var(--tl-font-mono)',
-}
-
-/** @public */
-export const FONT_ALIGNMENT: Record<TLAlignType, string> = {
-	middle: 'center',
-	start: 'left',
-	end: 'right',
-}
-
-/** @public */
-export const STYLES: TLStyleCollections = {
-	color: [
-		{ id: 'black', type: 'color', icon: 'color' },
-		{ id: 'grey', type: 'color', icon: 'color' },
-		{ id: 'light-violet', type: 'color', icon: 'color' },
-		{ id: 'violet', type: 'color', icon: 'color' },
-		{ id: 'blue', type: 'color', icon: 'color' },
-		{ id: 'light-blue', type: 'color', icon: 'color' },
-		{ id: 'yellow', type: 'color', icon: 'color' },
-		{ id: 'orange', type: 'color', icon: 'color' },
-		{ id: 'green', type: 'color', icon: 'color' },
-		{ id: 'light-green', type: 'color', icon: 'color' },
-		{ id: 'light-red', type: 'color', icon: 'color' },
-		{ id: 'red', type: 'color', icon: 'color' },
-	],
-	fill: [
-		{ id: 'none', type: 'fill', icon: 'fill-none' },
-		{ id: 'semi', type: 'fill', icon: 'fill-semi' },
-		{ id: 'solid', type: 'fill', icon: 'fill-solid' },
-		{ id: 'pattern', type: 'fill', icon: 'fill-pattern' },
-	],
-	dash: [
-		{ id: 'draw', type: 'dash', icon: 'dash-draw' },
-		{ id: 'dashed', type: 'dash', icon: 'dash-dashed' },
-		{ id: 'dotted', type: 'dash', icon: 'dash-dotted' },
-		{ id: 'solid', type: 'dash', icon: 'dash-solid' },
-	],
-	size: [
-		{ id: 's', type: 'size', icon: 'size-small' },
-		{ id: 'm', type: 'size', icon: 'size-medium' },
-		{ id: 'l', type: 'size', icon: 'size-large' },
-		{ id: 'xl', type: 'size', icon: 'size-extra-large' },
-	],
-	font: [
-		{ id: 'draw', type: 'font', icon: 'font-draw' },
-		{ id: 'sans', type: 'font', icon: 'font-sans' },
-		{ id: 'serif', type: 'font', icon: 'font-serif' },
-		{ id: 'mono', type: 'font', icon: 'font-mono' },
-	],
-	align: [
-		{ id: 'start', type: 'align', icon: 'text-align-left' },
-		{ id: 'middle', type: 'align', icon: 'text-align-center' },
-		{ id: 'end', type: 'align', icon: 'text-align-right' },
-	],
-	verticalAlign: [
-		{ id: 'start', type: 'verticalAlign', icon: 'vertical-align-start' },
-		{ id: 'middle', type: 'verticalAlign', icon: 'vertical-align-center' },
-		{ id: 'end', type: 'verticalAlign', icon: 'vertical-align-end' },
-	],
-	geo: [
-		{ id: 'rectangle', type: 'geo', icon: 'geo-rectangle' },
-		{ id: 'ellipse', type: 'geo', icon: 'geo-ellipse' },
-		{ id: 'triangle', type: 'geo', icon: 'geo-triangle' },
-		{ id: 'diamond', type: 'geo', icon: 'geo-diamond' },
-		{ id: 'pentagon', type: 'geo', icon: 'geo-pentagon' },
-		{ id: 'hexagon', type: 'geo', icon: 'geo-hexagon' },
-		{ id: 'octagon', type: 'geo', icon: 'geo-octagon' },
-		{ id: 'star', type: 'geo', icon: 'geo-star' },
-		{ id: 'rhombus', type: 'geo', icon: 'geo-rhombus' },
-		{ id: 'rhombus-2', type: 'geo', icon: 'geo-rhombus-2' },
-		{ id: 'oval', type: 'geo', icon: 'geo-oval' },
-		{ id: 'trapezoid', type: 'geo', icon: 'geo-trapezoid' },
-		{ id: 'arrow-right', type: 'geo', icon: 'geo-arrow-right' },
-		{ id: 'arrow-left', type: 'geo', icon: 'geo-arrow-left' },
-		{ id: 'arrow-up', type: 'geo', icon: 'geo-arrow-up' },
-		{ id: 'arrow-down', type: 'geo', icon: 'geo-arrow-down' },
-		{ id: 'x-box', type: 'geo', icon: 'geo-x-box' },
-		{ id: 'check-box', type: 'geo', icon: 'geo-check-box' },
-	],
-	arrowheadStart: [
-		{ id: 'none', type: 'arrowheadStart', icon: 'arrowhead-none' },
-		{ id: 'arrow', type: 'arrowheadStart', icon: 'arrowhead-arrow' },
-		{ id: 'triangle', type: 'arrowheadStart', icon: 'arrowhead-triangle' },
-		{ id: 'square', type: 'arrowheadStart', icon: 'arrowhead-square' },
-		{ id: 'dot', type: 'arrowheadStart', icon: 'arrowhead-dot' },
-		{ id: 'diamond', type: 'arrowheadStart', icon: 'arrowhead-diamond' },
-		{ id: 'inverted', type: 'arrowheadStart', icon: 'arrowhead-triangle-inverted' },
-		{ id: 'bar', type: 'arrowheadStart', icon: 'arrowhead-bar' },
-	],
-	arrowheadEnd: [
-		{ id: 'none', type: 'arrowheadEnd', icon: 'arrowhead-none' },
-		{ id: 'arrow', type: 'arrowheadEnd', icon: 'arrowhead-arrow' },
-		{ id: 'triangle', type: 'arrowheadEnd', icon: 'arrowhead-triangle' },
-		{ id: 'square', type: 'arrowheadEnd', icon: 'arrowhead-square' },
-		{ id: 'dot', type: 'arrowheadEnd', icon: 'arrowhead-dot' },
-		{ id: 'diamond', type: 'arrowheadEnd', icon: 'arrowhead-diamond' },
-		{ id: 'inverted', type: 'arrowheadEnd', icon: 'arrowhead-triangle-inverted' },
-		{ id: 'bar', type: 'arrowheadEnd', icon: 'arrowhead-bar' },
-	],
-	spline: [
-		{ id: 'line', type: 'spline', icon: 'spline-line' },
-		{ id: 'cubic', type: 'spline', icon: 'spline-cubic' },
-	],
-}
-
-// These props should not cause Editor.props to update
-export const BLACKLISTED_PROPS = new Set([
-	'bend',
-	'w',
-	'h',
-	'start',
-	'end',
-	'text',
-	'name',
-	'url',
-	'growY',
-])
-
 /** @internal */
 export const COLLABORATOR_TIMEOUT = 3000
 

commit 271d0088e9962f7bc40984553a610261ed80794a
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jun 16 12:27:47 2023 +0100

    Tidy up (#1600)
    
    This PR is intended to do some housecleaning ahead of our developer
    release.
    
    It:
    - co-locates code in the `Editor` class, i.e. moving shape-related
    methods next to other shape-related methods
    - renames `cullingBounds` and other culling-related names to
    `renderingBounds`
    - renames `Editor.getParentPageId` to `Editor.getAncestorPageId`
    - renames `Editor.shapeIds` to `Editor.currentPageShapeIds`
    
    ### Change Type
    
    - [x] `major` ‚Äî api changes

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 506bf0cf3..3f4eed67a 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -107,3 +107,6 @@ export const COLLABORATOR_CHECK_INTERVAL = 1200
 export const INTERNAL_POINTER_IDS = {
 	CAMERA_MOVE: -10,
 } as const
+
+/** @internal */
+export const CAMERA_MOVING_TIMEOUT = 64

commit bdd8913af30e3c2cd12c58da9e858a9a7d8d46de
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jun 16 14:02:38 2023 +0100

    [fix] camera culling (#1602)
    
    This PR restores camera culling behavior and includes a 500ms forced
    render while the camera is moving to prevent weird long pan behavior.
    
    It:
    - removes `CameraManager`
    - adds `cameraState` to editor
    
    ### Change Type
    
    - [x] `major` ‚Äî Breaking change
    
    ### Release Notes
    
    - [editor] Adds `Editor.cameraState`
    - Adds smart culling to make panning and zooming more smooth

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 3f4eed67a..11444f205 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -110,3 +110,6 @@ export const INTERNAL_POINTER_IDS = {
 
 /** @internal */
 export const CAMERA_MOVING_TIMEOUT = 64
+
+/** @internal */
+export const CAMERA_MAX_RENDERING_INTERVAL = 620

commit e8bc114bf3ccd666079a704880622e300234bf88
Author: alex <alex@dytry.ch>
Date:   Sat Jun 24 14:46:04 2023 +0100

    Styles API follow-ups (#1636)
    
    tldraw-zero themed follow-ups to the styles API added in #1580.
    
    - Removed style related helpers from `ShapeUtil`
    - `editor.css` no longer includes the tldraw default color palette.
    Instead, a global `DefaultColorPalette` is defined as part of the color
    style. If developers wish to cusomise the colors, they can mutate that
    global.
    - `ShapeUtil.toSvg` no longer takes font/color. Instead, it takes an
    "svg export context" that can be used to add `<defs>` to the exported
    SVG element. Converting e.g. fonts to inlined data urls is now the
    responsibility of the shapes that use them rather than the Editor.
    - `usePattern` is not longer a core part of the editor. Instead,
    `ShapeUtil` has a `getCanvasSvgDefs` method for returning react
    components representing anything a shape needs included in `<defs>` for
    the canvas.
    - The shape-specific cleanup logic in `setStyle` has been deleted. It
    turned out that none of that logic has been running anyway, and instead
    the relevant logic lives in shape `onBeforeChange` callbacks already.
    
    ### Change Type
    - [x] `minor` ‚Äî New feature
    
    ### Test Plan
    
    
    - [x] Unit Tests
    - [x] End to end tests
    
    ### Release Notes
     --
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 11444f205..89b8653b2 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -70,11 +70,11 @@ export const DRAG_DISTANCE = 4
 export const SVG_PADDING = 32
 
 /** @internal */
-export const HASH_PATERN_ZOOM_NAMES: Record<string, string> = {}
+export const HASH_PATTERN_ZOOM_NAMES: Record<string, string> = {}
 
 for (let zoom = 1; zoom <= Math.ceil(MAX_ZOOM); zoom++) {
-	HASH_PATERN_ZOOM_NAMES[zoom + '_dark'] = `hash_pattern_zoom_${zoom}_dark`
-	HASH_PATERN_ZOOM_NAMES[zoom + '_light'] = `hash_pattern_zoom_${zoom}_light`
+	HASH_PATTERN_ZOOM_NAMES[zoom + '_dark'] = `hash_pattern_zoom_${zoom}_dark`
+	HASH_PATTERN_ZOOM_NAMES[zoom + '_light'] = `hash_pattern_zoom_${zoom}_light`
 }
 
 /** @internal */

commit eb6aa9bbe42e23f10f490ae0e408ed0cf997d483
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jun 30 13:46:07 2023 +0100

    [improvement] More nuanced cursor state (#1682)
    
    This PR adds some more nuance to collaborator cursors.
    
    Rather than being timed out or not timed out, a collaborator can now be
    `active`, `idle` or `inactive`.
    
    We calculate this based on the difference between the time that has
    elapsed since the user's last activity timestamp.
    
    After 3 seconds of inactivity, they go `idle`.
    After sixty seconds of inactivity, they are `inactive`.
    After any activity, they become `active` again.
    
    When a user is `active`, we always show their cursor.
    When a user is `idle`, we hide their cursor if they're following us,
    unless they're highlighted
    When a user is `inactive`, we hide their cursor unless they're
    highlighted.
    
    ### Change Type
    
    - [x] `minor`
    
    ### Test Plan
    
    1. Find a friend and experiment with inactive times
    2. Join a room that includes an inactive cursors; they should be hidden
    on load
    3. Have people follow you; do their timeouts feel natural?
    
    ### Release Notes
    
    - Improve cursor timeouts and hiding logic.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 89b8653b2..f73d6f3c0 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -95,7 +95,10 @@ export const GRID_STEPS = [
 ]
 
 /** @internal */
-export const COLLABORATOR_TIMEOUT = 3000
+export const COLLABORATOR_INACTIVE_TIMEOUT = 60000
+
+/** @internal */
+export const COLLABORATOR_IDLE_TIMEOUT = 3000
 
 /** @internal */
 export const COLLABORATOR_CHECK_INTERVAL = 1200

commit b7d9c8684cb6cf7bd710af5420135ea3516cc3bf
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Jul 17 22:22:34 2023 +0100

    tldraw zero - package shuffle (#1710)
    
    This PR moves code between our packages so that:
    - @tldraw/editor is a ‚Äúcore‚Äù library with the engine and canvas but no
    shapes, tools, or other things
    - @tldraw/tldraw contains everything particular to the experience we‚Äôve
    built for tldraw
    
    At first look, this might seem like a step away from customization and
    configuration, however I believe it greatly increases the configuration
    potential of the @tldraw/editor while also providing a more accurate
    reflection of what configuration options actually exist for
    @tldraw/tldraw.
    
    ## Library changes
    
    @tldraw/editor re-exports its dependencies and @tldraw/tldraw re-exports
    @tldraw/editor.
    
    - users of @tldraw/editor WITHOUT @tldraw/tldraw should almost always
    only import things from @tldraw/editor.
    - users of @tldraw/tldraw should almost always only import things from
    @tldraw/tldraw.
    
    - @tldraw/polyfills is merged into @tldraw/editor
    - @tldraw/indices is merged into @tldraw/editor
    - @tldraw/primitives is merged mostly into @tldraw/editor, partially
    into @tldraw/tldraw
    - @tldraw/file-format is merged into @tldraw/tldraw
    - @tldraw/ui is merged into @tldraw/tldraw
    
    Many (many) utils and other code is moved from the editor to tldraw. For
    example, embeds now are entirely an feature of @tldraw/tldraw. The only
    big chunk of code left in core is related to arrow handling.
    
    ## API Changes
    
    The editor can now be used without tldraw's assets. We load them in
    @tldraw/tldraw instead, so feel free to use whatever fonts or images or
    whatever that you like with the editor.
    
    All tools and shapes (except for the `Group` shape) are moved to
    @tldraw/tldraw. This includes the `select` tool.
    
    You should use the editor with at least one tool, however, so you now
    also need to send in an `initialState` prop to the Editor /
    <TldrawEditor> component indicating which state the editor should begin
    in.
    
    The `components` prop now also accepts `SelectionForeground`.
    
    The complex selection component that we use for tldraw is moved to
    @tldraw/tldraw. The default component is quite basic but can easily be
    replaced via the `components` prop. We pass down our tldraw-flavored
    SelectionFg via `components`.
    
    Likewise with the `Scribble` component: the `DefaultScribble` no longer
    uses our freehand tech and is a simple path instead. We pass down the
    tldraw-flavored scribble via `components`.
    
    The `ExternalContentManager` (`Editor.externalContentManager`) is
    removed and replaced with a mapping of types to handlers.
    
    - Register new content handlers with
    `Editor.registerExternalContentHandler`.
    - Register new asset creation handlers (for files and URLs) with
    `Editor.registerExternalAssetHandler`
    
    ### Change Type
    
    - [x] `major` ‚Äî Breaking change
    
    ### Test Plan
    
    - [x] Unit Tests
    - [x] End to end tests
    
    ### Release Notes
    
    - [@tldraw/editor] lots, wip
    - [@tldraw/ui] gone, merged to tldraw/tldraw
    - [@tldraw/polyfills] gone, merged to tldraw/editor
    - [@tldraw/primitives] gone, merged to tldraw/editor / tldraw/tldraw
    - [@tldraw/indices] gone, merged to tldraw/editor
    - [@tldraw/file-format] gone, merged to tldraw/tldraw
    
    ---------
    
    Co-authored-by: alex <alex@dytry.ch>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index f73d6f3c0..c7f0e707a 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -1,21 +1,10 @@
-import { EASINGS } from '@tldraw/primitives'
+import { EASINGS } from './primitives/easings'
 
 /** @internal */
 export const MAX_SHAPES_PER_PAGE = 2000
 /** @internal */
 export const MAX_PAGES = 40
 
-/** @internal */
-export const REMOVE_SYMBOL = Symbol('remove')
-
-/** @internal */
-export const RICH_TYPES: Record<string, boolean> = {
-	Date: true,
-	RegExp: true,
-	String: true,
-	Number: true,
-}
-
 /** @internal */
 export const ANIMATION_SHORT_MS = 80
 /** @internal */
@@ -44,17 +33,9 @@ export const MAJOR_NUDGE_FACTOR = 10
 /** @internal */
 export const MINOR_NUDGE_FACTOR = 1
 
-/** @internal */
-export const MAX_ASSET_WIDTH = 1000
-/** @internal */
-export const MAX_ASSET_HEIGHT = 1000
-
 /** @internal */
 export const GRID_INCREMENT = 5
 
-/** @internal */
-export const MIN_CROP_SIZE = 8
-
 /** @internal */
 export const DOUBLE_CLICK_DURATION = 450
 /** @internal */
@@ -84,7 +65,7 @@ export const DEFAULT_ANIMATION_OPTIONS = {
 }
 
 /** @internal */
-export const HAND_TOOL_FRICTION = 0.09
+export const CAMERA_SLIDE_FRICTION = 0.09
 
 /** @public */
 export const GRID_STEPS = [

commit d750da8f40efda4b011a91962ef8f30c63d1e5da
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jul 25 17:10:15 2023 +0100

    `ShapeUtil.getGeometry`, selection rewrite (#1751)
    
    This PR is a significant rewrite of our selection / hit testing logic.
    
    It
    - replaces our current geometric helpers (`getBounds`, `getOutline`,
    `hitTestPoint`, and `hitTestLineSegment`) with a new geometry API
    - moves our hit testing entirely to JS using geometry
    - improves selection logic, especially around editing shapes, groups and
    frames
    - fixes many minor selection bugs (e.g. shapes behind frames)
    - removes hit-testing DOM elements from ShapeFill etc.
    - adds many new tests around selection
    - adds new tests around selection
    - makes several superficial changes to surface editor APIs
    
    This PR is hard to evaluate. The `selection-omnibus` test suite is
    intended to describe all of the selection behavior, however all existing
    tests are also either here preserved and passing or (in a few cases
    around editing shapes) are modified to reflect the new behavior.
    
    ## Geometry
    
    All `ShapeUtils` implement `getGeometry`, which returns a single
    geometry primitive (`Geometry2d`). For example:
    
    ```ts
    class BoxyShapeUtil {
      getGeometry(shape: BoxyShape) {
        return new Rectangle2d({
            width: shape.props.width,
            height: shape.props.height,
            isFilled: true,
            margin: shape.props.strokeWidth
          })
        }
    }
    ```
    
    This geometric primitive is used for all bounds calculation, hit
    testing, intersection with arrows, etc.
    
    There are several geometric primitives that extend `Geometry2d`:
    - `Arc2d`
    - `Circle2d`
    - `CubicBezier2d`
    - `CubicSpline2d`
    - `Edge2d`
    - `Ellipse2d`
    - `Group2d`
    - `Polygon2d`
    - `Rectangle2d`
    - `Stadium2d`
    
    For shapes that have more complicated geometric representations, such as
    an arrow with a label, the `Group2d` can accept other primitives as its
    children.
    
    ## Hit testing
    
    Previously, we did all hit testing via events set on shapes and other
    elements. In this PR, I've replaced those hit tests with our own
    calculation for hit tests in JavaScript. This removed the need for many
    DOM elements, such as hit test area borders and fills which only existed
    to trigger pointer events.
    
    ## Selection
    
    We now support selecting "hollow" shapes by clicking inside of them.
    This involves a lot of new logic but it should work intuitively. See
    `Editor.getShapeAtPoint` for the (thoroughly commented) implementation.
    
    ![Kapture 2023-07-23 at 23 27
    27](https://github.com/tldraw/tldraw/assets/23072548/a743275c-acdb-42d9-a3fe-b3e20dce86b6)
    
    every sunset is actually the sun hiding in fear and respect of tldraw's
    quality of interactions
    
    This PR also fixes several bugs with scribble selection, in particular
    around the shift key modifier.
    
    ![Kapture 2023-07-24 at 23 34
    07](https://github.com/tldraw/tldraw/assets/23072548/871d67d0-8d06-42ae-a2b2-021effba37c5)
    
    ...as well as issues with labels and editing.
    
    There are **over 100 new tests** for selection covering groups, frames,
    brushing, scribbling, hovering, and editing. I'll add a few more before
    I feel comfortable merging this PR.
    
    ## Arrow binding
    
    Using the same "hollow shape" logic as selection, arrow binding is
    significantly improved.
    
    ![Kapture 2023-07-22 at 07 46
    25](https://github.com/tldraw/tldraw/assets/23072548/5aa724b3-b57d-4fb7-92d0-80e34246753c)
    
    a thousand wise men could not improve on this
    
    ## Moving focus between editing shapes
    
    Previously, this was handled in the `editing_shapes` state. This is
    moved to `useEditableText`, and should generally be considered an
    advanced implementation detail on a shape-by-shape basis. This addresses
    a bug that I'd never noticed before, but which can be reproduced by
    selecting an shape‚Äîbut not focusing its input‚Äîwhile editing a different
    shape. Previously, the new shape became the editing shape but its input
    did not focus.
    
    ![Kapture 2023-07-23 at 23 19
    09](https://github.com/tldraw/tldraw/assets/23072548/a5e157fb-24a8-42bd-a692-04ce769b1a9c)
    
    In this PR, you can select a shape by clicking on its edge or body, or
    select its input to transfer editing / focus.
    
    ![Kapture 2023-07-23 at 23 22
    21](https://github.com/tldraw/tldraw/assets/23072548/7384e7ea-9777-4e1a-8f63-15de2166a53a)
    
    tldraw, glorious tldraw
    
    ### Change Type
    
    - [x] `major` ‚Äî Breaking change
    
    ### Test Plan
    
    1. Erase shapes
    2. Select shapes
    3. Calculate their bounding boxes
    
    - [ ] Unit Tests // todo
    - [ ] End to end tests // todo
    
    ### Release Notes
    
    - [editor] Remove `ShapeUtil.getBounds`, `ShapeUtil.getOutline`,
    `ShapeUtil.hitTestPoint`, `ShapeUtil.hitTestLineSegment`
    - [editor] Add `ShapeUtil.getGeometry`
    - [editor] Add `Editor.getShapeGeometry`

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index c7f0e707a..256550726 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -28,14 +28,6 @@ export const FOLLOW_CHASE_ZOOM_SNAP = 0.005
 /** @internal */
 export const FOLLOW_CHASE_ZOOM_UNSNAP = 0.05
 
-/** @internal */
-export const MAJOR_NUDGE_FACTOR = 10
-/** @internal */
-export const MINOR_NUDGE_FACTOR = 1
-
-/** @internal */
-export const GRID_INCREMENT = 5
-
 /** @internal */
 export const DOUBLE_CLICK_DURATION = 450
 /** @internal */
@@ -69,9 +61,9 @@ export const CAMERA_SLIDE_FRICTION = 0.09
 
 /** @public */
 export const GRID_STEPS = [
-	{ min: -1, mid: 0.15, step: 100 },
-	{ min: 0.05, mid: 0.375, step: 25 },
-	{ min: 0.15, mid: 1, step: 5 },
+	{ min: -1, mid: 0.15, step: 64 },
+	{ min: 0.05, mid: 0.375, step: 16 },
+	{ min: 0.15, mid: 1, step: 4 },
 	{ min: 0.7, mid: 2.5, step: 1 },
 ]
 
@@ -97,3 +89,6 @@ export const CAMERA_MOVING_TIMEOUT = 64
 
 /** @internal */
 export const CAMERA_MAX_RENDERING_INTERVAL = 620
+
+/** @public */
+export const HIT_TEST_MARGIN = 8

commit 4e50c9c16251f9d4ca7034f2519759e093a99dbf
Author: Mitja Bezen≈°ek <mitja.bezensek@gmail.com>
Date:   Sat Dec 16 00:37:03 2023 +0100

    Start scrolling if we are dragging close to the window edges. (#2299)
    
    Start scrolling when we get close to the edges of the window. This works
    for brush selecting, translating, and resizing.
    
    
    https://github.com/tldraw/tldraw/assets/2523721/4a5effc8-5445-411b-b317-36097233d36c
    
    
    ### Change Type
    
    - [ ] `patch` ‚Äî Bug fix
    - [x] `minor` ‚Äî New feature
    - [ ] `major` ‚Äî Breaking change
    - [ ] `dependencies` ‚Äî Changes to package dependencies[^1]
    - [ ] `documentation` ‚Äî Changes to the documentation only[^2]
    - [ ] `tests` ‚Äî Changes to any test code only[^2]
    - [ ] `internal` ‚Äî Any other changes that don't affect the published
    package[^2]
    - [ ] I don't know
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version
    
    ### Test Plan
    
    1. Select a shape.
    2. Move it towards the edge of the window. The camera position should
    change.
    3. Also try resizing, brush selecting.
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Adds the logic to change the camera position when you get close to the
    edges of the window. This allows you to drag, resize, brush select past
    the edges of the current viewport.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 256550726..e291420c9 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -92,3 +92,6 @@ export const CAMERA_MAX_RENDERING_INTERVAL = 620
 
 /** @public */
 export const HIT_TEST_MARGIN = 8
+
+/** @internal */
+export const EDGE_SCROLL_SPEED = 20

commit b58274ced2c9cc8108961ff9eb3e5e79bad109e2
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Dec 19 11:47:40 2023 +0000

    Drop edge scrolling adjustment for mobile (#2346)
    
    This PR makes all edge scrolling distances 32px.
    
    ### Change Type
    
    - [x] `patch` ‚Äî Bug fix

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index e291420c9..d1a66a1ab 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -95,3 +95,6 @@ export const HIT_TEST_MARGIN = 8
 
 /** @internal */
 export const EDGE_SCROLL_SPEED = 20
+
+/** @internal */
+export const EDGE_SCROLL_DISTANCE = 32

commit 219e2f63dd8d2982846c0170e73636ba88460813
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Wed Jan 10 14:29:32 2024 +0000

    [improvement] account for coarse pointers / insets in edge scrolling (#2401)
    
    This PR:
    - shrinks the distance for edge scrolling and insets the distance for
    coarse pointers
    - adds edge inset tracking
    
    ## Scroll distances
    
    Rather than increasing the distance, we move the "zero" in from the
    edges, so that the middle of a honkin' fat finger would be at "zero"
    when the edge of the finger is touching the edge of the screen. This is
    a bit more reliable than looking at just the component size.
    
    ## Inset tracking
    
    We now track whether a shape's edges are identical to the edges of the
    document body. When an edge is inset, we extend the edge scrolling
    distance outside of the component, so that dragging PAST the edge of the
    component will scroll. When an edge is NOT inset, we bring that distance
    into the component's bounds, so that dragging NEAR TO the edge will
    begin to scroll.
    
    
    ![image](https://github.com/tldraw/tldraw/assets/23072548/bb216c98-3dd0-4e2e-a635-4c4f339d5117)
    
    
    ![image](https://github.com/tldraw/tldraw/assets/23072548/75e83c81-1ca9-40a9-8edc-72851d3b1411)
    
    
    ![image](https://github.com/tldraw/tldraw/assets/23072548/6cda7bda-2935-4ded-821c-e7bf78833a1c)
    
    ### Change Type
    
    - [x] `minor` ‚Äî New feature
    
    ### Test Plan
    
    1. Use edge scrolling on mobile
    2. Use edge scrolling on desktop
    3. Use edge scrolling in the "scrolling example"
    
    - [x] Unit Tests
    
    ### Release Notes
    
    - Add `instanceState.insets` to track which edges of the component are
    inset from the edges of the document body.
    - Improve behavior around edge scrolling

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index d1a66a1ab..3277413fa 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -97,4 +97,7 @@ export const HIT_TEST_MARGIN = 8
 export const EDGE_SCROLL_SPEED = 20
 
 /** @internal */
-export const EDGE_SCROLL_DISTANCE = 32
+export const EDGE_SCROLL_DISTANCE = 8
+
+/** @internal */
+export const COARSE_POINTER_WIDTH = 12

commit ef1f331e1f302dad19206e4644e27271c8ae1b1f
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sat Jan 27 12:33:27 2024 +0000

    [Fix] Missing bend handles on curved arrows (#2661)
    
    Fixes #2660.
    
    <img width="629" alt="image"
    src="https://github.com/tldraw/tldraw/assets/23072548/a661b76c-4877-42b1-aca7-5e5fcc5bc44b">
    
    ### Change Type
    
    - [x] `patch` ‚Äî Bug fix
    
    ### Test Plan
    
    1. Create a handle with a lot of bend but with a start and end handle
    that are close together. The bend handle should still be visible.
    
    ### Release Notes
    
    - Fixed a bug where the bend handle on arrows with a large curve could
    sometimes be hidden.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 3277413fa..2fb880568 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -101,3 +101,9 @@ export const EDGE_SCROLL_DISTANCE = 8
 
 /** @internal */
 export const COARSE_POINTER_WIDTH = 12
+
+/** @internal */
+export const COARSE_HANDLE_RADIUS = 20
+
+/** @internal */
+export const HANDLE_RADIUS = 12

commit d399c027fdd7f279bb2bae7c4286193395be118b
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Mar 28 09:42:48 2024 +0000

    Improve performance of culling (#3272)
    
    This PR tweaks the logic of _when_ we update the viewport screen bounds.
    Previously, we updated every one second in order to capture any changes
    to the viewport's screen position. In this PR, we _check_ every one
    second and update the screen bounds if the viewport's screen position
    has actually changed. Since we also update the rendering shapes when
    this happens, it would cause the rendering / culling shapes to update
    while the camera was moving.
    
    I've also removed the "maximum time before we start culling shapes", as
    this wasn't very useful and could also cause frames to start dropping
    without recovering.
    
    
    https://github.com/tldraw/tldraw/assets/23072548/9f474481-30c9-49b4-a009-66775ca6a0c1
    
    ### Change Type
    
    <!-- ‚ùó Please select a 'Scope' label ‚ùóÔ∏è -->
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [ ] `dotcom` ‚Äî Changes the tldraw.com web app
    - [ ] `docs` ‚Äî Changes to the documentation, examples, or templates.
    - [ ] `vs code` ‚Äî Changes to the vscode plugin
    - [ ] `internal` ‚Äî Does not affect user-facing stuff
    
    <!-- ‚ùó Please select a 'Type' label ‚ùóÔ∏è -->
    
    - [ ] `bugfix` ‚Äî Bug fix
    - [ ] `feature` ‚Äî New feature
    - [x] `improvement` ‚Äî Improving existing features
    - [ ] `chore` ‚Äî Updating dependencies, other boring stuff
    - [ ] `galaxy brain` ‚Äî Architectural changes
    - [ ] `tests` ‚Äî Changes to any test code
    - [ ] `tools` ‚Äî Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` ‚Äî I don't know
    
    
    ### Test Plan
    
    1. Zoom and pan around
    2. Culled shapes should only update when you stop moving the camera.
    
    - [ ] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Improve performance of the canvas when many shapes are present.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 2fb880568..fbdb79814 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -87,9 +87,6 @@ export const INTERNAL_POINTER_IDS = {
 /** @internal */
 export const CAMERA_MOVING_TIMEOUT = 64
 
-/** @internal */
-export const CAMERA_MAX_RENDERING_INTERVAL = 620
-
 /** @public */
 export const HIT_TEST_MARGIN = 8
 

commit 58286db90c77ca9cc4516c802bcec041cdb2a323
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Apr 4 22:50:01 2024 +0100

    Add long press event (#3275)
    
    This PR adds a "long press" event that fires when pointing for more than
    500ms. This event is used in the same way that dragging is used (e.g. to
    transition to from pointing_selection to translating) but only on
    desktop. On mobile, long presses are used to open the context menu.
    
    ![Kapture 2024-03-26 at 18 57
    15](https://github.com/tldraw/tldraw/assets/23072548/34a7ee2b-bde6-443b-93e0-082453a1cb61)
    
    ## Background
    
    This idea came out of @TodePond's #3208 PR. We use a "dead zone" to
    avoid accidentally moving / rotating things when clicking on them, which
    is especially common on mobile if a dead zone feature isn't implemented.
    However, this makes it difficult to make "fine adjustments" because you
    need to drag out of the dead zone (to start translating) and then drag
    back to where you want to go.
    
    ![Kapture 2024-03-26 at 19 00
    38](https://github.com/tldraw/tldraw/assets/23072548/9a15852d-03d0-4b88-b594-27dbd3b68780)
    
    With this change, you can long press on desktop to get to that
    translating state. It's a micro UX optimization but especially nice if
    apps want to display different UI for "dragging" shapes before the user
    leaves the dead zone.
    
    ![Kapture 2024-03-26 at 19 02
    59](https://github.com/tldraw/tldraw/assets/23072548/f0ff337e-2cbd-4b73-9ef5-9b7deaf0ae91)
    
    ### Change Type
    
    <!-- ‚ùó Please select a 'Scope' label ‚ùóÔ∏è -->
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [ ] `dotcom` ‚Äî Changes the tldraw.com web app
    - [ ] `docs` ‚Äî Changes to the documentation, examples, or templates.
    - [ ] `vs code` ‚Äî Changes to the vscode plugin
    - [ ] `internal` ‚Äî Does not affect user-facing stuff
    
    <!-- ‚ùó Please select a 'Type' label ‚ùóÔ∏è -->
    
    - [ ] `bugfix` ‚Äî Bug fix
    - [x] `feature` ‚Äî New feature
    - [ ] `improvement` ‚Äî Improving existing features
    - [ ] `chore` ‚Äî Updating dependencies, other boring stuff
    - [ ] `galaxy brain` ‚Äî Architectural changes
    - [ ] `tests` ‚Äî Changes to any test code
    - [ ] `tools` ‚Äî Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` ‚Äî I don't know
    
    
    ### Test Plan
    
    1. Long press shapes, selections, resize handles, rotate handles, crop
    handles.
    2. You should enter the corresponding states, just as you would have
    with a drag.
    
    - [ ] Unit Tests TODO
    
    ### Release Notes
    
    - Add support for long pressing on desktop.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index fbdb79814..43dcbfb10 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -104,3 +104,6 @@ export const COARSE_HANDLE_RADIUS = 20
 
 /** @internal */
 export const HANDLE_RADIUS = 12
+
+/** @internal */
+export const LONG_PRESS_DURATION = 500

commit fb2d3b437239cc5a45a346de7bc7be1753238738
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Apr 8 14:31:05 2024 +0100

    Perf: (slightly) faster min dist checks (#3401)
    
    This PR improves a bunch of places where we do "minimum distance
    checks". Previously, we were using `Vec.Dist`, which uses `Math.hypot`
    to find the actual distance, but we can just as well use the squared
    distance. So this PR makes a small improvement to `Vec.Dist2` and then
    switches to that method when checking minimum distances.
    
    ### Change Type
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [x] `improvement` ‚Äî Improving existing features
    
    
    ### Test Plan
    
    - [x] Unit Tests
    
    ### Release Notes
    
    - Performance: small improvements to hit testing.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 43dcbfb10..233119932 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -34,10 +34,10 @@ export const DOUBLE_CLICK_DURATION = 450
 export const MULTI_CLICK_DURATION = 200
 
 /** @internal */
-export const COARSE_DRAG_DISTANCE = 6
+export const COARSE_DRAG_DISTANCE = 36 // 6 squared
 
 /** @internal */
-export const DRAG_DISTANCE = 4
+export const DRAG_DISTANCE = 16 // 4 squared
 
 /** @internal */
 export const SVG_PADDING = 32

commit 2bbab1a79025383e84cd85a45066455a9b09d693
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Wed Apr 10 11:20:16 2024 +0100

    Perf: Improve text outline performance (#3429)
    
    We use text shadows to create "outlines" around text shapes. These
    shadows are rendered on the GPU. In Chrome (and on computers with a
    capable GPU) text shadows work pretty well, however on Safari‚Äîand in
    particular on iOS‚Äîthey cause massive frame drops.
    
    
    https://github.com/tldraw/tldraw/assets/23072548/b65cbcaa-6cc3-46f3-b54d-1f9cc07fc499
    
    This PR:
    - adds an LOD to text shadows, removing them at < 35% zoom
    - removes text shadows entirely on Safari
    
    If we had a "high performance" or "low-end device" mode, then shadows /
    text shadows would be the first to go.
    
    ### Change Type
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [x] `improvement` ‚Äî Improving existing features
    
    ### Test Plan
    
    1. Use text shapes on iOS.
    2. Use text shapes on Safari.
    3. Use text shapes on Chrome.
    
    ### Release Notes
    
    - Improves performance of text shapes on iOS / Safari.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 233119932..418491770 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -107,3 +107,6 @@ export const HANDLE_RADIUS = 12
 
 /** @internal */
 export const LONG_PRESS_DURATION = 500
+
+/** @internal */
+export const TEXT_SHADOW_LOD = 0.35

commit 41601ac61ec7d4fad715bd67a9df077ee1576a7b
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sun Apr 14 19:40:02 2024 +0100

    Stickies: release candidate (#3249)
    
    This PR is the target for the stickies PRs that are moving forward. It
    should collect changes.
    
    - [x] New icon
    - [x] Improved shadows
    - [x] Shadow LOD
    - [x] New colors / theme options
    - [x] Shrink text size to avoid word breaks on the x axis
    - [x] Hide indicator whilst typing (reverted)
    - [x] Adjacent note positions
      - [x] buttons / clone handles
      - [x] position helpers for creating / translating (pits)
    - [x] keyboard shortcuts: (Tab, Shift+tab (RTL aware), Cmd-Enter,
    Shift+Cmd+enter)
      - [x] multiple shape translating
    - [x] Text editing
      - [x] Edit on type (feature flagged)
      - [x] click goes in correct place
    - [x] Notes as parents (reverted)
    - [x] Update colors
    - [x] Update SVG appearance
    
    ### Change Type
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [x] `feature` ‚Äî New feature
    
    ### Test Plan
    
    Todo: fold in test plans for child PRs
    
    ### Unit tests:
    
    - [ ] Shrink text size to avoid word breaks on the x axis
    - [x] Adjacent notes
      - [x] buttons (clone handles)
      - [x] position helpers (pits)
    - [x] keyboard shortcuts: (Tab, Shift+tab (RTL aware), Cmd-Enter,
    Shift+Cmd+enter)
    - [ ] Text editing
      - [ ] Edit on type
      - [ ] click goes in correct place
    
    ### Release Notes
    
    - Improves sticky notes (see list)
    
    ---------
    
    Signed-off-by: dependabot[bot] <support@github.com>
    Co-authored-by: Mime ƒåuvalo <mimecuvalo@gmail.com>
    Co-authored-by: alex <alex@dytry.ch>
    Co-authored-by: Mitja Bezen≈°ek <mitja.bezensek@gmail.com>
    Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
    Co-authored-by: github-actions[bot] <github-actions[bot]@users.noreply.github.com>
    Co-authored-by: Lu[ke] Wilson <l2wilson94@gmail.com>
    Co-authored-by: huppy-bot[bot] <128400622+huppy-bot[bot]@users.noreply.github.com>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 418491770..d27456340 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -105,6 +105,9 @@ export const COARSE_HANDLE_RADIUS = 20
 /** @internal */
 export const HANDLE_RADIUS = 12
 
+/** @public */
+export const SIDES = ['top', 'right', 'bottom', 'left'] as const
+
 /** @internal */
 export const LONG_PRESS_DURATION = 500
 

commit fabba66c0f4b6c42ece30f409e70eb01e588f8e1
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sat May 4 18:39:04 2024 +0100

    Camera options (#3282)
    
    This PR implements a camera options API.
    
    - [x] Initial PR
    - [x] Updated unit tests
    - [x] Feedback / review
    - [x] New unit tests
    - [x] Update use-case examples
    - [x] Ship?
    
    ## Public API
    
    A user can provide camera options to the `Tldraw` component via the
    `cameraOptions` prop. The prop is also available on the `TldrawEditor`
    component and the constructor parameters of the `Editor` class.
    
    ```tsx
    export default function CameraOptionsExample() {
            return (
                    <div className="tldraw__editor">
                            <Tldraw cameraOptions={CAMERA_OPTIONS} />
                    </div>
            )
    }
    ```
    
    At runtime, a user can:
    -  get the current camera options with `Editor.getCameraOptions`
    -  update the camera options with `Editor.setCameraOptions`
    
    Setting the camera options automatically applies them to the current
    camera.
    
    ```ts
    editor.setCameraOptions({...editor.getCameraOptions(), isLocked: true })
    ```
    
    A user can get the "camera fit zoom" via `editor.getCameraFitZoom()`.
    
    # Interface
    
    The camera options themselves can look a few different ways depending on
    the `type` provided.
    
    
    ```tsx
    export type TLCameraOptions = {
            /** Whether the camera is locked. */
            isLocked: boolean
            /** The speed of a scroll wheel / trackpad pan. Default is 1. */
            panSpeed: number
            /** The speed of a scroll wheel / trackpad zoom. Default is 1. */
            zoomSpeed: number
            /** The steps that a user can zoom between with zoom in / zoom out. The first and last value will determine the min and max zoom. */
            zoomSteps: number[]
            /** Controls whether the wheel pans or zooms.
             *
             * - `zoom`: The wheel will zoom in and out.
             * - `pan`: The wheel will pan the camera.
             * - `none`: The wheel will do nothing.
             */
            wheelBehavior: 'zoom' | 'pan' | 'none'
            /** The camera constraints. */
            constraints?: {
                    /** The bounds (in page space) of the constrained space */
                    bounds: BoxModel
                    /** The padding inside of the viewport (in screen space) */
                    padding: VecLike
                    /** The origin for placement. Used to position the bounds within the viewport when an axis is fixed or contained and zoom is below the axis fit. */
                    origin: VecLike
                    /** The camera's initial zoom, used also when the camera is reset.
                     *
                     * - `default`: Sets the initial zoom to 100%.
                     * - `fit-x`: The x axis will completely fill the viewport bounds.
                     * - `fit-y`: The y axis will completely fill the viewport bounds.
                     * - `fit-min`: The smaller axis will completely fill the viewport bounds.
                     * - `fit-max`: The larger axis will completely fill the viewport bounds.
                     * - `fit-x-100`: The x axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-y-100`: The y axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-min-100`: The smaller axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-max-100`: The larger axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     */
                    initialZoom:
                            | 'fit-min'
                            | 'fit-max'
                            | 'fit-x'
                            | 'fit-y'
                            | 'fit-min-100'
                            | 'fit-max-100'
                            | 'fit-x-100'
                            | 'fit-y-100'
                            | 'default'
                    /** The camera's base for its zoom steps.
                     *
                     * - `default`: Sets the initial zoom to 100%.
                     * - `fit-x`: The x axis will completely fill the viewport bounds.
                     * - `fit-y`: The y axis will completely fill the viewport bounds.
                     * - `fit-min`: The smaller axis will completely fill the viewport bounds.
                     * - `fit-max`: The larger axis will completely fill the viewport bounds.
                     * - `fit-x-100`: The x axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-y-100`: The y axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-min-100`: The smaller axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-max-100`: The larger axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     */
                    baseZoom:
                            | 'fit-min'
                            | 'fit-max'
                            | 'fit-x'
                            | 'fit-y'
                            | 'fit-min-100'
                            | 'fit-max-100'
                            | 'fit-x-100'
                            | 'fit-y-100'
                            | 'default'
                    /** The behavior for the constraints for both axes or each axis individually.
                     *
                     * - `free`: The bounds are ignored when moving the camera.
                     * - 'fixed': The bounds will be positioned within the viewport based on the origin
                     * - `contain`: The 'fixed' behavior will be used when the zoom is below the zoom level at which the bounds would fill the viewport; and when above this zoom, the bounds will use the 'inside' behavior.
                     * - `inside`: The bounds will stay completely within the viewport.
                     * - `outside`: The bounds will stay touching the viewport.
                     */
                    behavior:
                            | 'free'
                            | 'fixed'
                            | 'inside'
                            | 'outside'
                            | 'contain'
                            | {
                                            x: 'free' | 'fixed' | 'inside' | 'outside' | 'contain'
                                            y: 'free' | 'fixed' | 'inside' | 'outside' | 'contain'
                              }
            }
    }
    ```
    
    ### Change Type
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [x] `feature` ‚Äî New feature
    
    ### Test Plan
    
    These features combine in different ways, so we'll want to write some
    more tests to find surprises.
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [ ] Unit Tests
    
    ### Release Notes
    
    - SDK: Adds camera options.
    
    ---------
    
    Co-authored-by: Mitja Bezen≈°ek <mitja.bezensek@gmail.com>

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index d27456340..7b68334dd 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -1,3 +1,4 @@
+import { TLCameraOptions } from './editor/types/misc-types'
 import { EASINGS } from './primitives/easings'
 
 /** @internal */
@@ -11,13 +12,14 @@ export const ANIMATION_SHORT_MS = 80
 export const ANIMATION_MEDIUM_MS = 320
 
 /** @internal */
-export const ZOOMS = [0.1, 0.25, 0.5, 1, 2, 4, 8]
-/** @internal */
-export const MIN_ZOOM = 0.1
-/** @internal */
-export const MAX_ZOOM = 8
+export const DEFAULT_CAMERA_OPTIONS: TLCameraOptions = {
+	isLocked: false,
+	wheelBehavior: 'pan',
+	panSpeed: 1,
+	zoomSpeed: 1,
+	zoomSteps: [0.1, 0.25, 0.5, 1, 2, 4, 8],
+}
 
-/** @internal */
 export const FOLLOW_CHASE_PROPORTION = 0.5
 /** @internal */
 export const FOLLOW_CHASE_PAN_SNAP = 0.1
@@ -42,14 +44,6 @@ export const DRAG_DISTANCE = 16 // 4 squared
 /** @internal */
 export const SVG_PADDING = 32
 
-/** @internal */
-export const HASH_PATTERN_ZOOM_NAMES: Record<string, string> = {}
-
-for (let zoom = 1; zoom <= Math.ceil(MAX_ZOOM); zoom++) {
-	HASH_PATTERN_ZOOM_NAMES[zoom + '_dark'] = `hash_pattern_zoom_${zoom}_dark`
-	HASH_PATTERN_ZOOM_NAMES[zoom + '_light'] = `hash_pattern_zoom_${zoom}_light`
-}
-
 /** @internal */
 export const DEFAULT_ANIMATION_OPTIONS = {
 	duration: 0,
@@ -113,3 +107,8 @@ export const LONG_PRESS_DURATION = 500
 
 /** @internal */
 export const TEXT_SHADOW_LOD = 0.35
+
+export const LEFT_MOUSE_BUTTON = 0
+export const RIGHT_MOUSE_BUTTON = 2
+export const MIDDLE_MOUSE_BUTTON = 1
+export const STYLUS_ERASER_BUTTON = 5

commit c04b4286ca2b6278b6afd7f2a022ad6ae97ea9dc
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sun May 19 02:01:53 2024 +0100

    Bump max shapes to 4000 (#3716)
    
    This PR increases the maximum number of shapes per page from 2000 to
    4000.
    
    ### Change Type
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [x] `improvement` ‚Äî Improving existing features
    
    ### Test Plan
    
    1. Create max shapes
    2. Does it work?
    
    - [ ] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Increase maximum number of shapes per page from 2000 to 4000.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 7b68334dd..4b4f1a6b5 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -2,7 +2,7 @@ import { TLCameraOptions } from './editor/types/misc-types'
 import { EASINGS } from './primitives/easings'
 
 /** @internal */
-export const MAX_SHAPES_PER_PAGE = 2000
+export const MAX_SHAPES_PER_PAGE = 4000
 /** @internal */
 export const MAX_PAGES = 40
 

commit 48512995b41789e01f4856174a25b0ad7895300d
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Sun May 19 02:22:01 2024 +0100

    Prevent wobble during viewport following (#3695)
    
    This revives the old 'derived camera' idea to prevent cursor wobbling
    during viewport following.
    
    Before this PR we updated the camera on a tick during viewport
    following, but the shapes and cursors were not moving on the same tick
    (we tried that during the perf work and it was all kinds of
    problematic). Frankly I've forgotten how we ever managed to eliminate
    wobble here in the first place?
    
    Anyway after this PR we derive the camera based on whether or not we are
    following a user. When you follow a user it makes it so that your
    viewport contains their viewport. If your viewport is not already very
    close to their viewport it will animate the initial position, after
    which it will 'lock' in place and the derived value will be used from
    then on.
    
    This exposed a minor issue in our sync engine: the fact that we send
    presence updates in separate websocket messages from document updates.
    We get into situations like this
    
    1. user A follows user B
    2. user B deletes the current page they are on
    3. user B's page deletion diff gets sent
    4. user B's presence update gets sent with a new currentPageId
    5. user A receives the page deletion
    6. user A still thinks that user B is on the old page and doesn't know
    how to update the follow state.
    
    So to fix this I made it so that we can (and do) send presence updates
    in the same websocket messages as document updates so the server can
    handle them atomically.
    
    ### Change Type
    
    <!-- ‚ùó Please select a 'Scope' label ‚ùóÔ∏è -->
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [x] `bugfix` ‚Äî Bug fix
    
    
    
    ### Test Plan
    
    1. Add a step-by-step description of how to test your PR here.
    8.
    
    - [ ] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Fixes a bug that caused the cursor & shapes to wiggle around when
    following someone else's viewport

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 4b4f1a6b5..bfdb7fdc7 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -20,15 +20,8 @@ export const DEFAULT_CAMERA_OPTIONS: TLCameraOptions = {
 	zoomSteps: [0.1, 0.25, 0.5, 1, 2, 4, 8],
 }
 
-export const FOLLOW_CHASE_PROPORTION = 0.5
 /** @internal */
-export const FOLLOW_CHASE_PAN_SNAP = 0.1
-/** @internal */
-export const FOLLOW_CHASE_PAN_UNSNAP = 0.2
-/** @internal */
-export const FOLLOW_CHASE_ZOOM_SNAP = 0.005
-/** @internal */
-export const FOLLOW_CHASE_ZOOM_UNSNAP = 0.05
+export const FOLLOW_CHASE_VIEWPORT_SNAP = 2
 
 /** @internal */
 export const DOUBLE_CLICK_DURATION = 450

commit b7933d7e086633bd4e4b982b68f01b9e057c0f83
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue May 21 16:26:13 2024 +0100

    Tighten up zoom to fit padding (#3798)
    
    This PR reduces the zoom to fit area from 128 pixels on each edge to 50.
    It does produce some overlap with the toolbar but I do not mind this at
    all.
    
    ### Change Type
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [x] `improvement` ‚Äî Improving existing features
    
    ### Test Plan
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Reduce padding when zooming to fit.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index bfdb7fdc7..48961508f 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -105,3 +105,5 @@ export const LEFT_MOUSE_BUTTON = 0
 export const RIGHT_MOUSE_BUTTON = 2
 export const MIDDLE_MOUSE_BUTTON = 1
 export const STYLUS_ERASER_BUTTON = 5
+
+export const ZOOM_TO_FIT_PADDING = 128

commit a457a390819bc15add2b52c77f0908498a8613a6
Author: alex <alex@dytry.ch>
Date:   Tue May 28 15:22:03 2024 +0100

    Move constants to options prop (#3799)
    
    Another go at #3628 & #3783. This moves (most) constants into
    `editor.options`, configurable by the `options` prop on the tldraw
    component.
    
    ### Change Type
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [x] `feature` ‚Äî New feature
    
    ### Release Notes
    
    You can now override many options which were previously hard-coded
    constants. Pass an `options` prop into the tldraw component to change
    the maximum number of pages, grid steps, or other previously hard-coded
    values. See `TldrawOptions` for more

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 48961508f..fca0864fb 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -1,16 +1,6 @@
 import { TLCameraOptions } from './editor/types/misc-types'
 import { EASINGS } from './primitives/easings'
 
-/** @internal */
-export const MAX_SHAPES_PER_PAGE = 4000
-/** @internal */
-export const MAX_PAGES = 40
-
-/** @internal */
-export const ANIMATION_SHORT_MS = 80
-/** @internal */
-export const ANIMATION_MEDIUM_MS = 320
-
 /** @internal */
 export const DEFAULT_CAMERA_OPTIONS: TLCameraOptions = {
 	isLocked: false,
@@ -20,49 +10,12 @@ export const DEFAULT_CAMERA_OPTIONS: TLCameraOptions = {
 	zoomSteps: [0.1, 0.25, 0.5, 1, 2, 4, 8],
 }
 
-/** @internal */
-export const FOLLOW_CHASE_VIEWPORT_SNAP = 2
-
-/** @internal */
-export const DOUBLE_CLICK_DURATION = 450
-/** @internal */
-export const MULTI_CLICK_DURATION = 200
-
-/** @internal */
-export const COARSE_DRAG_DISTANCE = 36 // 6 squared
-
-/** @internal */
-export const DRAG_DISTANCE = 16 // 4 squared
-
-/** @internal */
-export const SVG_PADDING = 32
-
 /** @internal */
 export const DEFAULT_ANIMATION_OPTIONS = {
 	duration: 0,
 	easing: EASINGS.easeInOutCubic,
 }
 
-/** @internal */
-export const CAMERA_SLIDE_FRICTION = 0.09
-
-/** @public */
-export const GRID_STEPS = [
-	{ min: -1, mid: 0.15, step: 64 },
-	{ min: 0.05, mid: 0.375, step: 16 },
-	{ min: 0.15, mid: 1, step: 4 },
-	{ min: 0.7, mid: 2.5, step: 1 },
-]
-
-/** @internal */
-export const COLLABORATOR_INACTIVE_TIMEOUT = 60000
-
-/** @internal */
-export const COLLABORATOR_IDLE_TIMEOUT = 3000
-
-/** @internal */
-export const COLLABORATOR_CHECK_INTERVAL = 1200
-
 /**
  * Negative pointer ids are reserved for internal use.
  *
@@ -71,36 +24,9 @@ export const INTERNAL_POINTER_IDS = {
 	CAMERA_MOVE: -10,
 } as const
 
-/** @internal */
-export const CAMERA_MOVING_TIMEOUT = 64
-
-/** @public */
-export const HIT_TEST_MARGIN = 8
-
-/** @internal */
-export const EDGE_SCROLL_SPEED = 20
-
-/** @internal */
-export const EDGE_SCROLL_DISTANCE = 8
-
-/** @internal */
-export const COARSE_POINTER_WIDTH = 12
-
-/** @internal */
-export const COARSE_HANDLE_RADIUS = 20
-
-/** @internal */
-export const HANDLE_RADIUS = 12
-
 /** @public */
 export const SIDES = ['top', 'right', 'bottom', 'left'] as const
 
-/** @internal */
-export const LONG_PRESS_DURATION = 500
-
-/** @internal */
-export const TEXT_SHADOW_LOD = 0.35
-
 export const LEFT_MOUSE_BUTTON = 0
 export const RIGHT_MOUSE_BUTTON = 2
 export const MIDDLE_MOUSE_BUTTON = 1

commit 6c846716c343e1ad40839f0f2bab758f58b4284d
Author: Mime ƒåuvalo <mimecuvalo@gmail.com>
Date:   Tue Jun 11 15:17:09 2024 +0100

    assets: make option to transform urls dynamically / LOD (#3827)
    
    this is take #2 of this PR https://github.com/tldraw/tldraw/pull/3764
    
    This continues the idea kicked off in
    https://github.com/tldraw/tldraw/pull/3684 to explore LOD and takes it
    in a different direction.
    
    Several things here to call out:
    - our dotcom version would start to use Cloudflare's image transforms
    - we don't rewrite non-image assets
    - we debounce zooming so that we're not swapping out images while
    zooming (it creates jank)
    - we load different images based on steps of .25 (maybe we want to make
    this more, like 0.33). Feels like 0.5 might be a bit too much but we can
    play around with it.
    - we take into account network connection speed. if you're on 3g, for
    example, we have the size of the image.
    - dpr is taken into account - in our case, Cloudflare handles it. But if
    it wasn't Cloudflare, we could add it to our width equation.
    - we use Cloudflare's `fit=scale-down` setting to never scale _up_ an
    image.
    - we don't swap the image in until we've finished loading it
    programatically (to avoid a blank image while it loads)
    
    TODO
    - [x] We need to enable Cloudflare's pricing on image transforms btw
    @steveruizok üòâ - this won't work quite yet until we do that.
    
    
    ### Change Type
    
    <!-- ‚ùó Please select a 'Scope' label ‚ùóÔ∏è -->
    
    - [x] `sdk` ‚Äî Changes the tldraw SDK
    - [ ] `dotcom` ‚Äî Changes the tldraw.com web app
    - [ ] `docs` ‚Äî Changes to the documentation, examples, or templates.
    - [ ] `vs code` ‚Äî Changes to the vscode plugin
    - [ ] `internal` ‚Äî Does not affect user-facing stuff
    
    <!-- ‚ùó Please select a 'Type' label ‚ùóÔ∏è -->
    
    - [ ] `bugfix` ‚Äî Bug fix
    - [x] `feature` ‚Äî New feature
    - [ ] `improvement` ‚Äî Improving existing features
    - [ ] `chore` ‚Äî Updating dependencies, other boring stuff
    - [ ] `galaxy brain` ‚Äî Architectural changes
    - [ ] `tests` ‚Äî Changes to any test code
    - [ ] `tools` ‚Äî Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` ‚Äî I don't know
    
    
    ### Test Plan
    
    1. Test images on staging, small, medium, large, mega
    2. Test videos on staging
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Assets: make option to transform urls dynamically to provide different
    sized images on demand.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index fca0864fb..62d814136 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -1,4 +1,4 @@
-import { TLCameraOptions } from './editor/types/misc-types'
+import { TLAssetOptions, TLCameraOptions } from './editor/types/misc-types'
 import { EASINGS } from './primitives/easings'
 
 /** @internal */
@@ -10,6 +10,11 @@ export const DEFAULT_CAMERA_OPTIONS: TLCameraOptions = {
 	zoomSteps: [0.1, 0.25, 0.5, 1, 2, 4, 8],
 }
 
+/** @internal */
+export const DEFAULT_ASSET_OPTIONS: TLAssetOptions = {
+	onResolveAsset: async (asset) => asset?.props.src || '',
+}
+
 /** @internal */
 export const DEFAULT_ANIMATION_OPTIONS = {
 	duration: 0,

commit 965bc10997725a7e2e1484767165253d4352b21a
Author: alex <alex@dytry.ch>
Date:   Wed Jul 10 14:00:18 2024 +0100

    [1/4] Blob storage in TLStore (#4068)
    
    Reworks the store to include information about how blob assets
    (images/videos) are stored/retrieved. This replaces the old
    internal-only `assetOptions` prop, and supplements the existing
    `registerExternalAssetHandler` API.
    
    Previously, `registerExternalAssetHandler` had two responsibilities:
    1. Extracting asset metadata
    2. Uploading the asset and returning its URL
    
    Existing `registerExternalAssetHandler` implementation will still work,
    but now uploading is the responsibility of a new `editor.uploadAsset`
    method which calls the new store-based upload method. Our default asset
    handlers extract metadata, then call that new API. I think this is a
    pretty big improvement over what we had before: overriding uploads was a
    pretty common ask, but doing so meant having to copy paste our metadata
    extraction which felt pretty fragile. Just in this codebase, we had a
    bunch of very slightly different metadata extraction code-paths that had
    been copy-pasted around then diverged over time. Now, you can change how
    uploads work without having to mess with metadata extraction and
    vice-versa.
    
    As part of this we also:
    1. merge the old separate asset indexeddb store with the main one.
    because this warrants some pretty big migration stuff, i refactored our
    indexed-db helpers to work around an instance instead of being free
    functions
    2. move our existing asset stuff over to the new approach
    3. add a new hook in `sync-react` to create a demo store with the new
    assets
    
    ### Change type
    
    - [x] `api`
    
    ### Release notes
    
    Introduce a new `assets` option for the store, describing how to save
    and retrieve asset blobs like images & videos from e.g. a user-content
    CDN. These are accessible through `editor.uploadAsset` and
    `editor.resolveAssetUrl`. This supplements the existing
    `registerExternalAssetHandler` API: `registerExternalAssetHandler` is
    for customising metadata extraction, and should call
    `editor.uploadAsset` to save assets. Existing
    `registerExternalAssetHandler` calls will still work, but if you're only
    using them to configure uploads and don't want to customise metadata
    extraction, consider switching to the new `assets` store prop.

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index 62d814136..fca0864fb 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -1,4 +1,4 @@
-import { TLAssetOptions, TLCameraOptions } from './editor/types/misc-types'
+import { TLCameraOptions } from './editor/types/misc-types'
 import { EASINGS } from './primitives/easings'
 
 /** @internal */
@@ -10,11 +10,6 @@ export const DEFAULT_CAMERA_OPTIONS: TLCameraOptions = {
 	zoomSteps: [0.1, 0.25, 0.5, 1, 2, 4, 8],
 }
 
-/** @internal */
-export const DEFAULT_ASSET_OPTIONS: TLAssetOptions = {
-	onResolveAsset: async (asset) => asset?.props.src || '',
-}
-
 /** @internal */
 export const DEFAULT_ANIMATION_OPTIONS = {
 	duration: 0,

commit bf79438b7304b13e0a50b3cc12ccfc7d8a6d2bd5
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sat Mar 15 15:04:10 2025 +0000

    5% minimum zoom / zoom-towards-cursor (#5584)
    
    This PR makes two changes to the zoom defaults:
    
    - Adds a new 5% zoom step as the smallest zoom step (down from 10%)
    - Adds Shift + / Shift - for zoom towards cursor.
    
    ### Change type
    
    - [ ] `bugfix`
    - [x] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. Zoom out
    2. Zoom in
    
    ### Release notes
    
    - Added a new minimum zoom step at 5%
    - Added new keyboard shortcuts for zoom in or out towards your cursor
    (Shift +, Shift -)

diff --git a/packages/editor/src/lib/constants.ts b/packages/editor/src/lib/constants.ts
index fca0864fb..2300e0876 100644
--- a/packages/editor/src/lib/constants.ts
+++ b/packages/editor/src/lib/constants.ts
@@ -7,7 +7,7 @@ export const DEFAULT_CAMERA_OPTIONS: TLCameraOptions = {
 	wheelBehavior: 'pan',
 	panSpeed: 1,
 	zoomSpeed: 1,
-	zoomSteps: [0.1, 0.25, 0.5, 1, 2, 4, 8],
+	zoomSteps: [0.05, 0.1, 0.25, 0.5, 1, 2, 4, 8],
 }
 
 /** @internal */

