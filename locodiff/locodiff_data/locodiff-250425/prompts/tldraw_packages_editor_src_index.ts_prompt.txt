# Instructions

You are being benchmarked. You will see the output of a git log command, and from that must infer the current state of a file. Think carefully, as you must output the exact state of the file to earn full marks.

**Important:** Your goal is to reproduce the file's content *exactly* as it exists at the final commit, even if the code appears broken, buggy, or contains obvious errors. Do **not** try to "fix" the code. Attempting to correct issues will result in a poor score, as this benchmark evaluates your ability to reproduce the precise state of the file based on its history.

# Required Response Format

Wrap the content of the file in triple backticks (```). Any text outside the final closing backticks will be ignored. End your response after outputting the closing backticks.

# Example Response

```python
#!/usr/bin/env python
print('Hello, world!')
```

# File History

> git log -p --cc --topo-order --reverse -- packages/editor/src/index.ts

commit 29ed921c6745923dcc8daa72ba6f815a5c4b279a
Author: alex <alex@dytry.ch>
Date:   Tue Apr 25 12:01:25 2023 +0100

    transfer-out: transfer out

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
new file mode 100644
index 000000000..08b24dcf5
--- /dev/null
+++ b/packages/editor/src/index.ts
@@ -0,0 +1,267 @@
+// Important! don't move this tlschema re-export to lib/index.ts, doing so causes esbuild to produce
+// incorrect output. https://github.com/evanw/esbuild/issues/1737
+
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/tlschema'
+export { getHashForString } from '@tldraw/utils'
+export {
+	ErrorScreen,
+	LoadingScreen,
+	TldrawEditor,
+	type TldrawEditorProps,
+} from './lib/TldrawEditor'
+export {
+	App,
+	isShapeWithHandles,
+	type AnimationOptions,
+	type AppOptions,
+	type TLChange,
+} from './lib/app/App'
+export { TLArrowShapeDef, TLArrowUtil } from './lib/app/shapeutils/TLArrowUtil/TLArrowUtil'
+export {
+	TLBookmarkShapeDef,
+	TLBookmarkUtil,
+} from './lib/app/shapeutils/TLBookmarkUtil/TLBookmarkUtil'
+export { TLBoxUtil } from './lib/app/shapeutils/TLBoxUtil'
+export { TLDrawShapeDef, TLDrawUtil } from './lib/app/shapeutils/TLDrawUtil/TLDrawUtil'
+export { TLEmbedShapeDef, TLEmbedUtil } from './lib/app/shapeutils/TLEmbedUtil/TLEmbedUtil'
+export { TLFrameShapeDef, TLFrameUtil } from './lib/app/shapeutils/TLFrameUtil/TLFrameUtil'
+export { TLGeoShapeDef, TLGeoUtil } from './lib/app/shapeutils/TLGeoUtil/TLGeoUtil'
+export { TLGroupShapeDef, TLGroupUtil } from './lib/app/shapeutils/TLGroupUtil/TLGroupUtil'
+export { TLImageShapeDef, TLImageUtil } from './lib/app/shapeutils/TLImageUtil/TLImageUtil'
+export {
+	TLLineShapeDef,
+	TLLineUtil,
+	getSplineForLineShape,
+} from './lib/app/shapeutils/TLLineUtil/TLLineUtil'
+export { TLNoteShapeDef, TLNoteUtil } from './lib/app/shapeutils/TLNoteUtil/TLNoteUtil'
+export {
+	TLShapeUtil,
+	type OnBeforeCreateHandler,
+	type OnBeforeUpdateHandler,
+	type OnBindingChangeHandler,
+	type OnChildrenChangeHandler,
+	type OnClickHandler,
+	type OnDoubleClickHandleHandler,
+	type OnDoubleClickHandler,
+	type OnDragHandler,
+	type OnEditEndHandler,
+	type OnHandleChangeHandler,
+	type OnResizeEndHandler,
+	type OnResizeHandler,
+	type OnResizeStartHandler,
+	type OnRotateEndHandler,
+	type OnRotateHandler,
+	type OnRotateStartHandler,
+	type OnTranslateEndHandler,
+	type OnTranslateHandler,
+	type OnTranslateStartHandler,
+	type TLResizeMode,
+	type TLShapeUtilConstructor,
+	type TLShapeUtilFlag,
+} from './lib/app/shapeutils/TLShapeUtil'
+export { TLTextShapeDef, TLTextUtil } from './lib/app/shapeutils/TLTextUtil/TLTextUtil'
+export { TLVideoShapeDef, TLVideoUtil } from './lib/app/shapeutils/TLVideoUtil/TLVideoUtil'
+export { StateNode, type StateNodeConstructor } from './lib/app/statechart/StateNode'
+export { TLBoxTool, type TLBoxLike } from './lib/app/statechart/TLBoxTool/TLBoxTool'
+export { type ClipboardPayload, type TLClipboardModel } from './lib/app/types/clipboard-types'
+export {
+	EVENT_NAME_MAP,
+	type TLBaseEventInfo,
+	type TLCLickEventName,
+	type TLCancelEvent,
+	type TLCancelEventInfo,
+	type TLClickEvent,
+	type TLClickEventInfo,
+	type TLCompleteEvent,
+	type TLCompleteEventInfo,
+	type TLEventHandlers,
+	type TLEventInfo,
+	type TLEventName,
+	type TLInterruptEvent,
+	type TLInterruptEventInfo,
+	type TLKeyboardEvent,
+	type TLKeyboardEventInfo,
+	type TLKeyboardEventName,
+	type TLPinchEvent,
+	type TLPinchEventInfo,
+	type TLPinchEventName,
+	type TLPointerEvent,
+	type TLPointerEventInfo,
+	type TLPointerEventName,
+	type TLPointerEventTarget,
+	type TLTickEvent,
+	type TLWheelEvent,
+	type TLWheelEventInfo,
+	type UiEnterHandler,
+	type UiEvent,
+	type UiEventType,
+	type UiExitHandler,
+} from './lib/app/types/event-types'
+export {
+	type TLCommand,
+	type TLCommandHandler,
+	type TLHistoryEntry,
+	type TLMark,
+} from './lib/app/types/history-types'
+export { type RequiredKeys, type TLEasingType } from './lib/app/types/misc-types'
+export { type TLReorderOperation } from './lib/app/types/reorder-types'
+export { type TLResizeHandle, type TLSelectionHandle } from './lib/app/types/selection-types'
+export { defaultEditorAssetUrls, type EditorAssetUrls } from './lib/assetUrls'
+export { Canvas } from './lib/components/Canvas'
+export { DefaultErrorFallback } from './lib/components/DefaultErrorFallback'
+export {
+	ErrorBoundary,
+	OptionalErrorBoundary,
+	type ErrorBoundaryProps,
+} from './lib/components/ErrorBoundary'
+export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
+export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
+export {
+	type ErrorSyncedStore,
+	type InitializingSyncedStore,
+	type ReadySyncedStore,
+	type SyncedStore,
+} from './lib/config/SyncedStore'
+export {
+	defineShape,
+	type TLShapeDef,
+	type TLUnknownShapeDef,
+} from './lib/config/TLShapeDefinition'
+export { TldrawEditorConfig } from './lib/config/TldrawEditorConfig'
+export {
+	ANIMATION_MEDIUM_MS,
+	ANIMATION_SHORT_MS,
+	ARROW_LABEL_FONT_SIZES,
+	BOUND_ARROW_OFFSET,
+	DEFAULT_ANIMATION_OPTIONS,
+	DEFAULT_BOOKMARK_HEIGHT,
+	DEFAULT_BOOKMARK_WIDTH,
+	DOUBLE_CLICK_DURATION,
+	DRAG_DISTANCE,
+	FONT_ALIGNMENT,
+	FONT_FAMILIES,
+	FONT_SIZES,
+	GRID_INCREMENT,
+	GRID_STEPS,
+	HAND_TOOL_FRICTION,
+	HASH_PATERN_ZOOM_NAMES,
+	ICON_SIZES,
+	LABEL_FONT_SIZES,
+	MAJOR_NUDGE_FACTOR,
+	MAX_ASSET_HEIGHT,
+	MAX_ASSET_WIDTH,
+	MAX_PAGES,
+	MAX_SHAPES_PER_PAGE,
+	MAX_ZOOM,
+	MINOR_NUDGE_FACTOR,
+	MIN_ARROW_LENGTH,
+	MIN_ZOOM,
+	MULTI_CLICK_DURATION,
+	REMOVE_SYMBOL,
+	RICH_TYPES,
+	ROTATING_SHADOWS,
+	STYLES,
+	SVG_PADDING,
+	TEXT_PROPS,
+	WAY_TOO_BIG_ARROW_BEND_FACTOR,
+	ZOOMS,
+} from './lib/constants'
+export { normalizeWheel } from './lib/hooks/shared'
+export { useApp } from './lib/hooks/useApp'
+export { useContainer } from './lib/hooks/useContainer'
+export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
+export { useQuickReactor } from './lib/hooks/useQuickReactor'
+export { useReactor } from './lib/hooks/useReactor'
+export { useUrlState } from './lib/hooks/useUrlState'
+export { WeakMapCache } from './lib/utils/WeakMapCache'
+export {
+	ACCEPTED_ASSET_TYPE,
+	ACCEPTED_IMG_TYPE,
+	ACCEPTED_VID_TYPE,
+	containBoxSize,
+	createAssetShapeAtPoint,
+	createBookmarkShapeAtPoint,
+	createEmbedShapeAtPoint,
+	createShapesFromFiles,
+	dataUrlToFile,
+	getFileMetaData,
+	getImageSizeFromSrc,
+	getMediaAssetFromFile,
+	getResizedImageDataUrl,
+	getValidHttpURLList,
+	getVideoSizeFromSrc,
+	isImage,
+	isSvgText,
+	isValidHttpURL,
+} from './lib/utils/assets'
+export { buildFromV1Document, type LegacyTldrawDocument } from './lib/utils/buildFromV1Document'
+export {
+	checkFlag,
+	fileToBase64,
+	getIncrementedName,
+	isSerializable,
+	snapToGrid,
+	uniqueId,
+} from './lib/utils/data'
+export { debugFlags } from './lib/utils/debug-flags'
+export {
+	loopToHtmlElement,
+	preventDefault,
+	releasePointerCapture,
+	rotateBoxShadow,
+	setPointerCapture,
+	truncateStringWithEllipsis,
+	usePrefersReducedMotion,
+} from './lib/utils/dom'
+export {
+	getEmbedInfo,
+	getEmbedInfoUnsafely,
+	matchEmbedUrl,
+	matchUrl,
+	type EmbedResult,
+} from './lib/utils/embeds'
+export {
+	downloadDataURLAsFile,
+	getSvgAsDataUrl,
+	getSvgAsDataUrlSync,
+	getSvgAsImage,
+	getSvgAsString,
+	getTextBoundingBox,
+	isGeoShape,
+	isNoteShape,
+	type TLCopyType,
+	type TLExportType,
+} from './lib/utils/export'
+export { hardResetApp } from './lib/utils/hard-reset'
+export { isAnimated, isGIF } from './lib/utils/is-gif-animated'
+export { setPropsForNextShape } from './lib/utils/props-for-next-shape'
+export { refreshPage } from './lib/utils/refresh-page'
+export {
+	getIndexAbove,
+	getIndexBelow,
+	getIndexBetween,
+	getIndexGenerator,
+	getIndices,
+	getIndicesAbove,
+	getIndicesBelow,
+	getIndicesBetween,
+	getMaxIndex,
+	indexGenerator,
+	sortById,
+	sortByIndex,
+} from './lib/utils/reordering/reordering'
+export {
+	applyRotationToSnapshotShapes,
+	getRotationSnapshot,
+	type RotationSnapshot,
+} from './lib/utils/rotation'
+export { runtime, setRuntimeOverrides } from './lib/utils/runtime'
+export {
+	blobAsString,
+	correctSpacesToNbsp,
+	dataTransferItemAsString,
+	defaultEmptyAs,
+} from './lib/utils/string'
+export { getPointerInfo, getSvgPathFromStroke, getSvgPathFromStrokePoints } from './lib/utils/svg'
+export { openWindow } from './lib/utils/window-open'

commit 00e3d20dc853a850d87e3fcc3957eebb86d7af4a
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Wed May 3 14:48:46 2023 +0100

    [feat] new LiveCollaborators behind feature flag (#1219)
    
    In this PR I'm adding new versions of the `LiveCollaborators` and
    `Collaborators` components for the ephemeral state work. They are behind
    a feature flag for now.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 08b24dcf5..6e44ec191 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -171,6 +171,8 @@ export { normalizeWheel } from './lib/hooks/shared'
 export { useApp } from './lib/hooks/useApp'
 export { useContainer } from './lib/hooks/useContainer'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
+export { usePeerIds } from './lib/hooks/usePeerIds'
+export { usePresence } from './lib/hooks/usePresence'
 export { useQuickReactor } from './lib/hooks/useQuickReactor'
 export { useReactor } from './lib/hooks/useReactor'
 export { useUrlState } from './lib/hooks/useUrlState'

commit 880f82e658dbf325c2b90182e0ed22cc8cfe9958
Author: alex <alex@dytry.ch>
Date:   Fri May 5 14:10:36 2023 +0100

    New vite-based examples app (#1226)
    
    Right now this examples app looks exactly the same as our old examples
    app, but there are a couple of tiny differences:
    - We use `vite` instead of our own esbuild setup for development and
    bundling
    - We use `@tldraw/assets` for smart asset hashing instead of copying the
    assets to a public folder
    
    You can use `@tldraw/assets` with vite with a bunch of extra config, but
    it (plus a bunch of other bundlers) also support a special syntax for
    specifying asset urls: `new URL('./my/asset.svg',
    import.meta.url).href`. This approach is more standards-complient, but
    doesn't work with every bundler just yet. This diff also adds a
    url-based version of `@tldraw/assets`, although I'd like to tweak the
    entry point - right now you need to import from
    `@tldraw/assets/lib/urls`, but i'd like to find a way to get this to
    `@tldraw/assets/urls` or something at some point.
    
    There are a couple other extra fixes in here:
    - vscode builds were broken, they're fixed now!
    - there's also a little tweak to the `getBundlerAssetUrls` API to allow
    passing in a function instead of an object for URL formatting
    - there are new internal-only functions for injecting asset urls
    globally instead of passing them in via react props. this means we can
    get the benefits of cacheable URLs without having to clutter our
    examples by passing them in

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 6e44ec191..72a0aac9a 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -107,7 +107,11 @@ export {
 export { type RequiredKeys, type TLEasingType } from './lib/app/types/misc-types'
 export { type TLReorderOperation } from './lib/app/types/reorder-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/app/types/selection-types'
-export { defaultEditorAssetUrls, type EditorAssetUrls } from './lib/assetUrls'
+export {
+	defaultEditorAssetUrls,
+	setDefaultEditorAssetUrls,
+	type EditorAssetUrls,
+} from './lib/assetUrls'
 export { Canvas } from './lib/components/Canvas'
 export { DefaultErrorFallback } from './lib/components/DefaultErrorFallback'
 export {

commit b1569c97e0f9b7c0ae54cce52f2e36bc4ca51a06
Author: Lu[ke] Wilson <l2wilson94@gmail.com>
Date:   Fri May 5 07:05:25 2023 -0700

    add docs for TLShapeUtil (#1215)
    
    This PR adds docs for the methods in the TLShapeUtil class.
    I think that it's a good page to have docs on, as it shows people what's
    possible with the custom shape API.
    
    Currently, our docs are not showing `@param` info for lots of methods,
    including the ones added in this PR.
    I'll do fix for that in a follow-up PR, so that it's easier to review.
    
    ---
    
    Note: Moving forward, we probably want to consider **_where_** these
    docs are shown, and how we achieve that.
    
    For example, do we put the docs for these methods in:
    * The docs page for the `TLShapeUtil` class?
    * The docs pages for the handler types, eg:
    [`OnResizeHandler`](http://localhost:3000/gen/editor/OnResizeHandler-type)?
    * Both?
    
    Right now, I opted for putting them in the the TLShapeUtil class, as it
    keeps them all in one place, and it's what we already do for some
    others.
    
    We should consider both - what works best for the docs? and what works
    best for code editors?
    
    ---
    
    This PR also includes a fix to our pre-commit step that @SomeHats did.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 72a0aac9a..eee16e3bb 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -56,6 +56,7 @@ export {
 	type OnTranslateEndHandler,
 	type OnTranslateHandler,
 	type OnTranslateStartHandler,
+	type TLResizeInfo,
 	type TLResizeMode,
 	type TLShapeUtilConstructor,
 	type TLShapeUtilFlag,

commit 3437ca89d9e9e9c1397c06896d1768c196954cb6
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu May 11 23:14:58 2023 +0100

    [feature] ui events (#1326)
    
    This PR updates the editor events:
    - adds types to the events emitted by the app (by `app.emit`)
    - removes a few events emitted by the app (e.g. `move-to-page`,
    `change-camera`)
    - adds `onEvent` prop to the <TldrawUi> / <Tldraw> components
    - call the `onEvent` when actions occur or tools are selected
    - does some superficial cleanup on editor app APIs
    
    ### Release Note
    
    - Fix layout bug in error dialog
    - (ui) Add `TLEventMap` for types emitted from editor app
    - (editor) Update `crash` event emitted from editor app to include error
    - (editor) Update `change-history` event emitted from editor app
    - (editor) Remove `change-camera` event from editor app
    - (editor) Remove `move-to-page` event from editor app
    - (ui) Add `onEvent` prop and events to <Tldraw> / <TldrawUi>
    - (editor) Replace `app.openMenus` plain Set with computed value
    - (editor) Add `addOpenMenu` method
    - (editor) Add `removeOpenMenu` method
    - (editor) Add `setFocusMode` method
    - (editor) Add `setToolLocked` method
    - (editor) Add `setSnapMode` method
    - (editor) Add `isSnapMode` method
    - (editor) Update `setGridMode` method return type to editor app
    - (editor) Update `setReadOnly` method return type to editor app
    - (editor) Update `setPenMode` method return type to editor app
    - (editor) Update `selectNone` method return type to editor app
    - (editor) Rename `backToContent` to `zoomToContent`
    - (editor) Remove `TLReorderOperation` type
    
    ---------
    
    Co-authored-by: Orange Mug <orangemug@users.noreply.github.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index eee16e3bb..935e52a3a 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -66,6 +66,7 @@ export { TLVideoShapeDef, TLVideoUtil } from './lib/app/shapeutils/TLVideoUtil/T
 export { StateNode, type StateNodeConstructor } from './lib/app/statechart/StateNode'
 export { TLBoxTool, type TLBoxLike } from './lib/app/statechart/TLBoxTool/TLBoxTool'
 export { type ClipboardPayload, type TLClipboardModel } from './lib/app/types/clipboard-types'
+export { type TLEventMap, type TLEventMapHandler } from './lib/app/types/emit-types'
 export {
 	EVENT_NAME_MAP,
 	type TLBaseEventInfo,
@@ -106,7 +107,6 @@ export {
 	type TLMark,
 } from './lib/app/types/history-types'
 export { type RequiredKeys, type TLEasingType } from './lib/app/types/misc-types'
-export { type TLReorderOperation } from './lib/app/types/reorder-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/app/types/selection-types'
 export {
 	defaultEditorAssetUrls,

commit 6573cb2fbe65f5c7632a6ac4b6d57c9726b33257
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Wed May 17 16:43:38 2023 +0100

    remove url state, to private (#1402)
    
    This PR moves a hook to the private repo.
    
    ### Change Type
    
    - [ ] `patch` â€” Bug Fix
    - [ ] `minor` â€” New Feature
    - [x] `major` â€” Breaking Change
    
    ### Release Notes
    
    - [editor] remove `useUrlState`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 935e52a3a..a586627a5 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -180,7 +180,6 @@ export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
 export { useQuickReactor } from './lib/hooks/useQuickReactor'
 export { useReactor } from './lib/hooks/useReactor'
-export { useUrlState } from './lib/hooks/useUrlState'
 export { WeakMapCache } from './lib/utils/WeakMapCache'
 export {
 	ACCEPTED_ASSET_TYPE,

commit a1e72014c65ab944d2eacceeb7a35119033cfca2
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Wed May 17 17:32:25 2023 +0100

    [improvement] refactor paste to support multi-line text (#1398)
    
    This PR refactors our clipboard handlers. It should simplify the way
    that things work and better handle the difference between how the native
    API events are handled vs. the browser's clipboard API events.
    
    ![Kapture 2023-05-17 at 13 26
    34](https://github.com/tldraw/tldraw/assets/23072548/5dedcc25-a1d2-423f-8bc2-415f761b643b)
    
    Everything that used to be supported now also still works.
    
    In addition, we now have several useful features:
    
    ### Multiline text can be pasted into the app
    
    When pasting text that contains more than one line, the text is pasted
    correctly; even if the clipboard also includes HTML data. Previously, we
    would try to paste HTML data if we found it, because that data might
    contain tldraw's own content as a comment; but if that failed, we would
    paste the data as text instead. This led to pasting text that lost lots
    of information from that text, such as line breaks and indentations.
    
    ### Multiline text shapes are aligned correctly
    
    When pasting raw text that has more than one line, the text will be left
    alignedâ€”or right aligned if the text is likely from a RTL language.
    
    ![Kapture 2023-05-17 at 13 42
    54](https://github.com/tldraw/tldraw/assets/23072548/f705acd5-136c-4144-80da-6e97ff766a58)
    
    ### Common minimum indentation is removed from each line
    
    ![Kapture 2023-05-17 at 13 56
    28](https://github.com/tldraw/tldraw/assets/23072548/d45c95f6-6d28-4c9f-8cd3-8078700ce928)
    
    This is something that absolutely every app should implement, but here
    we go. When multiline text has "common indentation" on each line, which
    is often the case when pasting text from code, then that indentation is
    removed from each line.
    
    ### Auto wrapping for big pastes
    
    When a line has no text breaks but a lot of text, we now set the width
    of the text shape.
    
    ![Kapture 2023-05-17 at 14 00
    04](https://github.com/tldraw/tldraw/assets/23072548/0b7f69c3-bcf9-42e9-a1ed-df026f868793)
    
    ## How it works
    
    A `ClipboardThing` is the common interface for things that we found on
    the clipboard, native or otherwise. Both `handlePasteFromClipboardApi`
    and `handlePasteFromEventClipboardData` parse out `ClipboardThing`s and
    pass them to `handleClipboardThings`.
    
    <img width="905" alt="image"
    src="https://github.com/tldraw/tldraw/assets/23072548/fd087539-edbb-4527-b5ff-ca7d7c1726b2">
    
    A `ClipboardResult` is the result of processing a `ClipboardThing`, and
    usually contains text and other information about that text. We make
    decisions on what to create based on which `ClipboardResult`s we find.
    
    When pasting text, we check to see whether the result would be bigger
    than the viewport, or if the text is multiline, or if the text is of an
    RTL language by testing certain common RTL characters. We make some
    adjustments based on those factors, ensuring that the top-left corner of
    the text is on screen and reasonably positioned within the viewport if
    possible.
    
    ### Change Type
    
    - [x] `minor` â€” New Feature
    
    ### Test Plan
    
    1. Copy and paste shapes
    2. Copy and paste text from elsewhere into the app
    3. Copy and paste images from elsewhere into the app
    4. Try on different browsers
    
    ### Release Notes
    
    - Improves clipboard logic when pasting text
    - Adds support for pasting multi-line text
    - Adds maximum widths when pasting single-line text
    - Adds support for RTL languages when pasting multi-line or wrapped text
    - Strips leading indentation when pasting text

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index a586627a5..57bf1936d 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -61,7 +61,7 @@ export {
 	type TLShapeUtilConstructor,
 	type TLShapeUtilFlag,
 } from './lib/app/shapeutils/TLShapeUtil'
-export { TLTextShapeDef, TLTextUtil } from './lib/app/shapeutils/TLTextUtil/TLTextUtil'
+export { INDENT, TLTextShapeDef, TLTextUtil } from './lib/app/shapeutils/TLTextUtil/TLTextUtil'
 export { TLVideoShapeDef, TLVideoUtil } from './lib/app/shapeutils/TLVideoUtil/TLVideoUtil'
 export { StateNode, type StateNodeConstructor } from './lib/app/statechart/StateNode'
 export { TLBoxTool, type TLBoxLike } from './lib/app/statechart/TLBoxTool/TLBoxTool'

commit e43b0103fdf5f3a20a0c3f2a1f77fb870d4996f2
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon May 22 09:18:01 2023 +0100

    Create @tldraw/indices package (#1426)
    
    This PR moves our "fractical indices" library into its own package.
    
    - [x] `major` â€” Breaking Change
    
    ### Release Notes
    
    - [@tldraw/editor] Remove fractional indices code into `@tldraw/indices`
    - [@tldraw/indices] Create library for fractional indices code

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 57bf1936d..69ffd9a3f 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -1,6 +1,16 @@
 // Important! don't move this tlschema re-export to lib/index.ts, doing so causes esbuild to produce
 // incorrect output. https://github.com/evanw/esbuild/issues/1737
 
+export {
+	getIndexAbove,
+	getIndexBelow,
+	getIndexBetween,
+	getIndices,
+	getIndicesAbove,
+	getIndicesBelow,
+	getIndicesBetween,
+	sortByIndex,
+} from '@tldraw/indices'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/tlschema'
 export { getHashForString } from '@tldraw/utils'
@@ -243,20 +253,6 @@ export { hardResetApp } from './lib/utils/hard-reset'
 export { isAnimated, isGIF } from './lib/utils/is-gif-animated'
 export { setPropsForNextShape } from './lib/utils/props-for-next-shape'
 export { refreshPage } from './lib/utils/refresh-page'
-export {
-	getIndexAbove,
-	getIndexBelow,
-	getIndexBetween,
-	getIndexGenerator,
-	getIndices,
-	getIndicesAbove,
-	getIndicesBelow,
-	getIndicesBetween,
-	getMaxIndex,
-	indexGenerator,
-	sortById,
-	sortByIndex,
-} from './lib/utils/reordering/reordering'
 export {
 	applyRotationToSnapshotShapes,
 	getRotationSnapshot,

commit 649125cdad88bd75bd5c489ad113255d57a620f9
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue May 23 13:32:42 2023 +0100

    [refactor] Remove `TLShapeDef`, `getShapeUtilByType`. (#1432)
    
    This PR removes `TLShapeDef` and associated helpers / references.
    
    It purposely loosens the configuration and typings to better support
    customization.
    
    ### Change Type
    
    - [x] `major` â€” Breaking Change
    
    ### Test Plan
    
    1. Use the app!
    
    ### Release Notes
    
    - [tlschema] Update props of `createTLSchema`
    - [editor] Update props of `TldrawEditorConfig`
    - [editor] Remove `App.getShapeUtilByType`
    - [editor] Update `App.getShapeUtil` to take a type rather than a shape
    
    ---------
    
    Co-authored-by: alex <alex@dytry.ch>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 69ffd9a3f..447b66b60 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -27,24 +27,17 @@ export {
 	type AppOptions,
 	type TLChange,
 } from './lib/app/App'
-export { TLArrowShapeDef, TLArrowUtil } from './lib/app/shapeutils/TLArrowUtil/TLArrowUtil'
-export {
-	TLBookmarkShapeDef,
-	TLBookmarkUtil,
-} from './lib/app/shapeutils/TLBookmarkUtil/TLBookmarkUtil'
+export { TLArrowUtil } from './lib/app/shapeutils/TLArrowUtil/TLArrowUtil'
+export { TLBookmarkUtil } from './lib/app/shapeutils/TLBookmarkUtil/TLBookmarkUtil'
 export { TLBoxUtil } from './lib/app/shapeutils/TLBoxUtil'
-export { TLDrawShapeDef, TLDrawUtil } from './lib/app/shapeutils/TLDrawUtil/TLDrawUtil'
-export { TLEmbedShapeDef, TLEmbedUtil } from './lib/app/shapeutils/TLEmbedUtil/TLEmbedUtil'
-export { TLFrameShapeDef, TLFrameUtil } from './lib/app/shapeutils/TLFrameUtil/TLFrameUtil'
-export { TLGeoShapeDef, TLGeoUtil } from './lib/app/shapeutils/TLGeoUtil/TLGeoUtil'
-export { TLGroupShapeDef, TLGroupUtil } from './lib/app/shapeutils/TLGroupUtil/TLGroupUtil'
-export { TLImageShapeDef, TLImageUtil } from './lib/app/shapeutils/TLImageUtil/TLImageUtil'
-export {
-	TLLineShapeDef,
-	TLLineUtil,
-	getSplineForLineShape,
-} from './lib/app/shapeutils/TLLineUtil/TLLineUtil'
-export { TLNoteShapeDef, TLNoteUtil } from './lib/app/shapeutils/TLNoteUtil/TLNoteUtil'
+export { TLDrawUtil } from './lib/app/shapeutils/TLDrawUtil/TLDrawUtil'
+export { TLEmbedUtil } from './lib/app/shapeutils/TLEmbedUtil/TLEmbedUtil'
+export { TLFrameUtil } from './lib/app/shapeutils/TLFrameUtil/TLFrameUtil'
+export { TLGeoUtil } from './lib/app/shapeutils/TLGeoUtil/TLGeoUtil'
+export { TLGroupUtil } from './lib/app/shapeutils/TLGroupUtil/TLGroupUtil'
+export { TLImageUtil } from './lib/app/shapeutils/TLImageUtil/TLImageUtil'
+export { TLLineUtil, getSplineForLineShape } from './lib/app/shapeutils/TLLineUtil/TLLineUtil'
+export { TLNoteUtil } from './lib/app/shapeutils/TLNoteUtil/TLNoteUtil'
 export {
 	TLShapeUtil,
 	type OnBeforeCreateHandler,
@@ -71,8 +64,8 @@ export {
 	type TLShapeUtilConstructor,
 	type TLShapeUtilFlag,
 } from './lib/app/shapeutils/TLShapeUtil'
-export { INDENT, TLTextShapeDef, TLTextUtil } from './lib/app/shapeutils/TLTextUtil/TLTextUtil'
-export { TLVideoShapeDef, TLVideoUtil } from './lib/app/shapeutils/TLVideoUtil/TLVideoUtil'
+export { INDENT, TLTextUtil } from './lib/app/shapeutils/TLTextUtil/TLTextUtil'
+export { TLVideoUtil } from './lib/app/shapeutils/TLVideoUtil/TLVideoUtil'
 export { StateNode, type StateNodeConstructor } from './lib/app/statechart/StateNode'
 export { TLBoxTool, type TLBoxLike } from './lib/app/statechart/TLBoxTool/TLBoxTool'
 export { type ClipboardPayload, type TLClipboardModel } from './lib/app/types/clipboard-types'
@@ -138,11 +131,6 @@ export {
 	type ReadySyncedStore,
 	type SyncedStore,
 } from './lib/config/SyncedStore'
-export {
-	defineShape,
-	type TLShapeDef,
-	type TLUnknownShapeDef,
-} from './lib/config/TLShapeDefinition'
 export { TldrawEditorConfig } from './lib/config/TldrawEditorConfig'
 export {
 	ANIMATION_MEDIUM_MS,

commit 356a0d1e73000ab94dcf828527eaedb230842096
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Thu May 25 10:54:29 2023 +0100

    [chore] refactor user preferences (#1435)
    
    - Remove TLUser, TLUserPresence
    - Add first-class support for user preferences that persists across
    rooms and tabs
    
    ### Change Type
    
    <!-- ðŸ’¡ Indicate the type of change your pull request is. -->
    <!-- ðŸ¤·â€â™€ï¸ If you're not sure, don't select anything -->
    <!-- âœ‚ï¸ Feel free to delete unselected options -->
    
    <!-- To select one, put an x in the box: [x] -->
    
    - [ ] `patch` â€” Bug Fix
    - [ ] `minor` â€” New Feature
    - [x] `major` â€” Breaking Change
    - [ ] `dependencies` â€” Dependency Update (publishes a `patch` release,
    for devDependencies use `internal`)
    - [ ] `documentation` â€” Changes to the documentation only (will not
    publish a new version)
    - [ ] `tests` â€” Changes to any testing-related code only (will not
    publish a new version)
    - [ ] `internal` â€” Any other changes that don't affect the published
    package (will not publish a new version)
    
    ### Test Plan
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [ ] Unit Tests
    - [ ] Webdriver tests
    
    ### Release Notes
    
    - Add a brief release note for your PR here.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 447b66b60..3f17c2bb6 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -131,6 +131,7 @@ export {
 	type ReadySyncedStore,
 	type SyncedStore,
 } from './lib/config/SyncedStore'
+export { USER_COLORS } from './lib/config/TLUserPreferences'
 export { TldrawEditorConfig } from './lib/config/TldrawEditorConfig'
 export {
 	ANIMATION_MEDIUM_MS,

commit 4048064e78b09492423bd117e8fbc51b09673bde
Author: alex <alex@dytry.ch>
Date:   Tue May 30 14:06:15 2023 +0100

    Feature flags rework (#1474)
    
    This diff tweaks our `debugFlags` framework to support setting different
    default value for different environments, makes it easier to define
    feature flags, and makes feature flags show up in the debug menu by
    default. With this change, feature flags will default to being enabled
    in dev and preview environments, but disabled in production.
    
    Specify a feature flag like this:
    ```ts
    const featureFlags = {
          myCoolNewFeature: createFeatureFlag('myCoolNewFeature')
    }
    ```
    
    optionally, pass a second value to control its defaults:
    ```ts
    const featureFlags = {
        featureEnabledInProduction: createFeatureFlag('someFeature', { all: true }),
        customEnabled: createFeatureFlag('otherFeature', {development: true, staging: false, production: false}),
    }
    ```
    
    In code, the value can be read using `featureFlags.myFeature.value`.
    Remember to wrap reading it in a reactive context!
    
    ### Change Type
    
    - [x] `patch` â€” Bug Fix
    
    ### Test Plan
    
    -
    
    ### Release Notes
    
    [internal only change]

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 3f17c2bb6..0dd24d531 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -209,7 +209,7 @@ export {
 	snapToGrid,
 	uniqueId,
 } from './lib/utils/data'
-export { debugFlags } from './lib/utils/debug-flags'
+export { debugFlags, featureFlags, type DebugFlag } from './lib/utils/debug-flags'
 export {
 	loopToHtmlElement,
 	preventDefault,

commit 674a829d1f5d57aa61135fa47bc41f5fe3f6025e
Author: alex <alex@dytry.ch>
Date:   Thu Jun 1 13:46:13 2023 +0100

    [1/3] initial highlighter shape/tool (#1401)
    
    This diff adds an initial version of the highlighter shape. At this
    stage, it's a complete copy of the draw tool minus the following
    features:
    * Fills
    * Stroke types
    * Closed shapes
    
    I've created a new shape util (a copy-paste of the draw one with stuff
    renamed/deleted) but reused the state chart nodes for the draw shape.
    Currently this new tool looks exactly like the draw tool, but that'll be
    changing soon!
    
    ![Kapture 2023-05-17 at 15 37
    33](https://github.com/tldraw/tldraw/assets/1489520/982e78f4-6495-4a68-aa51-c8f7b5bcdd01)
    
    The UI here is extremely WIP. The highlighter tool is behind a feature
    flag, but once enabled is accessible through the tool bar. There's a
    first-draft highlighter icon (i didn't spend much time on this, it's not
    super legible on non-retina displays yet imo), and the tool is bound to
    the `i` key (any better suggestions? `h` is taken by the hand tool)
    
    ### The plan
    1. initial highlighter shape/tool #1401 **>you are here<**
    2. sandwich rendering for highlighter shapes #1418
    3. shape styling - new colours and sizes, lightweight perfect freehand
    changes
    
    ### Change Type
    - [x] `minor` â€” New Feature
    
    ### Test Plan
    (not yet)
    
    ### Release Notes
    
    [internal only change layout ground work for highlighter]

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 0dd24d531..6abc65eef 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -35,6 +35,7 @@ export { TLEmbedUtil } from './lib/app/shapeutils/TLEmbedUtil/TLEmbedUtil'
 export { TLFrameUtil } from './lib/app/shapeutils/TLFrameUtil/TLFrameUtil'
 export { TLGeoUtil } from './lib/app/shapeutils/TLGeoUtil/TLGeoUtil'
 export { TLGroupUtil } from './lib/app/shapeutils/TLGroupUtil/TLGroupUtil'
+export { TLHighlightUtil } from './lib/app/shapeutils/TLHighlightUtil/TLHighlightUtil'
 export { TLImageUtil } from './lib/app/shapeutils/TLImageUtil/TLImageUtil'
 export { TLLineUtil, getSplineForLineShape } from './lib/app/shapeutils/TLLineUtil/TLLineUtil'
 export { TLNoteUtil } from './lib/app/shapeutils/TLNoteUtil/TLNoteUtil'

commit 0c4174c0b8b0ef1250cc3bd4c4030f99e5204929
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Jun 1 16:47:34 2023 +0100

    [refactor] User-facing APIs (#1478)
    
    This PR updates our user-facing APIs for the Tldraw and TldrawEditor
    components, as well as the Editor (App). It mainly incorporates surface
    changes from #1450 without any changes to validators or migrators,
    incorporating feedback / discussion with @SomeHats and @ds300.
    
    Here we:
    - remove the TldrawEditorConfig
    - bring back a loose version of shape definitions
    - make a separation between "core" shapes and "default" shapes
    - do not allow custom shapes, migrators or validators to overwrite core
    shapes
    - but _do_ allow new shapes
    
    ## `<Tldraw>` component
    
    In this PR, the `Tldraw` component wraps both the `TldrawEditor`
    component and our `TldrawUi` component. It accepts a union of props for
    both components. Previously, this component also added local syncing via
    a `useLocalSyncClient` hook call, however that has been pushed down to
    the `TldrawEditor` component.
    
    ## `<TldrawEditor>` component
    
    The `TldrawEditor` component now more neatly wraps up the different ways
    that the editor can be configured.
    
    ## The store prop (`TldrawEditorProps.store`)
    
    There are three main ways for the `TldrawEditor` component to be run:
    1. with an externally defined store
    2. with an externally defined syncing store (local or remote)
    3. with an internally defined store
    4. with an internally defined locally syncing store
    
    The `store` prop allows for these configurations.
    
    If the `store` prop is defined, it may be defined either as a `TLStore`
    or as a `SyncedStore`. If the store is a `TLStore`, then the Editor will
    assume that the store is ready to go; if it is defined as a SyncedStore,
    then the component will display the loading / error screens as needed,
    or the final editor once the store's status is "synced".
    
    When the store is left undefined, then the `TldrawEditor` will create
    its own internal store using the optional `instanceId`, `initialData`,
    or `shapes` props to define the store / store schema.
    
    If the `persistenceKey` prop is left undefined, then the store will not
    be synced. If the `persistenceKey` is defined, then the store will be
    synced locally. In the future, we may also here accept the API key /
    roomId / etc for creating a remotely synced store.
    
    The `SyncedStore` type has been expanded to also include types used for
    remote syncing, e.g. with `ConnectionStatus`.
    
    ## Tools
    
    By default, the App has two "baked-in" tools: the select tool and the
    zoom tool. These cannot (for now) be replaced or removed. The default
    tools are used by default, but may be replaced by other tools if
    provided.
    
    ## Shapes
    
    By default, the App has a set of "core" shapes:
    - group
    - embed
    - bookmark
    - image
    - video
    - text
    
    That cannot by overwritten because they're created by the app at
    different moments, such as when double clicking on the canvas or via a
    copy and paste event. In follow up PRs, we'll split these out so that
    users can replace parts of the code where these shapes are created.
    
    ### Change Type
    
    - [x] `major` â€” Breaking Change
    
    ### Test Plan
    
    - [x] Unit Tests

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 6abc65eef..b91acd2ea 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -127,13 +127,14 @@ export {
 export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
 export {
-	type ErrorSyncedStore,
-	type InitializingSyncedStore,
-	type ReadySyncedStore,
-	type SyncedStore,
-} from './lib/config/SyncedStore'
-export { USER_COLORS } from './lib/config/TLUserPreferences'
-export { TldrawEditorConfig } from './lib/config/TldrawEditorConfig'
+	USER_COLORS,
+	getUserPreferences,
+	setUserPreferences,
+	type TLUserPreferences,
+} from './lib/config/TLUserPreferences'
+export { createTLStore } from './lib/config/createTLStore'
+export { defaultShapes } from './lib/config/defaultShapes'
+export { defaultTools } from './lib/config/defaultTools'
 export {
 	ANIMATION_MEDIUM_MS,
 	ANIMATION_SHORT_MS,
@@ -176,10 +177,12 @@ export { normalizeWheel } from './lib/hooks/shared'
 export { useApp } from './lib/hooks/useApp'
 export { useContainer } from './lib/hooks/useContainer'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
+export { useLocalStore } from './lib/hooks/useLocalStore'
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
 export { useQuickReactor } from './lib/hooks/useQuickReactor'
 export { useReactor } from './lib/hooks/useReactor'
+export { useTLStore } from './lib/hooks/useTLStore'
 export { WeakMapCache } from './lib/utils/WeakMapCache'
 export {
 	ACCEPTED_ASSET_TYPE,
@@ -256,4 +259,7 @@ export {
 	defaultEmptyAs,
 } from './lib/utils/string'
 export { getPointerInfo, getSvgPathFromStroke, getSvgPathFromStrokePoints } from './lib/utils/svg'
+export { type StoreWithStatus } from './lib/utils/sync/StoreWithStatus'
+export { hardReset } from './lib/utils/sync/hardReset'
+export { TAB_ID } from './lib/utils/sync/persistence-constants'
 export { openWindow } from './lib/utils/window-open'

commit da35e0da27b9b9cce00b812f009bf40889e2d60a
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jun 2 10:38:13 2023 +0100

    move v1 migration code into file-format (#1499)
    
    Move v1 migration code out of editor
    
    ### Change Type
    
    - [x] `minor` â€” New Feature

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index b91acd2ea..6124be3b5 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -204,7 +204,6 @@ export {
 	isSvgText,
 	isValidHttpURL,
 } from './lib/utils/assets'
-export { buildFromV1Document, type LegacyTldrawDocument } from './lib/utils/buildFromV1Document'
 export {
 	checkFlag,
 	fileToBase64,

commit 735f1c41b79a3fcce14446b6384ec796f0298a31
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jun 2 16:21:45 2023 +0100

    rename app to editor (#1503)
    
    This PR renames `App`, `app` and all appy names to `Editor`, `editor`,
    and editorry names.
    
    ### Change Type
    
    - [x] `major` â€” Breaking Change
    
    ### Release Notes
    
    - Rename `App` to `Editor` and many other things that reference `app` to
    `editor`.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 6124be3b5..ddaf4da2d 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -21,12 +21,12 @@ export {
 	type TldrawEditorProps,
 } from './lib/TldrawEditor'
 export {
-	App,
+	Editor,
 	isShapeWithHandles,
 	type AnimationOptions,
 	type AppOptions,
 	type TLChange,
-} from './lib/app/App'
+} from './lib/app/Editor'
 export { TLArrowUtil } from './lib/app/shapeutils/TLArrowUtil/TLArrowUtil'
 export { TLBookmarkUtil } from './lib/app/shapeutils/TLBookmarkUtil/TLBookmarkUtil'
 export { TLBoxUtil } from './lib/app/shapeutils/TLBoxUtil'
@@ -174,8 +174,8 @@ export {
 	ZOOMS,
 } from './lib/constants'
 export { normalizeWheel } from './lib/hooks/shared'
-export { useApp } from './lib/hooks/useApp'
 export { useContainer } from './lib/hooks/useContainer'
+export { useEditor } from './lib/hooks/useEditor'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
 export { useLocalStore } from './lib/hooks/useLocalStore'
 export { usePeerIds } from './lib/hooks/usePeerIds'
@@ -241,7 +241,7 @@ export {
 	type TLCopyType,
 	type TLExportType,
 } from './lib/utils/export'
-export { hardResetApp } from './lib/utils/hard-reset'
+export { hardResetEditor } from './lib/utils/hard-reset'
 export { isAnimated, isGIF } from './lib/utils/is-gif-animated'
 export { setPropsForNextShape } from './lib/utils/props-for-next-shape'
 export { refreshPage } from './lib/utils/refresh-page'

commit 0f893096046acfbbc6870a90796b5574b9ddf91b
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sun Jun 4 11:38:53 2023 +0100

    Renaming types, shape utils, tools (#1513)
    
    This PR renames all exported types to include the `TL` prefix. It also
    removes the `TL` prefix from things that are not types, including:
    - shape utils (e.g. `TLArrowUtil` becomes `ArrowShapeUtil`)
    - tools (e.g. `TLArrowTool` becomes `ArrowShapeTool`, `TLSelectTool`
    becomes `SelectTool`)
    
    ### Change Type
    
    - [x] `major` â€” Breaking Change
    
    ### Release Notes
    
    - Renaming of types, shape utils, tools

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index ddaf4da2d..fa1e397d8 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -1,16 +1,8 @@
 // Important! don't move this tlschema re-export to lib/index.ts, doing so causes esbuild to produce
 // incorrect output. https://github.com/evanw/esbuild/issues/1737
 
-export {
-	getIndexAbove,
-	getIndexBelow,
-	getIndexBetween,
-	getIndices,
-	getIndicesAbove,
-	getIndicesBelow,
-	getIndicesBetween,
-	sortByIndex,
-} from '@tldraw/indices'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/indices'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/tlschema'
 export { getHashForString } from '@tldraw/utils'
@@ -20,56 +12,53 @@ export {
 	TldrawEditor,
 	type TldrawEditorProps,
 } from './lib/TldrawEditor'
-export {
-	Editor,
-	isShapeWithHandles,
-	type AnimationOptions,
-	type AppOptions,
-	type TLChange,
-} from './lib/app/Editor'
-export { TLArrowUtil } from './lib/app/shapeutils/TLArrowUtil/TLArrowUtil'
-export { TLBookmarkUtil } from './lib/app/shapeutils/TLBookmarkUtil/TLBookmarkUtil'
-export { TLBoxUtil } from './lib/app/shapeutils/TLBoxUtil'
-export { TLDrawUtil } from './lib/app/shapeutils/TLDrawUtil/TLDrawUtil'
-export { TLEmbedUtil } from './lib/app/shapeutils/TLEmbedUtil/TLEmbedUtil'
-export { TLFrameUtil } from './lib/app/shapeutils/TLFrameUtil/TLFrameUtil'
-export { TLGeoUtil } from './lib/app/shapeutils/TLGeoUtil/TLGeoUtil'
-export { TLGroupUtil } from './lib/app/shapeutils/TLGroupUtil/TLGroupUtil'
-export { TLHighlightUtil } from './lib/app/shapeutils/TLHighlightUtil/TLHighlightUtil'
-export { TLImageUtil } from './lib/app/shapeutils/TLImageUtil/TLImageUtil'
-export { TLLineUtil, getSplineForLineShape } from './lib/app/shapeutils/TLLineUtil/TLLineUtil'
-export { TLNoteUtil } from './lib/app/shapeutils/TLNoteUtil/TLNoteUtil'
-export {
-	TLShapeUtil,
-	type OnBeforeCreateHandler,
-	type OnBeforeUpdateHandler,
-	type OnBindingChangeHandler,
-	type OnChildrenChangeHandler,
-	type OnClickHandler,
-	type OnDoubleClickHandleHandler,
-	type OnDoubleClickHandler,
-	type OnDragHandler,
-	type OnEditEndHandler,
-	type OnHandleChangeHandler,
-	type OnResizeEndHandler,
-	type OnResizeHandler,
-	type OnResizeStartHandler,
-	type OnRotateEndHandler,
-	type OnRotateHandler,
-	type OnRotateStartHandler,
-	type OnTranslateEndHandler,
-	type OnTranslateHandler,
-	type OnTranslateStartHandler,
+export { Editor, type TLAnimationOptions, type TLEditorOptions } from './lib/app/Editor'
+export { ArrowShapeUtil } from './lib/app/shapeutils/ArrowShapeUtil/ArrowShapeUtil'
+export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/app/shapeutils/BaseBoxShapeUtil'
+export { BookmarkShapeUtil } from './lib/app/shapeutils/BookmarkShapeUtil/BookmarkShapeUtil'
+export { DrawShapeUtil } from './lib/app/shapeutils/DrawShapeUtil/DrawShapeUtil'
+export { EmbedShapeUtil } from './lib/app/shapeutils/EmbedShapeUtil/EmbedShapeUtil'
+export { FrameShapeUtil } from './lib/app/shapeutils/FrameShapeUtil/FrameShapeUtil'
+export { GeoShapeUtil } from './lib/app/shapeutils/GeoShapeUtil/GeoShapeUtil'
+export { GroupShapeUtil } from './lib/app/shapeutils/GroupShapeUtil/GroupShapeUtil'
+export { HighlightShapeUtil } from './lib/app/shapeutils/HighlightShapeUtil/HighlightShapeUtil'
+export { ImageShapeUtil } from './lib/app/shapeutils/ImageShapeUtil/ImageShapeUtil'
+export {
+	LineShapeUtil,
+	getSplineForLineShape,
+} from './lib/app/shapeutils/LineShapeUtil/LineShapeUtil'
+export { NoteShapeUtil } from './lib/app/shapeutils/NoteShapeUtil/NoteShapeUtil'
+export {
+	ShapeUtil,
+	type TLOnBeforeCreateHandler,
+	type TLOnBeforeUpdateHandler,
+	type TLOnBindingChangeHandler,
+	type TLOnChildrenChangeHandler,
+	type TLOnClickHandler,
+	type TLOnDoubleClickHandleHandler,
+	type TLOnDoubleClickHandler,
+	type TLOnDragHandler,
+	type TLOnEditEndHandler,
+	type TLOnHandleChangeHandler,
+	type TLOnResizeEndHandler,
+	type TLOnResizeHandler,
+	type TLOnResizeStartHandler,
+	type TLOnRotateEndHandler,
+	type TLOnRotateHandler,
+	type TLOnRotateStartHandler,
+	type TLOnTranslateEndHandler,
+	type TLOnTranslateHandler,
+	type TLOnTranslateStartHandler,
 	type TLResizeInfo,
 	type TLResizeMode,
 	type TLShapeUtilConstructor,
 	type TLShapeUtilFlag,
-} from './lib/app/shapeutils/TLShapeUtil'
-export { INDENT, TLTextUtil } from './lib/app/shapeutils/TLTextUtil/TLTextUtil'
-export { TLVideoUtil } from './lib/app/shapeutils/TLVideoUtil/TLVideoUtil'
-export { StateNode, type StateNodeConstructor } from './lib/app/statechart/StateNode'
-export { TLBoxTool, type TLBoxLike } from './lib/app/statechart/TLBoxTool/TLBoxTool'
-export { type ClipboardPayload, type TLClipboardModel } from './lib/app/types/clipboard-types'
+} from './lib/app/shapeutils/ShapeUtil'
+export { INDENT, TextShapeUtil } from './lib/app/shapeutils/TextShapeUtil/TextShapeUtil'
+export { VideoShapeUtil } from './lib/app/shapeutils/VideoShapeUtil/VideoShapeUtil'
+export { BaseBoxShapeTool } from './lib/app/tools/BaseBoxShapeTool/BaseBoxShapeTool'
+export { StateNode, type TLStateNodeConstructor } from './lib/app/tools/StateNode'
+export { type TLContent } from './lib/app/types/clipboard-types'
 export { type TLEventMap, type TLEventMapHandler } from './lib/app/types/emit-types'
 export {
 	EVENT_NAME_MAP,
@@ -81,9 +70,11 @@ export {
 	type TLClickEventInfo,
 	type TLCompleteEvent,
 	type TLCompleteEventInfo,
+	type TLEnterEventHandler,
 	type TLEventHandlers,
 	type TLEventInfo,
 	type TLEventName,
+	type TLExitEventHandler,
 	type TLInterruptEvent,
 	type TLInterruptEventInfo,
 	type TLKeyboardEvent,
@@ -99,30 +90,28 @@ export {
 	type TLTickEvent,
 	type TLWheelEvent,
 	type TLWheelEventInfo,
-	type UiEnterHandler,
 	type UiEvent,
 	type UiEventType,
-	type UiExitHandler,
 } from './lib/app/types/event-types'
 export {
 	type TLCommand,
 	type TLCommandHandler,
 	type TLHistoryEntry,
-	type TLMark,
+	type TLHistoryMark,
 } from './lib/app/types/history-types'
-export { type RequiredKeys, type TLEasingType } from './lib/app/types/misc-types'
+export { type RequiredKeys } from './lib/app/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/app/types/selection-types'
 export {
 	defaultEditorAssetUrls,
 	setDefaultEditorAssetUrls,
-	type EditorAssetUrls,
+	type TLEditorAssetUrls,
 } from './lib/assetUrls'
 export { Canvas } from './lib/components/Canvas'
 export { DefaultErrorFallback } from './lib/components/DefaultErrorFallback'
 export {
 	ErrorBoundary,
 	OptionalErrorBoundary,
-	type ErrorBoundaryProps,
+	type TLErrorBoundaryProps,
 } from './lib/components/ErrorBoundary'
 export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
@@ -227,7 +216,7 @@ export {
 	getEmbedInfoUnsafely,
 	matchEmbedUrl,
 	matchUrl,
-	type EmbedResult,
+	type TLEmbedResult,
 } from './lib/utils/embeds'
 export {
 	downloadDataURLAsFile,
@@ -245,11 +234,6 @@ export { hardResetEditor } from './lib/utils/hard-reset'
 export { isAnimated, isGIF } from './lib/utils/is-gif-animated'
 export { setPropsForNextShape } from './lib/utils/props-for-next-shape'
 export { refreshPage } from './lib/utils/refresh-page'
-export {
-	applyRotationToSnapshotShapes,
-	getRotationSnapshot,
-	type RotationSnapshot,
-} from './lib/utils/rotation'
 export { runtime, setRuntimeOverrides } from './lib/utils/runtime'
 export {
 	blobAsString,
@@ -258,7 +242,7 @@ export {
 	defaultEmptyAs,
 } from './lib/utils/string'
 export { getPointerInfo, getSvgPathFromStroke, getSvgPathFromStrokePoints } from './lib/utils/svg'
-export { type StoreWithStatus } from './lib/utils/sync/StoreWithStatus'
+export { type TLStoreWithStatus } from './lib/utils/sync/StoreWithStatus'
 export { hardReset } from './lib/utils/sync/hardReset'
 export { TAB_ID } from './lib/utils/sync/persistence-constants'
 export { openWindow } from './lib/utils/window-open'

commit f15a8797f04132dc21949f731894b0e2d97a3e14
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Mon Jun 5 15:11:07 2023 +0100

    Independent instance state persistence (#1493)
    
    This PR
    
    - Removes UserDocumentRecordType
      - moving isSnapMode to user preferences
      - moving isGridMode and isPenMode to InstanceRecordType
      - deleting the other properties which are no longer needed.
    
    - Creates a separate pipeline for persisting instance state.
    
    Previously the instance state records were stored alongside the document
    state records, and in order to load the state for a particular instance
    (in our case, a particular tab) you needed to pass the 'instanceId'
    prop. This prop ended up totally pervading the public API and people ran
    into all kinds of issues with it, e.g. using the same instance id in
    multiple editor instances.
    
    There was also an issue whereby it was hard for us to clean up old
    instance state so the idb table ended up bloating over time.
    
    This PR makes it so that rather than passing an instanceId, you load the
    instance state yourself while creating the store. It provides tools to
    make that easy.
    
    - Undoes the assumption that we might have more than one instance's
    state in the store.
    
    - Like `document`, `instance` now has a singleton id
    `instance:instance`.
    - Page state ids and camera ids are no longer random, but rather derive
    from the page they belong to. This is like having a foreign primary key
    in SQL databases. It's something i'd love to support fully as part of
    the RecordType/Store api.
    
    Tests to do
    
    - [x] Test Migrations
    - [x] Test Store.listen filtering
    - [x] Make type sets in Store public and readonly
    - [x] Test RecordType.createId
    - [x] Test Instance state snapshot loading/exporting
    - [x] Manual test File I/O
    - [x] Manual test Vscode extension with multiple tabs
    - [x] Audit usages of store.query
    - [x] Audit usages of changed types: InstanceRecordType, 'instance',
    InstancePageStateRecordType, 'instance_page_state', 'user_document',
    'camera', CameraRecordType, InstancePresenceRecordType,
    'instance_presence'
    - [x] Test user preferences
    - [x] Manual test isSnapMode and isGridMode and isPenMode
    - [ ] Test indexedDb functions
    - [x] Add instanceId stuff back
    
    
    ### Change Type
    
    - [x] `major` â€” Breaking Change
    
    
    ### Test Plan
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [ ] Unit Tests
    - [ ] Webdriver tests
    
    ### Release Notes
    
    - Add a brief release note for your PR here.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index fa1e397d8..79004bb6b 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -115,6 +115,13 @@ export {
 } from './lib/components/ErrorBoundary'
 export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
+export {
+	TAB_ID,
+	createSessionStateSnapshotSignal,
+	extractSessionStateFromLegacySnapshot,
+	loadSessionStateSnapshotIntoStore,
+	type TLSessionStateSnapshot,
+} from './lib/config/TLSessionStateSnapshot'
 export {
 	USER_COLORS,
 	getUserPreferences,
@@ -244,5 +251,4 @@ export {
 export { getPointerInfo, getSvgPathFromStroke, getSvgPathFromStrokePoints } from './lib/utils/svg'
 export { type TLStoreWithStatus } from './lib/utils/sync/StoreWithStatus'
 export { hardReset } from './lib/utils/sync/hardReset'
-export { TAB_ID } from './lib/utils/sync/persistence-constants'
 export { openWindow } from './lib/utils/window-open'

commit 355ed1de72de231232ce61612270f5fc7915690b
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jun 6 17:01:54 2023 +0100

    rename app folder to editor (#1528)
    
    Turns out there was one last terrible renaming PR to make. This PR
    renames the `@tldraw.editor`'s `app` folder to `editor`. It should not
    effect exports but it will be a gnarly diff.
    
    ### Change Type
    
    - [x] `internal` â€” Any other changes that don't affect the published
    package (will not publish a new version)

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 79004bb6b..0b3e6501b 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -12,95 +12,6 @@ export {
 	TldrawEditor,
 	type TldrawEditorProps,
 } from './lib/TldrawEditor'
-export { Editor, type TLAnimationOptions, type TLEditorOptions } from './lib/app/Editor'
-export { ArrowShapeUtil } from './lib/app/shapeutils/ArrowShapeUtil/ArrowShapeUtil'
-export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/app/shapeutils/BaseBoxShapeUtil'
-export { BookmarkShapeUtil } from './lib/app/shapeutils/BookmarkShapeUtil/BookmarkShapeUtil'
-export { DrawShapeUtil } from './lib/app/shapeutils/DrawShapeUtil/DrawShapeUtil'
-export { EmbedShapeUtil } from './lib/app/shapeutils/EmbedShapeUtil/EmbedShapeUtil'
-export { FrameShapeUtil } from './lib/app/shapeutils/FrameShapeUtil/FrameShapeUtil'
-export { GeoShapeUtil } from './lib/app/shapeutils/GeoShapeUtil/GeoShapeUtil'
-export { GroupShapeUtil } from './lib/app/shapeutils/GroupShapeUtil/GroupShapeUtil'
-export { HighlightShapeUtil } from './lib/app/shapeutils/HighlightShapeUtil/HighlightShapeUtil'
-export { ImageShapeUtil } from './lib/app/shapeutils/ImageShapeUtil/ImageShapeUtil'
-export {
-	LineShapeUtil,
-	getSplineForLineShape,
-} from './lib/app/shapeutils/LineShapeUtil/LineShapeUtil'
-export { NoteShapeUtil } from './lib/app/shapeutils/NoteShapeUtil/NoteShapeUtil'
-export {
-	ShapeUtil,
-	type TLOnBeforeCreateHandler,
-	type TLOnBeforeUpdateHandler,
-	type TLOnBindingChangeHandler,
-	type TLOnChildrenChangeHandler,
-	type TLOnClickHandler,
-	type TLOnDoubleClickHandleHandler,
-	type TLOnDoubleClickHandler,
-	type TLOnDragHandler,
-	type TLOnEditEndHandler,
-	type TLOnHandleChangeHandler,
-	type TLOnResizeEndHandler,
-	type TLOnResizeHandler,
-	type TLOnResizeStartHandler,
-	type TLOnRotateEndHandler,
-	type TLOnRotateHandler,
-	type TLOnRotateStartHandler,
-	type TLOnTranslateEndHandler,
-	type TLOnTranslateHandler,
-	type TLOnTranslateStartHandler,
-	type TLResizeInfo,
-	type TLResizeMode,
-	type TLShapeUtilConstructor,
-	type TLShapeUtilFlag,
-} from './lib/app/shapeutils/ShapeUtil'
-export { INDENT, TextShapeUtil } from './lib/app/shapeutils/TextShapeUtil/TextShapeUtil'
-export { VideoShapeUtil } from './lib/app/shapeutils/VideoShapeUtil/VideoShapeUtil'
-export { BaseBoxShapeTool } from './lib/app/tools/BaseBoxShapeTool/BaseBoxShapeTool'
-export { StateNode, type TLStateNodeConstructor } from './lib/app/tools/StateNode'
-export { type TLContent } from './lib/app/types/clipboard-types'
-export { type TLEventMap, type TLEventMapHandler } from './lib/app/types/emit-types'
-export {
-	EVENT_NAME_MAP,
-	type TLBaseEventInfo,
-	type TLCLickEventName,
-	type TLCancelEvent,
-	type TLCancelEventInfo,
-	type TLClickEvent,
-	type TLClickEventInfo,
-	type TLCompleteEvent,
-	type TLCompleteEventInfo,
-	type TLEnterEventHandler,
-	type TLEventHandlers,
-	type TLEventInfo,
-	type TLEventName,
-	type TLExitEventHandler,
-	type TLInterruptEvent,
-	type TLInterruptEventInfo,
-	type TLKeyboardEvent,
-	type TLKeyboardEventInfo,
-	type TLKeyboardEventName,
-	type TLPinchEvent,
-	type TLPinchEventInfo,
-	type TLPinchEventName,
-	type TLPointerEvent,
-	type TLPointerEventInfo,
-	type TLPointerEventName,
-	type TLPointerEventTarget,
-	type TLTickEvent,
-	type TLWheelEvent,
-	type TLWheelEventInfo,
-	type UiEvent,
-	type UiEventType,
-} from './lib/app/types/event-types'
-export {
-	type TLCommand,
-	type TLCommandHandler,
-	type TLHistoryEntry,
-	type TLHistoryMark,
-} from './lib/app/types/history-types'
-export { type RequiredKeys } from './lib/app/types/misc-types'
-export { type TLResizeHandle, type TLSelectionHandle } from './lib/app/types/selection-types'
 export {
 	defaultEditorAssetUrls,
 	setDefaultEditorAssetUrls,
@@ -169,6 +80,95 @@ export {
 	WAY_TOO_BIG_ARROW_BEND_FACTOR,
 	ZOOMS,
 } from './lib/constants'
+export { Editor, type TLAnimationOptions, type TLEditorOptions } from './lib/editor/Editor'
+export { ArrowShapeUtil } from './lib/editor/shapeutils/ArrowShapeUtil/ArrowShapeUtil'
+export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapeutils/BaseBoxShapeUtil'
+export { BookmarkShapeUtil } from './lib/editor/shapeutils/BookmarkShapeUtil/BookmarkShapeUtil'
+export { DrawShapeUtil } from './lib/editor/shapeutils/DrawShapeUtil/DrawShapeUtil'
+export { EmbedShapeUtil } from './lib/editor/shapeutils/EmbedShapeUtil/EmbedShapeUtil'
+export { FrameShapeUtil } from './lib/editor/shapeutils/FrameShapeUtil/FrameShapeUtil'
+export { GeoShapeUtil } from './lib/editor/shapeutils/GeoShapeUtil/GeoShapeUtil'
+export { GroupShapeUtil } from './lib/editor/shapeutils/GroupShapeUtil/GroupShapeUtil'
+export { HighlightShapeUtil } from './lib/editor/shapeutils/HighlightShapeUtil/HighlightShapeUtil'
+export { ImageShapeUtil } from './lib/editor/shapeutils/ImageShapeUtil/ImageShapeUtil'
+export {
+	LineShapeUtil,
+	getSplineForLineShape,
+} from './lib/editor/shapeutils/LineShapeUtil/LineShapeUtil'
+export { NoteShapeUtil } from './lib/editor/shapeutils/NoteShapeUtil/NoteShapeUtil'
+export {
+	ShapeUtil,
+	type TLOnBeforeCreateHandler,
+	type TLOnBeforeUpdateHandler,
+	type TLOnBindingChangeHandler,
+	type TLOnChildrenChangeHandler,
+	type TLOnClickHandler,
+	type TLOnDoubleClickHandleHandler,
+	type TLOnDoubleClickHandler,
+	type TLOnDragHandler,
+	type TLOnEditEndHandler,
+	type TLOnHandleChangeHandler,
+	type TLOnResizeEndHandler,
+	type TLOnResizeHandler,
+	type TLOnResizeStartHandler,
+	type TLOnRotateEndHandler,
+	type TLOnRotateHandler,
+	type TLOnRotateStartHandler,
+	type TLOnTranslateEndHandler,
+	type TLOnTranslateHandler,
+	type TLOnTranslateStartHandler,
+	type TLResizeInfo,
+	type TLResizeMode,
+	type TLShapeUtilConstructor,
+	type TLShapeUtilFlag,
+} from './lib/editor/shapeutils/ShapeUtil'
+export { INDENT, TextShapeUtil } from './lib/editor/shapeutils/TextShapeUtil/TextShapeUtil'
+export { VideoShapeUtil } from './lib/editor/shapeutils/VideoShapeUtil/VideoShapeUtil'
+export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
+export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'
+export { type TLContent } from './lib/editor/types/clipboard-types'
+export { type TLEventMap, type TLEventMapHandler } from './lib/editor/types/emit-types'
+export {
+	EVENT_NAME_MAP,
+	type TLBaseEventInfo,
+	type TLCLickEventName,
+	type TLCancelEvent,
+	type TLCancelEventInfo,
+	type TLClickEvent,
+	type TLClickEventInfo,
+	type TLCompleteEvent,
+	type TLCompleteEventInfo,
+	type TLEnterEventHandler,
+	type TLEventHandlers,
+	type TLEventInfo,
+	type TLEventName,
+	type TLExitEventHandler,
+	type TLInterruptEvent,
+	type TLInterruptEventInfo,
+	type TLKeyboardEvent,
+	type TLKeyboardEventInfo,
+	type TLKeyboardEventName,
+	type TLPinchEvent,
+	type TLPinchEventInfo,
+	type TLPinchEventName,
+	type TLPointerEvent,
+	type TLPointerEventInfo,
+	type TLPointerEventName,
+	type TLPointerEventTarget,
+	type TLTickEvent,
+	type TLWheelEvent,
+	type TLWheelEventInfo,
+	type UiEvent,
+	type UiEventType,
+} from './lib/editor/types/event-types'
+export {
+	type TLCommand,
+	type TLCommandHandler,
+	type TLHistoryEntry,
+	type TLHistoryMark,
+} from './lib/editor/types/history-types'
+export { type RequiredKeys } from './lib/editor/types/misc-types'
+export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
 export { normalizeWheel } from './lib/hooks/shared'
 export { useContainer } from './lib/hooks/useContainer'
 export { useEditor } from './lib/hooks/useEditor'

commit 0cc91eec62cc879f1c164d5fc04252a9dfefa91c
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Jun 8 15:53:11 2023 +0100

    `ExternalContentManager` for handling external content (files, images, etc) (#1550)
    
    This PR improves the editor's APIs around creating assets and files.
    This allows end user developers to replace behavior that might occur,
    for example, when pasting images or dragging files onto the canvas.
    
    Here, we:
    - remove `onCreateAssetFromFile` prop
    - remove `onCreateBookmarkFromUrl` prop
    - introduce `onEditorReady` prop
    - introduce `onEditorWillDispose` prop
    - introduce `ExternalContentManager`
    
    The `ExternalContentManager` (ECM) is used in circumstances where we're
    turning external content (text, images, urls, etc) into assets or
    shapes. It is designed to allow certain methods to be overwritten by
    other developers as a kind of weakly supported hack.
    
    For example, when a user drags an image onto the canvas, the event
    handler passes a `TLExternalContent` object to the editor's
    `putExternalContent` method. This method runs the ECM's handler for this
    content type. That handler may in turn run other methods, such as
    `createAssetFromFile` or `createShapesForAssets`, which will lead to the
    image being created on the canvas.
    
    If a developer wanted to change the way that assets are created from
    files, then they could overwrite that method at runtime.
    
    ```ts
    const handleEditorReady = (editor: Editor) => {
      editor.externalContentManager.createAssetFromFile = myHandler
    }
    
    function Example() {
      return <Tldraw onEditorReady={handleEditorReady}/>
    }
    ```
    
    If you wanted to go even deeper, you could override the editor's
    `putExternalContent` method.
    
    ```ts
    const handleEditorReady = (editor: Editor) => {
    const handleExternalContent = (info: TLExternalContent): Promise<void> => {
            if (info.type === 'files') {
               // do something here
            } else {
              // do the normal thing
              editor.externalContentManager.handleContent(info)
            }
    }
    ```
    
    ### Change Type
    
    - [x] `major`
    
    ### Test Plan
    
    1. Drag images, urls, etc. onto the canvas
    2. Use copy and paste for single and multiple files
    3. Use bookmark / embed shapes and convert between eachother
    
    ### Release Notes
    
    - [editor] add `ExternalContentManager` for plopping content onto the
    canvas
    - [editor] remove `onCreateAssetFromFile` prop
    - [editor] remove `onCreateBookmarkFromUrl` prop
    - [editor] introduce `onEditorReady` prop
    - [editor] introduce `onEditorWillDispose` prop
    - [editor] introduce `ExternalContentManager`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 0b3e6501b..cf973da75 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -81,6 +81,10 @@ export {
 	ZOOMS,
 } from './lib/constants'
 export { Editor, type TLAnimationOptions, type TLEditorOptions } from './lib/editor/Editor'
+export {
+	ExternalContentManager as PlopManager,
+	type TLExternalContent,
+} from './lib/editor/managers/ExternalContentManager'
 export { ArrowShapeUtil } from './lib/editor/shapeutils/ArrowShapeUtil/ArrowShapeUtil'
 export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapeutils/BaseBoxShapeUtil'
 export { BookmarkShapeUtil } from './lib/editor/shapeutils/BookmarkShapeUtil/BookmarkShapeUtil'
@@ -185,10 +189,6 @@ export {
 	ACCEPTED_IMG_TYPE,
 	ACCEPTED_VID_TYPE,
 	containBoxSize,
-	createAssetShapeAtPoint,
-	createBookmarkShapeAtPoint,
-	createEmbedShapeAtPoint,
-	createShapesFromFiles,
 	dataUrlToFile,
 	getFileMetaData,
 	getImageSizeFromSrc,

commit d71d15124cf807ef0d989a733360a864f890c964
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jun 9 13:15:06 2023 +0100

    yjs example (#1560)
    
    This PR adds a yjs example to the examples app.
    
    ### Change Type
    
    - [x] `internal` â€” Any other changes that don't affect the published
    package (will not publish a new version)
    
    ### Release Notes
    
    - [editor] Adds yjs example project

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index cf973da75..b4d83c797 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -39,7 +39,12 @@ export {
 	setUserPreferences,
 	type TLUserPreferences,
 } from './lib/config/TLUserPreferences'
-export { createTLStore } from './lib/config/createTLStore'
+export {
+	createTLStore,
+	type TLShapeInfo,
+	type TLStoreEventInfo,
+	type TLStoreOptions,
+} from './lib/config/createTLStore'
 export { defaultShapes } from './lib/config/defaultShapes'
 export { defaultTools } from './lib/config/defaultTools'
 export {

commit 1927f8804158ed4bc1df42eb8a08bdc6b305c379
Author: alex <alex@dytry.ch>
Date:   Mon Jun 12 15:04:14 2023 +0100

    mini `defineShape` API (#1563)
    
    Based on #1549, but with a lot of code-structure related changes backed
    out. Shape schemas are still defined in tlschemas with this diff.
    
    Couple differences between this and #1549:
    - This tightens up the relationship between store schemas and editor
    schemas a bit
    - Reduces the number of places we need to remember to include core
    shapes
    - Only `<TLdrawEditor />` sets default shapes by default. If you're
    doing something funky with lower-level APIs, you need to specify
    `defaultShapes` manually
    - Replaces `validator` with `props` for shapes
    
    ### Change Type
    
    - [x] `major` â€” Breaking Change
    
    ### Test Plan
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [x] Unit Tests
    - [ ] Webdriver tests
    
    ### Release Notes
    
    [dev-facing, notes to come]

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index b4d83c797..94d03c5e2 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -41,12 +41,12 @@ export {
 } from './lib/config/TLUserPreferences'
 export {
 	createTLStore,
-	type TLShapeInfo,
 	type TLStoreEventInfo,
 	type TLStoreOptions,
 } from './lib/config/createTLStore'
-export { defaultShapes } from './lib/config/defaultShapes'
+export { coreShapes, defaultShapes } from './lib/config/defaultShapes'
 export { defaultTools } from './lib/config/defaultTools'
+export { defineShape, type TLShapeInfo } from './lib/config/defineShape'
 export {
 	ANIMATION_MEDIUM_MS,
 	ANIMATION_SHORT_MS,

commit 7b03ef9d0c6244c00de7bf92d3c022e2873977fa
Author: alex <alex@dytry.ch>
Date:   Mon Jun 12 16:39:50 2023 +0100

    shapes folder, move tools into shape defs (#1574)
    
    This diff adds a new property to `defineShape`: `tool`.
    
    The tool prop allows shapes to bring a tool along with them as part of
    their definition. E.g. the draw shape isn't much use without the draw
    tool, so adding the draw shape to your app gives you the draw tool tool.
    
    As part of this, i renamed the `shapeutils` folder to just `shapes`, and
    moved a bunch of shape-specific tools from the tools folder into the
    shapes folder. This more closely reflects how things will be once we
    move our default shapes out of core for tldraw-zero.
    
    ### Change Type
    
    - [x] `patch` â€” Bug fix
    
    ### Test Plan
    
    Tested locally
    
    ### Release Notes
    
    n/a

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 94d03c5e2..1370f96e5 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -90,21 +90,7 @@ export {
 	ExternalContentManager as PlopManager,
 	type TLExternalContent,
 } from './lib/editor/managers/ExternalContentManager'
-export { ArrowShapeUtil } from './lib/editor/shapeutils/ArrowShapeUtil/ArrowShapeUtil'
-export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapeutils/BaseBoxShapeUtil'
-export { BookmarkShapeUtil } from './lib/editor/shapeutils/BookmarkShapeUtil/BookmarkShapeUtil'
-export { DrawShapeUtil } from './lib/editor/shapeutils/DrawShapeUtil/DrawShapeUtil'
-export { EmbedShapeUtil } from './lib/editor/shapeutils/EmbedShapeUtil/EmbedShapeUtil'
-export { FrameShapeUtil } from './lib/editor/shapeutils/FrameShapeUtil/FrameShapeUtil'
-export { GeoShapeUtil } from './lib/editor/shapeutils/GeoShapeUtil/GeoShapeUtil'
-export { GroupShapeUtil } from './lib/editor/shapeutils/GroupShapeUtil/GroupShapeUtil'
-export { HighlightShapeUtil } from './lib/editor/shapeutils/HighlightShapeUtil/HighlightShapeUtil'
-export { ImageShapeUtil } from './lib/editor/shapeutils/ImageShapeUtil/ImageShapeUtil'
-export {
-	LineShapeUtil,
-	getSplineForLineShape,
-} from './lib/editor/shapeutils/LineShapeUtil/LineShapeUtil'
-export { NoteShapeUtil } from './lib/editor/shapeutils/NoteShapeUtil/NoteShapeUtil'
+export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseBoxShapeUtil'
 export {
 	ShapeUtil,
 	type TLOnBeforeCreateHandler,
@@ -130,9 +116,33 @@ export {
 	type TLResizeMode,
 	type TLShapeUtilConstructor,
 	type TLShapeUtilFlag,
-} from './lib/editor/shapeutils/ShapeUtil'
-export { INDENT, TextShapeUtil } from './lib/editor/shapeutils/TextShapeUtil/TextShapeUtil'
-export { VideoShapeUtil } from './lib/editor/shapeutils/VideoShapeUtil/VideoShapeUtil'
+} from './lib/editor/shapes/ShapeUtil'
+export { ArrowShape } from './lib/editor/shapes/arrow/ArrowShape'
+export { ArrowShapeUtil } from './lib/editor/shapes/arrow/ArrowShapeUtil'
+export { BookmarkShape } from './lib/editor/shapes/bookmark/BookmarkShape'
+export { BookmarkShapeUtil } from './lib/editor/shapes/bookmark/BookmarkShapeUtil'
+export { DrawShape } from './lib/editor/shapes/draw/DrawShape'
+export { DrawShapeUtil } from './lib/editor/shapes/draw/DrawShapeUtil'
+export { EmbedShape } from './lib/editor/shapes/embed/EmbedShape'
+export { EmbedShapeUtil } from './lib/editor/shapes/embed/EmbedShapeUtil'
+export { FrameShape } from './lib/editor/shapes/frame/FrameShape'
+export { FrameShapeUtil } from './lib/editor/shapes/frame/FrameShapeUtil'
+export { GeoShape } from './lib/editor/shapes/geo/GeoShape'
+export { GeoShapeUtil } from './lib/editor/shapes/geo/GeoShapeUtil'
+export { GroupShape } from './lib/editor/shapes/group/GroupShape'
+export { GroupShapeUtil } from './lib/editor/shapes/group/GroupShapeUtil'
+export { HighlightShape } from './lib/editor/shapes/highlight/HighlightShape'
+export { HighlightShapeUtil } from './lib/editor/shapes/highlight/HighlightShapeUtil'
+export { ImageShape } from './lib/editor/shapes/image/ImageShape'
+export { ImageShapeUtil } from './lib/editor/shapes/image/ImageShapeUtil'
+export { LineShape } from './lib/editor/shapes/line/LineShape'
+export { LineShapeUtil, getSplineForLineShape } from './lib/editor/shapes/line/LineShapeUtil'
+export { NoteShape } from './lib/editor/shapes/note/NoteShape'
+export { NoteShapeUtil } from './lib/editor/shapes/note/NoteShapeUtil'
+export { TextShape } from './lib/editor/shapes/text/TextShape'
+export { INDENT, TextShapeUtil } from './lib/editor/shapes/text/TextShapeUtil'
+export { VideoShape } from './lib/editor/shapes/video/VideoShape'
+export { VideoShapeUtil } from './lib/editor/shapes/video/VideoShapeUtil'
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'
 export { type TLContent } from './lib/editor/types/clipboard-types'

commit 34a880dcbd4184fba4ffda85982cca28afd4ea9d
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Jun 12 20:15:58 2023 +0100

    [improvement] bookmark shape logic (#1568)
    
    This PR extracts some logic from the EditUrlDialog into the bookmark
    shape util, removing the dependency between the two.
    
    ### Change Type
    
    - [x] `internal` â€” Any other changes that don't affect the published
    package (will not publish a new version)
    
    ### Test Plan
    
    1. Create a bookmark shape
    2. Set its URL to an empty string
    
    - [x] Unit Tests

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 1370f96e5..782a17b8b 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -220,6 +220,7 @@ export {
 	fileToBase64,
 	getIncrementedName,
 	isSerializable,
+	isValidUrl,
 	snapToGrid,
 	uniqueId,
 } from './lib/utils/data'

commit b65aef5cf21b13d51a1973922eca8ec327312bb1
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jun 13 09:27:54 2023 +0100

    [improvement] Embed shape cleanup (#1569)
    
    This PR does some cleanup around our Embed Shape.
    
    It:
    - removes used `doesResize` and `overridePermissions` props
    - removes the no-longer-needed `tmpOldUrl` prop
    - adds a `canUnmount` property to embed definitions, so that some embeds
    can unmount when desired
    
    ### Change Type
    
    - [x] `patch` â€” Bug Fix
    
    ### Test Plan
    
    1. Create embed shapes
    2. Migrate old data that includes embed shapes?
    
    - [x] Unit Tests
    
    ### Release Notes
    
    - [editor] Remove unused props for `TLEditorShape`
    - [editor] Adds `canUnmount` property to embed definitions

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 782a17b8b..87b20fd44 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -78,7 +78,6 @@ export {
 	MULTI_CLICK_DURATION,
 	REMOVE_SYMBOL,
 	RICH_TYPES,
-	ROTATING_SHADOWS,
 	STYLES,
 	SVG_PADDING,
 	TEXT_PROPS,
@@ -226,10 +225,10 @@ export {
 } from './lib/utils/data'
 export { debugFlags, featureFlags, type DebugFlag } from './lib/utils/debug-flags'
 export {
+	getRotatedBoxShadow,
 	loopToHtmlElement,
 	preventDefault,
 	releasePointerCapture,
-	rotateBoxShadow,
 	setPointerCapture,
 	truncateStringWithEllipsis,
 	usePrefersReducedMotion,

commit 6a8eb283bab3f686c236e14c4592dc529506c1ea
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Wed Jun 14 23:08:07 2023 +0100

    update exports for user presence (#1583)
    
    This PR updates exports related to user presence, in order to enable
    external sync solutions that use user presence.
    
    ### Change Type
    
    - [x] `patch` â€” Bug fix
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 87b20fd44..261d4209b 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -35,6 +35,7 @@ export {
 } from './lib/config/TLSessionStateSnapshot'
 export {
 	USER_COLORS,
+	getFreshUserPreferences,
 	getUserPreferences,
 	setUserPreferences,
 	type TLUserPreferences,

commit 21377c0f2274441e8998f12d9a59467821be7e1f
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Jun 15 16:09:41 2023 +0100

    Explicit shape type checks (#1594)
    
    This PR adds shape type checks that use the shape util, e.g.
    `this.editor.isShapeOfType(shape, FrameShapeUtil)`. In part this is
    designed to help us track down where dependencies exist between the
    editor and our default shapes.
    
    ### Change Type
    
    - [x] `internal` â€” Any other changes that don't affect the published
    package

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 261d4209b..e044fae7e 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -248,8 +248,6 @@ export {
 	getSvgAsImage,
 	getSvgAsString,
 	getTextBoundingBox,
-	isGeoShape,
-	isNoteShape,
 	type TLCopyType,
 	type TLExportType,
 } from './lib/utils/export'

commit b88a2370b314855237774548d627ed4d3301a1ad
Author: alex <alex@dytry.ch>
Date:   Fri Jun 16 11:33:47 2023 +0100

    Styles API (#1580)
    
    Removes `propsForNextShape` and replaces it with the new styles API.
    
    Changes in here:
    - New custom style example
    - `setProp` is now `setStyle` and takes a `StyleProp` instead of a
    string
    - `Editor.props` and `Editor.opacity` are now `Editor.sharedStyles` and
    `Editor.sharedOpacity`
    - They return an object that flags mixed vs shared types instead of
    using null to signal mixed types
    - `Editor.styles` returns a `SharedStyleMap` - keyed on `StyleProp`
    instead of `string`
    - `StateNode.shapeType` is now the shape util rather than just a string.
    This lets us pull the styles from the shape type directly.
    - `color` is no longer a core part of the editor set on the shape
    parent. Individual child shapes have to use color directly.
    - `propsForNextShape` is now `stylesForNextShape`
    - `InstanceRecordType` is created at runtime in the same way
    `ShapeRecordType` is. This is so it can pull style validators out of
    shape defs for `stylesForNextShape`
    - Shape type are now defined by their props rather than having separate
    validators & type defs
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Test Plan
    
    1. Big time regression testing around styles!
    2. Check UI works as intended for all shape/style/tool combos
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    -
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index e044fae7e..7000deee4 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -51,22 +51,13 @@ export { defineShape, type TLShapeInfo } from './lib/config/defineShape'
 export {
 	ANIMATION_MEDIUM_MS,
 	ANIMATION_SHORT_MS,
-	ARROW_LABEL_FONT_SIZES,
-	BOUND_ARROW_OFFSET,
 	DEFAULT_ANIMATION_OPTIONS,
-	DEFAULT_BOOKMARK_HEIGHT,
-	DEFAULT_BOOKMARK_WIDTH,
 	DOUBLE_CLICK_DURATION,
 	DRAG_DISTANCE,
-	FONT_ALIGNMENT,
-	FONT_FAMILIES,
-	FONT_SIZES,
 	GRID_INCREMENT,
 	GRID_STEPS,
 	HAND_TOOL_FRICTION,
 	HASH_PATERN_ZOOM_NAMES,
-	ICON_SIZES,
-	LABEL_FONT_SIZES,
 	MAJOR_NUDGE_FACTOR,
 	MAX_ASSET_HEIGHT,
 	MAX_ASSET_WIDTH,
@@ -74,15 +65,11 @@ export {
 	MAX_SHAPES_PER_PAGE,
 	MAX_ZOOM,
 	MINOR_NUDGE_FACTOR,
-	MIN_ARROW_LENGTH,
 	MIN_ZOOM,
 	MULTI_CLICK_DURATION,
 	REMOVE_SYMBOL,
 	RICH_TYPES,
-	STYLES,
 	SVG_PADDING,
-	TEXT_PROPS,
-	WAY_TOO_BIG_ARROW_BEND_FACTOR,
 	ZOOMS,
 } from './lib/constants'
 export { Editor, type TLAnimationOptions, type TLEditorOptions } from './lib/editor/Editor'
@@ -198,6 +185,11 @@ export { usePresence } from './lib/hooks/usePresence'
 export { useQuickReactor } from './lib/hooks/useQuickReactor'
 export { useReactor } from './lib/hooks/useReactor'
 export { useTLStore } from './lib/hooks/useTLStore'
+export {
+	ReadonlySharedStyleMap,
+	SharedStyleMap,
+	type SharedStyle,
+} from './lib/utils/SharedStylesMap'
 export { WeakMapCache } from './lib/utils/WeakMapCache'
 export {
 	ACCEPTED_ASSET_TYPE,
@@ -253,7 +245,6 @@ export {
 } from './lib/utils/export'
 export { hardResetEditor } from './lib/utils/hard-reset'
 export { isAnimated, isGIF } from './lib/utils/is-gif-animated'
-export { setPropsForNextShape } from './lib/utils/props-for-next-shape'
 export { refreshPage } from './lib/utils/refresh-page'
 export { runtime, setRuntimeOverrides } from './lib/utils/runtime'
 export {

commit 3f52c24fec0f6cd1180d0da5a4e775371dcd7f09
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jun 16 16:59:13 2023 +0100

    [fix] yjs presence (#1603)
    
    This PR:
    - updates the yjs example to include user presence
    - tweaks the `createPresenceStateDerivation` API
    - fix a "double update" bug caused by re-syncing local changes
    - fix connection bugs
    
    ### Change Type
    
    - [x] `minor` â€” New feature

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 7000deee4..1b9bc2e47 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -45,6 +45,7 @@ export {
 	type TLStoreEventInfo,
 	type TLStoreOptions,
 } from './lib/config/createTLStore'
+export { createTLUser } from './lib/config/createTLUser'
 export { coreShapes, defaultShapes } from './lib/config/defaultShapes'
 export { defaultTools } from './lib/config/defaultTools'
 export { defineShape, type TLShapeInfo } from './lib/config/defineShape'

commit 57bb341593d5f66261de4f0341736681aa6a71b6
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Jun 19 15:01:18 2023 +0100

    `ShapeUtil` refactor, `Editor` cleanup (#1611)
    
    This PR improves the ergonomics of `ShapeUtil` classes.
    
    ### Cached methods
    
    First, I've remove the cached methods (such as `bounds`) from the
    `ShapeUtil` class and lifted this to the `Editor` class.
    
    Previously, calling `ShapeUtil.getBounds` would return the un-cached
    bounds of a shape, while calling `ShapeUtil.bounds` would return the
    cached bounds of a shape. We also had `Editor.getBounds`, which would
    call `ShapeUtil.bounds`. It was confusing. The cached methods like
    `outline` were also marked with "please don't override", which suggested
    the architecture was just wrong.
    
    The only weirdness from this is that utils sometimes reach out to the
    editor for cached versions of data rather than calling their own cached
    methods. It's still an easier story to tell than what we had before.
    
    ### More defaults
    
    We now have three and only three `abstract` methods for a `ShapeUtil`:
    - `getDefaultProps` (renamed from `defaultProps`)
    - `getBounds`,
    - `component`
    -  `indicator`
    
    Previously, we also had `getCenter` as an abstract method, though this
    was usually just the middle of the bounds anyway.
    
    ### Editing bounds
    
    This PR removes the concept of editingBounds. The viewport will no
    longer animate to editing shapes.
    
    ### Active area manager
    
    This PR also removes the active area manager, which was not being used
    in the way we expected it to be.
    
    ### Dpr manager
    
    This PR removes the dpr manager and uses a hook instead to update it
    from React. This is one less runtime browser dependency in the app, one
    less thing to document.
    
    ### Moving things around
    
    This PR also continues to try to organize related methods and properties
    in the editor.
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Release Notes
    
    - [editor] renames `defaultProps` to `getDefaultProps`
    - [editor] removes `outline`, `outlineSegments`, `handles`, `bounds`
    - [editor] renames `renderBackground` to `backgroundComponent`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 1b9bc2e47..efba78a56 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -3,6 +3,7 @@
 
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/indices'
+export { defineMigrations } from '@tldraw/store'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/tlschema'
 export { getHashForString } from '@tldraw/utils'

commit 5cb08711c19c086a013b3a52b06b7cdcfd443fe5
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jun 20 14:31:26 2023 +0100

    Incorporate signia as @tldraw/state (#1620)
    
    It tried to get out but we're dragging it back in.
    
    This PR brings [signia](https://github.com/tldraw/signia) back into
    tldraw as @tldraw/state.
    
    ### Change Type
    
    - [x] major
    
    ---------
    
    Co-authored-by: David Sheldrick <d.j.sheldrick@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index efba78a56..d97253fcd 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -3,6 +3,17 @@
 
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/indices'
+export {
+	atom,
+	computed,
+	react,
+	track,
+	useComputed,
+	useQuickReactor,
+	useReactor,
+	useValue,
+	whyAmIRunning,
+} from '@tldraw/state'
 export { defineMigrations } from '@tldraw/store'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/tlschema'
@@ -184,8 +195,6 @@ export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
 export { useLocalStore } from './lib/hooks/useLocalStore'
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
-export { useQuickReactor } from './lib/hooks/useQuickReactor'
-export { useReactor } from './lib/hooks/useReactor'
 export { useTLStore } from './lib/hooks/useTLStore'
 export {
 	ReadonlySharedStyleMap,

commit e8bc114bf3ccd666079a704880622e300234bf88
Author: alex <alex@dytry.ch>
Date:   Sat Jun 24 14:46:04 2023 +0100

    Styles API follow-ups (#1636)
    
    tldraw-zero themed follow-ups to the styles API added in #1580.
    
    - Removed style related helpers from `ShapeUtil`
    - `editor.css` no longer includes the tldraw default color palette.
    Instead, a global `DefaultColorPalette` is defined as part of the color
    style. If developers wish to cusomise the colors, they can mutate that
    global.
    - `ShapeUtil.toSvg` no longer takes font/color. Instead, it takes an
    "svg export context" that can be used to add `<defs>` to the exported
    SVG element. Converting e.g. fonts to inlined data urls is now the
    responsibility of the shapes that use them rather than the Editor.
    - `usePattern` is not longer a core part of the editor. Instead,
    `ShapeUtil` has a `getCanvasSvgDefs` method for returning react
    components representing anything a shape needs included in `<defs>` for
    the canvas.
    - The shape-specific cleanup logic in `setStyle` has been deleted. It
    turned out that none of that logic has been running anyway, and instead
    the relevant logic lives in shape `onBeforeChange` callbacks already.
    
    ### Change Type
    - [x] `minor` â€” New feature
    
    ### Test Plan
    
    
    - [x] Unit Tests
    - [x] End to end tests
    
    ### Release Notes
     --
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index d97253fcd..214865d1d 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -70,7 +70,7 @@ export {
 	GRID_INCREMENT,
 	GRID_STEPS,
 	HAND_TOOL_FRICTION,
-	HASH_PATERN_ZOOM_NAMES,
+	HASH_PATTERN_ZOOM_NAMES,
 	MAJOR_NUDGE_FACTOR,
 	MAX_ASSET_HEIGHT,
 	MAX_ASSET_WIDTH,

commit 7fd0ab75edc88bb017cb25eca6e3ae35b115eed8
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jun 27 15:51:35 2023 +0100

    [improvement] custom shapes example (#1660)
    
    This PR fixes an import in the custom shapes example. It also tweaks the
    example to show how buttons and other interactive content should work.
    
    ### Change Type
    
    - [x] `documentation`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 214865d1d..5a4ed9235 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -139,6 +139,7 @@ export { LineShape } from './lib/editor/shapes/line/LineShape'
 export { LineShapeUtil, getSplineForLineShape } from './lib/editor/shapes/line/LineShapeUtil'
 export { NoteShape } from './lib/editor/shapes/note/NoteShape'
 export { NoteShapeUtil } from './lib/editor/shapes/note/NoteShapeUtil'
+export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'
 export { TextShape } from './lib/editor/shapes/text/TextShape'
 export { INDENT, TextShapeUtil } from './lib/editor/shapes/text/TextShapeUtil'
 export { VideoShape } from './lib/editor/shapes/video/VideoShape'

commit 6faef733b6f5d3908c9de291463f5372eeccc506
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Jun 29 15:10:54 2023 +0100

    [improvement] export scribble manager (#1671)
    
    This PR adds the `ScribbleManager` to the exports from `@tldraw/editor`.
    
    ### Change Type
    
    - [x] `minor` â€” New feature
    
    
    ### Release Notes
    
    - [@tldraw/tldraw] Export `ScribbleManager`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 5a4ed9235..491f88b3f 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -90,6 +90,7 @@ export {
 	ExternalContentManager as PlopManager,
 	type TLExternalContent,
 } from './lib/editor/managers/ExternalContentManager'
+export { ScribbleManager } from './lib/editor/managers/ScribbleManager'
 export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseBoxShapeUtil'
 export {
 	ShapeUtil,

commit d99c4a0e9c9997d3c1f60c1f22e81c6628a901ca
Author: Lu Wilson <l2wilson94@gmail.com>
Date:   Fri Jul 7 12:50:47 2023 +0100

    Make some missing tsdocs appear on the docs site (#1706)
    
    ðŸš¨ Note ðŸš¨
    This PR has changed! See my [newer
    comment](https://github.com/tldraw/tldraw/pull/1706#issuecomment-1623451709)
    for what the PR does now.
    This description is kept here to show the original intention of the PR.
    
    ---
    
    This PR fixes the tsdocs formatting of `TldrawEditorProps`, so that they
    appears on the docs site.
    
    We have docs already written, but they weren't appearing. There are
    probably others like this too.
    
    
    ![image](https://github.com/tldraw/tldraw/assets/15892272/8d8940b3-983f-48b3-9804-7ac88116ca9d)
    
    ### Change Type
    
    - [x] `documentation` â€” Changes to the documentation only[^2]
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version
    
    ### Test Plan
    
    1. Navigate to `/gen/editor/TldrawEditorProps`
    2. Make sure that that the parameters are listed out with descriptions.
    
    - [ ] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Docs: Fixed some missing docs for the TldrawEditor component.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 491f88b3f..94af02e53 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -22,6 +22,8 @@ export {
 	ErrorScreen,
 	LoadingScreen,
 	TldrawEditor,
+	type TLOnMountHandler,
+	type TldrawEditorBaseProps,
 	type TldrawEditorProps,
 } from './lib/TldrawEditor'
 export {

commit b7d9c8684cb6cf7bd710af5420135ea3516cc3bf
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Jul 17 22:22:34 2023 +0100

    tldraw zero - package shuffle (#1710)
    
    This PR moves code between our packages so that:
    - @tldraw/editor is a â€œcoreâ€ library with the engine and canvas but no
    shapes, tools, or other things
    - @tldraw/tldraw contains everything particular to the experience weâ€™ve
    built for tldraw
    
    At first look, this might seem like a step away from customization and
    configuration, however I believe it greatly increases the configuration
    potential of the @tldraw/editor while also providing a more accurate
    reflection of what configuration options actually exist for
    @tldraw/tldraw.
    
    ## Library changes
    
    @tldraw/editor re-exports its dependencies and @tldraw/tldraw re-exports
    @tldraw/editor.
    
    - users of @tldraw/editor WITHOUT @tldraw/tldraw should almost always
    only import things from @tldraw/editor.
    - users of @tldraw/tldraw should almost always only import things from
    @tldraw/tldraw.
    
    - @tldraw/polyfills is merged into @tldraw/editor
    - @tldraw/indices is merged into @tldraw/editor
    - @tldraw/primitives is merged mostly into @tldraw/editor, partially
    into @tldraw/tldraw
    - @tldraw/file-format is merged into @tldraw/tldraw
    - @tldraw/ui is merged into @tldraw/tldraw
    
    Many (many) utils and other code is moved from the editor to tldraw. For
    example, embeds now are entirely an feature of @tldraw/tldraw. The only
    big chunk of code left in core is related to arrow handling.
    
    ## API Changes
    
    The editor can now be used without tldraw's assets. We load them in
    @tldraw/tldraw instead, so feel free to use whatever fonts or images or
    whatever that you like with the editor.
    
    All tools and shapes (except for the `Group` shape) are moved to
    @tldraw/tldraw. This includes the `select` tool.
    
    You should use the editor with at least one tool, however, so you now
    also need to send in an `initialState` prop to the Editor /
    <TldrawEditor> component indicating which state the editor should begin
    in.
    
    The `components` prop now also accepts `SelectionForeground`.
    
    The complex selection component that we use for tldraw is moved to
    @tldraw/tldraw. The default component is quite basic but can easily be
    replaced via the `components` prop. We pass down our tldraw-flavored
    SelectionFg via `components`.
    
    Likewise with the `Scribble` component: the `DefaultScribble` no longer
    uses our freehand tech and is a simple path instead. We pass down the
    tldraw-flavored scribble via `components`.
    
    The `ExternalContentManager` (`Editor.externalContentManager`) is
    removed and replaced with a mapping of types to handlers.
    
    - Register new content handlers with
    `Editor.registerExternalContentHandler`.
    - Register new asset creation handlers (for files and URLs) with
    `Editor.registerExternalAssetHandler`
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Test Plan
    
    - [x] Unit Tests
    - [x] End to end tests
    
    ### Release Notes
    
    - [@tldraw/editor] lots, wip
    - [@tldraw/ui] gone, merged to tldraw/tldraw
    - [@tldraw/polyfills] gone, merged to tldraw/editor
    - [@tldraw/primitives] gone, merged to tldraw/editor / tldraw/tldraw
    - [@tldraw/indices] gone, merged to tldraw/editor
    - [@tldraw/file-format] gone, merged to tldraw/tldraw
    
    ---------
    
    Co-authored-by: alex <alex@dytry.ch>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 94af02e53..50fe96866 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -1,23 +1,30 @@
 // Important! don't move this tlschema re-export to lib/index.ts, doing so causes esbuild to produce
 // incorrect output. https://github.com/evanw/esbuild/issues/1737
 
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/indices'
 export {
+	EMPTY_ARRAY,
 	atom,
 	computed,
 	react,
 	track,
+	transact,
+	transaction,
 	useComputed,
 	useQuickReactor,
 	useReactor,
 	useValue,
 	whyAmIRunning,
+	type Atom,
+	type Signal,
 } from '@tldraw/state'
-export { defineMigrations } from '@tldraw/store'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/store'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/tlschema'
-export { getHashForString } from '@tldraw/utils'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/utils'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/validate'
 export {
 	ErrorScreen,
 	LoadingScreen,
@@ -26,20 +33,16 @@ export {
 	type TldrawEditorBaseProps,
 	type TldrawEditorProps,
 } from './lib/TldrawEditor'
-export {
-	defaultEditorAssetUrls,
-	setDefaultEditorAssetUrls,
-	type TLEditorAssetUrls,
-} from './lib/assetUrls'
 export { Canvas } from './lib/components/Canvas'
-export { DefaultErrorFallback } from './lib/components/DefaultErrorFallback'
 export {
 	ErrorBoundary,
 	OptionalErrorBoundary,
 	type TLErrorBoundaryProps,
 } from './lib/components/ErrorBoundary'
 export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
+export { PositionedOnCanvas } from './lib/components/PositionedOnCanvas'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
+export { DefaultErrorFallback } from './lib/components/default-components/DefaultErrorFallback'
 export {
 	TAB_ID,
 	createSessionStateSnapshotSignal,
@@ -60,39 +63,35 @@ export {
 	type TLStoreOptions,
 } from './lib/config/createTLStore'
 export { createTLUser } from './lib/config/createTLUser'
-export { coreShapes, defaultShapes } from './lib/config/defaultShapes'
-export { defaultTools } from './lib/config/defaultTools'
-export { defineShape, type TLShapeInfo } from './lib/config/defineShape'
+export { coreShapes, type TLAnyShapeUtilConstructor } from './lib/config/defaultShapes'
 export {
 	ANIMATION_MEDIUM_MS,
 	ANIMATION_SHORT_MS,
+	CAMERA_SLIDE_FRICTION,
 	DEFAULT_ANIMATION_OPTIONS,
 	DOUBLE_CLICK_DURATION,
 	DRAG_DISTANCE,
 	GRID_INCREMENT,
 	GRID_STEPS,
-	HAND_TOOL_FRICTION,
 	HASH_PATTERN_ZOOM_NAMES,
 	MAJOR_NUDGE_FACTOR,
-	MAX_ASSET_HEIGHT,
-	MAX_ASSET_WIDTH,
 	MAX_PAGES,
 	MAX_SHAPES_PER_PAGE,
 	MAX_ZOOM,
 	MINOR_NUDGE_FACTOR,
 	MIN_ZOOM,
 	MULTI_CLICK_DURATION,
-	REMOVE_SYMBOL,
-	RICH_TYPES,
 	SVG_PADDING,
 	ZOOMS,
 } from './lib/constants'
 export { Editor, type TLAnimationOptions, type TLEditorOptions } from './lib/editor/Editor'
 export {
-	ExternalContentManager as PlopManager,
-	type TLExternalContent,
-} from './lib/editor/managers/ExternalContentManager'
-export { ScribbleManager } from './lib/editor/managers/ScribbleManager'
+	SnapManager,
+	type GapsSnapLine,
+	type PointsSnapLine,
+	type SnapLine,
+	type SnapPoint,
+} from './lib/editor/managers/SnapManager'
 export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseBoxShapeUtil'
 export {
 	ShapeUtil,
@@ -117,38 +116,25 @@ export {
 	type TLOnTranslateStartHandler,
 	type TLResizeInfo,
 	type TLResizeMode,
+	type TLShapeUtilCanvasSvgDef,
 	type TLShapeUtilConstructor,
 	type TLShapeUtilFlag,
 } from './lib/editor/shapes/ShapeUtil'
-export { ArrowShape } from './lib/editor/shapes/arrow/ArrowShape'
-export { ArrowShapeUtil } from './lib/editor/shapes/arrow/ArrowShapeUtil'
-export { BookmarkShape } from './lib/editor/shapes/bookmark/BookmarkShape'
-export { BookmarkShapeUtil } from './lib/editor/shapes/bookmark/BookmarkShapeUtil'
-export { DrawShape } from './lib/editor/shapes/draw/DrawShape'
-export { DrawShapeUtil } from './lib/editor/shapes/draw/DrawShapeUtil'
-export { EmbedShape } from './lib/editor/shapes/embed/EmbedShape'
-export { EmbedShapeUtil } from './lib/editor/shapes/embed/EmbedShapeUtil'
-export { FrameShape } from './lib/editor/shapes/frame/FrameShape'
-export { FrameShapeUtil } from './lib/editor/shapes/frame/FrameShapeUtil'
-export { GeoShape } from './lib/editor/shapes/geo/GeoShape'
-export { GeoShapeUtil } from './lib/editor/shapes/geo/GeoShapeUtil'
-export { GroupShape } from './lib/editor/shapes/group/GroupShape'
 export { GroupShapeUtil } from './lib/editor/shapes/group/GroupShapeUtil'
-export { HighlightShape } from './lib/editor/shapes/highlight/HighlightShape'
-export { HighlightShapeUtil } from './lib/editor/shapes/highlight/HighlightShapeUtil'
-export { ImageShape } from './lib/editor/shapes/image/ImageShape'
-export { ImageShapeUtil } from './lib/editor/shapes/image/ImageShapeUtil'
-export { LineShape } from './lib/editor/shapes/line/LineShape'
-export { LineShapeUtil, getSplineForLineShape } from './lib/editor/shapes/line/LineShapeUtil'
-export { NoteShape } from './lib/editor/shapes/note/NoteShape'
-export { NoteShapeUtil } from './lib/editor/shapes/note/NoteShapeUtil'
+export { getArrowheadPathForType } from './lib/editor/shapes/shared/arrow/arrowheads'
+export {
+	getCurvedArrowHandlePath,
+	getSolidCurvedArrowPath,
+} from './lib/editor/shapes/shared/arrow/curved-arrow'
+export { getArrowTerminalsInArrowSpace } from './lib/editor/shapes/shared/arrow/shared'
+export {
+	getSolidStraightArrowPath,
+	getStraightArrowHandlePath,
+} from './lib/editor/shapes/shared/arrow/straight-arrow'
 export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'
-export { TextShape } from './lib/editor/shapes/text/TextShape'
-export { INDENT, TextShapeUtil } from './lib/editor/shapes/text/TextShapeUtil'
-export { VideoShape } from './lib/editor/shapes/video/VideoShape'
-export { VideoShapeUtil } from './lib/editor/shapes/video/VideoShapeUtil'
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'
+export { type SvgExportContext, type SvgExportDef } from './lib/editor/types/SvgExportContext'
 export { type TLContent } from './lib/editor/types/clipboard-types'
 export { type TLEventMap, type TLEventMapHandler } from './lib/editor/types/emit-types'
 export {
@@ -184,6 +170,10 @@ export {
 	type UiEvent,
 	type UiEventType,
 } from './lib/editor/types/event-types'
+export {
+	type TLExternalAssetContent,
+	type TLExternalContent,
+} from './lib/editor/types/external-content'
 export {
 	type TLCommand,
 	type TLCommandHandler,
@@ -192,83 +182,126 @@ export {
 } from './lib/editor/types/history-types'
 export { type RequiredKeys } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
-export { normalizeWheel } from './lib/hooks/shared'
 export { useContainer } from './lib/hooks/useContainer'
+export { getCursor } from './lib/hooks/useCursor'
 export { useEditor } from './lib/hooks/useEditor'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
+export { useIsCropping } from './lib/hooks/useIsCropping'
+export { useIsEditing } from './lib/hooks/useIsEditing'
 export { useLocalStore } from './lib/hooks/useLocalStore'
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
+export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLStore } from './lib/hooks/useTLStore'
+export { useTransform } from './lib/hooks/useTransform'
+export {
+	Box2d,
+	ROTATE_CORNER_TO_SELECTION_CORNER,
+	rotateSelectionHandle,
+	type RotateCorner,
+	type SelectionCorner,
+	type SelectionEdge,
+	type SelectionHandle,
+} from './lib/primitives/Box2d'
+export { Matrix2d, type Matrix2dModel } from './lib/primitives/Matrix2d'
+export { Vec2d, type VecLike } from './lib/primitives/Vec2d'
+export { EASINGS } from './lib/primitives/easings'
+export {
+	intersectLineSegmentPolygon,
+	intersectLineSegmentPolyline,
+	intersectPolygonPolygon,
+	linesIntersect,
+	polygonsIntersect,
+} from './lib/primitives/intersect'
+export {
+	EPSILON,
+	PI,
+	PI2,
+	SIN,
+	TAU,
+	angleDelta,
+	approximately,
+	areAnglesCompatible,
+	average,
+	canonicalizeRotation,
+	clamp,
+	clampRadians,
+	degreesToRadians,
+	getArcLength,
+	getPointOnCircle,
+	getPolygonVertices,
+	getStarBounds,
+	getSweep,
+	isAngleBetween,
+	isSafeFloat,
+	lerpAngles,
+	longAngleDist,
+	perimeterOfEllipse,
+	pointInBounds,
+	pointInCircle,
+	pointInEllipse,
+	pointInPolygon,
+	pointInPolyline,
+	pointInRect,
+	pointNearToLineSegment,
+	pointNearToPolyline,
+	precise,
+	radiansToDegrees,
+	rangeIntersection,
+	shortAngleDist,
+	snapAngle,
+	toDomPrecision,
+	toFixed,
+	toPrecision,
+} from './lib/primitives/utils'
 export {
 	ReadonlySharedStyleMap,
 	SharedStyleMap,
 	type SharedStyle,
 } from './lib/utils/SharedStylesMap'
 export { WeakMapCache } from './lib/utils/WeakMapCache'
-export {
-	ACCEPTED_ASSET_TYPE,
-	ACCEPTED_IMG_TYPE,
-	ACCEPTED_VID_TYPE,
-	containBoxSize,
-	dataUrlToFile,
-	getFileMetaData,
-	getImageSizeFromSrc,
-	getMediaAssetFromFile,
-	getResizedImageDataUrl,
-	getValidHttpURLList,
-	getVideoSizeFromSrc,
-	isImage,
-	isSvgText,
-	isValidHttpURL,
-} from './lib/utils/assets'
-export {
-	checkFlag,
-	fileToBase64,
-	getIncrementedName,
-	isSerializable,
-	isValidUrl,
-	snapToGrid,
-	uniqueId,
-} from './lib/utils/data'
+export { dataUrlToFile } from './lib/utils/assets'
 export { debugFlags, featureFlags, type DebugFlag } from './lib/utils/debug-flags'
 export {
-	getRotatedBoxShadow,
 	loopToHtmlElement,
 	preventDefault,
 	releasePointerCapture,
 	setPointerCapture,
-	truncateStringWithEllipsis,
-	usePrefersReducedMotion,
+	stopEventPropagation,
 } from './lib/utils/dom'
+export { getIncrementedName } from './lib/utils/getIncrementedName'
+export { getPointerInfo } from './lib/utils/getPointerInfo'
+export { getSvgPathFromPoints } from './lib/utils/getSvgPathFromPoints'
+export { hardResetEditor } from './lib/utils/hardResetEditor'
+export { normalizeWheel } from './lib/utils/normalizeWheel'
+export { png } from './lib/utils/png'
+export { refreshPage } from './lib/utils/refreshPage'
 export {
-	getEmbedInfo,
-	getEmbedInfoUnsafely,
-	matchEmbedUrl,
-	matchUrl,
-	type TLEmbedResult,
-} from './lib/utils/embeds'
+	getIndexAbove,
+	getIndexBelow,
+	getIndexBetween,
+	getIndices,
+	getIndicesAbove,
+	getIndicesBelow,
+	getIndicesBetween,
+	sortByIndex,
+} from './lib/utils/reordering/reordering'
 export {
-	downloadDataURLAsFile,
-	getSvgAsDataUrl,
-	getSvgAsDataUrlSync,
-	getSvgAsImage,
-	getSvgAsString,
-	getTextBoundingBox,
-	type TLCopyType,
-	type TLExportType,
-} from './lib/utils/export'
-export { hardResetEditor } from './lib/utils/hard-reset'
-export { isAnimated, isGIF } from './lib/utils/is-gif-animated'
-export { refreshPage } from './lib/utils/refresh-page'
+	applyRotationToSnapshotShapes,
+	getRotationSnapshot,
+	type TLRotationSnapshot,
+} from './lib/utils/rotation'
 export { runtime, setRuntimeOverrides } from './lib/utils/runtime'
-export {
-	blobAsString,
-	correctSpacesToNbsp,
-	dataTransferItemAsString,
-	defaultEmptyAs,
-} from './lib/utils/string'
-export { getPointerInfo, getSvgPathFromStroke, getSvgPathFromStrokePoints } from './lib/utils/svg'
 export { type TLStoreWithStatus } from './lib/utils/sync/StoreWithStatus'
 export { hardReset } from './lib/utils/sync/hardReset'
+export { uniq } from './lib/utils/uniq'
+export { uniqueId } from './lib/utils/uniqueId'
 export { openWindow } from './lib/utils/window-open'
+
+/** @polyfills */
+
+import 'core-js/stable/array/at'
+import 'core-js/stable/array/flat'
+import 'core-js/stable/array/flat-map'
+import 'core-js/stable/string/at'
+import 'core-js/stable/string/replace-all'

commit 3e31ef2a7d01467ef92ca4f7aed13ee708db73ef
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jul 18 22:50:23 2023 +0100

    Remove helpers / extraneous API methods. (#1745)
    
    This PR removes several extraneous computed values from the editor. It
    adds some silly instance state onto the instance state record and
    unifies a few methods which were inconsistent. This is fit and finish
    work ðŸ§½
    
    ## Computed Values
    
    In general, where once we had a getter and setter for `isBlahMode`,
    which really masked either an `_isBlahMode` atom on the editor or
    `instanceState.isBlahMode`, these are merged into `instanceState`; they
    can be accessed / updated via `editor.instanceState` /
    `editor.updateInstanceState`.
    
    ## tldraw select tool specific things
    
    This PR also removes some tldraw specific state checks and creates new
    component overrides to allow us to include them in tldraw/tldraw.
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Test Plan
    
    - [x] Unit Tests
    - [x] End to end tests
    
    ### Release Notes
    
    - [tldraw] rename `useReadonly` to `useReadOnly`
    - [editor] remove `Editor.isDarkMode`
    - [editor] remove `Editor.isChangingStyle`
    - [editor] remove `Editor.isCoarsePointer`
    - [editor] remove `Editor.isDarkMode`
    - [editor] remove `Editor.isFocused`
    - [editor] remove `Editor.isGridMode`
    - [editor] remove `Editor.isPenMode`
    - [editor] remove `Editor.isReadOnly`
    - [editor] remove `Editor.isSnapMode`
    - [editor] remove `Editor.isToolLocked`
    - [editor] remove `Editor.locale`
    - [editor] rename `Editor.pageState` to `Editor.currentPageState`
    - [editor] add `Editor.pageStates`
    - [editor] add `Editor.setErasingIds`
    - [editor] add `Editor.setEditingId`
    - [editor] add several new component overrides

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 50fe96866..e9e62507e 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -42,7 +42,22 @@ export {
 export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
 export { PositionedOnCanvas } from './lib/components/PositionedOnCanvas'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
+export { ShapeIndicator, type TLShapeIndicatorComponent } from './lib/components/ShapeIndicator'
+export { type TLBackgroundComponent } from './lib/components/default-components/DefaultBackground'
+export { type TLBrushComponent } from './lib/components/default-components/DefaultBrush'
+export { type TLCollaboratorHintComponent } from './lib/components/default-components/DefaultCollaboratorHint'
+export { type TLCursorComponent } from './lib/components/default-components/DefaultCursor'
 export { DefaultErrorFallback } from './lib/components/default-components/DefaultErrorFallback'
+export { type TLGridComponent } from './lib/components/default-components/DefaultGrid'
+export { type TLHandleComponent } from './lib/components/default-components/DefaultHandle'
+export { type TLHandlesComponent } from './lib/components/default-components/DefaultHandles'
+export { type TLHoveredShapeIndicatorComponent } from './lib/components/default-components/DefaultHoveredShapeIndicator'
+export { type TLScribbleComponent } from './lib/components/default-components/DefaultScribble'
+export { type TLSelectionBackgroundComponent } from './lib/components/default-components/DefaultSelectionBackground'
+export { type TLSelectionForegroundComponent } from './lib/components/default-components/DefaultSelectionForeground'
+export { type TLSnapLineComponent } from './lib/components/default-components/DefaultSnapLine'
+export { type TLSpinnerComponent } from './lib/components/default-components/DefaultSpinner'
+export { type TLSvgDefsComponent } from './lib/components/default-components/DefaultSvgDefs'
 export {
 	TAB_ID,
 	createSessionStateSnapshotSignal,

commit 6309cbe6a5daf261707a99ffbebff76a0aa41324
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Wed Jul 19 11:50:40 2023 +0100

    move some utils into tldraw/utils (#1750)
    
    This PR moves certain shared utilities (for images, etc.) to
    @tldraw/utils.
    
    ### Change Type
    
    - [x] `major` â€” Breaking change

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index e9e62507e..ed9614a28 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -289,7 +289,6 @@ export { getPointerInfo } from './lib/utils/getPointerInfo'
 export { getSvgPathFromPoints } from './lib/utils/getSvgPathFromPoints'
 export { hardResetEditor } from './lib/utils/hardResetEditor'
 export { normalizeWheel } from './lib/utils/normalizeWheel'
-export { png } from './lib/utils/png'
 export { refreshPage } from './lib/utils/refreshPage'
 export {
 	getIndexAbove,

commit 0323ee1f6b6ece000b0c1e35cd259a986f852aad
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Jul 20 12:38:55 2023 +0100

    [fix] dark mode (#1754)
    
    This PR fixes a bug where dark mode would not immediately cause shapes
    to update their colors. Previously, we got the current theme during
    render but not in a way that hooked into the change. In this update, we
    hook into the change. We also pass the change down to shape fills as
    props rather than getting the theme from deeper down.
    
    ### Change Type
    
    - [x] `patch`
    
    ### Test Plan
    
    1. Use dark mode.
    2. Switch colors
    
    ### Release Notes
    
    - [fix] dark mode colors not updating

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index ed9614a28..a64b9c875 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -202,6 +202,7 @@ export { getCursor } from './lib/hooks/useCursor'
 export { useEditor } from './lib/hooks/useEditor'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
 export { useIsCropping } from './lib/hooks/useIsCropping'
+export { useIsDarkMode } from './lib/hooks/useIsDarkMode'
 export { useIsEditing } from './lib/hooks/useIsEditing'
 export { useLocalStore } from './lib/hooks/useLocalStore'
 export { usePeerIds } from './lib/hooks/usePeerIds'

commit d750da8f40efda4b011a91962ef8f30c63d1e5da
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jul 25 17:10:15 2023 +0100

    `ShapeUtil.getGeometry`, selection rewrite (#1751)
    
    This PR is a significant rewrite of our selection / hit testing logic.
    
    It
    - replaces our current geometric helpers (`getBounds`, `getOutline`,
    `hitTestPoint`, and `hitTestLineSegment`) with a new geometry API
    - moves our hit testing entirely to JS using geometry
    - improves selection logic, especially around editing shapes, groups and
    frames
    - fixes many minor selection bugs (e.g. shapes behind frames)
    - removes hit-testing DOM elements from ShapeFill etc.
    - adds many new tests around selection
    - adds new tests around selection
    - makes several superficial changes to surface editor APIs
    
    This PR is hard to evaluate. The `selection-omnibus` test suite is
    intended to describe all of the selection behavior, however all existing
    tests are also either here preserved and passing or (in a few cases
    around editing shapes) are modified to reflect the new behavior.
    
    ## Geometry
    
    All `ShapeUtils` implement `getGeometry`, which returns a single
    geometry primitive (`Geometry2d`). For example:
    
    ```ts
    class BoxyShapeUtil {
      getGeometry(shape: BoxyShape) {
        return new Rectangle2d({
            width: shape.props.width,
            height: shape.props.height,
            isFilled: true,
            margin: shape.props.strokeWidth
          })
        }
    }
    ```
    
    This geometric primitive is used for all bounds calculation, hit
    testing, intersection with arrows, etc.
    
    There are several geometric primitives that extend `Geometry2d`:
    - `Arc2d`
    - `Circle2d`
    - `CubicBezier2d`
    - `CubicSpline2d`
    - `Edge2d`
    - `Ellipse2d`
    - `Group2d`
    - `Polygon2d`
    - `Rectangle2d`
    - `Stadium2d`
    
    For shapes that have more complicated geometric representations, such as
    an arrow with a label, the `Group2d` can accept other primitives as its
    children.
    
    ## Hit testing
    
    Previously, we did all hit testing via events set on shapes and other
    elements. In this PR, I've replaced those hit tests with our own
    calculation for hit tests in JavaScript. This removed the need for many
    DOM elements, such as hit test area borders and fills which only existed
    to trigger pointer events.
    
    ## Selection
    
    We now support selecting "hollow" shapes by clicking inside of them.
    This involves a lot of new logic but it should work intuitively. See
    `Editor.getShapeAtPoint` for the (thoroughly commented) implementation.
    
    ![Kapture 2023-07-23 at 23 27
    27](https://github.com/tldraw/tldraw/assets/23072548/a743275c-acdb-42d9-a3fe-b3e20dce86b6)
    
    every sunset is actually the sun hiding in fear and respect of tldraw's
    quality of interactions
    
    This PR also fixes several bugs with scribble selection, in particular
    around the shift key modifier.
    
    ![Kapture 2023-07-24 at 23 34
    07](https://github.com/tldraw/tldraw/assets/23072548/871d67d0-8d06-42ae-a2b2-021effba37c5)
    
    ...as well as issues with labels and editing.
    
    There are **over 100 new tests** for selection covering groups, frames,
    brushing, scribbling, hovering, and editing. I'll add a few more before
    I feel comfortable merging this PR.
    
    ## Arrow binding
    
    Using the same "hollow shape" logic as selection, arrow binding is
    significantly improved.
    
    ![Kapture 2023-07-22 at 07 46
    25](https://github.com/tldraw/tldraw/assets/23072548/5aa724b3-b57d-4fb7-92d0-80e34246753c)
    
    a thousand wise men could not improve on this
    
    ## Moving focus between editing shapes
    
    Previously, this was handled in the `editing_shapes` state. This is
    moved to `useEditableText`, and should generally be considered an
    advanced implementation detail on a shape-by-shape basis. This addresses
    a bug that I'd never noticed before, but which can be reproduced by
    selecting an shapeâ€”but not focusing its inputâ€”while editing a different
    shape. Previously, the new shape became the editing shape but its input
    did not focus.
    
    ![Kapture 2023-07-23 at 23 19
    09](https://github.com/tldraw/tldraw/assets/23072548/a5e157fb-24a8-42bd-a692-04ce769b1a9c)
    
    In this PR, you can select a shape by clicking on its edge or body, or
    select its input to transfer editing / focus.
    
    ![Kapture 2023-07-23 at 23 22
    21](https://github.com/tldraw/tldraw/assets/23072548/7384e7ea-9777-4e1a-8f63-15de2166a53a)
    
    tldraw, glorious tldraw
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Test Plan
    
    1. Erase shapes
    2. Select shapes
    3. Calculate their bounding boxes
    
    - [ ] Unit Tests // todo
    - [ ] End to end tests // todo
    
    ### Release Notes
    
    - [editor] Remove `ShapeUtil.getBounds`, `ShapeUtil.getOutline`,
    `ShapeUtil.hitTestPoint`, `ShapeUtil.hitTestLineSegment`
    - [editor] Add `ShapeUtil.getGeometry`
    - [editor] Add `Editor.getShapeGeometry`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index a64b9c875..b1727d6e9 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -43,21 +43,60 @@ export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLCon
 export { PositionedOnCanvas } from './lib/components/PositionedOnCanvas'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
 export { ShapeIndicator, type TLShapeIndicatorComponent } from './lib/components/ShapeIndicator'
-export { type TLBackgroundComponent } from './lib/components/default-components/DefaultBackground'
-export { type TLBrushComponent } from './lib/components/default-components/DefaultBrush'
-export { type TLCollaboratorHintComponent } from './lib/components/default-components/DefaultCollaboratorHint'
-export { type TLCursorComponent } from './lib/components/default-components/DefaultCursor'
+export {
+	DefaultBackground,
+	type TLBackgroundComponent,
+} from './lib/components/default-components/DefaultBackground'
+export {
+	DefaultBrush,
+	type TLBrushComponent,
+} from './lib/components/default-components/DefaultBrush'
+export {
+	DefaultCollaboratorHint,
+	type TLCollaboratorHintComponent,
+} from './lib/components/default-components/DefaultCollaboratorHint'
+export {
+	DefaultCursor,
+	type TLCursorComponent,
+} from './lib/components/default-components/DefaultCursor'
 export { DefaultErrorFallback } from './lib/components/default-components/DefaultErrorFallback'
-export { type TLGridComponent } from './lib/components/default-components/DefaultGrid'
-export { type TLHandleComponent } from './lib/components/default-components/DefaultHandle'
-export { type TLHandlesComponent } from './lib/components/default-components/DefaultHandles'
-export { type TLHoveredShapeIndicatorComponent } from './lib/components/default-components/DefaultHoveredShapeIndicator'
-export { type TLScribbleComponent } from './lib/components/default-components/DefaultScribble'
-export { type TLSelectionBackgroundComponent } from './lib/components/default-components/DefaultSelectionBackground'
-export { type TLSelectionForegroundComponent } from './lib/components/default-components/DefaultSelectionForeground'
-export { type TLSnapLineComponent } from './lib/components/default-components/DefaultSnapLine'
-export { type TLSpinnerComponent } from './lib/components/default-components/DefaultSpinner'
-export { type TLSvgDefsComponent } from './lib/components/default-components/DefaultSvgDefs'
+export { DefaultGrid, type TLGridComponent } from './lib/components/default-components/DefaultGrid'
+export {
+	DefaultHandle,
+	type TLHandleComponent,
+} from './lib/components/default-components/DefaultHandle'
+export {
+	DefaultHandles,
+	type TLHandlesComponent,
+} from './lib/components/default-components/DefaultHandles'
+export {
+	DefaultHoveredShapeIndicator,
+	type TLHoveredShapeIndicatorComponent,
+} from './lib/components/default-components/DefaultHoveredShapeIndicator'
+export {
+	DefaultScribble,
+	type TLScribbleComponent,
+} from './lib/components/default-components/DefaultScribble'
+export {
+	DefaultSelectionBackground,
+	type TLSelectionBackgroundComponent,
+} from './lib/components/default-components/DefaultSelectionBackground'
+export {
+	DefaultSelectionForeground,
+	type TLSelectionForegroundComponent,
+} from './lib/components/default-components/DefaultSelectionForeground'
+export {
+	DefaultSnapLine,
+	type TLSnapLineComponent,
+} from './lib/components/default-components/DefaultSnapLine'
+export {
+	DefaultSpinner,
+	type TLSpinnerComponent,
+} from './lib/components/default-components/DefaultSpinner'
+export {
+	DefaultSvgDefs,
+	type TLSvgDefsComponent,
+} from './lib/components/default-components/DefaultSvgDefs'
 export {
 	TAB_ID,
 	createSessionStateSnapshotSignal,
@@ -86,14 +125,12 @@ export {
 	DEFAULT_ANIMATION_OPTIONS,
 	DOUBLE_CLICK_DURATION,
 	DRAG_DISTANCE,
-	GRID_INCREMENT,
 	GRID_STEPS,
 	HASH_PATTERN_ZOOM_NAMES,
-	MAJOR_NUDGE_FACTOR,
+	HIT_TEST_MARGIN,
 	MAX_PAGES,
 	MAX_SHAPES_PER_PAGE,
 	MAX_ZOOM,
-	MINOR_NUDGE_FACTOR,
 	MIN_ZOOM,
 	MULTI_CLICK_DURATION,
 	SVG_PADDING,
@@ -222,6 +259,18 @@ export {
 export { Matrix2d, type Matrix2dModel } from './lib/primitives/Matrix2d'
 export { Vec2d, type VecLike } from './lib/primitives/Vec2d'
 export { EASINGS } from './lib/primitives/easings'
+export { Arc2d } from './lib/primitives/geometry/Arc2d'
+export { Circle2d } from './lib/primitives/geometry/Circle2d'
+export { CubicBezier2d } from './lib/primitives/geometry/CubicBezier2d'
+export { CubicSpline2d } from './lib/primitives/geometry/CubicSpline2d'
+export { Edge2d } from './lib/primitives/geometry/Edge2d'
+export { Ellipse2d } from './lib/primitives/geometry/Ellipse2d'
+export { Geometry2d } from './lib/primitives/geometry/Geometry2d'
+export { Group2d } from './lib/primitives/geometry/Group2d'
+export { Polygon2d } from './lib/primitives/geometry/Polygon2d'
+export { Polyline2d } from './lib/primitives/geometry/Polyline2d'
+export { Rectangle2d } from './lib/primitives/geometry/Rectangle2d'
+export { Stadium2d } from './lib/primitives/geometry/Stadium2d'
 export {
 	intersectLineSegmentPolygon,
 	intersectLineSegmentPolyline,

commit 89914684467c1e18ef06fa702c82ed0f88a2ea09
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sat Aug 5 12:21:07 2023 +0100

    history options / markId / createPage (#1796)
    
    This PR:
    
    - adds history options to several commands in order to allow them to
    support squashing and ephemeral data (previously, these commands had
    boolean values for squashing / ephemeral)
    
    It also:
    - changes `markId` to return the editor instance rather than the mark id
    passed into the command
    - removes `focus` and `blur` commands
    - changes `createPage` parameters
    - unifies `animateShape` / `animateShapes` options
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Test Plan
    
    - [x] Unit Tests

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index b1727d6e9..ce13186fe 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -136,7 +136,12 @@ export {
 	SVG_PADDING,
 	ZOOMS,
 } from './lib/constants'
-export { Editor, type TLAnimationOptions, type TLEditorOptions } from './lib/editor/Editor'
+export {
+	Editor,
+	type TLAnimationOptions,
+	type TLEditorOptions,
+	type TLResizeShapeOptions,
+} from './lib/editor/Editor'
 export {
 	SnapManager,
 	type GapsSnapLine,

commit 5cd74f4bd602fd2c56bdd57219aa92bde681b104
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Sep 19 16:33:54 2023 +0100

    [feature] Include `sources` in `TLExternalContent` (#1925)
    
    This PR adds the source items from a paste event to the data shared with
    external content handlers. This allows developers to customize the way
    certain content is handled.
    
    For example, pasting text sometimes incudes additional clipboard items,
    such as the HTML representation of that text. We wouldn't want to create
    two shapesâ€”one for the text and one for the HTMLâ€”so we still treat this
    as a single text paste. The `registerExternalContentHandler` API allows
    a developer to change how that text is handled, and the new `sources`
    API will now allow the developer to take into consideration all of the
    items that were on the clipboard.
    
    ![Kapture 2023-09-19 at 12 25
    52](https://github.com/tldraw/tldraw/assets/23072548/fa976320-cfec-4921-b481-10cae0d4043e)
    
    ### Change Type
    
    - [x] `minor` â€” New feature
    
    ### Test Plan
    
    1. Try the external content source example.
    2. Paste text that includes HTML (e.g. from VS Code)
    
    ### Release Notes
    
    - [editor / tldraw] add `sources` to `TLExternalContent`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index ce13186fe..f8e4c33e0 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -230,6 +230,7 @@ export {
 export {
 	type TLExternalAssetContent,
 	type TLExternalContent,
+	type TLExternalContentSource,
 } from './lib/editor/types/external-content'
 export {
 	type TLCommand,

commit 9e4dbd19013ccbae28a112929cf5e50474e5028f
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Sep 26 09:05:05 2023 -0500

    [fix] geo shape text label placement (#1927)
    
    This PR fixes the text label placement for geo shapes. (It also fixes
    the way an ellipse renders when set to dash or dotted).
    
    There's still the slightest offset of the text label's outline when you
    begin editing. Maybe we should keep the indicator instead?
    
    ### Change Type
    
    - [x] `patch` â€” Bug fix
    
    ### Test Plan
    
    Create a hexagon shape
    hit enter to type
    indicator is offset, text label is no longer offset
    
    ---------
    
    Co-authored-by: David Sheldrick <d.j.sheldrick@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index f8e4c33e0..452815232 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -297,6 +297,7 @@ export {
 	canonicalizeRotation,
 	clamp,
 	clampRadians,
+	clockwiseAngleDist,
 	degreesToRadians,
 	getArcLength,
 	getPointOnCircle,

commit 3d30f77ac1035cf6c9ba1d4c47b134a49530a7a9
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Fri Sep 29 16:20:39 2023 +0100

    Make user preferences optional (#1963)
    
    This PR makes it so that user preferences can be in a 'null' state,
    where we use the default values and/or infer from the system
    preferences.
    
    Before this PR it was impossible to allow a user to change their locale
    via their system config rather than selecting an explicit value in the
    tldraw editor menu. Similarly, it was impossible to adapt to changes in
    the user's system preferences for dark/light mode.
    
    That's because we saved the full user preference values the first time
    the user loaded tldraw, and the only way for them to change after that
    is by saving new values.
    
    After this PR, if a value is `null` we will use the 'default' version of
    it, which can be inferred based on the user's system preferences in the
    case of dark mode, locale, and animation speed. Then if the user changes
    their system config and refreshes the page their changes should be
    picked up by tldraw where they previously wouldn't have been.
    
    Dark mode inference is opt-in by setting a prop `inferDarkMode: true` on
    the `Editor` instance (and the `<Tldraw />` components), because we
    don't want it to be a surprise for existing library users.
    
    
    ### Change Type
    
    - [ ] `patch` â€” Bug fix
    - [ ] `minor` â€” New feature
    - [x] `major` â€” Breaking change
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 452815232..758652b28 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -106,6 +106,7 @@ export {
 } from './lib/config/TLSessionStateSnapshot'
 export {
 	USER_COLORS,
+	defaultUserPreferences,
 	getFreshUserPreferences,
 	getUserPreferences,
 	setUserPreferences,

commit 1367e4c50082acd7b08d5ced5947c2a4c7b3824e
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Nov 7 09:27:20 2023 +0000

    [feature] Things on the canvas (#2150)
    
    This PR adds two new component overrides to the editor's `components`
    slot. They are:
    
    - `<OnTheCanvas/>`, which renders inside of the html layer that scales
    and translates with the camera
    - `<InFrontOfTheCanvas/>`, which renders in front of the canvas but
    behind any UI elements, and which does not scale / pan with the camera.
    
    ![Kapture 2023-11-06 at 12 19
    15](https://github.com/tldraw/tldraw/assets/23072548/51c0421d-8b39-48b5-9b8a-c717253c3423)
    
    ### Change Type
    
    - [x] `minor` â€” New feature
    
    ### Test Plan
    
    1. See the "on the canvas" example.
    
    ### Release Notes
    
    - [editor] Adds two new components, `OnTheCanvas` and
    `InFrontOfTheCanvas`.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 758652b28..c754df6fd 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -73,6 +73,8 @@ export {
 	DefaultHoveredShapeIndicator,
 	type TLHoveredShapeIndicatorComponent,
 } from './lib/components/default-components/DefaultHoveredShapeIndicator'
+export { type TLInFrontOfTheCanvas } from './lib/components/default-components/DefaultInFrontOfTheCanvas'
+export { type TLOnTheCanvas } from './lib/components/default-components/DefaultOnTheCanvas'
 export {
 	DefaultScribble,
 	type TLScribbleComponent,

commit 14e8d19a713fb21c3f976a15cdbdf0dd05167366
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Wed Nov 15 18:06:02 2023 +0000

    Custom Tools DX + screenshot example (#2198)
    
    This PR adds a custom tool example, the `Screenshot Tool`.
    
    It demonstrates how a user can create a custom tool together with custom
    tool UI.
    
    ### Change Type
    
    - [x] `minor` â€” New feature
    
    ### Test Plan
    
    1. Use the screenshot example
    
    ### Release Notes
    
    - adds ScreenshotTool custom tool example
    - improvements and new exports related to copying and exporting images /
    files
    - loosens up types around icons and translations
    - moving `StateNode.isActive` into an atom
    - adding `Editor.path`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index c754df6fd..22d494cf8 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -241,7 +241,7 @@ export {
 	type TLHistoryEntry,
 	type TLHistoryMark,
 } from './lib/editor/types/history-types'
-export { type RequiredKeys } from './lib/editor/types/misc-types'
+export { type RequiredKeys, type TLSvgOptions } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
 export { useContainer } from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'
@@ -260,6 +260,7 @@ export {
 	Box2d,
 	ROTATE_CORNER_TO_SELECTION_CORNER,
 	rotateSelectionHandle,
+	type BoxLike,
 	type RotateCorner,
 	type SelectionCorner,
 	type SelectionEdge,

commit 390c45c7eb61555454b9ce5e3a4d4be1852af870
Author: alex <alex@dytry.ch>
Date:   Fri Dec 1 16:48:30 2023 +0000

    fix vite HMR issue (#2279)
    
    This is an attempt at #1989. The big issue there is when `shapeUtils`
    change when you're relying on tldraw to provide you with the store
    instead of providing your own. Our `useTLStore` component had a bug
    where it would rely on effects & a ref to detect when its options had
    changed whilst still scheduling updates. Fresh opts would come in, but
    they'd be different from the ones in the ref, so we'd schedule an
    update, so the opts would come in again, but they'd still be different
    as we hadn't run effects yet, and we'd schedule an update again (and so
    on).
    
    This diff fixes that by storing the previous opts in state instead of a
    ref, so they're updating in lockstep with the store itself. this
    prevents the update loop.
    
    There are still situations where we can get into loops if the developer
    is passing in custom tools, shapeUtils, or components but not memoising
    them or defining them outside of react. As a DX improvement, we do some
    auto-memoisation of these values using shallow equality to help with
    this issue.
    
    ### Change Type
    
    - [x] `patch` â€” Bug fix
    
    
    ### Test Plan
    
    - [x] Unit Tests
    
    ### Release Notes
    
    - Fixes a bug that could cause crashes due to a re-render loop with HMR
    #1989

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 22d494cf8..3683b3b9b 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -247,6 +247,7 @@ export { useContainer } from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'
 export { useEditor } from './lib/hooks/useEditor'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
+export { useShallowArrayIdentity, useShallowObjectIdentity } from './lib/hooks/useIdentity'
 export { useIsCropping } from './lib/hooks/useIsCropping'
 export { useIsDarkMode } from './lib/hooks/useIsDarkMode'
 export { useIsEditing } from './lib/hooks/useIsEditing'

commit 4e50c9c16251f9d4ca7034f2519759e093a99dbf
Author: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>
Date:   Sat Dec 16 00:37:03 2023 +0100

    Start scrolling if we are dragging close to the window edges. (#2299)
    
    Start scrolling when we get close to the edges of the window. This works
    for brush selecting, translating, and resizing.
    
    
    https://github.com/tldraw/tldraw/assets/2523721/4a5effc8-5445-411b-b317-36097233d36c
    
    
    ### Change Type
    
    - [ ] `patch` â€” Bug fix
    - [x] `minor` â€” New feature
    - [ ] `major` â€” Breaking change
    - [ ] `dependencies` â€” Changes to package dependencies[^1]
    - [ ] `documentation` â€” Changes to the documentation only[^2]
    - [ ] `tests` â€” Changes to any test code only[^2]
    - [ ] `internal` â€” Any other changes that don't affect the published
    package[^2]
    - [ ] I don't know
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version
    
    ### Test Plan
    
    1. Select a shape.
    2. Move it towards the edge of the window. The camera position should
    change.
    3. Also try resizing, brush selecting.
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Adds the logic to change the camera position when you get close to the
    edges of the window. This allows you to drag, resize, brush select past
    the edges of the current viewport.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 3683b3b9b..73027b5f8 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -225,6 +225,7 @@ export {
 	type TLPointerEventName,
 	type TLPointerEventTarget,
 	type TLTickEvent,
+	type TLTickEventHandler,
 	type TLWheelEvent,
 	type TLWheelEventInfo,
 	type UiEvent,
@@ -346,6 +347,7 @@ export {
 	setPointerCapture,
 	stopEventPropagation,
 } from './lib/utils/dom'
+export { moveCameraWhenCloseToEdge } from './lib/utils/edgeScrolling'
 export { getIncrementedName } from './lib/utils/getIncrementedName'
 export { getPointerInfo } from './lib/utils/getPointerInfo'
 export { getSvgPathFromPoints } from './lib/utils/getSvgPathFromPoints'

commit 6b1005ef71a63613a09606310f666487547d5f23
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Wed Jan 3 12:13:15 2024 +0000

    [tech debt] Primitives renaming party / cleanup (#2396)
    
    This PR:
    - renames Vec2d to Vec
    - renames Vec2dModel to VecModel
    - renames Box2d to Box
    - renames Box2dModel to BoxModel
    - renames Matrix2d to Mat
    - renames Matrix2dModel to MatModel
    - removes unused primitive helpers
    - removes unused exports
    - removes a few redundant tests in dgreensp
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Release Notes
    
    - renames Vec2d to Vec
    - renames Vec2dModel to VecModel
    - renames Box2d to Box
    - renames Box2dModel to BoxModel
    - renames Matrix2d to Mat
    - renames Matrix2dModel to MatModel
    - removes unused primitive helpers

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 73027b5f8..21fd7b4cf 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -145,6 +145,15 @@ export {
 	type TLEditorOptions,
 	type TLResizeShapeOptions,
 } from './lib/editor/Editor'
+export type {
+	TLAfterChangeHandler,
+	TLAfterCreateHandler,
+	TLAfterDeleteHandler,
+	TLBatchCompleteHandler,
+	TLBeforeChangeHandler,
+	TLBeforeCreateHandler,
+	TLBeforeDeleteHandler,
+} from './lib/editor/managers/SideEffectManager'
 export {
 	SnapManager,
 	type GapsSnapLine,
@@ -181,16 +190,12 @@ export {
 	type TLShapeUtilFlag,
 } from './lib/editor/shapes/ShapeUtil'
 export { GroupShapeUtil } from './lib/editor/shapes/group/GroupShapeUtil'
-export { getArrowheadPathForType } from './lib/editor/shapes/shared/arrow/arrowheads'
 export {
-	getCurvedArrowHandlePath,
-	getSolidCurvedArrowPath,
-} from './lib/editor/shapes/shared/arrow/curved-arrow'
+	type TLArcInfo,
+	type TLArrowInfo,
+	type TLArrowPoint,
+} from './lib/editor/shapes/shared/arrow/arrow-types'
 export { getArrowTerminalsInArrowSpace } from './lib/editor/shapes/shared/arrow/shared'
-export {
-	getSolidStraightArrowPath,
-	getStraightArrowHandlePath,
-} from './lib/editor/shapes/shared/arrow/straight-arrow'
 export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'
@@ -259,7 +264,7 @@ export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLStore } from './lib/hooks/useTLStore'
 export { useTransform } from './lib/hooks/useTransform'
 export {
-	Box2d,
+	Box,
 	ROTATE_CORNER_TO_SELECTION_CORNER,
 	rotateSelectionHandle,
 	type BoxLike,
@@ -267,9 +272,9 @@ export {
 	type SelectionCorner,
 	type SelectionEdge,
 	type SelectionHandle,
-} from './lib/primitives/Box2d'
-export { Matrix2d, type Matrix2dModel } from './lib/primitives/Matrix2d'
-export { Vec2d, type VecLike } from './lib/primitives/Vec2d'
+} from './lib/primitives/Box'
+export { Mat, type MatLike, type MatModel } from './lib/primitives/Mat'
+export { Vec, type VecLike } from './lib/primitives/Vec'
 export { EASINGS } from './lib/primitives/easings'
 export { Arc2d } from './lib/primitives/geometry/Arc2d'
 export { Circle2d } from './lib/primitives/geometry/Circle2d'
@@ -279,24 +284,29 @@ export { Edge2d } from './lib/primitives/geometry/Edge2d'
 export { Ellipse2d } from './lib/primitives/geometry/Ellipse2d'
 export { Geometry2d } from './lib/primitives/geometry/Geometry2d'
 export { Group2d } from './lib/primitives/geometry/Group2d'
+export { Point2d } from './lib/primitives/geometry/Point2d'
 export { Polygon2d } from './lib/primitives/geometry/Polygon2d'
 export { Polyline2d } from './lib/primitives/geometry/Polyline2d'
 export { Rectangle2d } from './lib/primitives/geometry/Rectangle2d'
 export { Stadium2d } from './lib/primitives/geometry/Stadium2d'
 export {
+	intersectCircleCircle,
+	intersectCirclePolygon,
+	intersectCirclePolyline,
+	intersectLineSegmentCircle,
+	intersectLineSegmentLineSegment,
 	intersectLineSegmentPolygon,
 	intersectLineSegmentPolyline,
+	intersectPolygonBounds,
 	intersectPolygonPolygon,
 	linesIntersect,
 	polygonsIntersect,
 } from './lib/primitives/intersect'
 export {
-	EPSILON,
+	HALF_PI,
 	PI,
 	PI2,
 	SIN,
-	TAU,
-	angleDelta,
 	approximately,
 	areAnglesCompatible,
 	average,
@@ -305,24 +315,11 @@ export {
 	clampRadians,
 	clockwiseAngleDist,
 	degreesToRadians,
-	getArcLength,
 	getPointOnCircle,
 	getPolygonVertices,
-	getStarBounds,
-	getSweep,
-	isAngleBetween,
 	isSafeFloat,
-	lerpAngles,
-	longAngleDist,
 	perimeterOfEllipse,
-	pointInBounds,
-	pointInCircle,
-	pointInEllipse,
 	pointInPolygon,
-	pointInPolyline,
-	pointInRect,
-	pointNearToLineSegment,
-	pointNearToPolyline,
 	precise,
 	radiansToDegrees,
 	rangeIntersection,

commit ce85eaac34809a5d59640baa47d8c5254b8ba983
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jan 23 15:27:25 2024 +0000

    Export TLCommandHistoryOptions type (#2598)
    
    Export TLCommandHistoryOptions type.
    
    ### Change Type
    
    - [x] `patch` â€” Bug fix
    
    ### Release Notes
    
    - Added TLCommandHistoryOptions to the exported types.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 21fd7b4cf..17d191189 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -17,6 +17,7 @@ export {
 	type Atom,
 	type Signal,
 } from '@tldraw/state'
+export type { TLCommandHistoryOptions } from './lib/editor/types/history-types'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/store'
 // eslint-disable-next-line local/no-export-star

commit 07cda7ef9fd9008c2feebce20659e2d087ddbdd3
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Wed Jan 24 10:19:20 2024 +0000

    arrows: add ability to change label placement (#2557)
    
    This adds the ability to drag the label on an arrow to a different
    location within the line segment/arc.
    
    
    https://github.com/tldraw/tldraw/assets/469604/dbd2ee35-bebc-48d6-b8ee-fcf12ce91fa5
    
    - A lot of the complexity lay in ensuring a fixed distance from the ends
    of the arrowheads.
    - I added a new type of handle `text-adjust` that makes the text box the
    very handle itself.
    - I added a `ARROW_HANDLES` enum - we should use more enums!
    - The bulk of the changes are in ArrowShapeUtil â€” check that out in
    particular obviously :)
    
    Along the way, I tried to improve a couple spots as I touched them:
    - added some more documentation to Vec.ts because some of the functions
    in there were obscure/new to me. (at least the naming, hah)
    - added `getPointOnCircle` which was being done in a couple places
    independently and refactored those places.
    
    ### Questions
    - the `getPointOnCircle` API changed. Is this considered breaking and/or
    should I leave the signature the same? Wasn't sure if it was a big deal
    or not.
    - I made `labelPosition` in the schema always but I guess it could have
    been optional? Lemme know if there's a preference.
    - Any feedback on tests? Happy to expand those if necessary.
    
    ### Change Type
    
    - [ ] `patch` â€” Bug fix
    - [x] `minor` â€” New feature
    - [ ] `major` â€” Breaking change
    - [ ] `dependencies` â€” Changes to package dependencies[^1]
    - [ ] `documentation` â€” Changes to the documentation only[^2]
    - [ ] `tests` â€” Changes to any test code only[^2]
    - [ ] `internal` â€” Any other changes that don't affect the published
    package[^2]
    - [ ] I don't know
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version
    
    ### Test Plan
    
    1. For arrow in [straightArrow, curvedArrow] test the following:
       a. Label in the middle
       b. Label at both ends of the arrow
       c. Test arrows in different directions
    d. Rotating the endpoints and seeing that the label stays at the end of
    the arrow at a fixed width.
       e. Test different stroke widths.
       f. Test with different arrowheads.
    2. Also, test arcs that are more circle like than arc-like.
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Adds ability to change label position on arrows.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>
    Co-authored-by: alex <alex@dytry.ch>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 17d191189..8d48b3155 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -174,7 +174,8 @@ export {
 	type TLOnDoubleClickHandler,
 	type TLOnDragHandler,
 	type TLOnEditEndHandler,
-	type TLOnHandleChangeHandler,
+	type TLOnHandleDragHandler,
+	type TLOnHandleDragStartHandler,
 	type TLOnResizeEndHandler,
 	type TLOnResizeHandler,
 	type TLOnResizeStartHandler,
@@ -308,6 +309,7 @@ export {
 	PI,
 	PI2,
 	SIN,
+	angleDistance,
 	approximately,
 	areAnglesCompatible,
 	average,
@@ -315,6 +317,7 @@ export {
 	clamp,
 	clampRadians,
 	clockwiseAngleDist,
+	counterClockwiseAngleDist,
 	degreesToRadians,
 	getPointOnCircle,
 	getPolygonVertices,

commit 34a95b2ec8811fc50eaf74a9a4139909e9b834b7
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Wed Jan 31 11:17:03 2024 +0000

    arrows: separate out handle behavior from labels (#2621)
    
    This is a followup on the arrows work.
    - allow labels to go to the ends if no arrowhead is present
    - avoid using / overloading TLHandle and use a new PointingLabel state
    to specifically address label movement
    - removes the feature flag to launch this feature!
    
    ### Change Type
    
    - [x] `patch` â€” Bug fix
    
    ### Release Notes
    
    - Arrow labels: provide more polish on label placement
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 8d48b3155..0e85d8e63 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -175,7 +175,6 @@ export {
 	type TLOnDragHandler,
 	type TLOnEditEndHandler,
 	type TLOnHandleDragHandler,
-	type TLOnHandleDragStartHandler,
 	type TLOnResizeEndHandler,
 	type TLOnResizeHandler,
 	type TLOnResizeStartHandler,
@@ -319,6 +318,8 @@ export {
 	clockwiseAngleDist,
 	counterClockwiseAngleDist,
 	degreesToRadians,
+	getArcMeasure,
+	getPointInArcT,
 	getPointOnCircle,
 	getPolygonVertices,
 	isSafeFloat,

commit 4d0aff8f016ab4e31999f6ae9e89c5df5fdfda49
Author: alex <alex@dytry.ch>
Date:   Wed Feb 7 10:40:01 2024 +0000

    Split snap manager into ShapeBoundsSnaps and HandleSnaps (#2747)
    
    Taking the opportunity for some last-minute low-consequence breaking
    changes before 2.0, this diff does some prep work for adding a new
    snapping API by making the distinction between the two types of snapping
    a bit clearer and cleaning up some naming.
    
    - `SnapManager` has had most of the actual snapping logic moved into two
    properties: `shapeBounds` (for snapping shape bounds on translate and
    resize) and `handles` (for snapping handles)
    - `SnapLine`s are renamed to `SnapIndicator`s. The 'line' name was a bit
    confusing because not all of these indicators are lines (the new vertex
    snap type will be a single point)
    
    I'm not too worried about this being a breaking change as it touches an
    area of the API that I'd be very surprised if more than a couple of
    people were using.
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Test Plan
    
    - No user-facing changes.
    
    ### Release Notes
    
    - `SnapLine`s are now called `SnapIndicator`s
    - Snapping methods moved from `editor.snaps` to
    `editor.snaps.shapeBounds` and `editor.snaps.handles` depending on the
    type of snapping you're trying to do.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 0e85d8e63..1f965cd19 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -89,9 +89,9 @@ export {
 	type TLSelectionForegroundComponent,
 } from './lib/components/default-components/DefaultSelectionForeground'
 export {
-	DefaultSnapLine,
-	type TLSnapLineComponent,
-} from './lib/components/default-components/DefaultSnapLine'
+	DefaultSnapIndicator,
+	type TLSnapIndicatorComponent,
+} from './lib/components/default-components/DefaultSnapIndictor'
 export {
 	DefaultSpinner,
 	type TLSpinnerComponent,
@@ -155,13 +155,13 @@ export type {
 	TLBeforeCreateHandler,
 	TLBeforeDeleteHandler,
 } from './lib/editor/managers/SideEffectManager'
+export { type BoundsSnapPoint } from './lib/editor/managers/SnapManager/BoundsSnaps'
 export {
 	SnapManager,
-	type GapsSnapLine,
-	type PointsSnapLine,
-	type SnapLine,
-	type SnapPoint,
-} from './lib/editor/managers/SnapManager'
+	type GapsSnapIndicator,
+	type PointsSnapIndicator,
+	type SnapIndicator,
+} from './lib/editor/managers/SnapManager/SnapManager'
 export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseBoxShapeUtil'
 export {
 	ShapeUtil,

commit 93c2ed615c61f09a3d4936c2ed06bcebd85cf363
Author: alex <alex@dytry.ch>
Date:   Wed Feb 14 17:53:30 2024 +0000

    [Snapping 1/5] Validation & strict types for fractional indexes  (#2827)
    
    Currently, we type our fractional index keys as `string` and don't have
    any validation for them. I'm touching some of this code for my work on
    line handles and wanted to change that:
    - fractional indexes are now `IndexKey`s, not `string`s. `IndexKey`s
    have a brand property so can't be used interchangeably with strings
    (like our IDs)
    - There's a new `T.indexKey` validator which we can use in our
    validations to make sure we don't end up with nonsense keys.
    
    This PR is part of a series - please don't merge it until the things
    before it have landed!
    1. #2827 (you are here)
    2. #2831
    3. #2793
    4. #2841
    5. #2845
    
    ### Change Type
    
    - [x] `patch` â€” Bug fix
    
    ### Test Plan
    
    1. Mostly relying on unit & end to end tests here - no user facing
    changes.
    
    - [x] Unit Tests

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 1f965cd19..ac99b948c 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -356,16 +356,6 @@ export { getSvgPathFromPoints } from './lib/utils/getSvgPathFromPoints'
 export { hardResetEditor } from './lib/utils/hardResetEditor'
 export { normalizeWheel } from './lib/utils/normalizeWheel'
 export { refreshPage } from './lib/utils/refreshPage'
-export {
-	getIndexAbove,
-	getIndexBelow,
-	getIndexBetween,
-	getIndices,
-	getIndicesAbove,
-	getIndicesBelow,
-	getIndicesBetween,
-	sortByIndex,
-} from './lib/utils/reordering/reordering'
 export {
 	applyRotationToSnapshotShapes,
 	getRotationSnapshot,

commit ac0259a6af0ede496f26041d552119a6e7dce41c
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Feb 15 12:10:09 2024 +0000

    Composable custom UI  (#2796)
    
    This PR refactors our menu systems and provides an interface to hide or
    replace individual user interface elements.
    
    # Background
    
    Previously, we've had two types of overrides:
    - "schema" overrides that would allow insertion or replacement of items
    in the different menus
    - "component" overrides that would replace components in the editor's
    user interface
    
    This PR is an attempt to unify the two and to provide for additional
    cases where the "schema-based" user interface had begun to break down.
    
    # Approach
    
    This PR makes no attempt to change the `actions` or `tools`
    overridesâ€”the current system seems to be correct for those because they
    are not reactive. The challenge with the other ui schemas is that they
    _are_ reactive, and thus the overrides both need to a) be fed in from
    outside of the editor as props, and b) react to changes from the editor,
    which is an impossible situation.
    
    The new approach is to use React to declare menu items. (Surprise!)
    
    ```tsx
    function CustomHelpMenuContent() {
            return (
                    <>
                            <DefaultHelpMenuContent />
                            <TldrawUiMenuGroup id="custom stuff">
                                    <TldrawUiMenuItem
                                            id="about"
                                            label="Like my posts"
                                            icon="external-link"
                                            readonlyOk
                                            onSelect={() => {
                                                    window.open('https://x.com/tldraw', '_blank')
                                            }}
                                    />
                            </TldrawUiMenuGroup>
                    </>
            )
    }
    
    const components: TLComponents = {
            HelpMenuContent: CustomHelpMenuContent,
    }
    
    export default function CustomHelpMenuContentExample() {
            return (
                    <div className="tldraw__editor">
                            <Tldraw components={components} />
                    </div>
            )
    }
    ```
    
    We use a `components` prop with the combined editor and ui components.
    
    - [ ] Create a "layout" component?
    - [ ] Make UI components more isolated? If possible, they shouldn't
    depend on styles outside of themselves, so that they can be used in
    other layouts. Maybe we wait on this because I'm feeling a slippery
    slope toward presumptions about configurability.
    - [ ] OTOH maybe we go hard and consider these things as separate
    components, even packages, with their own interfaces for customizability
    / configurability, just go all the way with it, and see what that looks
    like.
    
    # Pros
    
    Top line: you can customize tldraw's user interface in a MUCH more
    granular / powerful way than before.
    
    It solves a case where menu items could not be made stateful from
    outside of the editor context, and provides the option to do things in
    the menus that we couldn't allow previously with the "schema-based"
    approach.
    
    It also may (who knows) be more performant because we can locate the
    state inside of the components for individual buttons and groups,
    instead of all at the top level above the "schema". Because items /
    groups decide their own state, we don't have to have big checks on how
    many items are selected, or whether we have a flippable state. Items and
    groups themselves are allowed to re-build as part of the regular React
    lifecycle. Menus aren't constantly being rebuilt, if that were ever an
    issue.
    
    Menu items can be shared between different menu types. We'll are
    sometimes able to re-use items between, for example, the menu and the
    context menu and the actions menu.
    
    Our overrides no longer mutate anything, so there's less weird searching
    and finding.
    
    # Cons
    
    This approach can make customization menu contents significantly more
    complex, as an end user would need to re-declare most of a menu in order
    to make any change to it. Luckily a user can add things to the top or
    bottom of the context menu fairly easily. (And who knows, folks may
    actually want to do deep customization, and this allows for it.)
    
    It's more code. We are shipping more react components, basically one for
    each menu item / group.
    
    Currently this PR does not export the subcomponents, i.e. menu items. If
    we do want to export these, then heaven help us, it's going to be a
    _lot_ of exports.
    
    # Progress
    
    - [x] Context menu
    - [x] Main menu
    - [x] Zoom menu
    - [x] Help menu
    - [x] Actions menu
    - [x] Keyboard shortcuts menu
    - [x] Quick actions in main menu? (new)
    - [x] Helper buttons? (new)
    - [x] Debug Menu
    
    And potentially
    - [x] Toolbar
    - [x] Style menu
    - [ ] Share zone
    - [x] Navigation zone
    - [ ] Other zones
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    
    ### Test Plan
    
    1. use the context menu
    2. use the custom context menu example
    3. use cursor chat in the context menu
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Add a brief release note for your PR here.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index ac99b948c..80274c553 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -41,7 +41,6 @@ export {
 	type TLErrorBoundaryProps,
 } from './lib/components/ErrorBoundary'
 export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
-export { PositionedOnCanvas } from './lib/components/PositionedOnCanvas'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
 export { ShapeIndicator, type TLShapeIndicatorComponent } from './lib/components/ShapeIndicator'
 export {

commit 77865d9f5ef82eca1c3d236542460408f47161f9
Author: alex <alex@dytry.ch>
Date:   Thu Feb 15 15:10:04 2024 +0000

    [Snapping 3/5] Custom snapping API (#2793)
    
    This diff adds an API for customising our existing snap types. These
    are:
    1. Bound snapping. When translating or resizing a shape, it'll snap to
    certain key points on the bounds of particular shapes. Previously, these
    were hard-coded to the corners and center of the bounding box of the
    shape. Now, a shape can bring its own (e.g. a triangle may add snapping
    for its 3 corners, and it's centroid rather than bounding box center.
    2. Handle outline snapping. When dragging a handle, it'll snap to the
    outline of other shapes geometry. Now, shapes can return different
    geometry for this sort of snapping if they like.
    
    Each of these is customised through a method on `ShapeUtil`:
    `getBoundsSnapGeometry` and `getHandleSnapGeometry`. These return
    interfaces describing the different geometry that can be snapped to in
    both these cases. Currently, each returns an object with a single
    property, but there are more types of snapping coming in follow-up PRs.
    When reviewing this PR, start with the definitions of
    `BoundsSnapGeometry` in `BoundsSnaps.ts` and `HandleSnapGeometry` in
    `HandleSnaps.ts`
    
    This doesn't add point snapping - i'll add that in a follow-up! It'll be
    customisable with the `getHandleSnapGeometry` API.
    
    Fixes TLD-2197
    
    This PR is part of a series - please don't merge it until the things
    before it have landed!
    1. #2827
    4. #2831
    5. #2793 (you are here)
    6. #2841
    7. #2845
    
    ### Change Type
    
    - [x] `minor` â€” New feature
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version
    
    ### Test Plan
    
    - [x] Unit Tests
    
    ### Release Notes
    
    - Add `ShapeUtil.getSnapInfo` for customising shape snaps.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 80274c553..ac156870b 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -154,7 +154,11 @@ export type {
 	TLBeforeCreateHandler,
 	TLBeforeDeleteHandler,
 } from './lib/editor/managers/SideEffectManager'
-export { type BoundsSnapPoint } from './lib/editor/managers/SnapManager/BoundsSnaps'
+export {
+	type BoundsSnapGeometry,
+	type BoundsSnapPoint,
+} from './lib/editor/managers/SnapManager/BoundsSnaps'
+export { type HandleSnapGeometry } from './lib/editor/managers/SnapManager/HandleSnaps'
 export {
 	SnapManager,
 	type GapsSnapIndicator,

commit 212eb88480bd66b5b2930768e1594f814b8da150
Author: Lu Wilson <l2wilson94@gmail.com>
Date:   Fri Feb 16 13:54:48 2024 +0000

    Add component for viewing an image of a snapshot  (#2804)
    
    This PR adds the `TldrawImage` component that displays a tldraw snapshot
    as an SVG image.
    
    ![2024-02-15 at 12 29 52 - Coral
    Cod](https://github.com/tldraw/tldraw/assets/15892272/14140e9e-7d6d-4dd3-88a3-86a6786325c5)
    
    ## Why
    
    We've seen requests for this kind of thing from users. eg: GitBook, and
    on discord:
    
    <img width="710" alt="image"
    src="https://github.com/tldraw/tldraw/assets/15892272/3d3a3e9d-66b9-42e7-81de-a70aa7165bdc">
    
    The component provides a way to do that.
    This PR also untangles various bits of editor state from image
    exporting, which makes it easier for library users to export images more
    agnostically. (ie: they can now export any shapes on any page in any
    theme. previously, they had to change the user's state to do that).
    
    ## What else
    
    - This PR also adds an **Image snapshot** example to demonstrate the new
    component.
    - We now pass an `isDarkMode` property to the `toSvg` method (inside the
    `ctx` argument). This means that `toSvg` doesn't have to rely on editor
    state anymore. I updated all our `toSvg` methods to use it.
    - See code comments for more info.
    
    ## Any issues?
    
    When you toggle to editing mode in the new example, text measurements
    are initially wrong (until you edit the size of a text shape). Click on
    the text shape to see how its indicator is wrong. Not sure why this is,
    or if it's even related. Does it ring a bell with anyone? If not, I'll
    take a closer look. (fixed, see comments --steve)
    
    ## Future work
    
    Now that we've untangled image exporting from editor state, we could
    expose some more helpful helpers for making this easier.
    
    Fixes tld-2122
    
    ### Change Type
    
    - [x] `minor` â€” New feature
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version
    
    ### Test Plan
    
    1. Open the **Image snapshot** example.
    2. Try editing the image, saving the image, and making sure the image
    updates.
    
    - [ ] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Dev: Added the `TldrawImage` component.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index ac156870b..0f66a4ad7 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -253,9 +253,9 @@ export {
 } from './lib/editor/types/history-types'
 export { type RequiredKeys, type TLSvgOptions } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
-export { useContainer } from './lib/hooks/useContainer'
+export { ContainerProvider, useContainer } from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'
-export { useEditor } from './lib/hooks/useEditor'
+export { EditorContext, useEditor } from './lib/hooks/useEditor'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
 export { useShallowArrayIdentity, useShallowObjectIdentity } from './lib/hooks/useIdentity'
 export { useIsCropping } from './lib/hooks/useIsCropping'

commit 9fc5f4459f674b121cc177f8ae99efa9fdb442c8
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Feb 19 14:52:43 2024 +0000

    Roundup fixes (#2862)
    
    This one is a roundup of superficial changes, apologies for having them
    in a single PR.
    
    This PR:
    - does some chair re-arranging for one of our hotter paths related to
    updating shapes
    - changes our type exports for editor components
    - adds shape indicator to editor components
    - moves canvas to be an editor component
    - fixes a CSS bug with hinted buttons
    - fixes CSS bugs with the menus
    - fixes bad imports in examples
    
    ### Change Type
    
    - [x] `major`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 0f66a4ad7..341f412b3 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -34,7 +34,6 @@ export {
 	type TldrawEditorBaseProps,
 	type TldrawEditorProps,
 } from './lib/TldrawEditor'
-export { Canvas } from './lib/components/Canvas'
 export {
 	ErrorBoundary,
 	OptionalErrorBoundary,
@@ -42,63 +41,53 @@ export {
 } from './lib/components/ErrorBoundary'
 export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
-export { ShapeIndicator, type TLShapeIndicatorComponent } from './lib/components/ShapeIndicator'
-export {
-	DefaultBackground,
-	type TLBackgroundComponent,
-} from './lib/components/default-components/DefaultBackground'
-export {
-	DefaultBrush,
-	type TLBrushComponent,
-} from './lib/components/default-components/DefaultBrush'
+export { DefaultBackground } from './lib/components/default-components/DefaultBackground'
+export { DefaultBrush, type TLBrushProps } from './lib/components/default-components/DefaultBrush'
+export { DefaultCanvas } from './lib/components/default-components/DefaultCanvas'
 export {
 	DefaultCollaboratorHint,
-	type TLCollaboratorHintComponent,
+	type TLCollaboratorHintProps,
 } from './lib/components/default-components/DefaultCollaboratorHint'
 export {
 	DefaultCursor,
-	type TLCursorComponent,
+	type TLCursorProps,
 } from './lib/components/default-components/DefaultCursor'
 export { DefaultErrorFallback } from './lib/components/default-components/DefaultErrorFallback'
-export { DefaultGrid, type TLGridComponent } from './lib/components/default-components/DefaultGrid'
+export { DefaultGrid, type TLGridProps } from './lib/components/default-components/DefaultGrid'
 export {
 	DefaultHandle,
-	type TLHandleComponent,
+	type TLHandleProps,
 } from './lib/components/default-components/DefaultHandle'
 export {
 	DefaultHandles,
-	type TLHandlesComponent,
+	type TLHandlesProps,
 } from './lib/components/default-components/DefaultHandles'
 export {
 	DefaultHoveredShapeIndicator,
-	type TLHoveredShapeIndicatorComponent,
+	type TLHoveredShapeIndicatorProps,
 } from './lib/components/default-components/DefaultHoveredShapeIndicator'
-export { type TLInFrontOfTheCanvas } from './lib/components/default-components/DefaultInFrontOfTheCanvas'
-export { type TLOnTheCanvas } from './lib/components/default-components/DefaultOnTheCanvas'
 export {
 	DefaultScribble,
-	type TLScribbleComponent,
+	type TLScribbleProps,
 } from './lib/components/default-components/DefaultScribble'
 export {
 	DefaultSelectionBackground,
-	type TLSelectionBackgroundComponent,
+	type TLSelectionBackgroundProps,
 } from './lib/components/default-components/DefaultSelectionBackground'
 export {
 	DefaultSelectionForeground,
-	type TLSelectionForegroundComponent,
+	type TLSelectionForegroundProps,
 } from './lib/components/default-components/DefaultSelectionForeground'
+export {
+	DefaultShapeIndicator,
+	type TLShapeIndicatorProps,
+} from './lib/components/default-components/DefaultShapeIndicator'
 export {
 	DefaultSnapIndicator,
-	type TLSnapIndicatorComponent,
+	type TLSnapIndicatorProps,
 } from './lib/components/default-components/DefaultSnapIndictor'
-export {
-	DefaultSpinner,
-	type TLSpinnerComponent,
-} from './lib/components/default-components/DefaultSpinner'
-export {
-	DefaultSvgDefs,
-	type TLSvgDefsComponent,
-} from './lib/components/default-components/DefaultSvgDefs'
+export { DefaultSpinner } from './lib/components/default-components/DefaultSpinner'
+export { DefaultSvgDefs } from './lib/components/default-components/DefaultSvgDefs'
 export {
 	TAB_ID,
 	createSessionStateSnapshotSignal,
@@ -256,6 +245,7 @@ export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/
 export { ContainerProvider, useContainer } from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'
 export { EditorContext, useEditor } from './lib/hooks/useEditor'
+export { useEditorComponents } from './lib/hooks/useEditorComponents'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
 export { useShallowArrayIdentity, useShallowObjectIdentity } from './lib/hooks/useIdentity'
 export { useIsCropping } from './lib/hooks/useIsCropping'

commit 0f1599d5b338bc0f896ed319ab52e9eee42f2661
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Feb 23 17:36:27 2024 +0000

    [fix] Corejs imports (#2940)
    
    This PR fixes a bug with corejs imports. See
    https://github.com/tldraw/tldraw/issues/1947
    
    ### Change Type
    
    - [x] `patch` â€” Bug fix
    
    ### Release Notes
    
    - Fixes a bug effecting some users related to corejs imports.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 341f412b3..a273b3a73 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -363,8 +363,8 @@ export { openWindow } from './lib/utils/window-open'
 
 /** @polyfills */
 
-import 'core-js/stable/array/at'
-import 'core-js/stable/array/flat'
-import 'core-js/stable/array/flat-map'
-import 'core-js/stable/string/at'
-import 'core-js/stable/string/replace-all'
+import 'core-js/stable/array/at.js'
+import 'core-js/stable/array/flat-map.js'
+import 'core-js/stable/array/flat.js'
+import 'core-js/stable/string/at.js'
+import 'core-js/stable/string/replace-all.js'

commit adebb680e5ebe913b3e8a40e3a796d57b9ffd799
Author: alex <alex@dytry.ch>
Date:   Tue Mar 12 16:14:28 2024 +0000

    Component-based toolbar customisation API (#3067)
    
    When we went from overrides-based to component based UI customisation
    APIs, we didn't do the toolbar because it had some significant extra
    complexity around overflowing the contents of the menu into the
    dropdown. This is really hard to do at render-time with react - you
    can't introspect what a component will return to move some of it into an
    overflow.
    
    Instead, this diff runs that logic in a `useLayoutEffect` - we render
    all the items into both the main toolbar and the overflow menu, then in
    the effect (or if the rendered components change) we use CSS to remove
    the items we don't need, check which was last active, etc. Originally, I
    wasn't really into this approach - but i've actually found it to work
    super well and be very reliable.
    
    ### Change Type
    
    - [x] `major` â€” Breaking change
    - [ ] `dependencies` â€” Changes to package dependencies[^1]
    - [ ] `documentation` â€” Changes to the documentation only[^2]
    - [ ] `tests` â€” Changes to any test code only[^2]
    - [ ] `internal` â€” Any other changes that don't affect the published
    package[^2]
    - [ ] I don't know
    
    [^1]: publishes a `patch` release, for devDependencies use `internal`
    [^2]: will not publish a new version
    
    ### Test Plan
    
    1. Test the toolbar at many different sizes with many different 'active
    tools'
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index a273b3a73..b9650e506 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -247,6 +247,7 @@ export { getCursor } from './lib/hooks/useCursor'
 export { EditorContext, useEditor } from './lib/hooks/useEditor'
 export { useEditorComponents } from './lib/hooks/useEditorComponents'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
+export { useEvent } from './lib/hooks/useEvent'
 export { useShallowArrayIdentity, useShallowObjectIdentity } from './lib/hooks/useIdentity'
 export { useIsCropping } from './lib/hooks/useIsCropping'
 export { useIsDarkMode } from './lib/hooks/useIsDarkMode'
@@ -254,6 +255,7 @@ export { useIsEditing } from './lib/hooks/useIsEditing'
 export { useLocalStore } from './lib/hooks/useLocalStore'
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
+export { useSafeId } from './lib/hooks/useSafeId'
 export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLStore } from './lib/hooks/useTLStore'
 export { useTransform } from './lib/hooks/useTransform'

commit b9b5bd5b81ef3fb1b6072b32e3a82b027f27d5c6
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Mar 18 14:33:36 2024 +0000

    [fix] Batch tick events (#3181)
    
    This PR fixes an issue where events happening on tick were not batched.
    
    ![Kapture 2024-03-17 at 22 49
    52](https://github.com/tldraw/tldraw/assets/23072548/2bcfa335-a38f-46c4-a3f3-434cac61b6ce)
    
    We were listening to the `tick` event directly from the state node,
    rather than passing the event into the state chart at the top. This
    meant that it was bypassing the regular state chart rules, which was
    what got me looking at this; but then I noticed that we also weren't
    batching the changes, either. This causes computed stuff to re-compute
    after each atom is updated within the `onTick` handler, which can be a
    LOT.
    
    Before:
    <img width="1557" alt="image"
    src="https://github.com/tldraw/tldraw/assets/23072548/ba8791f2-faec-463d-945a-9f5920826aab">
    
    After:
    <img width="1204" alt="image"
    src="https://github.com/tldraw/tldraw/assets/23072548/a00f8e4a-caca-406a-89a2-8cff0e01b642">
    
    It's not game breaking but it's important enough to hotfix at least in
    the dot com.
    
    ### Change Type
    
    <!-- â— Please select a 'Scope' label â—ï¸ -->
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [ ] `dotcom` â€” Changes the tldraw.com web app
    - [ ] `docs` â€” Changes to the documentation, examples, or templates.
    - [ ] `vs code` â€” Changes to the vscode plugin
    - [ ] `internal` â€” Does not affect user-facing stuff
    
    <!-- â— Please select a 'Type' label â—ï¸ -->
    
    - [x] `bugfix` â€” Bug fix
    - [ ] `feature` â€” New feature
    - [ ] `improvement` â€” Improving existing features
    - [ ] `chore` â€” Updating dependencies, other boring stuff
    - [ ] `galaxy brain` â€” Architectural changes
    - [ ] `tests` â€” Changes to any test code
    - [ ] `tools` â€” Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` â€” I don't know
    
    
    ### Test Plan
    
    1. Select many shapes.
    2. Resize them.
    
    ### Release Notes
    
    - Fix a performance issue effecting resizing multiple shapes.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index b9650e506..8f7f42c9f 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -223,7 +223,6 @@ export {
 	type TLPointerEventName,
 	type TLPointerEventTarget,
 	type TLTickEvent,
-	type TLTickEventHandler,
 	type TLWheelEvent,
 	type TLWheelEventInfo,
 	type UiEvent,

commit 05f58f7c2a16ba3860471f8188beba930567c818
Author: alex <alex@dytry.ch>
Date:   Mon Mar 25 14:16:55 2024 +0000

    React-powered SVG exports (#3117)
    
    ## Migration path
    1. If any of your shapes implement `toSvg` for exports, you'll need to
    replace your implementation with a new version that returns JSX (it's a
    react component) instead of manually constructing SVG DOM nodes
    2. `editor.getSvg` is deprecated. It still works, but will be going away
    in a future release. If you still need SVGs as DOM elements rather than
    strings, use `new DOMParser().parseFromString(svgString,
    'image/svg+xml').firstElementChild`
    
    ## The change in detail
    At the moment, our SVG exports very carefully try to recreate the
    visuals of our shapes by manually constructing SVG DOM nodes. On its own
    this is really painful, but it also results in a lot of duplicated logic
    between the `component` and `getSvg` methods of shape utils.
    
    In #3020, we looked at using string concatenation & DOMParser to make
    this a bit less painful. This works, but requires specifying namespaces
    everywhere, is still pretty painful (no syntax highlighting or
    formatting), and still results in all that duplicated logic.
    
    I briefly experimented with creating my own version of the javascript
    language that let you embed XML like syntax directly. I was going to
    call it EXTREME JAVASCRIPT or XJS for short, but then I noticed that we
    already wrote the whole of tldraw in this thing called react and a (imo
    much worse named) version of the javascript xml thing already existed.
    
    Given the entire library already depends on react, what would it look
    like if we just used react directly for these exports? Turns out things
    get a lot simpler! Take a look at lmk what you think
    
    This diff was intended as a proof of concept, but is actually pretty
    close to being landable. The main thing is that here, I've deliberately
    leant into this being a big breaking change to see just how much code we
    could delete (turns out: lots). We could if we wanted to make this
    without making it a breaking change at all, but it would add back a lot
    of complexity on our side and run a fair bit slower
    
    ---------
    
    Co-authored-by: huppy-bot[bot] <128400622+huppy-bot[bot]@users.noreply.github.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 8f7f42c9f..a8acb06ce 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -192,7 +192,11 @@ export { getArrowTerminalsInArrowSpace } from './lib/editor/shapes/shared/arrow/
 export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'
-export { type SvgExportContext, type SvgExportDef } from './lib/editor/types/SvgExportContext'
+export {
+	useSvgExportContext,
+	type SvgExportContext,
+	type SvgExportDef,
+} from './lib/editor/types/SvgExportContext'
 export { type TLContent } from './lib/editor/types/clipboard-types'
 export { type TLEventMap, type TLEventMapHandler } from './lib/editor/types/emit-types'
 export {

commit 3593799d9ec251ec59d16864633881ae61b2558d
Author: alex <alex@dytry.ch>
Date:   Tue Mar 26 18:38:19 2024 +0000

    side effects reference docs & examples (#3258)
    
    Adds reference docs, guide in the "Editor" article, and examples for the
    side effects manager.
    
    There are 4 new examples:
    1. Before create/update shape - constrains shapes to be places within a
    circle
    2. Before delete shape - prevent red shapes from being deleted
    3. After create/update shape - make sure there's only ever one red shape
    on the page at a time
    4. After delete shape - delete frames after their last child is deleted
    
    As these examples all require fairly specific configurations of shapes
    (or are hard to understand without some visual hinting in the case of
    placing shapes within a circle), I've included a `createDemoShapes`
    function in each of these which makes sure the examples start with
    shapes that will quickly show you the side effects in action. I've kept
    these separate from the main code (in a function at the bottom), so
    hopefully that won't be a source of confusion to anyone working from
    these examples.
    
    
    ### Change Type
    - [x] `docs` â€” Changes to the documentation, examples, or templates.
    - [x] `improvement` â€” Improving existing features

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index a8acb06ce..51b62ba6c 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -135,6 +135,7 @@ export {
 	type TLResizeShapeOptions,
 } from './lib/editor/Editor'
 export type {
+	SideEffectManager,
 	TLAfterChangeHandler,
 	TLAfterCreateHandler,
 	TLAfterDeleteHandler,

commit 3ceebc82f8adeba922f2feafbd38e5eed2822445
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sat Apr 13 14:30:30 2024 +0100

    Faster selection / erasing (#3454)
    
    This PR makes a small improvement to the way we measure distances.
    (Often we measure distances multiple times per frame per shape on the
    screen). In many cases, we compare a minimum distance. This makes those
    checks faster by avoiding a square root.
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `improvement` â€” Improving existing features
    
    ### Release Notes
    
    - Improve performance of minimum distance checks.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 51b62ba6c..b639db49a 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -62,10 +62,6 @@ export {
 	DefaultHandles,
 	type TLHandlesProps,
 } from './lib/components/default-components/DefaultHandles'
-export {
-	DefaultHoveredShapeIndicator,
-	type TLHoveredShapeIndicatorProps,
-} from './lib/components/default-components/DefaultHoveredShapeIndicator'
 export {
 	DefaultScribble,
 	type TLScribbleProps,

commit 41601ac61ec7d4fad715bd67a9df077ee1576a7b
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sun Apr 14 19:40:02 2024 +0100

    Stickies: release candidate (#3249)
    
    This PR is the target for the stickies PRs that are moving forward. It
    should collect changes.
    
    - [x] New icon
    - [x] Improved shadows
    - [x] Shadow LOD
    - [x] New colors / theme options
    - [x] Shrink text size to avoid word breaks on the x axis
    - [x] Hide indicator whilst typing (reverted)
    - [x] Adjacent note positions
      - [x] buttons / clone handles
      - [x] position helpers for creating / translating (pits)
    - [x] keyboard shortcuts: (Tab, Shift+tab (RTL aware), Cmd-Enter,
    Shift+Cmd+enter)
      - [x] multiple shape translating
    - [x] Text editing
      - [x] Edit on type (feature flagged)
      - [x] click goes in correct place
    - [x] Notes as parents (reverted)
    - [x] Update colors
    - [x] Update SVG appearance
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `feature` â€” New feature
    
    ### Test Plan
    
    Todo: fold in test plans for child PRs
    
    ### Unit tests:
    
    - [ ] Shrink text size to avoid word breaks on the x axis
    - [x] Adjacent notes
      - [x] buttons (clone handles)
      - [x] position helpers (pits)
    - [x] keyboard shortcuts: (Tab, Shift+tab (RTL aware), Cmd-Enter,
    Shift+Cmd+enter)
    - [ ] Text editing
      - [ ] Edit on type
      - [ ] click goes in correct place
    
    ### Release Notes
    
    - Improves sticky notes (see list)
    
    ---------
    
    Signed-off-by: dependabot[bot] <support@github.com>
    Co-authored-by: Mime ÄŒuvalo <mimecuvalo@gmail.com>
    Co-authored-by: alex <alex@dytry.ch>
    Co-authored-by: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>
    Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
    Co-authored-by: github-actions[bot] <github-actions[bot]@users.noreply.github.com>
    Co-authored-by: Lu[ke] Wilson <l2wilson94@gmail.com>
    Co-authored-by: huppy-bot[bot] <128400622+huppy-bot[bot]@users.noreply.github.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index b639db49a..4577b1395 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -121,6 +121,7 @@ export {
 	MAX_ZOOM,
 	MIN_ZOOM,
 	MULTI_CLICK_DURATION,
+	SIDES,
 	SVG_PADDING,
 	ZOOMS,
 } from './lib/constants'
@@ -296,6 +297,7 @@ export {
 	intersectPolygonBounds,
 	intersectPolygonPolygon,
 	linesIntersect,
+	polygonIntersectsPolyline,
 	polygonsIntersect,
 } from './lib/primitives/intersect'
 export {

commit 8151e6f586149e4447149d25bd70868a5a4e8838
Author: alex <alex@dytry.ch>
Date:   Wed Apr 24 19:26:10 2024 +0100

    Automatic undo/redo (#3364)
    
    Our undo-redo system before this diff is based on commands. A command
    is:
    - A function that produces some data required to perform and undo a
    change
    - A function that actually performs the change, based on the data
    - Another function that undoes the change, based on the data
    - Optionally, a function to _redo_ the change, although in practice we
    never use this
    
    Each command that gets run is added to the undo/redo stack unless it
    says it shouldn't be.
    
    This diff replaces this system of commands with a new one where all
    changes to the store are automatically recorded in the undo/redo stack.
    You can imagine the new history manager like a tape recorder - it
    automatically records everything that happens to the store in a special
    diff, unless you "pause" the recording and ask it not to. Undo and redo
    rewind/fast-forward the tape to certain marks.
    
    As the command concept is gone, the things that were commands are now
    just functions that manipulate the store.
    
    One other change here is that the store's after-phase callbacks (and the
    after-phase side-effects as a result) are now batched up and called at
    the end of certain key operations. For example, `applyDiff` would
    previously call all the `afterCreate` callbacks before making any
    removals from the diff. Now, it (and anything else that uses
    `store.atomic(fn)` will defer firing any after callbacks until the end
    of an operation. before callbacks are still called part-way through
    operations.
    
    ## Design options
    Automatic recording is a fairly large big semantic change, particularly
    to the standalone `store.put`/`store.remove` etc. commands. We could
    instead make not-recording the default, and make recording opt-in
    instead. However, I think auto-record-by-default is the right choice for
    a few reasons:
    
    1. Switching to a recording-based vs command-based undo-redo model is
    fundamentally a big semantic change. In the past, `store.put` etc. were
    always ignored. Now, regardless of whether we choose record-by-default
    or ignore-by-default, the behaviour of `store.put` is _context_
    dependant.
    2. Switching to ignore-by-default means that either our commands don't
    record undo/redo history any more (unless wrapped in
    `editor.history.record`, a far larger semantic change) or they have to
    always-record/all accept a history options bag. If we choose
    always-record, we can't use commands within `history.ignore` as they'll
    start recording again. If we choose the history options bag, we have to
    accept those options in 10s of methods - basically the entire `Editor`
    api surface.
    
    Overall, given that some breaking semantic change here is unavoidable, I
    think that record-by-default hits the right balance of tradeoffs. I
    think it's a better API going forward, whilst also not being too
    disruptive as the APIs it affects are very "deep" ones that we don't
    typically encourage people to use.
    
    
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `improvement` â€” Improving existing features
    - [x] `galaxy brain` â€” Architectural changes
    
    ### Release Note
    #### Breaking changes
    ##### 1. History Options
    Previously, some (not all!) commands accepted a history options object
    with `squashing`, `ephemeral`, and `preserveRedoStack` flags. Squashing
    enabled/disabled a memory optimisation (storing individual commands vs
    squashing them together). Ephemeral stopped a command from affecting the
    undo/redo stack at all. Preserve redo stack stopped commands from wiping
    the redo stack. These flags were never available consistently - some
    commands had them and others didn't.
    
    In this version, most of these flags have been removed. `squashing` is
    gone entirely (everything squashes & does so much faster than before).
    There were a couple of commands that had a special default - for
    example, `updateInstanceState` used to default to being `ephemeral`.
    Those maintain the defaults, but the options look a little different now
    - `{ephemeral: true}` is now `{history: 'ignore'}` and
    `{preserveRedoStack: true}` is now `{history:
    'record-preserveRedoStack'}`.
    
    If you were previously using these options in places where they've now
    been removed, you can use wrap them with `editor.history.ignore(fn)` or
    `editor.history.batch(fn, {history: 'record-preserveRedoStack'})`. For
    example,
    ```ts
    editor.nudgeShapes(..., { ephemeral: true })
    ```
    can now be written as
    ```ts
    editor.history.ignore(() => {
        editor.nudgeShapes(...)
    })
    ```
    
    ##### 2. Automatic recording
    Previously, only commands (e.g. `editor.updateShapes` and things that
    use it) were added to the undo/redo stack. Everything else (e.g.
    `editor.store.put`) wasn't. Now, _everything_ that touches the store is
    recorded in the undo/redo stack (unless it's part of
    `mergeRemoteChanges`). You can use `editor.history.ignore(fn)` as above
    if you want to make other changes to the store that aren't recorded -
    this is short for `editor.history.batch(fn, {history: 'ignore'})`
    
    When upgrading to this version of tldraw, you shouldn't need to change
    anything unless you're using `store.put`, `store.remove`, or
    `store.applyDiff` outside of `store.mergeRemoteChanges`. If you are, you
    can preserve the functionality of those not being recorded by wrapping
    them either in `mergeRemoteChanges` (if they're multiplayer-related) or
    `history.ignore` as appropriate.
    
    ##### 3. Side effects
    Before this diff, any changes in side-effects weren't captured by the
    undo-redo stack. This was actually the motivation for this change in the
    first place! But it's a pretty big change, and if you're using side
    effects we recommend you double-check how they interact with undo/redo
    before/after this change. To get the old behaviour back, wrap your side
    effects in `editor.history.ignore`.
    
    ##### 4. Mark options
    Previously, `editor.mark(id)` accepted two additional boolean
    parameters: `onUndo` and `onRedo`. If these were set to false, then when
    undoing or redoing we'd skip over that mark and keep going until we
    found one with those values set to true. We've removed those options -
    if you're using them, let us know and we'll figure out an alternative!

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 4577b1395..d89708f3e 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -17,7 +17,6 @@ export {
 	type Atom,
 	type Signal,
 } from '@tldraw/state'
-export type { TLCommandHistoryOptions } from './lib/editor/types/history-types'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/store'
 // eslint-disable-next-line local/no-export-star
@@ -131,6 +130,7 @@ export {
 	type TLEditorOptions,
 	type TLResizeShapeOptions,
 } from './lib/editor/Editor'
+export { HistoryManager } from './lib/editor/managers/HistoryManager'
 export type {
 	SideEffectManager,
 	TLAfterChangeHandler,
@@ -235,12 +235,6 @@ export {
 	type TLExternalContent,
 	type TLExternalContentSource,
 } from './lib/editor/types/external-content'
-export {
-	type TLCommand,
-	type TLCommandHandler,
-	type TLHistoryEntry,
-	type TLHistoryMark,
-} from './lib/editor/types/history-types'
 export { type RequiredKeys, type TLSvgOptions } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
 export { ContainerProvider, useContainer } from './lib/hooks/useContainer'

commit fabba66c0f4b6c42ece30f409e70eb01e588f8e1
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sat May 4 18:39:04 2024 +0100

    Camera options (#3282)
    
    This PR implements a camera options API.
    
    - [x] Initial PR
    - [x] Updated unit tests
    - [x] Feedback / review
    - [x] New unit tests
    - [x] Update use-case examples
    - [x] Ship?
    
    ## Public API
    
    A user can provide camera options to the `Tldraw` component via the
    `cameraOptions` prop. The prop is also available on the `TldrawEditor`
    component and the constructor parameters of the `Editor` class.
    
    ```tsx
    export default function CameraOptionsExample() {
            return (
                    <div className="tldraw__editor">
                            <Tldraw cameraOptions={CAMERA_OPTIONS} />
                    </div>
            )
    }
    ```
    
    At runtime, a user can:
    -  get the current camera options with `Editor.getCameraOptions`
    -  update the camera options with `Editor.setCameraOptions`
    
    Setting the camera options automatically applies them to the current
    camera.
    
    ```ts
    editor.setCameraOptions({...editor.getCameraOptions(), isLocked: true })
    ```
    
    A user can get the "camera fit zoom" via `editor.getCameraFitZoom()`.
    
    # Interface
    
    The camera options themselves can look a few different ways depending on
    the `type` provided.
    
    
    ```tsx
    export type TLCameraOptions = {
            /** Whether the camera is locked. */
            isLocked: boolean
            /** The speed of a scroll wheel / trackpad pan. Default is 1. */
            panSpeed: number
            /** The speed of a scroll wheel / trackpad zoom. Default is 1. */
            zoomSpeed: number
            /** The steps that a user can zoom between with zoom in / zoom out. The first and last value will determine the min and max zoom. */
            zoomSteps: number[]
            /** Controls whether the wheel pans or zooms.
             *
             * - `zoom`: The wheel will zoom in and out.
             * - `pan`: The wheel will pan the camera.
             * - `none`: The wheel will do nothing.
             */
            wheelBehavior: 'zoom' | 'pan' | 'none'
            /** The camera constraints. */
            constraints?: {
                    /** The bounds (in page space) of the constrained space */
                    bounds: BoxModel
                    /** The padding inside of the viewport (in screen space) */
                    padding: VecLike
                    /** The origin for placement. Used to position the bounds within the viewport when an axis is fixed or contained and zoom is below the axis fit. */
                    origin: VecLike
                    /** The camera's initial zoom, used also when the camera is reset.
                     *
                     * - `default`: Sets the initial zoom to 100%.
                     * - `fit-x`: The x axis will completely fill the viewport bounds.
                     * - `fit-y`: The y axis will completely fill the viewport bounds.
                     * - `fit-min`: The smaller axis will completely fill the viewport bounds.
                     * - `fit-max`: The larger axis will completely fill the viewport bounds.
                     * - `fit-x-100`: The x axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-y-100`: The y axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-min-100`: The smaller axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-max-100`: The larger axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     */
                    initialZoom:
                            | 'fit-min'
                            | 'fit-max'
                            | 'fit-x'
                            | 'fit-y'
                            | 'fit-min-100'
                            | 'fit-max-100'
                            | 'fit-x-100'
                            | 'fit-y-100'
                            | 'default'
                    /** The camera's base for its zoom steps.
                     *
                     * - `default`: Sets the initial zoom to 100%.
                     * - `fit-x`: The x axis will completely fill the viewport bounds.
                     * - `fit-y`: The y axis will completely fill the viewport bounds.
                     * - `fit-min`: The smaller axis will completely fill the viewport bounds.
                     * - `fit-max`: The larger axis will completely fill the viewport bounds.
                     * - `fit-x-100`: The x axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-y-100`: The y axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-min-100`: The smaller axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     * - `fit-max-100`: The larger axis will completely fill the viewport bounds, or 100% zoom, whichever is smaller.
                     */
                    baseZoom:
                            | 'fit-min'
                            | 'fit-max'
                            | 'fit-x'
                            | 'fit-y'
                            | 'fit-min-100'
                            | 'fit-max-100'
                            | 'fit-x-100'
                            | 'fit-y-100'
                            | 'default'
                    /** The behavior for the constraints for both axes or each axis individually.
                     *
                     * - `free`: The bounds are ignored when moving the camera.
                     * - 'fixed': The bounds will be positioned within the viewport based on the origin
                     * - `contain`: The 'fixed' behavior will be used when the zoom is below the zoom level at which the bounds would fill the viewport; and when above this zoom, the bounds will use the 'inside' behavior.
                     * - `inside`: The bounds will stay completely within the viewport.
                     * - `outside`: The bounds will stay touching the viewport.
                     */
                    behavior:
                            | 'free'
                            | 'fixed'
                            | 'inside'
                            | 'outside'
                            | 'contain'
                            | {
                                            x: 'free' | 'fixed' | 'inside' | 'outside' | 'contain'
                                            y: 'free' | 'fixed' | 'inside' | 'outside' | 'contain'
                              }
            }
    }
    ```
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `feature` â€” New feature
    
    ### Test Plan
    
    These features combine in different ways, so we'll want to write some
    more tests to find surprises.
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [ ] Unit Tests
    
    ### Release Notes
    
    - SDK: Adds camera options.
    
    ---------
    
    Co-authored-by: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index d89708f3e..e6090e951 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -110,26 +110,18 @@ export {
 	ANIMATION_SHORT_MS,
 	CAMERA_SLIDE_FRICTION,
 	DEFAULT_ANIMATION_OPTIONS,
+	DEFAULT_CAMERA_OPTIONS,
 	DOUBLE_CLICK_DURATION,
 	DRAG_DISTANCE,
 	GRID_STEPS,
-	HASH_PATTERN_ZOOM_NAMES,
 	HIT_TEST_MARGIN,
 	MAX_PAGES,
 	MAX_SHAPES_PER_PAGE,
-	MAX_ZOOM,
-	MIN_ZOOM,
 	MULTI_CLICK_DURATION,
 	SIDES,
 	SVG_PADDING,
-	ZOOMS,
 } from './lib/constants'
-export {
-	Editor,
-	type TLAnimationOptions,
-	type TLEditorOptions,
-	type TLResizeShapeOptions,
-} from './lib/editor/Editor'
+export { Editor, type TLEditorOptions, type TLResizeShapeOptions } from './lib/editor/Editor'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'
 export type {
 	SideEffectManager,
@@ -235,7 +227,12 @@ export {
 	type TLExternalContent,
 	type TLExternalContentSource,
 } from './lib/editor/types/external-content'
-export { type RequiredKeys, type TLSvgOptions } from './lib/editor/types/misc-types'
+export {
+	type RequiredKeys,
+	type TLCameraMoveOptions,
+	type TLCameraOptions,
+	type TLSvgOptions,
+} from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
 export { ContainerProvider, useContainer } from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'

commit da35f2bd75e43fd48d11a9a74f60ee01c84a41d1
Author: alex <alex@dytry.ch>
Date:   Wed May 8 13:37:31 2024 +0100

    Bindings (#3326)
    
    First draft of the new bindings API. We'll follow this up with some API
    refinements, tests, documentation, and examples.
    
    Bindings are a new record type for establishing relationships between
    two shapes so they can update at the same time.
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `feature` â€” New feature
    
    ### Release Notes
    
    #### Breaking changes
    - The `start` and `end` properties on `TLArrowShape` no longer have
    `type: point | binding`. Instead, they're always a point, which may be
    out of date if a binding exists. To check for & retrieve arrow bindings,
    use `getArrowBindings(editor, shape)` instead.
    - `getArrowTerminalsInArrowSpace` must be passed a `TLArrowBindings` as
    a third argument: `getArrowTerminalsInArrowSpace(editor, shape,
    getArrowBindings(editor, shape))`
    - The following types have been renamed:
        - `ShapeProps` -> `RecordProps`
        - `ShapePropsType` -> `RecordPropsType`
        - `TLShapePropsMigrations` -> `TLPropsMigrations`
        - `SchemaShapeInfo` -> `SchemaPropsInfo`
    
    ---------
    
    Co-authored-by: David Sheldrick <d.j.sheldrick@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index e6090e951..2d7e4f027 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -104,6 +104,7 @@ export {
 	type TLStoreOptions,
 } from './lib/config/createTLStore'
 export { createTLUser } from './lib/config/createTLUser'
+export { type TLAnyBindingUtilConstructor } from './lib/config/defaultBindings'
 export { coreShapes, type TLAnyShapeUtilConstructor } from './lib/config/defaultShapes'
 export {
 	ANIMATION_MEDIUM_MS,
@@ -122,6 +123,15 @@ export {
 	SVG_PADDING,
 } from './lib/constants'
 export { Editor, type TLEditorOptions, type TLResizeShapeOptions } from './lib/editor/Editor'
+export {
+	BindingUtil,
+	type BindingOnChangeOptions,
+	type BindingOnCreateOptions,
+	type BindingOnDeleteOptions,
+	type BindingOnShapeChangeOptions,
+	type BindingOnShapeDeleteOptions,
+	type TLBindingUtilConstructor,
+} from './lib/editor/bindings/BindingUtil'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'
 export type {
 	SideEffectManager,
@@ -178,7 +188,13 @@ export {
 	type TLArrowInfo,
 	type TLArrowPoint,
 } from './lib/editor/shapes/shared/arrow/arrow-types'
-export { getArrowTerminalsInArrowSpace } from './lib/editor/shapes/shared/arrow/shared'
+export {
+	createOrUpdateArrowBinding,
+	getArrowBindings,
+	getArrowTerminalsInArrowSpace,
+	removeArrowBinding,
+	type TLArrowBindings,
+} from './lib/editor/shapes/shared/arrow/shared'
 export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'

commit 91903c97614f3645dcbdcf6986fd5e4ca3dd95dc
Author: alex <alex@dytry.ch>
Date:   Thu May 9 10:48:01 2024 +0100

    Move arrow helpers from editor to tldraw (#3721)
    
    With the new work on bindings, we no longer need to keep any arrows
    stuff hard-coded in `editor`, so let's move it to `tldraw` with the rest
    of the shapes.
    
    Couple other changes as part of this:
    - We had two different types of `WeakMap` backed cache, but we now only
    have one
    - There's a new free-standing version of `createComputedCache` that
    doesn't need access to the editor/store in order to create the cache.
    instead, it returns a `{get(editor, id)}` object and instantiates the
    cache on a per-editor basis for each call.
    - Fixed a bug in `createSelectedComputedCache` where the selector
    derivation would get re-created on every call to `get`
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `improvement` â€” Improving existing features
    
    ### Release Notes
    
    #### Breaking changes
    - `editor.getArrowInfo(shape)` has been replaced with
    `getArrowInfo(editor, shape)`
    - `editor.getArrowsBoundTo(shape)` has been removed. Instead, use
    `editor.getBindingsToShape(shape, 'arrow')` and follow the `fromId` of
    each binding to the corresponding arrow shape
    - These types have moved from `@tldraw/editor` to `tldraw`:
        - `TLArcInfo`
        - `TLArrowInfo`
        - `TLArrowPoint`
    - `WeakMapCache` has been removed

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 2d7e4f027..4ef5a26ea 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -183,18 +183,6 @@ export {
 	type TLShapeUtilFlag,
 } from './lib/editor/shapes/ShapeUtil'
 export { GroupShapeUtil } from './lib/editor/shapes/group/GroupShapeUtil'
-export {
-	type TLArcInfo,
-	type TLArrowInfo,
-	type TLArrowPoint,
-} from './lib/editor/shapes/shared/arrow/arrow-types'
-export {
-	createOrUpdateArrowBinding,
-	getArrowBindings,
-	getArrowTerminalsInArrowSpace,
-	removeArrowBinding,
-	type TLArrowBindings,
-} from './lib/editor/shapes/shared/arrow/shared'
 export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'
@@ -343,7 +331,6 @@ export {
 	SharedStyleMap,
 	type SharedStyle,
 } from './lib/utils/SharedStylesMap'
-export { WeakMapCache } from './lib/utils/WeakMapCache'
 export { dataUrlToFile } from './lib/utils/assets'
 export { debugFlags, featureFlags, type DebugFlag } from './lib/utils/debug-flags'
 export {

commit ab807afda313226953c72bd74a95bb312162b643
Author: alex <alex@dytry.ch>
Date:   Tue May 14 10:42:41 2024 +0100

    Store-level "operation end" event (#3748)
    
    This adds a store-level "operation end" event which fires at the end of
    atomic operations. It includes some other changes too:
    
    - The `SideEffectManager` now lives in & is a property of the store as
    `StoreSideEffects`. One benefit to this is that instead of overriding
    methods on the store to register side effects (meaning the store can
    only ever be used in one place) the store now calls directly into the
    side effect manager, which is responsible for dealing with any other
    callbacks
    - The history manager's "batch complete" event is gone, in favour of
    this new event. We were using the batch complete event for only one
    thing, calling `onChildrenChange` - which meant it wasn't getting called
    for undo/redo events, which aren't part of a batch. `onChildrenChange`
    is now called after each atomic store operation affecting children.
    
    I've also added a rough pin example which shows (kinda messily) how you
    might use the operation complete handler to traverse a graph of bindings
    and resolve constraints between them.
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `feature` â€” New feature
    
    ### Release Notes
    
    #### Breaking changes
    `editor.registerBatchCompleteHandler` has been replaced with
    `editor.registerOperationCompleteHandler`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 4ef5a26ea..87d751ba7 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -133,16 +133,6 @@ export {
 	type TLBindingUtilConstructor,
 } from './lib/editor/bindings/BindingUtil'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'
-export type {
-	SideEffectManager,
-	TLAfterChangeHandler,
-	TLAfterCreateHandler,
-	TLAfterDeleteHandler,
-	TLBatchCompleteHandler,
-	TLBeforeChangeHandler,
-	TLBeforeCreateHandler,
-	TLBeforeDeleteHandler,
-} from './lib/editor/managers/SideEffectManager'
 export {
 	type BoundsSnapGeometry,
 	type BoundsSnapPoint,

commit 48fa9018f42f5193a56d6eb3c04a03f621200082
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Thu May 16 14:48:36 2024 +0100

    [bindings] beforeUnbind/afterUnbind to replace beforeDelete/afterDelete (#3761)
    
    Before this PR the interface for doing cleanup when shapes/bindings were
    deleted was quite footgunny and inexpressive.
    
    We were abusing the shape beforeDelete callbacks to implement
    copy+paste, which doesn't work in situations where cascading deletes are
    required. This caused bugs in both our pin and sticker examples, where
    copy+paste was broken. I noticed the same bug in my experiment with text
    labels, and I think the fact that it took us a while to notice these
    bugs indicates other users are gonna fall prey to the same bugs unless
    we help them out.
    
    One suggestion to fix this was to add `onAfterDelete(From|To)Shape`
    callbacks. The cascading deletes could happen in those, while keeping
    the 'commit changes' kinds of updates in the `before` callbacks and
    theoretically that would fix the issues with copy+paste. However,
    expecting people to figure this out on their own is asking a heckuva lot
    IMO, and it's a heavy bit of nuance to try to convey in the docs. It's
    hard enough to convey it here. Plus I could imagine for some users it
    might easily even leave the store in an inconsistent state to allow a
    bound shape to exist for any length of time after the shape it was bound
    to was already deleted.
    
    It also just makes an already large and muddy API surface area even
    larger and muddier and if that can be avoided let's avoid it.
    
    This PR clears things up by making it so that there's only one callback
    for when a binding is removed. The callback is given a `reason` for why
    it is being called
    
    The `reason` is one of the following:
    
    - The 'from' is being deleted
    - The 'to' shape is being deleted
    - The binding is being deleted on it's own.
    
    Technically a binding might end up being deleted when both the `from`
    and `to` shapes are being deleted, but it's very hard to know for
    certain when that is happening, so I decided to just ignore it for now.
    I think it would only matter for perf reasons, to avoid doing useless
    work.
    
    So this PR replaces the `onBeforeDelete`, `onAfterDelete`,
    `onBeforeFromShapeDelete` and `onBeforeToShapeDelete` (and the
    prospective `onAfterFromShapeDelete` and `onAfterToShapeDelete`) with
    just two callbacks:
    
    - `onBeforeUnbind({binding, reason})` - called before any shapes or the
    binding have been deleted.
    - `onAfterUnbind({binding, reason})` - called after the binding and any
    shapes have been deleted.
    
    This still allows all the same behaviour as before, without having to
    spread the logic between multiple callbacks. It's also just clearer IMO
    since you only get one callback invocation per unbinding rather than
    potentially two. It also fixes our copy+paste footgun since we can now
    implement that by just deleting the bindings rather than invoking the
    `onBeforeDelete(From|To)Shape` callbacks.
    
    I'm not worried about losing the explicit before/after delete callbacks
    for the binding record or shape records because sdk users still have the
    ability to detect all those situations with full nuance in obvious ways.
    The one thing that would even require extra bookkeeping is getting
    access to a shape record after the shape was deleted, but that's
    probably not a thing anybody would want to do ðŸ¤·ðŸ¼
    
    ### Change Type
    
    <!-- â— Please select a 'Scope' label â—ï¸ -->
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [ ] `dotcom` â€” Changes the tldraw.com web app
    - [ ] `docs` â€” Changes to the documentation, examples, or templates.
    - [ ] `vs code` â€” Changes to the vscode plugin
    - [ ] `internal` â€” Does not affect user-facing stuff
    
    <!-- â— Please select a 'Type' label â—ï¸ -->
    
    - [ ] `bugfix` â€” Bug fix
    - [ ] `feature` â€” New feature
    - [x] `improvement` â€” Improving existing features
    - [ ] `chore` â€” Updating dependencies, other boring stuff
    - [ ] `galaxy brain` â€” Architectural changes
    - [ ] `tests` â€” Changes to any test code
    - [ ] `tools` â€” Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` â€” I don't know
    
    
    ### Test Plan
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [ ] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Add a brief release note for your PR here.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 87d751ba7..28fd807d2 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -124,12 +124,12 @@ export {
 } from './lib/constants'
 export { Editor, type TLEditorOptions, type TLResizeShapeOptions } from './lib/editor/Editor'
 export {
+	BindingUnbindReason,
 	BindingUtil,
 	type BindingOnChangeOptions,
 	type BindingOnCreateOptions,
-	type BindingOnDeleteOptions,
 	type BindingOnShapeChangeOptions,
-	type BindingOnShapeDeleteOptions,
+	type BindingOnUnbindOptions,
 	type TLBindingUtilConstructor,
 } from './lib/editor/bindings/BindingUtil'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'

commit f9ed1bf2c9480b1c49f591a8609adfb4fcf91eae
Author: alex <alex@dytry.ch>
Date:   Wed May 22 16:55:49 2024 +0100

    Force `interface` instead of `type` for better docs (#3815)
    
    Typescript's type aliases (`type X = thing`) can refer to basically
    anything, which makes it hard to write an automatic document formatter
    for them. Interfaces on the other hand are only object, so they play
    much nicer with docs. Currently, object-flavoured type aliases don't
    really get expanded at all on our docs site, which means we have a bunch
    of docs content that's not shown on the site.
    
    This diff introduces a lint rule that forces `interface X {foo: bar}`s
    instead of `type X = {foo: bar}` where possible, as it results in a much
    better documentation experience:
    
    Before:
    <img width="437" alt="Screenshot 2024-05-22 at 15 24 13"
    src="https://github.com/tldraw/tldraw/assets/1489520/32606fd1-6832-4a1e-aa5f-f0534d160c92">
    
    After:
    <img width="431" alt="Screenshot 2024-05-22 at 15 33 01"
    src="https://github.com/tldraw/tldraw/assets/1489520/4e0d59ee-c38e-4056-b9fd-6a7f15d28f0f">
    
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `docs` â€” Changes to the documentation, examples, or templates.
    - [x] `improvement` â€” Improving existing features

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 28fd807d2..69af60962 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -223,6 +223,7 @@ export {
 } from './lib/editor/types/external-content'
 export {
 	type RequiredKeys,
+	type TLCameraConstraints,
 	type TLCameraMoveOptions,
 	type TLCameraOptions,
 	type TLSvgOptions,

commit 87e3d60c9008e91dec81297f327fa5c6a8b76c6f
Author: alex <alex@dytry.ch>
Date:   Thu May 23 14:32:02 2024 +0100

    rework canBind callback (#3797)
    
    This PR reworks the `canBind` callback to work with customizable
    bindings. It now accepts an object with a the shape, the other shape
    (optional - it may not exist yet), the direction, and the type of the
    binding. Devs can use this to create shapes that only participate in
    certain binding types, can have bindings from but not to them, etc.
    
    If you're implementing a binding, you can see if binding two shapes is
    allowed using `editor.canBindShapes(fromShape, toShape, 'my binding
    type')`
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `improvement` â€” Improving existing features
    
    ### Release Notes
    
    #### Breaking changes
    The `canBind` flag now accepts an options object instead of just the
    shape in question. If you're relying on its arguments, you need to
    change from `canBind(shape) {}` to `canBind({shape}) {}`.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 69af60962..14e07eaed 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -168,6 +168,7 @@ export {
 	type TLOnTranslateStartHandler,
 	type TLResizeInfo,
 	type TLResizeMode,
+	type TLShapeUtilCanBindOpts,
 	type TLShapeUtilCanvasSvgDef,
 	type TLShapeUtilConstructor,
 	type TLShapeUtilFlag,

commit ef44d71ee2a83bb3d6d61cac7717c4254941019d
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri May 24 14:04:28 2024 +0100

    Add heart geo shape (#3787)
    
    This PR adds a heart geo shape. â¤ï¸
    
    It also:
    - adds `toSvgPathData` to geometry2d
    - uses geometry2d in places where previously we recalculated things like
    perimeter of ellipse
    - flattens geo shape util components
    
    - [x] Calculate the path length for the DashStyleHeart
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `feature` â€” New feature
    
    ### Release Notes
    
    - Adds a heart shape to the geo shape set.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 14e07eaed..2258cdf54 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -297,6 +297,7 @@ export {
 	areAnglesCompatible,
 	average,
 	canonicalizeRotation,
+	centerOfCircleFromThreePoints,
 	clamp,
 	clampRadians,
 	clockwiseAngleDist,
@@ -305,6 +306,7 @@ export {
 	getArcMeasure,
 	getPointInArcT,
 	getPointOnCircle,
+	getPointsOnArc,
 	getPolygonVertices,
 	isSafeFloat,
 	perimeterOfEllipse,

commit a457a390819bc15add2b52c77f0908498a8613a6
Author: alex <alex@dytry.ch>
Date:   Tue May 28 15:22:03 2024 +0100

    Move constants to options prop (#3799)
    
    Another go at #3628 & #3783. This moves (most) constants into
    `editor.options`, configurable by the `options` prop on the tldraw
    component.
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `feature` â€” New feature
    
    ### Release Notes
    
    You can now override many options which were previously hard-coded
    constants. Pass an `options` prop into the tldraw component to change
    the maximum number of pages, grid steps, or other previously hard-coded
    values. See `TldrawOptions` for more

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 2258cdf54..98ff9b0b8 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -106,22 +106,7 @@ export {
 export { createTLUser } from './lib/config/createTLUser'
 export { type TLAnyBindingUtilConstructor } from './lib/config/defaultBindings'
 export { coreShapes, type TLAnyShapeUtilConstructor } from './lib/config/defaultShapes'
-export {
-	ANIMATION_MEDIUM_MS,
-	ANIMATION_SHORT_MS,
-	CAMERA_SLIDE_FRICTION,
-	DEFAULT_ANIMATION_OPTIONS,
-	DEFAULT_CAMERA_OPTIONS,
-	DOUBLE_CLICK_DURATION,
-	DRAG_DISTANCE,
-	GRID_STEPS,
-	HIT_TEST_MARGIN,
-	MAX_PAGES,
-	MAX_SHAPES_PER_PAGE,
-	MULTI_CLICK_DURATION,
-	SIDES,
-	SVG_PADDING,
-} from './lib/constants'
+export { DEFAULT_ANIMATION_OPTIONS, DEFAULT_CAMERA_OPTIONS, SIDES } from './lib/constants'
 export { Editor, type TLEditorOptions, type TLResizeShapeOptions } from './lib/editor/Editor'
 export {
 	BindingUnbindReason,
@@ -247,6 +232,7 @@ export { useSafeId } from './lib/hooks/useSafeId'
 export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLStore } from './lib/hooks/useTLStore'
 export { useTransform } from './lib/hooks/useTransform'
+export { defaultTldrawOptions, type TldrawOptions } from './lib/options'
 export {
 	Box,
 	ROTATE_CORNER_TO_SELECTION_CORNER,

commit 19d051c188381e54d7f8a1fd90a2ccd247419909
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Mon Jun 3 16:58:00 2024 +0100

    Snapshots pit of success (#3811)
    
    Lots of people are having a bad time with loading/restoring snapshots
    and there's a few reasons for that:
    
    - It's not clear how to preserve UI state independently of document
    state.
    - Loading a snapshot wipes the instance state, which means we almost
    always need to
      - update the viewport page bounds
      - refocus the editor
      - preserver some other sneaky properties of the `instance` record
    
    ### Change Type
    
    <!-- â— Please select a 'Scope' label â—ï¸ -->
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [ ] `dotcom` â€” Changes the tldraw.com web app
    - [ ] `docs` â€” Changes to the documentation, examples, or templates.
    - [ ] `vs code` â€” Changes to the vscode plugin
    - [ ] `internal` â€” Does not affect user-facing stuff
    
    <!-- â— Please select a 'Type' label â—ï¸ -->
    
    - [ ] `bugfix` â€” Bug fix
    - [ ] `feature` â€” New feature
    - [ ] `improvement` â€” Improving existing features
    - [ ] `chore` â€” Updating dependencies, other boring stuff
    - [ ] `galaxy brain` â€” Architectural changes
    - [ ] `tests` â€” Changes to any test code
    - [ ] `tools` â€” Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` â€” I don't know
    
    
    ### Test Plan
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [ ] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Add a brief release note for your PR here.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 98ff9b0b8..6c4e4d3c0 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -83,6 +83,7 @@ export {
 } from './lib/components/default-components/DefaultSnapIndictor'
 export { DefaultSpinner } from './lib/components/default-components/DefaultSpinner'
 export { DefaultSvgDefs } from './lib/components/default-components/DefaultSvgDefs'
+export { getSnapshot, loadSnapshot, type TLEditorSnapshot } from './lib/config/TLEditorSnapshot'
 export {
 	TAB_ID,
 	createSessionStateSnapshotSignal,

commit d47fd56d829a7b096d98cbc9ca8f2cdfdd77f9b9
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Thu Jun 6 10:48:23 2024 +0100

    Bindings onBeforeShapeIsolate? (#3871)
    
    So we were kinda bending over backwards to capture the use case where we
    update the arrow's terminal x,y coords when unbinding, copy-pasting, and
    duplicating.
    
    - At first we abused the `onBeforeShapeDelete` callbacks, but that was
    footgunny.
    - Then we created a `onBeforeUnbind` callback, which was less footgunny
    but still subtly footgunny.
    
    This PR proposes reverting the `onBeforeUnbind` stuff, taking us back to
    having `onBeforeShapeDelete` stuff. But at the same time it adds
    `onBeforeShapeIsolate` callbacks which are triggered at the following
    times:
    
    - When you delete the other shape in a bound shape pair
    - When you copy/paste or duplicate one shape in a bound shape pair but
    not the other one
    - When you opt-in while deleting bindings e.g. `deleteBindings([...],
    {isolateShapes: true})`
    
    This PR also fixes the bound arrow drag interaction. We can probably
    extract that out to a separate PR if needed.
    
    
    ![Kapture 2024-06-04 at 12 42
    40](https://github.com/tldraw/tldraw/assets/1242537/95b51e14-1119-4dad-91e4-8b19fdb5e862)
    
    ### Change Type
    
    <!-- â— Please select a 'Scope' label â—ï¸ -->
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [ ] `dotcom` â€” Changes the tldraw.com web app
    - [ ] `docs` â€” Changes to the documentation, examples, or templates.
    - [ ] `vs code` â€” Changes to the vscode plugin
    - [ ] `internal` â€” Does not affect user-facing stuff
    
    <!-- â— Please select a 'Type' label â—ï¸ -->
    
    - [x] `bugfix` â€” Bug fix
    - [ ] `feature` â€” New feature
    - [x] `improvement` â€” Improving existing features
    - [ ] `chore` â€” Updating dependencies, other boring stuff
    - [ ] `galaxy brain` â€” Architectural changes
    - [ ] `tests` â€” Changes to any test code
    - [ ] `tools` â€” Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` â€” I don't know
    
    
    ### Test Plan
    
    1. Add a step-by-step description of how to test your PR here.
    2.
    
    - [ ] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Add a brief release note for your PR here.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 6c4e4d3c0..309617afb 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -110,12 +110,13 @@ export { coreShapes, type TLAnyShapeUtilConstructor } from './lib/config/default
 export { DEFAULT_ANIMATION_OPTIONS, DEFAULT_CAMERA_OPTIONS, SIDES } from './lib/constants'
 export { Editor, type TLEditorOptions, type TLResizeShapeOptions } from './lib/editor/Editor'
 export {
-	BindingUnbindReason,
 	BindingUtil,
 	type BindingOnChangeOptions,
 	type BindingOnCreateOptions,
+	type BindingOnDeleteOptions,
 	type BindingOnShapeChangeOptions,
-	type BindingOnUnbindOptions,
+	type BindingOnShapeDeleteOptions,
+	type BindingOnShapeIsolateOptions,
 	type TLBindingUtilConstructor,
 } from './lib/editor/bindings/BindingUtil'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'

commit fb0dd1d2fe7d974dfa194264b4c3f196469cba97
Author: alex <alex@dytry.ch>
Date:   Mon Jun 10 14:50:03 2024 +0100

    make sure everything marked @public gets documented (#3892)
    
    Previously, we had the `ae-forgotten-export` rule from api-extractor
    disabled. This rule makes sure that everything that's referred to in the
    public API is actually exported. There are more details on the rule
    [here](https://api-extractor.com/pages/messages/ae-forgotten-export/),
    but not exporting public API entires is bad because they're hard to
    document and can't be typed/called from consumer code. For us, the big
    effect is that they don't appear in our docs at all.
    
    This diff re-enables that rule. Now, if you introduce something new to
    the public API but don't export it, your build will fail.
    
    ### Change Type
    
    - [x] `docs` â€” Changes to the documentation, examples, or templates.
    - [x] `improvement` â€” Improving existing features

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 309617afb..f85dbb86c 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -1,6 +1,21 @@
 // Important! don't move this tlschema re-export to lib/index.ts, doing so causes esbuild to produce
 // incorrect output. https://github.com/evanw/esbuild/issues/1737
 
+import 'core-js/stable/array/at.js'
+import 'core-js/stable/array/flat-map.js'
+import 'core-js/stable/array/flat.js'
+import 'core-js/stable/string/at.js'
+import 'core-js/stable/string/replace-all.js'
+
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/store'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/tlschema'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/utils'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/validate'
+
 export {
 	EMPTY_ARRAY,
 	atom,
@@ -17,14 +32,6 @@ export {
 	type Atom,
 	type Signal,
 } from '@tldraw/state'
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/store'
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/tlschema'
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/utils'
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/validate'
 export {
 	ErrorScreen,
 	LoadingScreen,
@@ -42,7 +49,10 @@ export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLCon
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
 export { DefaultBackground } from './lib/components/default-components/DefaultBackground'
 export { DefaultBrush, type TLBrushProps } from './lib/components/default-components/DefaultBrush'
-export { DefaultCanvas } from './lib/components/default-components/DefaultCanvas'
+export {
+	DefaultCanvas,
+	type TLCanvasComponentProps,
+} from './lib/components/default-components/DefaultCanvas'
 export {
 	DefaultCollaboratorHint,
 	type TLCollaboratorHintProps,
@@ -51,7 +61,10 @@ export {
 	DefaultCursor,
 	type TLCursorProps,
 } from './lib/components/default-components/DefaultCursor'
-export { DefaultErrorFallback } from './lib/components/default-components/DefaultErrorFallback'
+export {
+	DefaultErrorFallback,
+	type TLErrorFallbackComponent,
+} from './lib/components/default-components/DefaultErrorFallback'
 export { DefaultGrid, type TLGridProps } from './lib/components/default-components/DefaultGrid'
 export {
 	DefaultHandle,
@@ -73,10 +86,12 @@ export {
 	DefaultSelectionForeground,
 	type TLSelectionForegroundProps,
 } from './lib/components/default-components/DefaultSelectionForeground'
+export { type TLShapeErrorFallbackComponent } from './lib/components/default-components/DefaultShapeErrorFallback'
 export {
 	DefaultShapeIndicator,
 	type TLShapeIndicatorProps,
 } from './lib/components/default-components/DefaultShapeIndicator'
+export { type TLShapeIndicatorErrorFallbackComponent } from './lib/components/default-components/DefaultShapeIndicatorErrorFallback'
 export {
 	DefaultSnapIndicator,
 	type TLSnapIndicatorProps,
@@ -104,7 +119,7 @@ export {
 	type TLStoreEventInfo,
 	type TLStoreOptions,
 } from './lib/config/createTLStore'
-export { createTLUser } from './lib/config/createTLUser'
+export { createTLUser, type TLUser } from './lib/config/createTLUser'
 export { type TLAnyBindingUtilConstructor } from './lib/config/defaultBindings'
 export { coreShapes, type TLAnyShapeUtilConstructor } from './lib/config/defaultShapes'
 export { DEFAULT_ANIMATION_OPTIONS, DEFAULT_CAMERA_OPTIONS, SIDES } from './lib/constants'
@@ -119,18 +134,25 @@ export {
 	type BindingOnShapeIsolateOptions,
 	type TLBindingUtilConstructor,
 } from './lib/editor/bindings/BindingUtil'
+export { ClickManager, type TLClickState } from './lib/editor/managers/ClickManager'
+export { EnvironmentManager } from './lib/editor/managers/EnvironmentManager'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'
+export { ScribbleManager, type ScribbleItem } from './lib/editor/managers/ScribbleManager'
 export {
+	BoundsSnaps,
 	type BoundsSnapGeometry,
 	type BoundsSnapPoint,
 } from './lib/editor/managers/SnapManager/BoundsSnaps'
-export { type HandleSnapGeometry } from './lib/editor/managers/SnapManager/HandleSnaps'
+export { HandleSnaps, type HandleSnapGeometry } from './lib/editor/managers/SnapManager/HandleSnaps'
 export {
 	SnapManager,
 	type GapsSnapIndicator,
 	type PointsSnapIndicator,
+	type SnapData,
 	type SnapIndicator,
 } from './lib/editor/managers/SnapManager/SnapManager'
+export { TextManager, type TLMeasureTextSpanOpts } from './lib/editor/managers/TextManager'
+export { UserPreferencesManager } from './lib/editor/managers/UserPreferencesManager'
 export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseBoxShapeUtil'
 export {
 	ShapeUtil,
@@ -199,6 +221,7 @@ export {
 	type TLPointerEventName,
 	type TLPointerEventTarget,
 	type TLTickEvent,
+	type TLTickEventInfo,
 	type TLWheelEvent,
 	type TLWheelEventInfo,
 	type UiEvent,
@@ -210,6 +233,13 @@ export {
 	type TLExternalContentSource,
 } from './lib/editor/types/external-content'
 export {
+	type TLHistoryBatchOptions,
+	type TLHistoryDiff,
+	type TLHistoryEntry,
+	type TLHistoryMark,
+} from './lib/editor/types/history-types'
+export {
+	type OptionalKeys,
 	type RequiredKeys,
 	type TLCameraConstraints,
 	type TLCameraMoveOptions,
@@ -254,7 +284,7 @@ export { CubicBezier2d } from './lib/primitives/geometry/CubicBezier2d'
 export { CubicSpline2d } from './lib/primitives/geometry/CubicSpline2d'
 export { Edge2d } from './lib/primitives/geometry/Edge2d'
 export { Ellipse2d } from './lib/primitives/geometry/Ellipse2d'
-export { Geometry2d } from './lib/primitives/geometry/Geometry2d'
+export { Geometry2d, type Geometry2dOptions } from './lib/primitives/geometry/Geometry2d'
 export { Group2d } from './lib/primitives/geometry/Group2d'
 export { Point2d } from './lib/primitives/geometry/Point2d'
 export { Polygon2d } from './lib/primitives/geometry/Polygon2d'
@@ -314,7 +344,13 @@ export {
 	type SharedStyle,
 } from './lib/utils/SharedStylesMap'
 export { dataUrlToFile } from './lib/utils/assets'
-export { debugFlags, featureFlags, type DebugFlag } from './lib/utils/debug-flags'
+export {
+	debugFlags,
+	featureFlags,
+	type DebugFlag,
+	type DebugFlagDef,
+	type DebugFlagDefaults,
+} from './lib/utils/debug-flags'
 export {
 	loopToHtmlElement,
 	preventDefault,
@@ -340,11 +376,3 @@ export { hardReset } from './lib/utils/sync/hardReset'
 export { uniq } from './lib/utils/uniq'
 export { uniqueId } from './lib/utils/uniqueId'
 export { openWindow } from './lib/utils/window-open'
-
-/** @polyfills */
-
-import 'core-js/stable/array/at.js'
-import 'core-js/stable/array/flat-map.js'
-import 'core-js/stable/array/flat.js'
-import 'core-js/stable/string/at.js'
-import 'core-js/stable/string/replace-all.js'

commit 6c846716c343e1ad40839f0f2bab758f58b4284d
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Tue Jun 11 15:17:09 2024 +0100

    assets: make option to transform urls dynamically / LOD (#3827)
    
    this is take #2 of this PR https://github.com/tldraw/tldraw/pull/3764
    
    This continues the idea kicked off in
    https://github.com/tldraw/tldraw/pull/3684 to explore LOD and takes it
    in a different direction.
    
    Several things here to call out:
    - our dotcom version would start to use Cloudflare's image transforms
    - we don't rewrite non-image assets
    - we debounce zooming so that we're not swapping out images while
    zooming (it creates jank)
    - we load different images based on steps of .25 (maybe we want to make
    this more, like 0.33). Feels like 0.5 might be a bit too much but we can
    play around with it.
    - we take into account network connection speed. if you're on 3g, for
    example, we have the size of the image.
    - dpr is taken into account - in our case, Cloudflare handles it. But if
    it wasn't Cloudflare, we could add it to our width equation.
    - we use Cloudflare's `fit=scale-down` setting to never scale _up_ an
    image.
    - we don't swap the image in until we've finished loading it
    programatically (to avoid a blank image while it loads)
    
    TODO
    - [x] We need to enable Cloudflare's pricing on image transforms btw
    @steveruizok ðŸ˜‰ - this won't work quite yet until we do that.
    
    
    ### Change Type
    
    <!-- â— Please select a 'Scope' label â—ï¸ -->
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [ ] `dotcom` â€” Changes the tldraw.com web app
    - [ ] `docs` â€” Changes to the documentation, examples, or templates.
    - [ ] `vs code` â€” Changes to the vscode plugin
    - [ ] `internal` â€” Does not affect user-facing stuff
    
    <!-- â— Please select a 'Type' label â—ï¸ -->
    
    - [ ] `bugfix` â€” Bug fix
    - [x] `feature` â€” New feature
    - [ ] `improvement` â€” Improving existing features
    - [ ] `chore` â€” Updating dependencies, other boring stuff
    - [ ] `galaxy brain` â€” Architectural changes
    - [ ] `tests` â€” Changes to any test code
    - [ ] `tools` â€” Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` â€” I don't know
    
    
    ### Test Plan
    
    1. Test images on staging, small, medium, large, mega
    2. Test videos on staging
    
    - [x] Unit Tests
    - [ ] End to end tests
    
    ### Release Notes
    
    - Assets: make option to transform urls dynamically to provide different
    sized images on demand.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index f85dbb86c..0f96cf194 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -28,6 +28,7 @@ export {
 	useQuickReactor,
 	useReactor,
 	useValue,
+	useValueDebounced,
 	whyAmIRunning,
 	type Atom,
 	type Signal,
@@ -239,8 +240,10 @@ export {
 	type TLHistoryMark,
 } from './lib/editor/types/history-types'
 export {
+	type AssetContextProps,
 	type OptionalKeys,
 	type RequiredKeys,
+	type TLAssetOptions,
 	type TLCameraConstraints,
 	type TLCameraMoveOptions,
 	type TLCameraOptions,

commit 6cb797a07475d7250bffe731174c516c50136a00
Author: alex <alex@dytry.ch>
Date:   Thu Jun 13 14:09:27 2024 +0100

    Better generated docs for react components (#3930)
    
    Before:
    ![Screenshot 2024-06-12 at 12 57
    26](https://github.com/tldraw/tldraw/assets/1489520/2a9f6098-ef2a-4f52-88f5-d6e4311c067d)
    
    After:
    ![Screenshot 2024-06-12 at 12 59
    16](https://github.com/tldraw/tldraw/assets/1489520/51733c2a-a2b4-4084-a89a-85bce5b47672)
    
    React components in docs now list their props, and appear under a new
    "Component" section instead of randomly under either `Function` or
    `Variable`. In order to have our docs generate this, a few criteria need
    to be met:
    1. They need to be tagged with the `@react` tsdoc tag
    2. Their props need to be a simple type alias, typically to an
    interface.
    
    Both of these rules are enforced with a new lint rule - any component
    tagged as `@public` will have these rules enforced.
    
    ### Change Type
    
    - [x] `docs` â€” Changes to the documentation, examples, or templates.
    - [x] `improvement` â€” Improving existing features

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 0f96cf194..7778ef17a 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -37,6 +37,7 @@ export {
 	ErrorScreen,
 	LoadingScreen,
 	TldrawEditor,
+	type LoadingScreenProps,
 	type TLOnMountHandler,
 	type TldrawEditorBaseProps,
 	type TldrawEditorProps,

commit 73c2b1088a1c4ab308fd6f71e5148bffc74c546b
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Fri Jun 14 11:01:50 2024 +0100

    image: follow-up fixes for LOD (#3934)
    
    couple fixes and improvements for the LOD work.
    
    - add `format=auto` for Cloudflare to send back more modern image
    formats
    - fix the broken asset logic that regressed (should not have looked at
    `url`)
    - fix stray parenthesis, omg
    - rm the `useValueDebounced` function in lieu of just debouncing the
    resolver. the problem was that the initial load in a multiplayer room
    has a zoom of 1 but then the real zoom comes in (via the url) and so we
    would double load all images ðŸ˜¬. this switches the debouncing to the
    resolving stage, not making it tied to the zoom specifically.
    
    
    ### Change Type
    
    <!-- â— Please select a 'Scope' label â—ï¸ -->
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [ ] `dotcom` â€” Changes the tldraw.com web app
    - [ ] `docs` â€” Changes to the documentation, examples, or templates.
    - [ ] `vs code` â€” Changes to the vscode plugin
    - [ ] `internal` â€” Does not affect user-facing stuff
    
    <!-- â— Please select a 'Type' label â—ï¸ -->
    
    - [x] `bugfix` â€” Bug fix
    - [ ] `feature` â€” New feature
    - [ ] `improvement` â€” Improving existing features
    - [ ] `chore` â€” Updating dependencies, other boring stuff
    - [ ] `galaxy brain` â€” Architectural changes
    - [ ] `tests` â€” Changes to any test code
    - [ ] `tools` â€” Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` â€” I don't know

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 7778ef17a..8b77d470b 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -28,7 +28,6 @@ export {
 	useQuickReactor,
 	useReactor,
 	useValue,
-	useValueDebounced,
 	whyAmIRunning,
 	type Atom,
 	type Signal,

commit 6c7b8febbf9bbbc21cc5988f8470844a2dd8e434
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Jun 17 17:18:49 2024 +0300

    Improve edge scrolling (#3950)
    
    This PR:
    - moves the edge scrolling logic into a manager
    - adds a new Editor option for `edgeScrollDelay`
    - adds a new Editor option for `edgeScrollEaseDuration`
    
    When in a state that would trigger an edge scroll, a delay is added
    before the scrolling starts. When scrolling does start, it is eased in
    by a certain duration.
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `improvement` â€” Improving existing features
    
    ### Test Plan
    
    1. Drag shapes, resize, or drag select to the edge of the screen
    2. The screen should move
    
    - [x] Unit Tests
    
    ### Release Notes
    
    - Add a delay and easing to edge scrolling.
    
    ---------
    
    Co-authored-by: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 8b77d470b..49183b250 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -136,6 +136,7 @@ export {
 	type TLBindingUtilConstructor,
 } from './lib/editor/bindings/BindingUtil'
 export { ClickManager, type TLClickState } from './lib/editor/managers/ClickManager'
+export { EdgeScrollManager } from './lib/editor/managers/EdgeScrollManager'
 export { EnvironmentManager } from './lib/editor/managers/EnvironmentManager'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'
 export { ScribbleManager, type ScribbleItem } from './lib/editor/managers/ScribbleManager'
@@ -361,7 +362,6 @@ export {
 	setPointerCapture,
 	stopEventPropagation,
 } from './lib/utils/dom'
-export { moveCameraWhenCloseToEdge } from './lib/utils/edgeScrolling'
 export { getIncrementedName } from './lib/utils/getIncrementedName'
 export { getPointerInfo } from './lib/utils/getPointerInfo'
 export { getSvgPathFromPoints } from './lib/utils/getSvgPathFromPoints'

commit 4ccac5da96d55e3d3fbceb37a7ee65a1901939fc
Author: alex <alex@dytry.ch>
Date:   Mon Jun 24 16:55:46 2024 +0100

    better auto-generated docs for Tldraw and TldrawEditor (#4012)
    
    Simplify the types used by the props of the `Tldraw` and `TldrawEditor`
    components. This doesn't make the docs perfect, but it makes them quite
    a bit better than they were.
    
    
    ![image](https://github.com/tldraw/tldraw/assets/1489520/66c72e0e-c22b-4414-b194-f0598e4a3736)
    
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `docs` â€” Changes to the documentation, examples, or templates.
    - [x] `improvement` â€” Improving existing features

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 49183b250..373a6f14b 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -40,6 +40,9 @@ export {
 	type TLOnMountHandler,
 	type TldrawEditorBaseProps,
 	type TldrawEditorProps,
+	type TldrawEditorStoreProps,
+	type TldrawEditorWithStoreProps,
+	type TldrawEditorWithoutStoreProps,
 } from './lib/TldrawEditor'
 export {
 	ErrorBoundary,
@@ -117,6 +120,7 @@ export {
 } from './lib/config/TLUserPreferences'
 export {
 	createTLStore,
+	type TLStoreBaseOptions,
 	type TLStoreEventInfo,
 	type TLStoreOptions,
 } from './lib/config/createTLStore'

commit aa1c99fee3384ee33daf20b3b1c8754148d7f885
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Jun 27 14:30:18 2024 +0100

    Cleanup z-indices (#4020)
    
    This PR:
    - simplifies a lot of z-index layers
    
    ### Change Type
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [x] `bugfix` â€” Bug fix
    
    ### Release Notes
    
    - Cleans up z-indexes and removes some unused CSS.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 373a6f14b..6a64eeea5 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -257,7 +257,7 @@ export {
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
 export { ContainerProvider, useContainer } from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'
-export { EditorContext, useEditor } from './lib/hooks/useEditor'
+export { useEditor } from './lib/hooks/useEditor'
 export { useEditorComponents } from './lib/hooks/useEditorComponents'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
 export { useEvent } from './lib/hooks/useEvent'

commit 1bf2820a3fed5fad4064d33d8ba38d9450e8a06a
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Jul 5 11:41:03 2024 +0100

    Add component for `ShapeIndicators` (#4083)
    
    This PR adds a component for `ShapeIndicators` to the UI component
    overrides. It moves the "select tool" state logic up to the new
    `TldrawShapeIndicators` component.
    
    ### Change type
    
    - [ ] `bugfix`
    - [x] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Release notes
    
    - Added new `ShapeIndicators` component to `components` object.
    - Added new `TldrawShapeIndicators` component.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 6a64eeea5..5da059e10 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -96,6 +96,7 @@ export {
 	type TLShapeIndicatorProps,
 } from './lib/components/default-components/DefaultShapeIndicator'
 export { type TLShapeIndicatorErrorFallbackComponent } from './lib/components/default-components/DefaultShapeIndicatorErrorFallback'
+export { DefaultShapeIndicators } from './lib/components/default-components/DefaultShapeIndicators'
 export {
 	DefaultSnapIndicator,
 	type TLSnapIndicatorProps,

commit 965bc10997725a7e2e1484767165253d4352b21a
Author: alex <alex@dytry.ch>
Date:   Wed Jul 10 14:00:18 2024 +0100

    [1/4] Blob storage in TLStore (#4068)
    
    Reworks the store to include information about how blob assets
    (images/videos) are stored/retrieved. This replaces the old
    internal-only `assetOptions` prop, and supplements the existing
    `registerExternalAssetHandler` API.
    
    Previously, `registerExternalAssetHandler` had two responsibilities:
    1. Extracting asset metadata
    2. Uploading the asset and returning its URL
    
    Existing `registerExternalAssetHandler` implementation will still work,
    but now uploading is the responsibility of a new `editor.uploadAsset`
    method which calls the new store-based upload method. Our default asset
    handlers extract metadata, then call that new API. I think this is a
    pretty big improvement over what we had before: overriding uploads was a
    pretty common ask, but doing so meant having to copy paste our metadata
    extraction which felt pretty fragile. Just in this codebase, we had a
    bunch of very slightly different metadata extraction code-paths that had
    been copy-pasted around then diverged over time. Now, you can change how
    uploads work without having to mess with metadata extraction and
    vice-versa.
    
    As part of this we also:
    1. merge the old separate asset indexeddb store with the main one.
    because this warrants some pretty big migration stuff, i refactored our
    indexed-db helpers to work around an instance instead of being free
    functions
    2. move our existing asset stuff over to the new approach
    3. add a new hook in `sync-react` to create a demo store with the new
    assets
    
    ### Change type
    
    - [x] `api`
    
    ### Release notes
    
    Introduce a new `assets` option for the store, describing how to save
    and retrieve asset blobs like images & videos from e.g. a user-content
    CDN. These are accessible through `editor.uploadAsset` and
    `editor.resolveAssetUrl`. This supplements the existing
    `registerExternalAssetHandler` API: `registerExternalAssetHandler` is
    for customising metadata extraction, and should call
    `editor.uploadAsset` to save assets. Existing
    `registerExternalAssetHandler` calls will still work, but if you're only
    using them to configure uploads and don't want to customise metadata
    extraction, consider switching to the new `assets` store prop.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 5da059e10..033f345d0 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -246,10 +246,8 @@ export {
 	type TLHistoryMark,
 } from './lib/editor/types/history-types'
 export {
-	type AssetContextProps,
 	type OptionalKeys,
 	type RequiredKeys,
-	type TLAssetOptions,
 	type TLCameraConstraints,
 	type TLCameraMoveOptions,
 	type TLCameraOptions,
@@ -269,6 +267,7 @@ export { useIsEditing } from './lib/hooks/useIsEditing'
 export { useLocalStore } from './lib/hooks/useLocalStore'
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
+export { useRefState } from './lib/hooks/useRefState'
 export { useSafeId } from './lib/hooks/useSafeId'
 export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLStore } from './lib/hooks/useTLStore'

commit 627c84c2af8144401b54c1729111d47a45ffeb8e
Author: alex <alex@dytry.ch>
Date:   Wed Jul 10 14:15:44 2024 +0100

    [2/4] Rename sync hooks, add bookmarks to demo (#4094)
    
    Adds a new `onEditorMount` callback to the store, allowing store
    creators to do things like registering bookmark handlers. We use this in
    the new demo hook.
    
    This also renames `useRemoteSyncClient` to `useMultiplayerSync`, and
    `useRemoteSyncDemo` to `useMultiplayerDemo`.
    
    Closes TLD-2601
    
    ### Change type
    
    - [x] `api`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 033f345d0..bb6fd7722 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -36,6 +36,7 @@ export {
 	ErrorScreen,
 	LoadingScreen,
 	TldrawEditor,
+	useOnMount,
 	type LoadingScreenProps,
 	type TLOnMountHandler,
 	type TldrawEditorBaseProps,

commit 69a1c17b463991882c49d1496d1efedcfa0a730f
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Thu Jul 11 12:49:18 2024 +0100

    sdk: wires up tldraw to have licensing mechanisms (#4021)
    
    For non-commercial usage of tldraw, this adds a watermark in the corner,
    both for branding purposes and as an incentive for our enterprise
    customers to purchase a license.
    
    For commercial usage of tldraw, you add a license to the `<Tldraw
    licenseKey={YOUR_LICENSE_KEY} />` component so that the watermark
    doesn't show.
    
    The license is a signed key that has various bits of information in it,
    such as:
    - license type
    - hosts that the license is valid for
    - whether it's an internal-only license
    - expiry date
    
    We check the license on load and show a watermark (or throw an error if
    internal-only) if the license is not valid in a production environment.
    
    This is a @MitjaBezensek, @Taha-Hassan-Git, @mimecuvalo joint
    production! ðŸ¤œ ðŸ¤›
    
    ### Change Type
    
    <!-- â— Please select a 'Scope' label â—ï¸ -->
    
    - [x] `sdk` â€” Changes the tldraw SDK
    - [ ] `dotcom` â€” Changes the tldraw.com web app
    - [ ] `docs` â€” Changes to the documentation, examples, or templates.
    - [ ] `vs code` â€” Changes to the vscode plugin
    - [ ] `internal` â€” Does not affect user-facing stuff
    
    <!-- â— Please select a 'Type' label â—ï¸ -->
    
    - [ ] `bugfix` â€” Bug fix
    - [x] `feature` â€” New feature
    - [ ] `improvement` â€” Improving existing features
    - [ ] `chore` â€” Updating dependencies, other boring stuff
    - [ ] `galaxy brain` â€” Architectural changes
    - [ ] `tests` â€” Changes to any test code
    - [ ] `tools` â€” Changes to infrastructure, CI, internal scripts,
    debugging tools, etc.
    - [ ] `dunno` â€” I don't know
    
    
    ### Test Plan
    
    1. We will be dogfooding on staging.tldraw.com and tldraw.com itself
    before releasing this.
    
    ### Release Notes
    
    - SDK: wires up tldraw to have licensing mechanisms.
    
    ---------
    
    Co-authored-by: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>
    Co-authored-by: Taha <98838967+Taha-Hassan-Git@users.noreply.github.com>
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index bb6fd7722..dc7c7d80f 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -352,7 +352,7 @@ export {
 	SharedStyleMap,
 	type SharedStyle,
 } from './lib/utils/SharedStylesMap'
-export { dataUrlToFile } from './lib/utils/assets'
+export { dataUrlToFile, getDefaultCdnBaseUrl } from './lib/utils/assets'
 export {
 	debugFlags,
 	featureFlags,

commit 0235f841153c40a89c538a369708b7c8422cbbdd
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Sun Jul 14 11:54:27 2024 +0100

    [sdk] make EffectScheduler and useStateTracking public (#4155)
    
    closes #4085
    
    Neither of these should be too valuable for tldraw users, but they're
    also both totally stable and well documented (now) so it should be fine
    to make them public?
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. Create a shape...
    2.
    
    - [ ] Unit tests
    - [ ] End to end tests
    
    ### Release notes
    
    - Made `EffectScheduler` and `useStateTracking` public

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index dc7c7d80f..81dd0688a 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -18,6 +18,7 @@ export * from '@tldraw/validate'
 
 export {
 	EMPTY_ARRAY,
+	EffectScheduler,
 	atom,
 	computed,
 	react,
@@ -27,6 +28,7 @@ export {
 	useComputed,
 	useQuickReactor,
 	useReactor,
+	useStateTracking,
 	useValue,
 	whyAmIRunning,
 	type Atom,

commit 7ba4040e840fcf6e2972edf9b4ae318438039f21
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Mon Jul 15 12:18:59 2024 +0100

    Split @tldraw/state into @tldraw/state and @tldraw/state-react (#4170)
    
    The backend code uses `@tldraw/state`, which is fine, but the package
    has a peer dependency on `react`, which is not fine to impose on backend
    consumers. So let's split this up again.
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [x] `other`
    
    ### Test plan
    
    1. Create a shape...
    2.
    
    - [ ] Unit tests
    - [ ] End to end tests
    
    ### Release notes
    
    - Fixed a bug withâ€¦

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 81dd0688a..5134f33c5 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -22,18 +22,20 @@ export {
 	atom,
 	computed,
 	react,
-	track,
 	transact,
 	transaction,
+	whyAmIRunning,
+	type Atom,
+	type Signal,
+} from '@tldraw/state'
+export {
+	track,
 	useComputed,
 	useQuickReactor,
 	useReactor,
 	useStateTracking,
 	useValue,
-	whyAmIRunning,
-	type Atom,
-	type Signal,
-} from '@tldraw/state'
+} from '@tldraw/state-react'
 export {
 	ErrorScreen,
 	LoadingScreen,

commit 01bc73e750a9450eb135ad080a7087f494020b48
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Jul 15 15:10:09 2024 +0100

    Editor.run, locked shapes improvements (#4042)
    
    This PR:
    - creates `Editor.run` (previously `Editor.batch`)
    - deprecates `Editor.batch`
    - introduces a `ignoreShapeLock` option top the `Editor.run` method that
    allows the editor to update and delete locked shapes
    - fixes a bug with `updateShapes` that allowed updating locked shapes
    - fixes a bug with `ungroupShapes` that allowed ungrouping locked shapes
    - makes `Editor.history` private
    - adds `Editor.squashToMark`
    - adds `Editor.clearHistory`
    - removes `History.ignore`
    - removes `History.onBatchComplete`
    - makes `_updateCurrentPageState` private
    
    ```ts
    editor.run(() => {
      editor.updateShape({ ...myLockedShape })
      editor.deleteShape(myLockedShape)
    }, { ignoreShapeLock: true })
    ```
    
    It also:
    
    ## How it works
    
    Normally `updateShape`/`updateShapes` and `deleteShape`/`deleteShapes`
    do not effect locked shapes.
    
    ```ts
    const myLockedShape = editor.getShape(myShapeId)!
    
    // no change from update
    editor.updateShape({ ...myLockedShape, x: 100 })
    expect(editor.getShape(myShapeId)).toMatchObject(myLockedShape)
    
    // no change from delete
    editor.deleteShapes([myLockedShape])
    expect(editor.getShape(myShapeId)).toMatchObject(myLockedShape)
    ```
    
    The new `run` method adds the option to ignore shape lock.
    
    ```ts
    const myLockedShape = editor.getShape(myShapeId)!
    
    // update works
    editor.run(() => { editor.updateShape({ ...myLockedShape, x: 100 }) }, { ignoreShapeLock: true })
    expect(editor.getShape(myShapeId)).toMatchObject({ ...myLockedShape, x: 100 })
    
    // delete works
    editor.run(() => { editor.deleteShapes([myLockedShape]), { ignoreShapeLock: true })
    expect(editor.getShape(myShapeId)).toBeUndefined()
    ```
    
    ## History changes
    
    This is a related but not entirely related change in this PR.
    
    Previously, we had a few ways to run code that ignored the history.
    
    - `editor.history.ignore(() => { ... })`
    - `editor.batch(() => { ... }, { history: "ignore" })`
    - `editor.history.batch(() => { ... }, { history: "ignore" })`
    - `editor.updateCurrentPageState(() => { ... }, { history: "ignore" })`
    
    We now have one way to run code that ignores history:
    
    - `editor.run(() => { ... }, { history: "ignore" })`
    
    ## Design notes
    
    We want a user to be able to update or delete locked shapes
    programmatically.
    
    ### Callback vs. method options?
    
    We could have added a `{ force: boolean }` property to the
    `updateShapes` / `deleteShapes` methods, however there are places where
    those methods are called from other methods (such as
    `distributeShapes`). If we wanted to make these work, we would have also
    had to provide a `force` option / bag to those methods.
    
    Using a wrapper callback allows for "regular" tldraw editor code to work
    while allowing for updates and deletes.
    
    ### Interaction logic?
    
    We don't want this change to effect any of our interaction logic.
    
    A lot of our interaction logic depends on identifying which shapes are
    locked and which shapes aren't. For example, clicking on a locked shape
    will go to the `pointing_canvas` state rather than the `pointing_shape`.
    This PR has no effect on that part of the library.
    
    It only effects the updateShapes and deleteShapes methods. As an example
    of this, when `_force` is set to true by default, the only tests that
    should fail are in `lockedShapes.test.ts`. The "user land" experience of
    locked shapes is identical to what it is now.
    
    ### Change type
    
    - [x] `bugfix`
    - [ ] `improvement`
    - [x] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. Create a shape
    2. Lock it
    3. From the console, update it
    4. From the console, delete it
    
    - [x] Unit tests
    
    ### Release notes
    
    - SDK: Adds `Editor.force()` to permit updating / deleting locked shapes
    - Fixed a bug that would allow locked shapes to be updated
    programmatically
    - Fixed a bug that would allow locked group shapes to be ungrouped
    programmatically
    
    ---------
    
    Co-authored-by: alex <alex@dytry.ch>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 5134f33c5..e4738faf1 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -134,7 +134,12 @@ export { createTLUser, type TLUser } from './lib/config/createTLUser'
 export { type TLAnyBindingUtilConstructor } from './lib/config/defaultBindings'
 export { coreShapes, type TLAnyShapeUtilConstructor } from './lib/config/defaultShapes'
 export { DEFAULT_ANIMATION_OPTIONS, DEFAULT_CAMERA_OPTIONS, SIDES } from './lib/constants'
-export { Editor, type TLEditorOptions, type TLResizeShapeOptions } from './lib/editor/Editor'
+export {
+	Editor,
+	type TLEditorOptions,
+	type TLEditorRunOptions,
+	type TLResizeShapeOptions,
+} from './lib/editor/Editor'
 export {
 	BindingUtil,
 	type BindingOnChangeOptions,

commit 43811d54bad8259830717edcd86f992724b4886d
Author: alex <alex@dytry.ch>
Date:   Tue Jul 16 12:24:01 2024 +0100

    bemo custom shape example (#4174)
    
    Adds a custom shape bemo example. Instead of having to create a schema
    ahead of time, here i've added bindingUtils/shapeUtils props to our sync
    hooks to match the ones we have in the `<Tldraw />` component. Not 100%
    about this though, I could easily be convinced to go with just the
    schema prop.
    
    ### Change type
    
    - [x] `other`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index e4738faf1..879398a40 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -125,10 +125,12 @@ export {
 	type TLUserPreferences,
 } from './lib/config/TLUserPreferences'
 export {
+	createTLSchemaFromUtils,
 	createTLStore,
 	type TLStoreBaseOptions,
 	type TLStoreEventInfo,
 	type TLStoreOptions,
+	type TLStoreSchemaOptions,
 } from './lib/config/createTLStore'
 export { createTLUser, type TLUser } from './lib/config/createTLUser'
 export { type TLAnyBindingUtilConstructor } from './lib/config/defaultBindings'
@@ -280,7 +282,7 @@ export { usePresence } from './lib/hooks/usePresence'
 export { useRefState } from './lib/hooks/useRefState'
 export { useSafeId } from './lib/hooks/useSafeId'
 export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
-export { useTLStore } from './lib/hooks/useTLStore'
+export { useTLSchemaFromUtils, useTLStore } from './lib/hooks/useTLStore'
 export { useTransform } from './lib/hooks/useTransform'
 export { defaultTldrawOptions, type TldrawOptions } from './lib/options'
 export {

commit 146965c2405eb4756c4952b55c61dbf6234d38ed
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Thu Jul 18 12:59:02 2024 +0100

    Watermark II (#4196)
    
    This PR is a second go at the watermark.
    
    ![localhost_5420_develop
    (1)](https://github.com/user-attachments/assets/70757e93-d8e5-4c96-b6ca-30dfbf1c21b1)
    
    It:
    - updates the watermark icon
    - removes the watermark on small devices
    - makes the watermark a react component with inline styles
      - the classname for these styles is based on the current version
    - improves the interactions around the watermark
      - the watermark requires a short delay before accepting events
      - events prior to that delay will be passed to the canvas
      - events after that delay will interact with the link to tldraw.dev
      - prevents interactions with the watermark while a menu is open
      - moves the watermark up when debug mode is active
    
    It also:
    - moves the "is unlicensed" logic into the license manager
    - adds the license manager as a private member of the editor class
    - removes the watermark manager
    
    ## Some thoughts
    
    I couldn't get the interaction we wanted from the watermark manager
    itself. It's important that this just the right amount of disruptive,
    and accidental clicks seemed to be a step too far. After some thinking,
    I think an improved experience is worth a little less security.
    
    Using a React component (with CSS styling) felt acceptable as long as we
    provided our own "inline" style sheet. My previous concern was that we'd
    designed a system where external CSS is acceptable, and so would require
    other users to provide our watermark CSS with any of their own CSS; but
    inline styles fix that.
    
    ### Change type
    
    - [x] `other`
    
    ### Test plan
    
    1. Same as the previous watermark tests.
    
    - [x] Unit tests
    
    ---------
    
    Co-authored-by: Mime ÄŒuvalo <mimecuvalo@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 879398a40..3f64a93ce 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -6,6 +6,7 @@ import 'core-js/stable/array/flat-map.js'
 import 'core-js/stable/array/flat.js'
 import 'core-js/stable/string/at.js'
 import 'core-js/stable/string/replace-all.js'
+import { featureFlags } from './lib/utils/debug-flags'
 
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/store'
@@ -395,3 +396,8 @@ export { hardReset } from './lib/utils/sync/hardReset'
 export { uniq } from './lib/utils/uniq'
 export { uniqueId } from './lib/utils/uniqueId'
 export { openWindow } from './lib/utils/window-open'
+
+/** @public */
+export function debugEnableLicensing() {
+	featureFlags.enableLicensing.set(true)
+}

commit 8347697097ab8cb9cb4fc3f4bd1dfcc0511ffe34
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Fri Jul 19 07:55:40 2024 +0100

    Finesse sync api (#4212)
    
    - Make it so that for client-side stuff, only the api surface area of
    the two hooks are public.
    - Make it so that for server-side stuff, only the TLSocketRoom api
    surface area is public.
    - Rename `sessionKey` => `sessionId` for consistency
    - Add tsdoc comments for public stuff
    
    NEW!
    
    - refactor `userPreferences` option quite heavily to make it simpler
    - rename the multiplayer option `userPreferences` -> `userInfo` and
    simplify the type since it's only a subset and don't want to pollute the
    api with confusing stuff.
    - `useTldrawUser()` api for easy-peasy user data integration + new
    example showing how it's used.
    - make assets required, and make `resolve` optional.
    
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. Create a shape...
    2.
    
    - [ ] Unit tests
    - [ ] End to end tests
    
    ### Release notes
    
    - Fixed a bug withâ€¦
    
    ---------
    
    Co-authored-by: alex <alex@dytry.ch>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 3f64a93ce..22f9b9a62 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -128,12 +128,13 @@ export {
 export {
 	createTLSchemaFromUtils,
 	createTLStore,
+	inlineBase64AssetStore,
 	type TLStoreBaseOptions,
 	type TLStoreEventInfo,
 	type TLStoreOptions,
 	type TLStoreSchemaOptions,
 } from './lib/config/createTLStore'
-export { createTLUser, type TLUser } from './lib/config/createTLUser'
+export { createTLUser, useTldrawUser, type TLUser } from './lib/config/createTLUser'
 export { type TLAnyBindingUtilConstructor } from './lib/config/defaultBindings'
 export { coreShapes, type TLAnyShapeUtilConstructor } from './lib/config/defaultShapes'
 export { DEFAULT_ANIMATION_OPTIONS, DEFAULT_CAMERA_OPTIONS, SIDES } from './lib/constants'

commit f05d102cd44ec3ab3ac84b51bf8669ef3b825481
Author: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>
Date:   Mon Jul 29 15:40:18 2024 +0200

    Move from function properties to methods (#4288)
    
    Things left to do
    - [x] Update docs (things like the [tools
    page](https://tldraw-docs-fqnvru1os-tldraw.vercel.app/docs/tools),
    possibly more)
    - [x] Write a list of breaking changes and how to upgrade.
    - [x] Do another pass and check if we can update any lines that have
    `@typescript-eslint/method-signature-style` and
    `local/prefer-class-methods` disabled
    - [x] Thinks about what to do with `TLEventHandlers`. Edit: Feels like
    keeping them is the best way to go.
    - [x] Remove `override` keyword where it's not needed. Not sure if it's
    worth the effort. Edit: decided not to spend time here.
    - [ ] What about possible detached / destructured uses?
    
    Fixes https://github.com/tldraw/tldraw/issues/2799
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. Create a shape...
    2.
    
    - [ ] Unit tests
    - [ ] End to end tests
    
    ### Release notes
    
    - Adds eslint rules for enforcing the use of methods instead of function
    properties and fixes / disables all the resulting errors.
    
    # Breaking changes
    
    This change affects the syntax of how the event handlers for shape tools
    and utils are defined.
    
    ## Shape utils
    **Before**
    ```ts
    export class CustomShapeUtil extends ShapeUtil<CustomShape> {
       // Defining flags
       override canEdit = () => true
    
       // Defining event handlers
       override onResize: TLOnResizeHandler<CustomShape> = (shape, info) => {
          ...
       }
    }
    ```
    
    
    **After**
    ```ts
    export class CustomShapeUtil extends ShapeUtil<CustomShape> {
       // Defining flags
       override canEdit() {
          return true
       }
    
       // Defining event handlers
       override onResize(shape: CustomShape, info: TLResizeInfo<CustomShape>) {
          ...
       }
    }
    ```
    
    ## Tools
    
    **Before**
    ```ts
    export class CustomShapeTool extends StateNode {
       // Defining child states
       static override children = (): TLStateNodeConstructor[] => [Idle, Pointing]
    
       // Defining event handlers
       override onKeyDown: TLEventHandlers['onKeyDown'] = (info) => {
          ...
       }
    }
    ```
    
    
    **After**
    ```ts
    export class CustomShapeTool extends StateNode {
       // Defining child states
       static override children(): TLStateNodeConstructor[] {
          return [Idle, Pointing]
       }
    
       // Defining event handlers
       override onKeyDown(info: TLKeyboardEventInfo) {
          ...
       }
    }
    ```
    
    ---------
    
    Co-authored-by: David Sheldrick <d.j.sheldrick@gmail.com>
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 22f9b9a62..cfebe76c2 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -177,31 +177,12 @@ export { UserPreferencesManager } from './lib/editor/managers/UserPreferencesMan
 export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseBoxShapeUtil'
 export {
 	ShapeUtil,
-	type TLOnBeforeCreateHandler,
-	type TLOnBeforeUpdateHandler,
-	type TLOnBindingChangeHandler,
-	type TLOnChildrenChangeHandler,
-	type TLOnClickHandler,
-	type TLOnDoubleClickHandleHandler,
-	type TLOnDoubleClickHandler,
-	type TLOnDragHandler,
-	type TLOnEditEndHandler,
-	type TLOnHandleDragHandler,
-	type TLOnResizeEndHandler,
-	type TLOnResizeHandler,
-	type TLOnResizeStartHandler,
-	type TLOnRotateEndHandler,
-	type TLOnRotateHandler,
-	type TLOnRotateStartHandler,
-	type TLOnTranslateEndHandler,
-	type TLOnTranslateHandler,
-	type TLOnTranslateStartHandler,
+	type TLHandleDragInfo,
 	type TLResizeInfo,
 	type TLResizeMode,
 	type TLShapeUtilCanBindOpts,
 	type TLShapeUtilCanvasSvgDef,
 	type TLShapeUtilConstructor,
-	type TLShapeUtilFlag,
 } from './lib/editor/shapes/ShapeUtil'
 export { GroupShapeUtil } from './lib/editor/shapes/group/GroupShapeUtil'
 export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'

commit 306c5c0204cfc3ed838b5f3378219a410d32b458
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Mon Jul 29 15:58:59 2024 +0100

    draw: fix dotted line rendering when zoomed out (#4261)
    
    Fixes https://github.com/tldraw/tldraw/issues/1995
    
    ### Change type
    
    - [x] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Release notes
    
    - Draw: fix dotted line shape rendering when zoomed out greatly.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index cfebe76c2..c4751bc4f 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -185,6 +185,7 @@ export {
 	type TLShapeUtilConstructor,
 } from './lib/editor/shapes/ShapeUtil'
 export { GroupShapeUtil } from './lib/editor/shapes/group/GroupShapeUtil'
+export { getPerfectDashProps } from './lib/editor/shapes/shared/getPerfectDashProps'
 export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'

commit 759f3c812c3b7da2bff80debeb005b3912d57d7a
Author: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>
Date:   Fri Aug 2 10:55:36 2024 +0200

    License: add docs (#4217)
    
    Do not merge for now - we'll do it when we remove the licensing feature
    flag.
    
    Adds licensing docs. It also adds a license checker to help people test
    out their license, if they so desire.
    
    <img width="1498" alt="Screenshot 2024-08-01 at 17 00 06"
    src="https://github.com/user-attachments/assets/72daa932-cbe2-430b-852f-5350fd4d3e0e">
    
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [x] `other`
    
    ### Release notes
    
    - Add licensing docs.
    
    ---------
    
    Co-authored-by: Mime ÄŒuvalo <mimecuvalo@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index c4751bc4f..cb3f5c266 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -268,6 +268,15 @@ export { useSafeId } from './lib/hooks/useSafeId'
 export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLSchemaFromUtils, useTLStore } from './lib/hooks/useTLStore'
 export { useTransform } from './lib/hooks/useTransform'
+export {
+	LicenseManager,
+	type InvalidLicenseKeyResult,
+	type InvalidLicenseReason,
+	type LicenseFromKeyResult,
+	type LicenseInfo,
+	type TestEnvironment,
+	type ValidLicenseKeyResult,
+} from './lib/license/LicenseManager'
 export { defaultTldrawOptions, type TldrawOptions } from './lib/options'
 export {
 	Box,

commit f1d6061d972e07af1faeba06f2d8516f2d21730e
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Aug 6 11:15:47 2024 +0100

    Make license debug helper return a cleanup function (#4356)
    
    This PR adds a cleanup function to the license debug helper, so that our
    license example doesn't effect other examples.
    
    ### Change type
    
    - [x] `other`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index cb3f5c266..cb203d7e2 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -392,4 +392,7 @@ export { openWindow } from './lib/utils/window-open'
 /** @public */
 export function debugEnableLicensing() {
 	featureFlags.enableLicensing.set(true)
+	return () => {
+		featureFlags.enableLicensing.set(false)
+	}
 }

commit 42de01d57230caac87ba34571b77c27e52d37a37
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Tue Aug 13 08:15:41 2024 +0100

    Deep Links (#4333)
    
    Deep Links are URLs which point to a specific part of a document. We
    provide a comprehensive set of tools to help you create and manage deep
    links in your application.
    
    ## The `deepLinks` prop
    
    The highest-level API for managing deep links is the `deepLinks` prop on
    the `<Tldraw />` component. This prop is designed for manipulating
    `window.location` to add a search param which tldraw can use to navigate
    to a specific part of the document.
    
    e.g. `https://my-app.com/document-name?d=v1234.-234.3.21`
    
    If you set `deepLinks` to `true` e.g. `<Tldraw deepLinks />` the
    following default behavior will be enabled:
    
    1. When the editor initializes, before the initial render, it will check
    the current `window.location` for a search param called `d`. If found,
    it will try to parse the value of this param as a deep link and navigate
    to that part of the document.
    2. 500 milliseconds after every time the editor finishes navigating to a
    new part of the document, it will update `window.location` to add the
    latest version of the `d` param.
    
    You can customize this behavior by passing a configuration object as the
    `deepLinks` prop. e.g.
    
    ```tsx
    <Tldraw
            deepLinks={{
                    // change the param name to `page`
                    paramName: 'page',
                    // only link to the current page
                    getTarget(editor) {
                            return { type: 'page', pageId: editor.getCurrentPageId() }
                    },
                    // log the new search params to the console instead of updating `window.location`
                    onChange(url) {
                            console.log('the new search params are', url.searchParams)
                    },
                    // set the debounce interval to 100ms instead of 500ms
                    debounceMs: 100,
            }}
    />
    ```
    
    For full options see the [`TLDeepLinkOptions`](?) API reference.
    
    ## Handling deep links manually
    
    We expose the core functionality for managing deep links as a set of
    methods and utilities. This gives you more control e.g. if you prefer
    not to use search params in the URL.
    
    ### Creating a deep link
    
    You can create an isolated deep link string using the
    [`createDeepLinkString`](?) helper which takes a [`TLDeepLink`](?)
    descriptor object.
    
    ```tsx
    createDeepLinkString({ type: 'page', pageId: 'page:abc123' })
    // => 'pabc123'
    createDeepLinkString({ type: 'shapes', shapeIds: ['shape:foo', 'shape:bar'] })
    // => 'sfoo.bar'
    createDeepLinkString({
            type: 'viewport',
            pageId: 'page:abc123',
            bounds: {
                    x: 0,
                    y: 0,
                    w: 1024,
                    h: 768,
            },
    })
    // => 'v0.0.1024.768.abc123'
    ```
    
    If you do prefer to put this in a URL as a query param, you can use the
    [`Editor#createDeepLink`](?) method.
    
    ```tsx
    editor.createDeepLink({ to: { type: 'page', pageId: 'page:abc123' } })
    // => 'https://my-app.com/document-name?d=pabc123'
    ```
    
    ### Handling a deep link
    
    You can parse a deep link string with [`parseDeepLinkString`](?) which
    returns a [`TLDeepLink`](?) descriptor object.
    
    You can then call [`Editor#handleDeepLink`](?) with this descriptor to
    navigate to the part of the document described by the deep link.
    
    `Editor#handleDeepLink` also can take a plain URL if the deep link is
    encoded as a query param.
    
    ```tsx
    editor.handleDeepLink(parseDeepLinkString('pabc123'))
    // or pass in a url
    editor.handleDeepLink({ url: 'https://my-app.com/document-name?d=pabc123' })
    // or call without options to use the current `window.location`
    editor.handleDeepLink()
    ```
    
    ### Listening for deep link changes
    
    You can listen for deep link changes with the
    [`Editor#registerDeepLinkListener`](?) method, which takes the same
    options as the `deepLinks` prop.
    
    ```tsx
    useEffect(() => {
            const unlisten = editor.registerDeepLinkListener({
                    paramName: 'page',
                    getTarget(editor) {
                            return { type: 'page', pageId: editor.getCurrentPageId() }
                    },
                    onChange(url) {
                            console.log('the new search params are', url.searchParams)
                    },
                    debounceMs: 100,
            })
            return () => {
                    unlisten()
            }
    }, [])
    ```
    
    ### Change type
    
    - [ ] `bugfix`
    - [x] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Release notes
    
    - Added support for managing deep links.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index cb203d7e2..84c49f248 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -364,6 +364,12 @@ export {
 	type DebugFlagDef,
 	type DebugFlagDefaults,
 } from './lib/utils/debug-flags'
+export {
+	createDeepLinkString,
+	parseDeepLinkString,
+	type TLDeepLink,
+	type TLDeepLinkOptions,
+} from './lib/utils/deepLinks'
 export {
 	loopToHtmlElement,
 	preventDefault,

commit 8ab18776cd8e94312330e3ed8edb57fdad511793
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Tue Aug 20 11:56:44 2024 +0100

    [api] Widen snapshots pit of success (#4392)
    
    This PR makes the snapshot loader preserve page states that are not
    explicitly overridden so that, e.g. you can load a previous snapshot
    version of a document without switching page or resetting camera simply
    by omitting the session state option.
    
    The goal is to provide a nice and robust version of the solution
    mentioned in #4381
    
    ### Change type
    
    - [ ] `bugfix`
    - [x] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Test plan
    
    - [x] Unit tests
    
    
    ### Release notes
    
    - Improved loadSnapshot to preserve page state like camera position and
    current page if no session snapshot is provided.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 84c49f248..f6940f972 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -109,12 +109,18 @@ export {
 } from './lib/components/default-components/DefaultSnapIndictor'
 export { DefaultSpinner } from './lib/components/default-components/DefaultSpinner'
 export { DefaultSvgDefs } from './lib/components/default-components/DefaultSvgDefs'
-export { getSnapshot, loadSnapshot, type TLEditorSnapshot } from './lib/config/TLEditorSnapshot'
+export {
+	getSnapshot,
+	loadSnapshot,
+	type TLEditorSnapshot,
+	type TLLoadSnapshotOptions,
+} from './lib/config/TLEditorSnapshot'
 export {
 	TAB_ID,
 	createSessionStateSnapshotSignal,
 	extractSessionStateFromLegacySnapshot,
 	loadSessionStateSnapshotIntoStore,
+	type TLLoadSessionStateSnapshotOptions,
 	type TLSessionStateSnapshot,
 } from './lib/config/TLSessionStateSnapshot'
 export {

commit 822a54040c04570ebd2213166cfc1de5019e9dc2
Author: alex <alex@dytry.ch>
Date:   Wed Aug 21 10:01:56 2024 +0100

    Detect multiple installed versions of tldraw packages (#4398)
    
    There are two semi-common failure modes around people using tldraw:
    1. They upgrade 1 tldraw package, but not the other, resulting in having
    multiple versions of the same package running at once
    2. Their bundler is misconfigured, and pulls in both the commonjs and
    esmodule versions of their packages.
    
    This diff detects those cases and adds a warning message explaining the
    situation.
    
    As part of this, I added another check on packages in the same vein as
    check-scripts and check-packages. Rather than add another script and
    step on github, I merged the three of them into one file.
    
    ### Change type
    - [x] `api`
    
    ### Release notes
    
    - We detect when there are multiple versions of tldraw installed and let
    you know, as this can cause bugs in your application

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index f6940f972..f4f1e3394 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -1,6 +1,4 @@
-// Important! don't move this tlschema re-export to lib/index.ts, doing so causes esbuild to produce
-// incorrect output. https://github.com/evanw/esbuild/issues/1737
-
+import { registerTldrawLibraryVersion } from '@tldraw/utils'
 import 'core-js/stable/array/at.js'
 import 'core-js/stable/array/flat-map.js'
 import 'core-js/stable/array/flat.js'
@@ -408,3 +406,9 @@ export function debugEnableLicensing() {
 		featureFlags.enableLicensing.set(false)
 	}
 }
+
+registerTldrawLibraryVersion(
+	(globalThis as any).TLDRAW_LIBRARY_NAME,
+	(globalThis as any).TLDRAW_LIBRARY_VERSION,
+	(globalThis as any).TLDRAW_LIBRARY_MODULES
+)

commit fa9dbe131e949cd23d4c646eaa94a10b4efdf85d
Author: alex <alex@dytry.ch>
Date:   Thu Aug 22 15:37:21 2024 +0100

    inline nanoid (#4410)
    
    We have a bunch of code working around the fact that nanoId is only
    distributed as an ES module, but we run both as es and commonjs modules.
    luckily, nanoid is nano! and even more so if you strip out the bits we
    don't use. This replaces the nanoid library with a vendored version of
    just the part we use.
    
    ### Change type
    
    - [x] `improvement`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index f4f1e3394..11e41f8ed 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -396,7 +396,6 @@ export { runtime, setRuntimeOverrides } from './lib/utils/runtime'
 export { type TLStoreWithStatus } from './lib/utils/sync/StoreWithStatus'
 export { hardReset } from './lib/utils/sync/hardReset'
 export { uniq } from './lib/utils/uniq'
-export { uniqueId } from './lib/utils/uniqueId'
 export { openWindow } from './lib/utils/window-open'
 
 /** @public */

commit da666ef4fdac0e5e11b5b0c7388d37ab5ef3739b
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Mon Sep 2 11:59:37 2024 +0100

    Rename TLSvgOptions (#4442)
    
    closes #4439
    
    ### Change type
    
    - [x] `api`
    
    
    ### Test plan
    
    1. Create a shape...
    2.
    
    - [ ] Unit tests
    - [ ] End to end tests
    
    ### Release notes
    
    - Rename `TLSvgOptions` to `TLImageExportOptions`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 11e41f8ed..2ade3e2b8 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -251,6 +251,8 @@ export {
 	type TLCameraConstraints,
 	type TLCameraMoveOptions,
 	type TLCameraOptions,
+	type TLImageExportOptions,
+	// eslint-disable-next-line deprecation/deprecation
 	type TLSvgOptions,
 } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'

commit 7d0433e91822f9a65a6b5d735918489822849bf0
Author: alex <alex@dytry.ch>
Date:   Wed Sep 4 16:33:26 2024 +0100

    add default <foreignObject> based export for shapes (#4403)
    
    Custom shapes (and our own bookmark shapes) now support SVG exports by
    default! The default implementation isn't the most efficient and won't
    work in all SVG environments, but you can still write your own if
    needed. It's pretty reliable though!
    
    ![Kapture 2024-08-27 at 17 29
    31](https://github.com/user-attachments/assets/3870e82b-b77b-486b-92b0-420921df8d51)
    
    This introduces a couple of new APIs for co-ordinating SVG exports. The
    main one is `useDelaySvgExport`. This is useful when your component
    might take a while to load, and you need to delay the export is until
    everything is ready & rendered. You use it like this:
    ```tsx
    function MyComponent() {
        const exportIsReady = useDelaySvgExport()
        const [dynamicData, setDynamicData] = useState(null)
    
        useEffect(() => {
            loadDynamicData.then((data) => {
                setDynamicData(data)
                exportIsReady()
            })
        })
    
        return <MyList data={data} />
    }
    ```
    
    This is a pretty low-level API that I wouldn't expect most people using
    these exports to need, but it does come in handy for some things.
    
    ### Change type
    
    - [x] `improvement`
    
    ### Release notes
    
    Custom shapes (and our own bookmark shapes) now render in image exports
    by default.
    
    ---------
    
    Co-authored-by: huppy-bot[bot] <128400622+huppy-bot[bot]@users.noreply.github.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 2ade3e2b8..f8e057f9d 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -146,6 +146,7 @@ export {
 	Editor,
 	type TLEditorOptions,
 	type TLEditorRunOptions,
+	type TLRenderingShape,
 	type TLResizeShapeOptions,
 } from './lib/editor/Editor'
 export {
@@ -194,6 +195,7 @@ export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/res
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'
 export {
+	useDelaySvgExport,
 	useSvgExportContext,
 	type SvgExportContext,
 	type SvgExportDef,

commit 9556a517d2ad7f1802413972aa607237c368b2fd
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Fri Sep 13 19:03:24 2024 +0100

    Enable license feature flag. (#4518)
    
    This PR fixes a bug where the license check would not run in production.
    
    ### Change type
    
    - [x] `bugfix`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index f8e057f9d..48fbe8daf 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -4,7 +4,6 @@ import 'core-js/stable/array/flat-map.js'
 import 'core-js/stable/array/flat.js'
 import 'core-js/stable/string/at.js'
 import 'core-js/stable/string/replace-all.js'
-import { featureFlags } from './lib/utils/debug-flags'
 
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/store'
@@ -402,12 +401,12 @@ export { hardReset } from './lib/utils/sync/hardReset'
 export { uniq } from './lib/utils/uniq'
 export { openWindow } from './lib/utils/window-open'
 
-/** @public */
+/**
+ * @deprecated Licensing is now enabled in the tldraw SDK.
+ * @public */
 export function debugEnableLicensing() {
-	featureFlags.enableLicensing.set(true)
-	return () => {
-		featureFlags.enableLicensing.set(false)
-	}
+	// noop
+	return
 }
 
 registerTldrawLibraryVersion(

commit b33cc2e6b0f2630ec328018f592e3d301b90efaf
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Mon Sep 23 18:07:34 2024 +0100

    [feature] isShapeHidden option (#4446)
    
    This PR adds an option to the Editor that allows people to control the
    visibility of shapes. This has been requested a couple of times for
    different use-cases:
    
    - A layer panel with a visibility toggle per shape
    - A kind-of 'private' drawing mode in a multiplayer app.
    
    So to test this feature out I've implemented both of those in minimal
    ways as examples.
    
    ### Change type
    
    - [x] `feature`
    
    
    ### Test plan
    
    - [x] Unit tests
    
    
    ### Release notes
    
    - Adds an `isShapeHidden` option, which allows you to provide custom
    logic to decide whether or not a shape should be shown on the canvas.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 48fbe8daf..d5d650550 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -28,6 +28,7 @@ export {
 } from '@tldraw/state'
 export {
 	track,
+	useAtom,
 	useComputed,
 	useQuickReactor,
 	useReactor,

commit 804a87fe10dee58d8fb0b4ef1182ce49790e8e1f
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Mon Sep 30 14:24:10 2024 +0100

    chore: refactor safe id (#4618)
    
    just a little thing that was driving me nuts :P
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [x] `other`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index d5d650550..d51867ba0 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -272,7 +272,7 @@ export { useLocalStore } from './lib/hooks/useLocalStore'
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
 export { useRefState } from './lib/hooks/useRefState'
-export { useSafeId } from './lib/hooks/useSafeId'
+export { sanitizeId, useSafeId } from './lib/hooks/useSafeId'
 export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLSchemaFromUtils, useTLStore } from './lib/hooks/useTLStore'
 export { useTransform } from './lib/hooks/useTransform'

commit 09f89a60f403ff704c1372eff9fecba6cd5ce361
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Mon Sep 30 16:27:45 2024 -0400

    [dotcom] Menus, dialogs, toasts, etc. (#4624)
    
    This PR brings tldraw's ui into the application layer: dialogs, menus,
    etc.
    
    It:
    - brings our dialogs to the application layer
    - brings our toasts to the application layer
    - brings our translations to the application layer
    - brings our assets to the application layer
    - creates a "file menu"
    - creates a "rename file" dialog
    - creates the UI for changing the title of a file in the header
    - adjusts some text sizes
    
    In order to do that, I've had to:
    - create a global `tlmenus` system for menus
    - create a global `tltime` system for timers
    - create a global `tlenv` for environment"
    - create a `useMaybeEditor` hook
    
    ### Change type
    
    - [x] `other`
    
    ### Release notes
    - exports dialogs system
    - exports toasts system
    - exports translations system
    - create a global `tlmenus` system for menus
    - create a global `tltime` system for timers
    - create a global `tlenv` for environment"
    - create a `useMaybeEditor` hook
    
    ---------
    
    Co-authored-by: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index d51867ba0..4ab76d1e4 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -4,7 +4,12 @@ import 'core-js/stable/array/flat-map.js'
 import 'core-js/stable/array/flat.js'
 import 'core-js/stable/string/at.js'
 import 'core-js/stable/string/replace-all.js'
-
+export { tlenv } from './lib/globals/environment'
+export { tlmenus } from './lib/globals/menus'
+export { tltime } from './lib/globals/time'
+export { useContainerIfExists } from './lib/hooks/useContainer'
+export { useMaybeEditor } from './lib/hooks/useEditor'
+export { useGlobalMenuIsOpen } from './lib/hooks/useGlobalMenuIsOpen'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/store'
 // eslint-disable-next-line local/no-export-star
@@ -161,7 +166,6 @@ export {
 } from './lib/editor/bindings/BindingUtil'
 export { ClickManager, type TLClickState } from './lib/editor/managers/ClickManager'
 export { EdgeScrollManager } from './lib/editor/managers/EdgeScrollManager'
-export { EnvironmentManager } from './lib/editor/managers/EnvironmentManager'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'
 export { ScribbleManager, type ScribbleItem } from './lib/editor/managers/ScribbleManager'
 export {
@@ -258,7 +262,11 @@ export {
 	type TLSvgOptions,
 } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
-export { ContainerProvider, useContainer } from './lib/hooks/useContainer'
+export {
+	ContainerProvider,
+	useContainer,
+	type ContainerProviderProps,
+} from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'
 export { useEditor } from './lib/hooks/useEditor'
 export { useEditorComponents } from './lib/hooks/useEditorComponents'

commit 4aeb1496b83a80d46c934931f23adb25ea9cf35c
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Thu Oct 3 20:59:09 2024 +0100

    selection: allow cmd/ctrl to add to selection (#4570)
    
    In the How-To sesh, I noticed that using Shift of course lets you add to
    a selection of shapes, but Cmd/Ctrl does not.
    Typically, cmd/ctrl lets you do this in other contexts so some of that
    muscle memory doesn't get allowed in tldraw currently.
    This enables cmd/ctrl to have the same behavior as shift.
    
    ### Change type
    
    - [ ] `bugfix`
    - [x] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Release notes
    
    - Selection: allow cmd/ctrl to add multiple shapes to the selection.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 4ab76d1e4..ec4a6c405 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -397,6 +397,7 @@ export { getIncrementedName } from './lib/utils/getIncrementedName'
 export { getPointerInfo } from './lib/utils/getPointerInfo'
 export { getSvgPathFromPoints } from './lib/utils/getSvgPathFromPoints'
 export { hardResetEditor } from './lib/utils/hardResetEditor'
+export { isAccelKey } from './lib/utils/keyboard'
 export { normalizeWheel } from './lib/utils/normalizeWheel'
 export { refreshPage } from './lib/utils/refreshPage'
 export {

commit 77cc5d8d6ccb94b4e6d5c1d7c715a2e429c1c4b3
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sun Oct 6 12:24:44 2024 +0100

    Pass through wheel events over non-scrolling user interface elements (#4662)
    
    The new #4651 PR made me look at accidental scrolling, too. This PR has
    a hook, `usePassThroughWheelEvents`, that allows different UI elements
    to opt into "passing through" wheel events to the canvas.
    
    ## Pros
    
    The user can scroll with their mouse wheel or trackpad while their
    pointer is over a toolbar or panel. Previously, this only worked if the
    cursor was over the canvas.
    
    ## Cons
    
    Unfortunately we can't create a single hook that turns off scrolling on
    _everything_ in the UI layer, because some things may actually need to
    scroll, such as our style panel on mobile and dialogs. And some things
    placed outside of the container may need to have their scroll prevented,
    too. As a consequence, every panel has its own
    `usePassThroughWheelEvents` hook.
    
    ### Change type
    
    - [x] `improvement`
    
    ### Test plan
    
    1. Mouse over ui
    2. Scroll wheel / trackpad
    3. The canvas should scroll
    
    ### Release notes
    
    - Fixes a bug where scrolling over user interface elements would not
    scroll the canvas.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index ec4a6c405..c688f4ef9 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -4,21 +4,6 @@ import 'core-js/stable/array/flat-map.js'
 import 'core-js/stable/array/flat.js'
 import 'core-js/stable/string/at.js'
 import 'core-js/stable/string/replace-all.js'
-export { tlenv } from './lib/globals/environment'
-export { tlmenus } from './lib/globals/menus'
-export { tltime } from './lib/globals/time'
-export { useContainerIfExists } from './lib/hooks/useContainer'
-export { useMaybeEditor } from './lib/hooks/useEditor'
-export { useGlobalMenuIsOpen } from './lib/hooks/useGlobalMenuIsOpen'
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/store'
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/tlschema'
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/utils'
-// eslint-disable-next-line local/no-export-star
-export * from '@tldraw/validate'
-
 export {
 	EMPTY_ARRAY,
 	EffectScheduler,
@@ -40,6 +25,14 @@ export {
 	useStateTracking,
 	useValue,
 } from '@tldraw/state-react'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/store'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/tlschema'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/utils'
+// eslint-disable-next-line local/no-export-star
+export * from '@tldraw/validate'
 export {
 	ErrorScreen,
 	LoadingScreen,
@@ -262,21 +255,27 @@ export {
 	type TLSvgOptions,
 } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
+export { tlenv } from './lib/globals/environment'
+export { tlmenus } from './lib/globals/menus'
+export { tltime } from './lib/globals/time'
 export {
 	ContainerProvider,
 	useContainer,
+	useContainerIfExists,
 	type ContainerProviderProps,
 } from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'
-export { useEditor } from './lib/hooks/useEditor'
+export { useEditor, useMaybeEditor } from './lib/hooks/useEditor'
 export { useEditorComponents } from './lib/hooks/useEditorComponents'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
 export { useEvent } from './lib/hooks/useEvent'
+export { useGlobalMenuIsOpen } from './lib/hooks/useGlobalMenuIsOpen'
 export { useShallowArrayIdentity, useShallowObjectIdentity } from './lib/hooks/useIdentity'
 export { useIsCropping } from './lib/hooks/useIsCropping'
 export { useIsDarkMode } from './lib/hooks/useIsDarkMode'
 export { useIsEditing } from './lib/hooks/useIsEditing'
 export { useLocalStore } from './lib/hooks/useLocalStore'
+export { usePassThroughWheelEvents } from './lib/hooks/usePassThroughWheelEvents'
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
 export { useRefState } from './lib/hooks/useRefState'

commit d5f4c1d05bb834ab5623d19d418e31e4ab5afa66
Author: alex <alex@dytry.ch>
Date:   Wed Oct 9 15:55:15 2024 +0100

    make sure DOM IDs are globally unique (#4694)
    
    There are a lot of places where we currently derive a DOM ID from a
    shape ID. This works fine (ish) on tldraw.com, but doesn't work for a
    lot of developer use-cases: if there are multiple tldraw instances or
    exports happening, for example. This is because the DOM expects IDs to
    be globally unique. If there are multiple elements with the same ID in
    the dom, only the first is ever used. This can cause issues if e.g.
    
    1. i have a shape with a clip-path determined by the shape ID
    2. i export that shape and add the resulting SVG to the dom. now, there
    are two clip paths with the same ID, but they're the same
    3. I change the shape - and now, the ID is referring to the export, so i
    get weird rendering issues.
    
    This diff attempts to resolve this issue and prevent it from happening
    again by introducing a new `SafeId` type, and helpers for generating and
    working with `SafeId`s. in tldraw, jsx using the `id` attribute will now
    result in a type error if the value isn't a safe ID. This doesn't affect
    library consumers writing JSX.
    
    As part of this, I've removed the ID that were added to certain shapes.
    Instead, all shapes now have a `data-shape-id` attribute on their
    wrapper.
    
    ### Change type
    
    - [x] `bugfix`
    
    ### Release notes
    
    - Exports and other tldraw instances no longer can affect how each other
    are rendered
    - **BREAKING:** the `id` attribute that was present on some shapes in
    the dom has been removed. there's now a data-shape-id attribute on every
    shape wrapper instead though.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index c688f4ef9..0911b820c 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -279,7 +279,13 @@ export { usePassThroughWheelEvents } from './lib/hooks/usePassThroughWheelEvents
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
 export { useRefState } from './lib/hooks/useRefState'
-export { sanitizeId, useSafeId } from './lib/hooks/useSafeId'
+export {
+	sanitizeId,
+	suffixSafeId,
+	useSharedSafeId,
+	useUniqueSafeId,
+	type SafeId,
+} from './lib/hooks/useSafeId'
 export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLSchemaFromUtils, useTLStore } from './lib/hooks/useTLStore'
 export { useTransform } from './lib/hooks/useTransform'

commit 9d6b5916e83ef758dc7c28d3fc221fd4f0236b14
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Mon Oct 21 13:01:37 2024 +0100

    menus: rework the open menu logic to be in one consistent place (#4642)
    
    We have a lot of logic scattered everywhere to prevent certain logic
    when menus are open. It's a very manual process, easy to forget about
    when adding new shapes/tools/logic. This flips the logic a bit to be
    handled in one place vs. various places trying to account for this.
    
    ### Change type
    
    - [ ] `bugfix`
    - [x] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Release notes
    
    - Rework open menu logic to be centralized.
    
    ---------
    
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 0911b820c..f33438752 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -52,6 +52,7 @@ export {
 	type TLErrorBoundaryProps,
 } from './lib/components/ErrorBoundary'
 export { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'
+export { MenuClickCapture } from './lib/components/MenuClickCapture'
 export { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'
 export { DefaultBackground } from './lib/components/default-components/DefaultBackground'
 export { DefaultBrush, type TLBrushProps } from './lib/components/default-components/DefaultBrush'

commit 9894eb43b99ee673f0d42cd4a7069c83865ded7d
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Mon Oct 21 14:26:32 2024 +0100

    botcom: account menu [bk] (#4683)
    
    [bk=burger king, as Alex says] kinda funky b/c i'm doing these
    MaybeProviders in `TlaRootProviders.tsx`. but it does work. lemme know
    what you think â€” we can rework from here.
    
    <img width="708" alt="Screenshot 2024-10-07 at 22 12 33"
    src="https://github.com/user-attachments/assets/554be50a-1842-4659-adff-dfed8fc4e0a5">
    
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [x] `other`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index f33438752..87fcf7ad7 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -126,6 +126,7 @@ export {
 	getFreshUserPreferences,
 	getUserPreferences,
 	setUserPreferences,
+	userTypeValidator,
 	type TLUserPreferences,
 } from './lib/config/TLUserPreferences'
 export {
@@ -266,7 +267,7 @@ export {
 	type ContainerProviderProps,
 } from './lib/hooks/useContainer'
 export { getCursor } from './lib/hooks/useCursor'
-export { useEditor, useMaybeEditor } from './lib/hooks/useEditor'
+export { EditorContext, useEditor, useMaybeEditor } from './lib/hooks/useEditor'
 export { useEditorComponents } from './lib/hooks/useEditorComponents'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
 export { useEvent } from './lib/hooks/useEvent'

commit b301aeb64e5ff7bcd55928d7200a39092da8c501
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Wed Oct 23 15:55:42 2024 +0100

    npm: upgrade eslint v8 â†’ v9 (#4757)
    
    As I worked on the i18n PR (https://github.com/tldraw/tldraw/pull/4719)
    I noticed that `react-intl` required a new version of `eslint`. That led
    me down a bit of a rabbit hole of upgrading v8 â†’ v9. There were a couple
    things to upgrade to make this work.
    
    - ran `npx @eslint/migrate-config .eslintrc.js` to upgrade to the new
    `eslint.config.mjs`
    - `.eslintignore` is now deprecated and part of `eslint.config.mjs`
    - some packages are no longer relevant, of note: `eslint-plugin-local`
    and `eslint-plugin-deprecation`
    - the upgrade caught a couple bugs/dead code
    
    ### Change type
    
    - [ ] `bugfix`
    - [x] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Release notes
    
    - Upgrade eslint v8 â†’ v9
    
    ---------
    
    Co-authored-by: alex <alex@dytry.ch>
    Co-authored-by: David Sheldrick <d.j.sheldrick@gmail.com>
    Co-authored-by: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 87fcf7ad7..2bd2bb283 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -253,7 +253,6 @@ export {
 	type TLCameraMoveOptions,
 	type TLCameraOptions,
 	type TLImageExportOptions,
-	// eslint-disable-next-line deprecation/deprecation
 	type TLSvgOptions,
 } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'

commit 106c984c74945d5cba15176dff695ec2a8746308
Author: Taha <98838967+Taha-Hassan-Git@users.noreply.github.com>
Date:   Wed Nov 13 11:51:30 2024 +0000

    Snap to grid when creating shapes (#4875)
    
    TLD-2817
    
    TLD-2816
    
    This PR makes sure that shapes snap to the grid when created. It adds a
    ```maybeSnapToGrid``` function, which can be used to push a shape onto
    the grid if grid mode is enabled, both when click-creating and when
    drag-creating.
    
    1. Any shapes using the basebox shape tool (i.e frames)
    2. Geo shapes
    3. Both arrow handles
    4. Line shapes, including shift-clicking
    5. Note shapes (when translating, note shapes prefer adjacent note
    positions over grid)
    6. Text shapes
    7. Aligns uploaded assets using the top left of the selection bounds.
    8. Does not snap to the grid when snap indicators are being shown
    
    It also adds tests for this behaviour
    
    ### Change type
    
    - [ ] `bugfix`
    - [x] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. Enable grid
    9. Click-create a note shape off the grid
    10. It should snap to the grid
    11. Add an asset, it should align with the grid
    
    - [x] Unit tests
    - [ ] End to end tests
    
    ### Release notes
    
    - Shapes snap to grid on creation, or when adding points.
    
    ---------
    
    Co-authored-by: Mime ÄŒuvalo <mimecuvalo@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 2bd2bb283..364189614 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -192,6 +192,7 @@ export { GroupShapeUtil } from './lib/editor/shapes/group/GroupShapeUtil'
 export { getPerfectDashProps } from './lib/editor/shapes/shared/getPerfectDashProps'
 export { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'
 export { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'
+export { maybeSnapToGrid } from './lib/editor/tools/BaseBoxShapeTool/children/Pointing'
 export { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'
 export {
 	useDelaySvgExport,

commit 4ecbef54a7fe82634fe682ed148165bc496b7b56
Author: David Sheldrick <d.j.sheldrick@gmail.com>
Date:   Fri Dec 6 13:52:44 2024 +0000

    [botcom] slurp local files on sign in (#5059)
    
    This PR replaces the temporary multiplayer room from the logged out root
    page with the previous local editor, and 'slurps' the data into a new
    room during the sign in flow.
    
    If something goes wrong the user sees this:
    <img width="541" alt="image"
    src="https://github.com/user-attachments/assets/92413d9a-a90c-43b6-b05d-4e0acdc7db30">
    
    follow up work:
    
    - [ ] e2e tests
    - [ ] add Terms and conditions checkbox to sign in
    
    I'll create tickets for these upon merging.
    
    
    ### Change type
    
    
    - [x] `other`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 364189614..b1a6334f0 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -25,6 +25,7 @@ export {
 	useStateTracking,
 	useValue,
 } from '@tldraw/state-react'
+export { LocalIndexedDb, Table, type StoreName } from './lib/utils/sync/LocalIndexedDb'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/store'
 // eslint-disable-next-line local/no-export-star

commit db18f4c2499282dfa387f55c486430a81a59dad8
Author: alex <alex@dytry.ch>
Date:   Mon Dec 16 16:00:13 2024 +0000

    custom sync presence (#5071)
    
    Allow supplying a custom presence derivation to `useSync` and
    `useSyncDemo`.
    
    ### Change type
    - [x] `api`
    
    ### Release notes
    
    - It's now possible to customise what presence data is synced between
    clients, or disable presence syncing entirely.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index b1a6334f0..abf5f02ab 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -271,7 +271,7 @@ export { getCursor } from './lib/hooks/useCursor'
 export { EditorContext, useEditor, useMaybeEditor } from './lib/hooks/useEditor'
 export { useEditorComponents } from './lib/hooks/useEditorComponents'
 export type { TLEditorComponents } from './lib/hooks/useEditorComponents'
-export { useEvent } from './lib/hooks/useEvent'
+export { useEvent, useReactiveEvent } from './lib/hooks/useEvent'
 export { useGlobalMenuIsOpen } from './lib/hooks/useGlobalMenuIsOpen'
 export { useShallowArrayIdentity, useShallowObjectIdentity } from './lib/hooks/useIdentity'
 export { useIsCropping } from './lib/hooks/useIsCropping'

commit 5ed55f12f0508edec34292d7c1bdd08b4e8c21a1
Author: alex <alex@dytry.ch>
Date:   Mon Jan 20 18:19:00 2025 +0000

    Exports DX pass (#5114)
    
    Over the last few weeks we've had a lot of requests on discord around
    asset resolution, exports, and the two together. Some of the APIs here
    have evolved and change independently of each other over time, so I
    wanted to take a pass at making them make sense with each other a bit
    more. There are a few things going on in this diff:
    
    1. **BREAKING** The export/copy-as JSON option has been removed. I think
    this was only ever there as a debug helper, and it's impossible to
    actually make use of the JSON once copied (it's not the same as .tldr
    json which confuses people).
    2. `exportToBlob` is deprecated in favour of a new `Editor.toImage`
    method. `exportToBlob` has been the canonical 'turn the canvas into an
    image' helper for a while, but it has quite a weird looking signature
    and isn't very discoverable.
    3. the `copyAs` and `exportAs` helpers have had a couple of args merged
    into the options bag for consistency.
    4. The `jpeg` format has been removed from `copyAs`. This is technically
    a breaking API change, but since it never actually worked anyway due to
    browser limitations i think its fine.
    5. SVG exports now resolve assets according to how they'll be used:
    - if it's for an SVG, we still use the existing
    `shouldResolveToOriginal` behaviour
    - if it's for a bitmap export, we request an image downscaled according
    to the size it will appear in that resulting bitmap.
    6. Better reference docs for several APIs around this stuff.
    7. **BREAKING** the `useImageOrVideoAsset` hook now requires passing in
    `width`, instead of reading `shape.props.w`. This is so it can be used
    with shapes other than our own. Whilst this is technically a breaking
    change, this limitation means its unlikely that it was used with many
    custom shapes in practice.
    8. The clamping that we used to apply in to `steppedScreenScale` in
    `resolveAssetUrl` has been moved to our own implementations of
    `TLAssetStore`. This is so implementors can make their own decisions
    about the range of scalings they might want to use.
    9. The `steppedScreenScale` limit changed from 1/8 to 1/32. This is
    because when testing with full res photos from a modern smartphone, we
    were still downloading a 1000+px image in order to render it at a few
    hundred px across (and also we don't pay anything for these right now).
    Happy to change now/in the future if this doesn't seem right though.
    
    ### Change type
    
    - [x] `api`
    
    ### Release notes
    
    #### Breaking changes / user facing changes
    - The copy/export as JSON option has been removed. Data copied/exported
    from here could not be used anyway. If you need this in your app, look
    into `Editor.getContentFromCurrentPage`.
    - `useImageOrVideoAssetUrl` now expects a `width` parameter representing
    the rendered width of the asset.
    - `Editor.getSvgElement` and `Editor.getSvgString` will now export all
    shapes on the current page instead of returning undefined when passed an
    empty array of shape ids.
    
    #### Product improvement
    - When exporting to an image, image assets are now downloaded at a
    resolution appropriate for how they will appear in the export.
    
    #### API changes
    - There's a new `Editor.toImage` method that makes creating an image
    from your canvas easier. (`exportToBlob` is deprecated in favour of it)
    - `SvgExportContext` now exposes the `scale` and `pixelRatio` options of
    the current export
    - `SvgExportContext` now has a `resolveAssetUrl` method to resolve an
    asset at a resolution appropriate for the export.
    - `copyAs(editor, ids, format, opts)` has been deprecated in favour of
    `copyAs(editor, ids, opts)`.
    - `exportAs(editor, ids, format, name, opts)` has been deprecated in
    favour of `exportAs(editor, ids, opts)`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index abf5f02ab..d28787afa 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -254,10 +254,13 @@ export {
 	type TLCameraConstraints,
 	type TLCameraMoveOptions,
 	type TLCameraOptions,
+	type TLExportType,
 	type TLImageExportOptions,
+	type TLSvgExportOptions,
 	type TLSvgOptions,
 } from './lib/editor/types/misc-types'
 export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
+export { getSvgAsImage } from './lib/exports/getSvgAsImage'
 export { tlenv } from './lib/globals/environment'
 export { tlmenus } from './lib/globals/menus'
 export { tltime } from './lib/globals/time'
@@ -381,6 +384,7 @@ export {
 	type SharedStyle,
 } from './lib/utils/SharedStylesMap'
 export { dataUrlToFile, getDefaultCdnBaseUrl } from './lib/utils/assets'
+export { clampToBrowserMaxCanvasSize, type CanvasMaxSize } from './lib/utils/browserCanvasMaxSize'
 export {
 	debugFlags,
 	featureFlags,

commit 7a17cab026a311d76361825f446407b0e330597c
Author: Trygve Aaberge <trygve.aaberge@autodesk.com>
Date:   Tue Jan 28 11:42:43 2025 +0100

    Add an onCrop handler to ShapeUtil (#5137)
    
    This is called when cropping and allows you to override the crop
    calculations. This is useful for instance to set a min width and/or
    height for the cropping.
    
    It can also be used to provide a completely different cropping
    mechanism, e.g. to keep the size of the shape fixed and instead resize
    the image when cropping. This would require overriding the
    SelectionForeground component, but it's better to only have to override
    that than the whole selection tool. And maybe that component can be made
    more dynamic in the future.
    
    This also defines specific crop interfaces instead of using the ones
    from the image shape and uses the correct util instead of the image util
    when cropping. Any shape can define that it supports cropping, so I
    don't think it should be tied to the image shape.
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. Add an onCrop handler to a util for a shape that can be cropped.
    1. Create a shape with a crop prop.
    2. Try to crop the shape and see that the behavior in onCrop is applied.
    
    - [x] Unit tests
    - [ ] End to end tests
    
    ### Release notes
    
    - Add support for an onCrop handler on shape utils that allows you to
    prevent or modify the crop.
    - The `TLImageShapeCrop` type has been replaced by `TLShapeCrop`.
    
    ---------
    
    Co-authored-by: Mime ÄŒuvalo <mimecuvalo@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index d28787afa..5af1ab6ba 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -182,6 +182,7 @@ export { UserPreferencesManager } from './lib/editor/managers/UserPreferencesMan
 export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseBoxShapeUtil'
 export {
 	ShapeUtil,
+	type TLCropInfo,
 	type TLHandleDragInfo,
 	type TLResizeInfo,
 	type TLResizeMode,

commit 0370480992065ccc4cc586568e4dc4d69f2d452f
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Jan 28 14:27:15 2025 +0000

    Add editor option to allow sticky note resizing by scale (#5273)
    
    This PR adds an option to resize sticky notes. There are a few ways that
    sticky notes _could_ resize however these are all a bit more complicated
    and would take time to unpick This PR only adds "scale" resizing while
    leaving some doors open for other options in the future.
    
    This PR also:
    - fixes a bug with `getNoteForPit`
    - changes the zIndex of handles to be in front of selection foreground
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [ ] `feature`
    - [x] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. Visit the "resize note shape" example
    2. Resize a note shape
    
    - [x] Unit tests
    
    ### Release notes
    
    - Added `options.noteShapeResizeMode` editor option to control how note
    shapes resize.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 5af1ab6ba..a7ed2cd31 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -25,6 +25,7 @@ export {
 	useStateTracking,
 	useValue,
 } from '@tldraw/state-react'
+export { resizeScaled } from './lib/editor/shapes/shared/resizeScaled'
 export { LocalIndexedDb, Table, type StoreName } from './lib/utils/sync/LocalIndexedDb'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/store'

commit 9b13f6b7554c52facf2bd81ce1377ec57a397944
Author: alex <alex@dytry.ch>
Date:   Thu Jan 30 10:34:05 2025 +0000

    separately export default external content/asset handlers (#5298)
    
    Currently, if you want to e.g. augment but not override one of our
    default content handlers (e.g. to add audio file support to pasting),
    you have to copy-paste the entirety of that handler into your app. This
    kind of sucks. Now, you can call our default handlers yourself, so you
    can augment how they work without having to completely re-implement
    them.
    
    For reviewers: it's easiest to read this diff with [whitespace changed
    hidden](https://github.com/tldraw/tldraw/pull/5298/files?diff=split&w=1#diff-51f3e244dba5247299a2153f96348efdca84e0e8fb8fe27cff4443dd9d8d4161)
    
    ### Change type
    
    - [x] `api`
    
    ### Release notes
    
    - You can now import each of our external asset/content handlers, so you
    can augment them without having to copy-paste them into your app
    
    #### BREAKING
    - `TLExternalAssetContent` has been renamed to `TLExternalAsset`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index a7ed2cd31..fe4c22a2a 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -240,9 +240,21 @@ export {
 	type UiEventType,
 } from './lib/editor/types/event-types'
 export {
-	type TLExternalAssetContent,
+	type TLBaseExternalContent,
+	type TLEmbedExternalContent,
+	type TLErrorExternalContentSource,
+	type TLExcalidrawExternalContentSource,
+	type TLExternalAsset,
 	type TLExternalContent,
 	type TLExternalContentSource,
+	type TLFileExternalAsset,
+	type TLFilesExternalContent,
+	type TLSvgTextExternalContent,
+	type TLTextExternalContent,
+	type TLTextExternalContentSource,
+	type TLTldrawExternalContentSource,
+	type TLUrlExternalAsset,
+	type TLUrlExternalContent,
 } from './lib/editor/types/external-content'
 export {
 	type TLHistoryBatchOptions,

commit fcad75fe42f9f6e451e84f5b3a1aec757c15ca51
Author: Mitja BezenÅ¡ek <mitja.bezensek@gmail.com>
Date:   Fri Feb 7 11:00:57 2025 +0100

    Numeric shortcuts were still getting triggered when used inside some inputs (like the file rename input) (#5378)
    
    We used `hotkeys` library [in the past
    t](https://github.com/tldraw/tldraw/pull/5340)o add the shortcuts for
    numeric tool shortcut keys. Looks like it handled the editable element
    filtering (not triggering keyboard shortcuts when the source was an
    editable element). Since we no longer use that we should prevent the
    shortcuts manually.
    
    ### Change type
    
    - [x] `bugfix`
    
    ### Test plan
    
    1. Edit the file name in the sidebar.
    2. Pressing 1, 2, 3 should no longer change the tool and should add the
    pressed key to the name input.
    
    ### Release notes
    
    - Fix an issue with numeric shortcuts working inside of editable
    elements.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index fe4c22a2a..324e52fd9 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -413,6 +413,7 @@ export {
 	type TLDeepLinkOptions,
 } from './lib/utils/deepLinks'
 export {
+	activeElementShouldCaptureKeys,
 	loopToHtmlElement,
 	preventDefault,
 	releasePointerCapture,

commit d14754ca7629205953c00615b2524286a2ec5353
Author: alex <alex@dytry.ch>
Date:   Wed Feb 12 13:53:55 2025 +0000

    Add tldraw and excalidraw to external content types (#5402)
    
    Almost all paste operations currently turn into calls to
    `putExternalContent`, which means they can be customized using
    `registerExternalContentHandler`. tldraw and excalidraw content are
    different: they're handled directly in the clipboard code, and so can't
    be customized.
    
    This diff changes that: these types now have external content handlers,
    and default implementations for how they work. We also add an example
    demonstrating how you can use this API to override pasting of e.g.
    single frame shapes to match how figma handles these (finding a space
    for them instead of pasting them in place).
    
    ### Change type
    
    - [x] `api`
    
    ### Release notes
    
    - You can now customize how pasted tldraw and excalidraw content is
    handled with `registerExternalContentHandler`.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 324e52fd9..764014c81 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -243,6 +243,7 @@ export {
 	type TLBaseExternalContent,
 	type TLEmbedExternalContent,
 	type TLErrorExternalContentSource,
+	type TLExcalidrawExternalContent,
 	type TLExcalidrawExternalContentSource,
 	type TLExternalAsset,
 	type TLExternalContent,
@@ -252,6 +253,7 @@ export {
 	type TLSvgTextExternalContent,
 	type TLTextExternalContent,
 	type TLTextExternalContentSource,
+	type TLTldrawExternalContent,
 	type TLTldrawExternalContentSource,
 	type TLUrlExternalAsset,
 	type TLUrlExternalContent,

commit d799df28e99e17bb71d1ab198f7c910fc3987a88
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Feb 25 14:17:56 2025 +0000

    Fix text padding, add context to shape geometry (#5487)
    
    Long have we suffered from this:
    
    <img width="630" alt="image"
    src="https://github.com/user-attachments/assets/6675d2be-09e4-4f08-8d1b-5c30ec8ff2c5"
    />
    
    Text has no horizontal padding. We've tried adding horizontal padding
    before (see #1084, #2855) however we always ran into a circular problem.
    
    - Adding horizontal text padding makes arrows look better
    - ...but then it runs alignment / snapping / selection
    - ...and it makes text move around
    
    
    ![image](https://github.com/user-attachments/assets/ab12d896-d5df-486b-aca8-19170cae781b)
    
    What do we really want? **Contextual geometry**.
    
    ![Kapture 2025-02-24 at 15 42
    22](https://github.com/user-attachments/assets/84e4c2b9-3688-410c-ae3f-e386d5fd8b6c)
    
    If I'm creating arrow info, I might want a different geometry than if
    I'm snapping or aligning.
    
    **Pros:**
    
     - Additive API, no other changes
     - No migrations needed
     - Opens the door for other contextual geometries
    - Might be useful also for lines, highlighters, draw shapes, and other
    shapes
    
    **Cons**
    
    - More geometries cached (ie any shape that I've ever pointed an arrow
    to)
    
    ### Change type
    
    - [x] `improvement`
    - [x] `api`
    
    ### Test plan
    
    1. Create a text shape
    2. Make a horizontal arrow pointing from the text shape to something
    else
    
    ### Release notes
    
    - Improved horizontal padding for arrows bound to text shapes

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 764014c81..b1c93b712 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -184,6 +184,7 @@ export { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseB
 export {
 	ShapeUtil,
 	type TLCropInfo,
+	type TLGeometryOpts,
 	type TLHandleDragInfo,
 	type TLResizeInfo,
 	type TLResizeMode,

commit 54b645dd9728bc7629b4a451dc96867a39cf98f6
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Tue Feb 25 16:05:20 2025 +0000

    Improve / fix layout methods: alignment, distribute, flip, stack. (#5479)
    
    This PR fixes various bugs in our layout methods: align, distribute,
    flip, stack, pack, etc.
    
    There are a lot of small changes and fixes in this PR but the main one
    is **shape clustering**.
    
    ## Shape clustering
    
    Previously, all of our layout options had bugs related to arrows. Our
    early solution was to ignore arrows, however this only partially solved
    the problem. Often the results would not be anywhere near
    expectationsâ€”obviously wrongâ€”but there wasn't a clear idea of what would
    be correct.
    
    While working on this problem, I had the idea to try treating networks
    of bound-and-selected shapes as "clusters" that would move together.
    This was specifically to solve a problem that could occur when aligning
    a shape that had an arrow bound to it and the other end not bound to
    anything.
    
    In this PR, all of our layout functions (except flip) move "clusters"
    rather than individual shapesâ€”though most clusters only contain a single
    shape.
    
    <img width="553" alt="image"
    src="https://github.com/user-attachments/assets/7245689c-80bd-4ae0-85df-d42d00251d44"
    />
    
    This fixes many problems which were previously impossible to solve. A
    use can bail out of the behavior by not selecting the arrows, just as
    they could before.
    
    ## Alignment
    
    Alignment now works correctly with clusters of bound shapes.
    
    ![Kapture 2025-02-23 at 09 41
    23](https://github.com/user-attachments/assets/de75ae58-17ab-430d-871f-cd8a0f3ad05e)
    
    ![Kapture 2025-02-23 at 18 19
    47](https://github.com/user-attachments/assets/10cc8841-8ec0-4d98-9872-545edcc1002d)
    
    ![Kapture 2025-02-23 at 18 21
    57](https://github.com/user-attachments/assets/fee0d432-5242-45dd-a47c-c659326f91fa)
    
    ## Distribution
    
    Distribution now works correctly with clusters of bound shapes.
    
    Adjusts the logic for distribution so that the result will **space
    shapes out evenly between** the first and last shapes, rather than
    spacing out the centers of the shapes.
    
    Fixes a bug when distributing shapes if the same shape constituted the
    first and last shape.
    
    Fixes a bug when distributing shapes if the last shape would change the
    dimensions of the selection.
    
    ![Kapture 2025-02-23 at 09 44
    11](https://github.com/user-attachments/assets/9991a149-9eb1-43e7-bc7c-0dcc6f1a087b)
    
    ![Kapture 2025-02-23 at 18 24
    40](https://github.com/user-attachments/assets/2dd815a1-7e0c-424f-b1d5-5377fbe41ddb)
    
    ## Flip
    
    I fixed a minor bug with arrows in flipping.
    
    ![Kapture 2025-02-23 at 15 03
    04](https://github.com/user-attachments/assets/59a1d7cc-6956-4f1b-a772-a4ae1fd4414c)
    
    ## Stretch
    
    Stretch now works with clusters of shapes.
    
    Fixed a limitation with rotated shapes. Previously, stretching did not
    support any page-rotated shapes unless their page rotation was a
    multiple of PI2. It now supports shapes with any rotation equal to PI /
    2 (e.g. 90, 180, 270, or 360 degrees, and so on).
    
    ## Pack
    
    Pack not works with clusters of shapes.
    
    ![Kapture 2025-02-23 at 17 48
    12](https://github.com/user-attachments/assets/2b9a35d4-1387-42db-97d1-80966a3822b0)
    
    ### Change type
    
    - [x] `bugfix`
    
    ### Test plan
    
    1. Align a shape to an edge where that edge in the shape bounds is
    defined by an arrow
    2. Distribute overlapping or irregular shapes
    
    - [x] Unit tests
    
    ### Release notes
    
    - Fixes several bugs when aligning / flipping / distributing /
    stretching / stacking a selection that included with arrows.
    - Fixed a bug with distribution with overlapping shapes
    - Fixed a bug with distribution that could lead to changed selection.
    - Fixed a bug preventing rotated shapes from being stretched.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index b1c93b712..eed4a39ee 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -188,6 +188,7 @@ export {
 	type TLHandleDragInfo,
 	type TLResizeInfo,
 	type TLResizeMode,
+	type TLShapeUtilCanBeLaidOutOpts,
 	type TLShapeUtilCanBindOpts,
 	type TLShapeUtilCanvasSvgDef,
 	type TLShapeUtilConstructor,

commit 3bf31007c5a7274f3f7926a84c96c89a4cc2c278
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Mon Mar 3 14:23:09 2025 +0000

    [feature] add rich text and contextual toolbar (#4895)
    
    We're looking to add rich text to the editor!
    
    We originally started with ProseMirror but it became quickly clear that
    since it's more down-to-the-metal we'd have to rebuild a bunch of
    functionality, effectively managing a rich text editor in addition to a
    2D canvas. Examples of this include behaviors around lists where people
    expect certain behaviors around combination of lists next to each other,
    tabbing, etc.
    On top of those product expectations, we'd need to provide a
    higher-level API that provided better DX around things like
    transactions, switching between listsâ†”headers, and more.
    
    Given those considerations, a very natural fit was to use TipTap. Much
    like tldraw, they provide a great experience around manipulating a rich
    text editor. And, we want to pass on those product/DX benefits
    downstream to our SDK users.
    
    Some high-level notes:
    - the data is stored as the TipTap stringified JSON, it's lightly
    validated at the moment, but not stringently.
    - there was originally going to be a short-circuit path for plaintext
    but it ended up being error-prone with richtext/plaintext living
    side-by-side. (this meant there were two separate fields)
    - We could still add a way to render faster â€” I just want to avoid it
    being two separate fields, too many footguns.
    - things like arrow labels are only plain text (debatable though).
    
    Other related efforts:
    - https://github.com/tldraw/tldraw/pull/3051
    - https://github.com/tldraw/tldraw/pull/2825
    
    Todo
    - [ ] figure out whether we should have a migration or not. This is what
    we discussed cc @ds300 and @SomeHats - and whether older clients would
    start messing up newer clients. The data becomes lossy if older clients
    overwrite with plaintext.
    
    <img width="427" alt="Screenshot 2024-12-09 at 14 43 51"
    src="https://github.com/user-attachments/assets/f9dddaee-bfd3-4746-8016-d4247e417e80">
    <img width="378" alt="Screenshot 2024-12-09 at 14 42 59"
    src="https://github.com/user-attachments/assets/95e016d3-ab4d-4d34-afd3-b3ef511d2d77">
    
    Current discussion list:
    - [x] positioning: discuss toolbar position (selection bounds vs cursor
    bounds, toolbar is going in center weirdly sometimes)
    - [x] artificial delay: latest updates make it feel slow/unresponsive?
    e.g. list toggle, changing selection
    - [x] keyboard selection: discuss toolbar logic around "mousing around"
    vs. being present when keyboard selecting (which is annoying)
    - [x] mobile: discuss concerns around mobile toolbar
    - [x] mobile, precision tap: discuss / rm tap into text (and sticky
    notes?) - disable precision editing on mobile
    - [x] discuss
    useContextualToolbar/useContextualToolbarPosition/ContextualToolbar/TldrawUiContextualToolbar
    example
    - [x] existing code: middle alignment for pasted text - keep?
    - [x] existing code: should text replace the shape content when pasted?
    keep?
    - [x] discuss animation, we had it, nixed it, it's back again; why the
    0.08s animation? imperceptible?
    - [x] hide during camera move?
    - [x] short form content - hard to make a different selection b/c
    toolbar is in the way of content
    - [x] check 'overflow: hidden' on tl-text-input (update: this is needed
    to avoid scrollbars)
    - [x] decide on toolbar set: italic, underline, strikethrough, highlight
    - [x] labelColor w/ highlighted text - steve has a commit here to tweak
    highlighting
    
    todos:
    - [x] font rebuild (bold, randomization tweaks) - david looking into
    this
    
    check bugs raised:
    - [x] can't do selection on list item
    - [x] mobile: b/c of the blur/Done logic, doesn't work if you dbl-click
    on geo shape (it's a plaintext problem too)
    - [x] mobile: No cursor when using the text tool - specifically for the
    Text tool â€” can't repro?
    - [x] VSCode html pasting, whitespace issue?
    - [x] Link toolbar make it extend to the widest size of the current tool
    set
    - [x] code has mutual exclusivity (this is a design choice by the Code
    plugin - we could fork)
    - [x] Text is copied to the clipboard with paragraphs rather than line
    breaks.
    - [x] multi-line plaintext for arrows busted
    
    nixed/outdated
    - [ ] ~link: on mobile should be in modal?~
    - [ ] ~link: back button?~
    - [ ] ~list button toggling? (can't repro)~
    - [ ] ~double/triple-clicking is now wonky with the new logic~
    - [ ] ~move blur() code into useEditableRichText - for Done on iOS~
    - [ ] ~toolbar when shape is rotated~
    - [ ] ~"The "isMousingDown" logic doesn't work, the events aren't
    reaching the window. Not sure how we get those from the editor element."
    (can't repro?)~
    - [ ] ~toolbar position bug when toggling code on and off (can't
    repro?)~
    - [ ] ~some issue around "Something's up with the initial size
    calculated from the text selection bounds."~
    - [ ] ~mobile: Context bar still visible out if user presses "Done" to
    end editing~
    - [ ] ~mobile: toolbar when switching between text fields~
    
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [x] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Test plan
    
    1. TODO: write a bunch more tests
    
    - [x] Unit tests
    - [x] End to end tests
    
    ### Release notes
    
    - Rich text using ProseMirror as a first-class supported option in the
    Editor.
    
    ---------
    
    Co-authored-by: huppy-bot[bot] <128400622+huppy-bot[bot]@users.noreply.github.com>
    Co-authored-by: alex <alex@dytry.ch>
    Co-authored-by: David Sheldrick <d.j.sheldrick@gmail.com>
    Co-authored-by: Steve Ruiz <steveruizok@gmail.com>

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index eed4a39ee..08be00c1a 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -26,6 +26,14 @@ export {
 	useValue,
 } from '@tldraw/state-react'
 export { resizeScaled } from './lib/editor/shapes/shared/resizeScaled'
+export {
+	getFontsFromRichText,
+	type RichTextFontVisitor,
+	type RichTextFontVisitorState,
+	type TLTextOptions,
+	type TiptapEditor,
+	type TiptapNode,
+} from './lib/utils/richText'
 export { LocalIndexedDb, Table, type StoreName } from './lib/utils/sync/LocalIndexedDb'
 // eslint-disable-next-line local/no-export-star
 export * from '@tldraw/store'
@@ -163,6 +171,11 @@ export {
 } from './lib/editor/bindings/BindingUtil'
 export { ClickManager, type TLClickState } from './lib/editor/managers/ClickManager'
 export { EdgeScrollManager } from './lib/editor/managers/EdgeScrollManager'
+export {
+	FontManager,
+	type TLFontFace,
+	type TLFontFaceSource,
+} from './lib/editor/managers/FontManager'
 export { HistoryManager } from './lib/editor/managers/HistoryManager'
 export { ScribbleManager, type ScribbleItem } from './lib/editor/managers/ScribbleManager'
 export {
@@ -299,6 +312,7 @@ export { useIsCropping } from './lib/hooks/useIsCropping'
 export { useIsDarkMode } from './lib/hooks/useIsDarkMode'
 export { useIsEditing } from './lib/hooks/useIsEditing'
 export { useLocalStore } from './lib/hooks/useLocalStore'
+export { usePassThroughMouseOverEvents } from './lib/hooks/usePassThroughMouseOverEvents'
 export { usePassThroughWheelEvents } from './lib/hooks/usePassThroughWheelEvents'
 export { usePeerIds } from './lib/hooks/usePeerIds'
 export { usePresence } from './lib/hooks/usePresence'
@@ -313,6 +327,7 @@ export {
 export { useSelectionEvents } from './lib/hooks/useSelectionEvents'
 export { useTLSchemaFromUtils, useTLStore } from './lib/hooks/useTLStore'
 export { useTransform } from './lib/hooks/useTransform'
+export { useViewportHeight } from './lib/hooks/useViewportHeight'
 export {
 	LicenseManager,
 	type InvalidLicenseKeyResult,

commit 3758de89732a9b38e18f60cf887e83a1ccc0d483
Author: Steve Ruiz <steveruizok@gmail.com>
Date:   Sat Mar 15 13:21:03 2025 +0000

    [Fix] indicators hideAll / showAll (#5654)
    
    This PR adds `showAll` and `hideAll` props to the `TLShapeIndicators`
    component.
    
    ## Context
    
    As an optimization, we mount indicators for all shapes and hide or show
    them dynamically using CSS. This is faster than mounting or unmounting
    them dynamically.
    
    There are certain states where we want to hide all of the indicators. We
    allow customization of this logic by overriding a the `ShapeIndicators`
    component. In tldraw's `ShapeIndicators` component override, we check to
    see if we're in one of the select tool's "hide the indicators" states
    and return `null` instead of the default indicators component.
    
    However, this means the indicators are unmounted and remounted whenever
    they're hidden or shown; and on larger projects, this can be a
    performance hit.
    
    ## Solution
    
    This PR provides `hideAll` and `showAll` props to the ShapeIndicators
    component so that we can allow parent components to control visibility
    in a more performant way.
    
    ### For later
    
    It would be good to move _all_ of the "hide indicators when in these
    states" logic out of the DefaultIndicators component, though this would
    be a breaking change.
    
    ### Change type
    
    - [x] `bugfix`
    - [] `improvement`
    - [ ] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Release notes
    
    - Improved performance on large projects when hiding / showing shape
    indicators.
    - Added `hideAll` and `showAll` props to the `ShapeIndicators` component
    props

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 08be00c1a..1581c879e 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -109,7 +109,10 @@ export {
 	type TLShapeIndicatorProps,
 } from './lib/components/default-components/DefaultShapeIndicator'
 export { type TLShapeIndicatorErrorFallbackComponent } from './lib/components/default-components/DefaultShapeIndicatorErrorFallback'
-export { DefaultShapeIndicators } from './lib/components/default-components/DefaultShapeIndicators'
+export {
+	DefaultShapeIndicators,
+	type TLShapeIndicatorsProps,
+} from './lib/components/default-components/DefaultShapeIndicators'
 export {
 	DefaultSnapIndicator,
 	type TLSnapIndicatorProps,

commit 3e2ed74b5e86028fc8b858893821ce2ba1f64c3f
Author: alex <alex@dytry.ch>
Date:   Thu Apr 3 14:15:59 2025 +0100

    Geometry2d Improvements (#5754)
    
    This diff adds a number of `Geometry2d` improvements back-ported from my
    work on elbow arrows.
    
    1. Intersection helpers. We have hit tests, distance to, nearest point
    etc. on geometry, but no intersections. This diff adds support for
    `Geometry2d.intersectLineSegment` and `Geometry2d.intersectCircle`. We
    previously were using these downstream in kind of a hack way, but having
    them directly on the geometry and able to play nicer with groups etc. is
    very helpful.
    2. Transformation. `Geometry2d.transform` allows you to efficiently
    transform a geometry by some matrix. Where possible, we avoid
    transforming every single point and instead forward the methods to the
    original untransformed geometry. This also allows for some efficiency
    gains by e.g. caching geometries in page space. For now, I've only
    ported some really obvious / simple use-cases over to using this, but
    there are many parts of the code that could now be simplified by
    switching to transformed geometries.
    3. Filters. Almost all geometry methods do some sort of filtering - e.g.
    to ignore labels, etc. Sometimes this was hard-coded, sometimes method
    accepted an optional boolean `includeFilters` parameter. Now, all
    methods than can have filters applied accept a filters argument which
    determines which parts do/don't get included in the shape. New here (&
    motivating this change) is a new way of designating parts of a group as
    "internal" geometry - e.g. the lines within a geo shape that we might
    not want to partake in arrow binding.
    
    ### Change type
    
    - [x] `api`
    
    ### Release notes
    
    - It's now easier to work with `Geometry2d` objects, with methods for
    intersections, transforming geometries, and filtering.

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index 1581c879e..a54b75404 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -360,7 +360,12 @@ export { CubicBezier2d } from './lib/primitives/geometry/CubicBezier2d'
 export { CubicSpline2d } from './lib/primitives/geometry/CubicSpline2d'
 export { Edge2d } from './lib/primitives/geometry/Edge2d'
 export { Ellipse2d } from './lib/primitives/geometry/Ellipse2d'
-export { Geometry2d, type Geometry2dOptions } from './lib/primitives/geometry/Geometry2d'
+export {
+	Geometry2d,
+	Geometry2dFilters,
+	TransformedGeometry2d,
+	type Geometry2dOptions,
+} from './lib/primitives/geometry/Geometry2d'
 export { Group2d } from './lib/primitives/geometry/Group2d'
 export { Point2d } from './lib/primitives/geometry/Point2d'
 export { Polygon2d } from './lib/primitives/geometry/Polygon2d'

commit 629125a2e474effa3536411584aaac8f77657673
Author: Mime ÄŒuvalo <mimecuvalo@gmail.com>
Date:   Thu Apr 3 16:07:49 2025 +0100

    a11y: navigable shapes (#5761)
    
    As part of a [larger push](https://github.com/tldraw/tldraw/issues/5215)
    to add accessibility to our SDK, a big piece of that work is being able
    to navigate through our shapes in some kind of predictable fashion. This
    builds upon @Taha-Hassan-Git 's great work and knowledge in this area,
    thanks man. :tip-o-the-hat:
    
    Things that were tackled in this PR:
    - navigating shapes using the Tab key, when in the Select tool.
    - navigating shapes using Cmd/Ctrl+Arrow keys, when in the Select tool.
    - only allowing certain shapes to be navigated to. We ignore
    draw/highlighter/arrow/group/line. Groups need exploration and will be
    tackled later.
    - panning the camera to the selected shape, but avoiding doing so in a
    jarring way. We don't center the shape to avoid too much whiplashy-ness.
    
    An initial foray into this was relaying purely on DOM but it had a bunch
    of browser quirks which forced making this purely a programmatic control
    on our end. Things like ensuring culled shapes are still accessible even
    though they're not rendered was one of the issues but also tab order
    became unpredictable at times which steered me away from that direction.
    
    We coud have considered using something like rbush for some spatial
    indexing of the shapes. For the intents and purposes of this PR, it
    seemed like overkill at the moment. But we might cross that bridge down
    the line, we'll see.
    
    The reading-direction heuristics are a combination of dividing the pages
    into rows and then looking at distance and angles to see what is the
    spatially "next" shape to be read. It takes _all_ of the shapes and
    sorts them into a logical order so that nothing is missed/skipped when
    tabbing around.
    The directional-arrow heuristics don't divide things into rows and don't
    create a sorted set of shapes. Instead, they decide based on the current
    shape and direction which is the next spatially to go to, depending on
    distance+angle.
    
    There's a decent amount of nuance in this kind of navigation but it's
    not all covered in this PR, for separate PRs, we'll look at:
    - [x] adding a "skipping to content" button
    - [ ] question whether maybe directional navigation visits â€˜canTabToâ€™
    shapes, maybe yes?
    - [ ] tackling what Enter/Escape should do when on the canvas shapes
    - [ ] how to deal with hierarchy / parent-child / frame / group shapes
    - [ ] and more
    
    
    
    https://github.com/user-attachments/assets/49b6b34e-2553-4047-846f-5d3383e1e3c6
    
    
    ### Change type
    
    - [ ] `bugfix`
    - [ ] `improvement`
    - [x] `feature`
    - [ ] `api`
    - [ ] `other`
    
    ### Test plan
    
    - [x] Unit tests
    - [x] End to end tests
    
    ### Release notes
    
    - a11y: navigable shapes using Tab and Cmd/Ctrl+Arrow

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index a54b75404..a2fd42d0d 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -293,7 +293,11 @@ export {
 	type TLSvgExportOptions,
 	type TLSvgOptions,
 } from './lib/editor/types/misc-types'
-export { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'
+export {
+	type TLAdjacentDirection,
+	type TLResizeHandle,
+	type TLSelectionHandle,
+} from './lib/editor/types/selection-types'
 export { getSvgAsImage } from './lib/exports/getSvgAsImage'
 export { tlenv } from './lib/globals/environment'
 export { tlmenus } from './lib/globals/menus'

commit 1793786aff8ae46a1214824b2161ed8e76029faa
Author: alex <alex@dytry.ch>
Date:   Tue Apr 15 14:45:16 2025 +0100

    Fix group bounds containing text shapes (#5909) (#5910)
    
    Previously, when constructing group geometry we would implicitly discard
    any 'isLabel' flags on child geometry. That was accidentally removed in
    #5754. This adds it back and makes it explicit.
    
    ### Change type
    
    - [x] `bugfix`

diff --git a/packages/editor/src/index.ts b/packages/editor/src/index.ts
index a2fd42d0d..844eba29a 100644
--- a/packages/editor/src/index.ts
+++ b/packages/editor/src/index.ts
@@ -369,6 +369,7 @@ export {
 	Geometry2dFilters,
 	TransformedGeometry2d,
 	type Geometry2dOptions,
+	type TransformedGeometry2dOptions,
 } from './lib/primitives/geometry/Geometry2d'
 export { Group2d } from './lib/primitives/geometry/Group2d'
 export { Point2d } from './lib/primitives/geometry/Point2d'

