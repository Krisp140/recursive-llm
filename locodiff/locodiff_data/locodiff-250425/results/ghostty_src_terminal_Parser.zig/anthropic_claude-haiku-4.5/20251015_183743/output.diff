
index ed477f2d1..5465fcc77 100644
--- a/ghostty_src_terminal_Parser.zig_expectedoutput.txt (expected):tmp/tmpyq3l9nx7_expected.txt	
+++ b/ghostty_src_terminal_Parser.zig_extracted.txt (actual):tmp/tmp6ozksi09_actual.txt	
@@ -185,7 +185,7 @@ pub const Action = union(enum) {
 
             try writer.writeAll(" }");
         } else {
-            try format(writer, "@{x}", .{@intFromPtr(&self)});
+            try std.fmt.format(writer, "@{x}", .{@intFromPtr(&self)});
         }
     }
 };
@@ -424,25 +424,6 @@ test {
     }
 }
 
-test "esc: ESC ( B" {
-    var p = init();
-    _ = p.next(0x1B);
-    _ = p.next('(');
-
-    {
-        const a = p.next('B');
-        try testing.expect(p.state == .ground);
-        try testing.expect(a[0] == null);
-        try testing.expect(a[1].? == .esc_dispatch);
-        try testing.expect(a[2] == null);
-
-        const d = a[1].?.esc_dispatch;
-        try testing.expect(d.final == 'B');
-        try testing.expect(d.intermediates.len == 1);
-        try testing.expect(d.intermediates[0] == '(');
-    }
-}
-
 test "csi: ESC [ H" {
     var p = init();
     _ = p.next(0x1B);
@@ -484,89 +465,33 @@ test "csi: ESC [ 1 ; 4 H" {
     }
 }
 
-test "csi: SGR ESC [ 38 : 2 m" {
+test "esc: ESC ( B" {
     var p = init();
     _ = p.next(0x1B);
-    _ = p.next('[');
-    _ = p.next('3');
-    _ = p.next('8');
-    _ = p.next(':');
-    _ = p.next('2');
+    _ = p.next('(');
 
     {
-        const a = p.next('m');
+        const a = p.next('B');
         try testing.expect(p.state == .ground);
         try testing.expect(a[0] == null);
-        try testing.expect(a[1].? == .csi_dispatch);
+        try testing.expect(a[1].? == .esc_dispatch);
         try testing.expect(a[2] == null);
 
-        const d = a[1].?.csi_dispatch;
-        try testing.expect(d.final == 'm');
-        try testing.expect(d.params.len == 2);
-        try testing.expectEqual(@as(u16, 38), d.params[0]);
-        try testing.expect(d.params_sep.isSet(0));
-        try testing.expectEqual(@as(u16, 2), d.params[1]);
-        try testing.expect(!d.params_sep.isSet(1));
+        const d = a[1].?.esc_dispatch;
+        try testing.expect(d.final == 'B');
+        try testing.expect(d.intermediates.len == 1);
+        try testing.expect(d.intermediates[0] == '(');
     }
 }
 
-test "csi: SGR colon followed by semicolon" {
+test "csi: SGR ESC [ 38 : 2 m" {
     var p = init();
-    _ = p.next(0x1B);
-    for ("[48:2") |c| {
-        const a = p.next(c);
-        try testing.expect(a[0] == null);
-        try testing.expect(a[1] == null);
-        try testing.expect(a[2] == null);
-    }
-
-    {
-        const a = p.next('m');
-        try testing.expect(p.state == .ground);
-        try testing.expect(a[0] == null);
-        try testing.expect(a[1].? == .csi_dispatch);
-        try testing.expect(a[2] == null);
-    }
-
     _ = p.next(0x1B);
     _ = p.next('[');
-    {
-        const a = p.next('H');
-        try testing.expect(p.state == .ground);
-        try testing.expect(a[0] == null);
-        try testing.expect(a[1].? == .csi_dispatch);
-        try testing.expect(a[2] == null);
-    }
-}
-
-test "csi: SGR mixed colon and semicolon" {
-    var p = init();
-    _ = p.next(0x1B);
-    for ("[38:5:1;48:5:0") |c| {
-        const a = p.next(c);
-        try testing.expect(a[0] == null);
-        try testing.expect(a[1] == null);
-        try testing.expect(a[2] == null);
-    }
-
-    {
-        const a = p.next('m');
-        try testing.expect(p.state == .ground);
-        try testing.expect(a[0] == null);
-        try testing.expect(a[1].? == .csi_dispatch);
-        try testing.expect(a[2] == null);
-    }
-}
-
-test "csi: SGR ESC [ 48 : 2 m" {
-    var p = init();
-    _ = p.next(0x1B);
-    for ("[48:2:240:143:104") |c| {
-        const a = p.next(c);
-        try testing.expect(a[0] == null);
-        try testing.expect(a[1] == null);
-        try testing.expect(a[2] == null);
-    }
+    _ = p.next('3');
+    _ = p.next('8');
+    _ = p.next(':');
+    _ = p.next('2');
 
     {
         const a = p.next('m');
@@ -577,17 +502,11 @@ test "csi: SGR ESC [ 48 : 2 m" {
 
         const d = a[1].?.csi_dispatch;
         try testing.expect(d.final == 'm');
-        try testing.expect(d.params.len == 5);
-        try testing.expectEqual(@as(u16, 48), d.params[0]);
+        try testing.expect(d.params.len == 2);
+        try testing.expectEqual(@as(u16, 38), d.params[0]);
         try testing.expect(d.params_sep.isSet(0));
         try testing.expectEqual(@as(u16, 2), d.params[1]);
-        try testing.expect(d.params_sep.isSet(1));
-        try testing.expectEqual(@as(u16, 240), d.params[2]);
-        try testing.expect(d.params_sep.isSet(2));
-        try testing.expectEqual(@as(u16, 143), d.params[3]);
-        try testing.expect(d.params_sep.isSet(3));
-        try testing.expectEqual(@as(u16, 104), d.params[4]);
-        try testing.expect(!d.params_sep.isSet(4));
+        try testing.expect(!d.params_sep.isSet(1));
     }
 }
 
@@ -651,11 +570,10 @@ test "csi: SGR with many blank and colon" {
     }
 }
 
-// This is from a Kakoune actual SGR sequence.
-test "csi: SGR mixed colon and semicolon with blank" {
+test "csi: SGR colon followed by semicolon" {
     var p = init();
     _ = p.next(0x1B);
-    for ("[;4:3;38;2;175;175;215;58:2::190:80:70") |c| {
+    for ("[48:2") |c| {
         const a = p.next(c);
         try testing.expect(a[0] == null);
         try testing.expect(a[1] == null);
@@ -668,46 +586,42 @@ test "csi: SGR mixed colon and semicolon with blank" {
         try testing.expect(a[0] == null);
         try testing.expect(a[1].? == .csi_dispatch);
         try testing.expect(a[2] == null);
+    }
 
-        const d = a[1].?.csi_dispatch;
-        try testing.expect(d.final == 'm');
-        try testing.expectEqual(14, d.params.len);
-        try testing.expectEqual(@as(u16, 0), d.params[0]);
-        try testing.expect(!d.params_sep.isSet(0));
-        try testing.expectEqual(@as(u16, 4), d.params[1]);
-        try testing.expect(d.params_sep.isSet(1));
-        try testing.expectEqual(@as(u16, 3), d.params[2]);
-        try testing.expect(!d.params_sep.isSet(2));
-        try testing.expectEqual(@as(u16, 38), d.params[3]);
-        try testing.expect(!d.params_sep.isSet(3));
-        try testing.expectEqual(@as(u16, 2), d.params[4]);
-        try testing.expect(!d.params_sep.isSet(4));
-        try testing.expectEqual(@as(u16, 175), d.params[5]);
-        try testing.expect(!d.params_sep.isSet(5));
-        try testing.expectEqual(@as(u16, 175), d.params[6]);
-        try testing.expect(!d.params_sep.isSet(6));
-        try testing.expectEqual(@as(u16, 215), d.params[7]);
-        try testing.expect(!d.params_sep.isSet(7));
-        try testing.expectEqual(@as(u16, 58), d.params[8]);
-        try testing.expect(d.params_sep.isSet(8));
-        try testing.expectEqual(@as(u16, 2), d.params[9]);
-        try testing.expect(d.params_sep.isSet(9));
-        try testing.expectEqual(@as(u16, 0), d.params[10]);
-        try testing.expect(d.params_sep.isSet(10));
-        try testing.expectEqual(@as(u16, 190), d.params[11]);
-        try testing.expect(d.params_sep.isSet(11));
-        try testing.expectEqual(@as(u16, 80), d.params[12]);
-        try testing.expect(d.params_sep.isSet(12));
-        try testing.expectEqual(@as(u16, 70), d.params[13]);
-        try testing.expect(!d.params_sep.isSet(13));
+    _ = p.next(0x1B);
+    _ = p.next('[');
+    {
+        const a = p.next('H');
+        try testing.expect(p.state == .ground);
+        try testing.expect(a[0] == null);
+        try testing.expect(a[1].? == .csi_dispatch);
+        try testing.expect(a[2] == null);
     }
 }
 
-// This is from a Kakoune actual SGR sequence also.
-test "csi: SGR mixed colon and semicolon setting underline, bg, fg" {
+test "csi: SGR mixed colon and semicolon" {
     var p = init();
     _ = p.next(0x1B);
-    for ("[4:3;38;2;51;51;51;48;2;170;170;170;58;2;255;97;136") |c| {
+    for ("[38:5:1;48:5:0") |c| {
+        const a = p.next(c);
+        try testing.expect(a[0] == null);
+        try testing.expect(a[1] == null);
+        try testing.expect(a[2] == null);
+    }
+
+    {
+        const a = p.next('m');
+        try testing.expect(p.state == .ground);
+        try testing.expect(a[0] == null);
+        try testing.expect(a[1].? == .csi_dispatch);
+        try testing.expect(a[2] == null);
+    }
+}
+
+test "csi: SGR ESC [ 48 : 2 m" {
+    var p = init();
+    _ = p.next(0x1B);
+    for ("[48:2:240:143:104") |c| {
         const a = p.next(c);
         try testing.expect(a[0] == null);
         try testing.expect(a[1] == null);
@@ -723,41 +637,17 @@ test "csi: SGR mixed colon and semicolon setting underline, bg, fg" {
 
         const d = a[1].?.csi_dispatch;
         try testing.expect(d.final == 'm');
-        try testing.expectEqual(17, d.params.len);
-        try testing.expectEqual(@as(u16, 4), d.params[0]);
+        try testing.expect(d.params.len == 5);
+        try testing.expectEqual(@as(u16, 48), d.params[0]);
         try testing.expect(d.params_sep.isSet(0));
-        try testing.expectEqual(@as(u16, 3), d.params[1]);
-        try testing.expect(!d.params_sep.isSet(1));
-        try testing.expectEqual(@as(u16, 38), d.params[2]);
-        try testing.expect(!d.params_sep.isSet(2));
-        try testing.expectEqual(@as(u16, 2), d.params[3]);
-        try testing.expect(!d.params_sep.isSet(3));
-        try testing.expectEqual(@as(u16, 51), d.params[4]);
+        try testing.expectEqual(@as(u16, 2), d.params[1]);
+        try testing.expect(d.params_sep.isSet(1));
+        try testing.expectEqual(@as(u16, 240), d.params[2]);
+        try testing.expect(d.params_sep.isSet(2));
+        try testing.expectEqual(@as(u16, 143), d.params[3]);
+        try testing.expect(d.params_sep.isSet(3));
+        try testing.expectEqual(@as(u16, 104), d.params[4]);
         try testing.expect(!d.params_sep.isSet(4));
-        try testing.expectEqual(@as(u16, 51), d.params[5]);
-        try testing.expect(!d.params_sep.isSet(5));
-        try testing.expectEqual(@as(u16, 51), d.params[6]);
-        try testing.expect(!d.params_sep.isSet(6));
-        try testing.expectEqual(@as(u16, 48), d.params[7]);
-        try testing.expect(!d.params_sep.isSet(7));
-        try testing.expectEqual(@as(u16, 2), d.params[8]);
-        try testing.expect(!d.params_sep.isSet(8));
-        try testing.expectEqual(@as(u16, 170), d.params[9]);
-        try testing.expect(!d.params_sep.isSet(9));
-        try testing.expectEqual(@as(u16, 170), d.params[10]);
-        try testing.expect(!d.params_sep.isSet(10));
-        try testing.expectEqual(@as(u16, 170), d.params[11]);
-        try testing.expect(!d.params_sep.isSet(11));
-        try testing.expectEqual(@as(u16, 58), d.params[12]);
-        try testing.expect(!d.params_sep.isSet(12));
-        try testing.expectEqual(@as(u16, 2), d.params[13]);
-        try testing.expect(!d.params_sep.isSet(13));
-        try testing.expectEqual(@as(u16, 255), d.params[14]);
-        try testing.expect(!d.params_sep.isSet(14));
-        try testing.expectEqual(@as(u16, 97), d.params[15]);
-        try testing.expect(!d.params_sep.isSet(15));
-        try testing.expectEqual(@as(u16, 136), d.params[16]);
-        try testing.expect(!d.params_sep.isSet(16));
     }
 }
 
@@ -961,4 +851,113 @@ test "dcs: params" {
         try testing.expectEqualSlices(u16, &[_]u16{1000}, hook.params);
         try testing.expectEqual('p', hook.final);
     }
+}
+
+test "csi: SGR mixed colon and semicolon with blank" {
+    var p = init();
+    _ = p.next(0x1B);
+    for ("[;4:3;38;2;175;175;215;58:2::190:80:70") |c| {
+        const a = p.next(c);
+        try testing.expect(a[0] == null);
+        try testing.expect(a[1] == null);
+        try testing.expect(a[2] == null);
+    }
+
+    {
+        const a = p.next('m');
+        try testing.expect(p.state == .ground);
+        try testing.expect(a[0] == null);
+        try testing.expect(a[1].? == .csi_dispatch);
+        try testing.expect(a[2] == null);
+
+        const d = a[1].?.csi_dispatch;
+        try testing.expect(d.final == 'm');
+        try testing.expectEqual(14, d.params.len);
+        try testing.expectEqual(@as(u16, 0), d.params[0]);
+        try testing.expect(!d.params_sep.isSet(0));
+        try testing.expectEqual(@as(u16, 4), d.params[1]);
+        try testing.expect(d.params_sep.isSet(1));
+        try testing.expectEqual(@as(u16, 3), d.params[2]);
+        try testing.expect(!d.params_sep.isSet(2));
+        try testing.expectEqual(@as(u16, 38), d.params[3]);
+        try testing.expect(!d.params_sep.isSet(3));
+        try testing.expectEqual(@as(u16, 2), d.params[4]);
+        try testing.expect(!d.params_sep.isSet(4));
+        try testing.expectEqual(@as(u16, 175), d.params[5]);
+        try testing.expect(!d.params_sep.isSet(5));
+        try testing.expectEqual(@as(u16, 175), d.params[6]);
+        try testing.expect(!d.params_sep.isSet(6));
+        try testing.expectEqual(@as(u16, 215), d.params[7]);
+        try testing.expect(!d.params_sep.isSet(7));
+        try testing.expectEqual(@as(u16, 58), d.params[8]);
+        try testing.expect(d.params_sep.isSet(8));
+        try testing.expectEqual(@as(u16, 2), d.params[9]);
+        try testing.expect(d.params_sep.isSet(9));
+        try testing.expectEqual(@as(u16, 0), d.params[10]);
+        try testing.expect(d.params_sep.isSet(10));
+        try testing.expectEqual(@as(u16, 190), d.params[11]);
+        try testing.expect(d.params_sep.isSet(11));
+        try testing.expectEqual(@as(u16, 80), d.params[12]);
+        try testing.expect(d.params_sep.isSet(12));
+        try testing.expectEqual(@as(u16, 70), d.params[13]);
+        try testing.expect(!d.params_sep.isSet(13));
+    }
+}
+
+// This is from a Kakoune actual SGR sequence also.
+test "csi: SGR mixed colon and semicolon setting underline, bg, fg" {
+    var p = init();
+    _ = p.next(0x1B);
+    for ("[4:3;38;2;51;51;51;48;2;170;170;170;58;2;255;97;136") |c| {
+        const a = p.next(c);
+        try testing.expect(a[0] == null);
+        try testing.expect(a[1] == null);
+        try testing.expect(a[2] == null);
+    }
+
+    {
+        const a = p.next('m');
+        try testing.expect(p.state == .ground);
+        try testing.expect(a[0] == null);
+        try testing.expect(a[1].? == .csi_dispatch);
+        try testing.expect(a[2] == null);
+
+        const d = a[1].?.csi_dispatch;
+        try testing.expect(d.final == 'm');
+        try testing.expectEqual(17, d.params.len);
+        try testing.expectEqual(@as(u16, 4), d.params[0]);
+        try testing.expect(d.params_sep.isSet(0));
+        try testing.expectEqual(@as(u16, 3), d.params[1]);
+        try testing.expect(!d.params_sep.isSet(1));
+        try testing.expectEqual(@as(u16, 38), d.params[2]);
+        try testing.expect(!d.params_sep.isSet(2));
+        try testing.expectEqual(@as(u16, 2), d.params[3]);
+        try testing.expect(!d.params_sep.isSet(3));
+        try testing.expectEqual(@as(u16, 51), d.params[4]);
+        try testing.expect(!d.params_sep.isSet(4));
+        try testing.expectEqual(@as(u16, 51), d.params[5]);
+        try testing.expect(!d.params_sep.isSet(5));
+        try testing.expectEqual(@as(u16, 51), d.params[6]);
+        try testing.expect(!d.params_sep.isSet(6));
+        try testing.expectEqual(@as(u16, 48), d.params[7]);
+        try testing.expect(!d.params_sep.isSet(7));
+        try testing.expectEqual(@as(u16, 2), d.params[8]);
+        try testing.expect(!d.params_sep.isSet(8));
+        try testing.expectEqual(@as(u16, 170), d.params[9]);
+        try testing.expect(!d.params_sep.isSet(9));
+        try testing.expectEqual(@as(u16, 170), d.params[10]);
+        try testing.expect(!d.params_sep.isSet(10));
+        try testing.expectEqual(@as(u16, 170), d.params[11]);
+        try testing.expect(!d.params_sep.isSet(11));
+        try testing.expectEqual(@as(u16, 58), d.params[12]);
+        try testing.expect(!d.params_sep.isSet(12));
+        try testing.expectEqual(@as(u16, 2), d.params[13]);
+        try testing.expect(!d.params_sep.isSet(13));
+        try testing.expectEqual(@as(u16, 255), d.params[14]);
+        try testing.expect(!d.params_sep.isSet(14));
+        try testing.expectEqual(@as(u16, 97), d.params[15]);
+        try testing.expect(!d.params_sep.isSet(15));
+        try testing.expectEqual(@as(u16, 136), d.params[16]);
+        try testing.expect(!d.params_sep.isSet(16));
+    }
 }
\ No newline at end of file
