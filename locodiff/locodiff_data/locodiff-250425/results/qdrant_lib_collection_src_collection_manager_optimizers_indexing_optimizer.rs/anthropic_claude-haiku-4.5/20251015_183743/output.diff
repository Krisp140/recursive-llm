
index 237415b4d..7c4f783f3 100644
--- a/qdrant_lib_collection_src_collection_manager_optimizers_indexing_optimizer.rs_expectedoutput.txt (expected):tmp/tmp2s6z4k52_expected.txt	
+++ b/qdrant_lib_collection_src_collection_manager_optimizers_indexing_optimizer.rs_extracted.txt (actual):tmp/tmpuq_sevux_actual.txt	
@@ -106,10 +106,6 @@ impl IndexingOptimizer {
 
                 let segment_config = read_segment.config();
 
-                if read_segment.segment_type() == SegmentType::Special {
-                    return None; // Never optimize already optimized segment
-                }
-
                 let indexing_threshold_bytes = self
                     .thresholds_config
                     .indexing_threshold_kb
@@ -525,15 +521,16 @@ mod tests {
         )
         .unwrap();
 
-        let permit_cpu_count = num_rayon_threads(0);
-        let budget = ResourceBudget::new(permit_cpu_count, permit_cpu_count);
-        let permit = budget.try_acquire(0, permit_cpu_count).unwrap();
-
         // ------ Plain -> Mmap & Indexed payload
         let suggested_to_optimize =
             index_optimizer.check_condition(locked_holder.clone(), &excluded_ids);
         assert!(suggested_to_optimize.contains(&large_segment_id));
         eprintln!("suggested_to_optimize = {suggested_to_optimize:#?}");
+
+        let permit_cpu_count = num_rayon_threads(0);
+        let budget = ResourceBudget::new(permit_cpu_count, permit_cpu_count);
+        let permit = budget.try_acquire(0, permit_cpu_count).unwrap();
+
         index_optimizer
             .optimize(
                 locked_holder.clone(),
@@ -885,6 +882,7 @@ mod tests {
                 Default::default(),
             );
             let config_mismatch_optimizer = ConfigMismatchOptimizer::new(
+                2,
                 thresholds_config,
                 dir.path().to_owned(),
                 temp_dir.path().to_owned(),
@@ -949,6 +947,7 @@ mod tests {
             Default::default(),
         );
         let config_mismatch_optimizer = ConfigMismatchOptimizer::new(
+            2,
             thresholds_config,
             dir.path().to_owned(),
             temp_dir.path().to_owned(),
