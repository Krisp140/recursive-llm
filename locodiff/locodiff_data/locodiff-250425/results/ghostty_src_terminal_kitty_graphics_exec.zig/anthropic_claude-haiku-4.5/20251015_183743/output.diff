
index ac4e9bf25..ac97416f4 100644
--- a/ghostty_src_terminal_kitty_graphics_exec.zig_expectedoutput.txt (expected):tmp/tmptyeofava_expected.txt	
+++ b/ghostty_src_terminal_kitty_graphics_exec.zig_extracted.txt (actual):tmp/tmp9tz5507n_actual.txt	
@@ -91,6 +91,7 @@ pub fn execute(
 
     return null;
 }
+
 /// Execute a "query" command.
 ///
 /// This command is used to attempt to load an image and respond with
@@ -359,7 +360,6 @@ fn loadAndAddImage(
     // Validate and store our image
     var img = try loading.complete(alloc);
     errdefer img.deinit(alloc);
-    try storage.addImage(alloc, img);
 
     // Get our display settings
     const display_ = loading.display;
@@ -368,6 +368,8 @@ fn loadAndAddImage(
     // won't be deinit because of "complete" above.
     loading.deinit(alloc);
 
+    try storage.addImage(alloc, img);
+
     return .{ .image = img, .display = display_ };
 }
 
