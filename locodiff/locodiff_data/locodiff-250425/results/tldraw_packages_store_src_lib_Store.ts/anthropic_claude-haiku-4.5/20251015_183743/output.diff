
index 489e95479..8f3d3551e 100644
--- a/tldraw_packages_store_src_lib_Store.ts_expectedoutput.txt (expected):tmp/tmp6yuio555_expected.txt	
+++ b/tldraw_packages_store_src_lib_Store.ts_extracted.txt (actual):tmp/tmps122gvqp_actual.txt	
@@ -280,10 +280,6 @@ export class Store<R extends UnknownRecord = UnknownRecord, Props = unknown> {
 		}
 	}
 
-	dispose() {
-		this.cancelHistoryReactor()
-	}
-
 	/**
 	 * Filters out non-document changes from a diff. Returns null if there are no changes left.
 	 * @param change - the records diff
@@ -326,6 +322,10 @@ export class Store<R extends UnknownRecord = UnknownRecord, Props = unknown> {
 		this.allRecords().forEach((record) => this.schema.validateRecord(this, record, phase, null))
 	}
 
+	dispose() {
+		this.cancelHistoryReactor()
+	}
+
 	/**
 	 * Add some records to the store. It's an error if they already exist.
 	 *
@@ -482,6 +482,20 @@ export class Store<R extends UnknownRecord = UnknownRecord, Props = unknown> {
 		return result
 	}
 
+	/**
+	 * Opposite of `serialize`. Replace the store's current records with records as defined by a
+	 * simple JSON structure into the stores.
+	 *
+	 * @param snapshot - The JSON snapshot to deserialize.
+	 * @public
+	 */
+	deserialize = (snapshot: SerializedStore<R>): void => {
+		transact(() => {
+			this.clear()
+			this.put(Object.values(snapshot))
+		})
+	}
+
 	/**
 	 * Get a serialized snapshot of the store and its schema.
 	 *
@@ -515,7 +529,7 @@ export class Store<R extends UnknownRecord = UnknownRecord, Props = unknown> {
 	 * Migrate a serialized snapshot of the store and its schema.
 	 *
 	 * ```ts
-	 * const snapshot = store.getSnapshot()
+	 * const snapshot = store.getStoreSnapshot()
 	 * store.migrateSnapshot(snapshot)
 	 * ```
 	 *
@@ -908,6 +922,64 @@ export class Store<R extends UnknownRecord = UnknownRecord, Props = unknown> {
 	}
 }
 
+/**
+ * Squash a collection of diffs into a single diff.
+ *
+ * @param diffs - An array of diffs to squash.
+ * @returns A single diff that represents the squashed diffs.
+ * @public
+ */
+export function squashRecordDiffs<T extends UnknownRecord>(
+	diffs: RecordsDiff<T>[]
+): RecordsDiff<T> {
+	const result = { added: {}, removed: {}, updated: {} } as RecordsDiff<T>
+
+	for (const diff of diffs) {
+		for (const [id, value] of objectMapEntries(diff.added)) {
+			if (result.removed[id]) {
+				const original = result.removed[id]
+				delete result.removed[id]
+				if (original !== value) {
+					result.updated[id] = [original, value]
+				}
+			} else {
+				result.added[id] = value
+			}
+		}
+
+		for (const [id, [_from, to]] of objectMapEntries(diff.updated)) {
+			if (result.added[id]) {
+				result.added[id] = to
+				delete result.updated[id]
+				delete result.removed[id]
+				continue
+			}
+			if (result.updated[id]) {
+				result.updated[id] = [result.updated[id][0], to]
+				delete result.removed[id]
+				continue
+			}
+
+			result.updated[id] = diff.updated[id]
+			delete result.removed[id]
+		}
+
+		for (const [id, value] of objectMapEntries(diff.removed)) {
+			// the same record was added in this diff sequence, just drop it
+			if (result.added[id]) {
+				delete result.added[id]
+			} else if (result.updated[id]) {
+				result.removed[id] = result.updated[id][0]
+				delete result.updated[id]
+			} else {
+				result.removed[id] = value
+			}
+		}
+	}
+
+	return result
+}
+
 /**
  * Collect all history entries by their adjacent sources.
  * For example, [user, user, remote, remote, user] would result in [user, remote, user],
